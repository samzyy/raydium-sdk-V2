var Zn=Object.defineProperty,Jn=Object.defineProperties;var Qn=Object.getOwnPropertyDescriptors;var lt=Object.getOwnPropertySymbols;var Vr=Object.prototype.hasOwnProperty,Nr=Object.prototype.propertyIsEnumerable;var vr=(e,t,r)=>t in e?Zn(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,J=(e,t)=>{for(var r in t||(t={}))Vr.call(t,r)&&vr(e,r,t[r]);if(lt)for(var r of lt(t))Nr.call(t,r)&&vr(e,r,t[r]);return e},te=(e,t)=>Jn(e,Qn(t));var dt=(e,t)=>{var r={};for(var n in e)Vr.call(e,n)&&t.indexOf(n)<0&&(r[n]=e[n]);if(e!=null&&lt)for(var n of lt(e))t.indexOf(n)<0&&Nr.call(e,n)&&(r[n]=e[n]);return r};import{PublicKey as z,SystemProgram as ws}from"@solana/web3.js";import{createAssociatedTokenAccountIdempotentInstruction as Ts}from"@solana/spl-token";import{PublicKey as $n}from"@solana/web3.js";import{get as Er,set as Xn}from"lodash";var Ft=class{constructor(t){this.logLevel=t.logLevel!==void 0?t.logLevel:0,this.name=t.name}set level(t){this.logLevel=t}get time(){return Date.now().toString()}get moduleName(){return this.name}isLogLevel(t){return t<=this.logLevel}error(...t){return this.isLogLevel(0)?(console.error(this.time,this.name,"sdk logger error",...t),this):this}logWithError(...t){let r=t.map(n=>typeof n=="object"?JSON.stringify(n):n).join(", ");throw new Error(r)}warning(...t){return this.isLogLevel(1)?(console.warn(this.time,this.name,"sdk logger warning",...t),this):this}info(...t){return this.isLogLevel(2)?(console.info(this.time,this.name,"sdk logger info",...t),this):this}debug(...t){return this.isLogLevel(3)?(console.debug(this.time,this.name,"sdk logger debug",...t),this):this}},Fr={},Yn={};function $(e){let t=Er(Fr,e);if(!t){let r=Er(Yn,e);t=new Ft({name:e,logLevel:r}),Xn(Fr,e,t)}return t}import{MINT_SIZE as Ks,TOKEN_PROGRAM_ID as Ms,getTransferFeeConfig as vs,unpackMint as Vs}from"@solana/spl-token";var _t=$("Raydium_accountInfo_util");async function _r(e,t,r){let{batchRequest:n,commitment:o="confirmed",chunkCount:i=100}=J({batchRequest:!1},r),s=Dt(t,i),a=new Array(s.length).fill([]);if(n){let c=s.map(l=>{let f=e._buildArgs([l.map(p=>p.toBase58())],o,"base64");return{methodName:"getMultipleAccounts",args:f}}),u=Dt(c,10);a=(await(await Promise.all(u.map(async l=>await e._rpcBatchRequest(l)))).flat()).map(l=>(l.error&&_t.logWithError(`failed to get info for multiple accounts, RPC_ERROR, ${l.error.message}`),l.result.value.map(f=>{if(f){let{data:p,executable:m,lamports:g,owner:b,rentEpoch:x}=f;return p.length!==2&&p[1]!=="base64"&&_t.logWithError("info must be base64 encoded, RPC_ERROR"),{data:Buffer.from(p[0],"base64"),executable:m,lamports:g,owner:new $n(b),rentEpoch:x}}return null})))}else try{a=await Promise.all(s.map(c=>e.getMultipleAccountsInfo(c,o)))}catch(c){c instanceof Error&&_t.logWithError(`failed to get info for multiple accounts, RPC_ERROR, ${c.message}`)}return a.flat()}import ke from"bn.js";var Ue=9e15,Ce=1e9,Ot="0123456789abcdef",mt="2.3025850929940456840179914546843642076011014886287729760333279009675726096773524802359972050895982983419677840422862486334095254650828067566662873690987816894829072083255546808437998948262331985283935053089653777326288461633662222876982198867465436674744042432743651550489343149393914796194044002221051017141748003688084012647080685567743216228355220114804663715659121373450747856947683463616792101806445070648000277502684916746550586856935673420670581136429224554405758925724208241314695689016758940256776311356919292033376587141660230105703089634572075440370847469940168269282808481184289314848524948644871927809676271275775397027668605952496716674183485704422507197965004714951050492214776567636938662976979522110718264549734772662425709429322582798502585509785265383207606726317164309505995087807523710333101197857547331541421808427543863591778117054309827482385045648019095610299291824318237525357709750539565187697510374970888692180205189339507238539205144634197265287286965110862571492198849978748873771345686209167058",gt="3.1415926535897932384626433832795028841971693993751058209749445923078164062862089986280348253421170679821480865132823066470938446095505822317253594081284811174502841027019385211055596446229489549303819644288109756659334461284756482337867831652712019091456485669234603486104543266482133936072602491412737245870066063155881748815209209628292540917153643678925903600113305305488204665213841469519415116094330572703657595919530921861173819326117931051185480744623799627495673518857527248912279381830119491298336733624406566430860213949463952247371907021798609437027705392171762931767523846748184676694051320005681271452635608277857713427577896091736371787214684409012249534301465495853710507922796892589235420199561121290219608640344181598136297747713099605187072113499999983729780499510597317328160963185950244594553469083026425223082533446850352619311881710100031378387528865875332083814206171776691473035982534904287554687311595628638823537875937519577818577805321712268066130019278766111959092164201989380952572010654858632789",Wt={precision:20,rounding:4,modulo:1,toExpNeg:-7,toExpPos:21,minE:-Ue,maxE:Ue,crypto:!1},Ur,we,F=!0,ht="[DecimalError] ",Re=ht+"Invalid argument: ",qr=ht+"Precision limit exceeded",Gr=ht+"crypto unavailable",jr="[object Decimal]",ie=Math.floor,re=Math.pow,eo=/^0b([01]+(\.[01]*)?|\.[01]+)(p[+-]?\d+)?$/i,to=/^0x([0-9a-f]+(\.[0-9a-f]*)?|\.[0-9a-f]+)(p[+-]?\d+)?$/i,ro=/^0o([0-7]+(\.[0-7]*)?|\.[0-7]+)(p[+-]?\d+)?$/i,Hr=/^(\d+(\.\d*)?|\.\d+)(e[+-]?\d+)?$/i,de=1e7,v=7,no=9007199254740991,oo=mt.length-1,Ut=gt.length-1,h={toStringTag:jr};h.absoluteValue=h.abs=function(){var e=new this.constructor(this);return e.s<0&&(e.s=1),C(e)};h.ceil=function(){return C(new this.constructor(this),this.e+1,2)};h.clampedTo=h.clamp=function(e,t){var r,n=this,o=n.constructor;if(e=new o(e),t=new o(t),!e.s||!t.s)return new o(NaN);if(e.gt(t))throw Error(Re+t);return r=n.cmp(e),r<0?e:n.cmp(t)>0?t:new o(n)};h.comparedTo=h.cmp=function(e){var t,r,n,o,i=this,s=i.d,a=(e=new i.constructor(e)).d,c=i.s,u=e.s;if(!s||!a)return!c||!u?NaN:c!==u?c:s===a?0:!s^c<0?1:-1;if(!s[0]||!a[0])return s[0]?c:a[0]?-u:0;if(c!==u)return c;if(i.e!==e.e)return i.e>e.e^c<0?1:-1;for(n=s.length,o=a.length,t=0,r=n<o?n:o;t<r;++t)if(s[t]!==a[t])return s[t]>a[t]^c<0?1:-1;return n===o?0:n>o^c<0?1:-1};h.cosine=h.cos=function(){var e,t,r=this,n=r.constructor;return r.d?r.d[0]?(e=n.precision,t=n.rounding,n.precision=e+Math.max(r.e,r.sd())+v,n.rounding=1,r=io(n,Xr(n,r)),n.precision=e,n.rounding=t,C(we==2||we==3?r.neg():r,e,t,!0)):new n(1):new n(NaN)};h.cubeRoot=h.cbrt=function(){var e,t,r,n,o,i,s,a,c,u,d=this,l=d.constructor;if(!d.isFinite()||d.isZero())return new l(d);for(F=!1,i=d.s*re(d.s*d,1/3),!i||Math.abs(i)==1/0?(r=oe(d.d),e=d.e,(i=(e-r.length+1)%3)&&(r+=i==1||i==-2?"0":"00"),i=re(r,1/3),e=ie((e+1)/3)-(e%3==(e<0?-1:2)),i==1/0?r="5e"+e:(r=i.toExponential(),r=r.slice(0,r.indexOf("e")+1)+e),n=new l(r),n.s=d.s):n=new l(i.toString()),s=(e=l.precision)+3;;)if(a=n,c=a.times(a).times(a),u=c.plus(d),n=Z(u.plus(d).times(a),u.plus(c),s+2,1),oe(a.d).slice(0,s)===(r=oe(n.d)).slice(0,s))if(r=r.slice(s-3,s+1),r=="9999"||!o&&r=="4999"){if(!o&&(C(a,e+1,0),a.times(a).times(a).eq(d))){n=a;break}s+=4,o=1}else{(!+r||!+r.slice(1)&&r.charAt(0)=="5")&&(C(n,e+1,1),t=!n.times(n).times(n).eq(d));break}return F=!0,C(n,e,l.rounding,t)};h.decimalPlaces=h.dp=function(){var e,t=this.d,r=NaN;if(t){if(e=t.length-1,r=(e-ie(this.e/v))*v,e=t[e],e)for(;e%10==0;e/=10)r--;r<0&&(r=0)}return r};h.dividedBy=h.div=function(e){return Z(this,new this.constructor(e))};h.dividedToIntegerBy=h.divToInt=function(e){var t=this,r=t.constructor;return C(Z(t,new r(e),0,1,1),r.precision,r.rounding)};h.equals=h.eq=function(e){return this.cmp(e)===0};h.floor=function(){return C(new this.constructor(this),this.e+1,3)};h.greaterThan=h.gt=function(e){return this.cmp(e)>0};h.greaterThanOrEqualTo=h.gte=function(e){var t=this.cmp(e);return t==1||t===0};h.hyperbolicCosine=h.cosh=function(){var e,t,r,n,o,i=this,s=i.constructor,a=new s(1);if(!i.isFinite())return new s(i.s?1/0:NaN);if(i.isZero())return a;r=s.precision,n=s.rounding,s.precision=r+Math.max(i.e,i.sd())+4,s.rounding=1,o=i.d.length,o<32?(e=Math.ceil(o/3),t=(1/wt(4,e)).toString()):(e=16,t="2.3283064365386962890625e-10"),i=qe(s,1,i.times(t),new s(1),!0);for(var c,u=e,d=new s(8);u--;)c=i.times(i),i=a.minus(c.times(d.minus(c.times(d))));return C(i,s.precision=r,s.rounding=n,!0)};h.hyperbolicSine=h.sinh=function(){var e,t,r,n,o=this,i=o.constructor;if(!o.isFinite()||o.isZero())return new i(o);if(t=i.precision,r=i.rounding,i.precision=t+Math.max(o.e,o.sd())+4,i.rounding=1,n=o.d.length,n<3)o=qe(i,2,o,o,!0);else{e=1.4*Math.sqrt(n),e=e>16?16:e|0,o=o.times(1/wt(5,e)),o=qe(i,2,o,o,!0);for(var s,a=new i(5),c=new i(16),u=new i(20);e--;)s=o.times(o),o=o.times(a.plus(s.times(c.times(s).plus(u))))}return i.precision=t,i.rounding=r,C(o,t,r,!0)};h.hyperbolicTangent=h.tanh=function(){var e,t,r=this,n=r.constructor;return r.isFinite()?r.isZero()?new n(r):(e=n.precision,t=n.rounding,n.precision=e+7,n.rounding=1,Z(r.sinh(),r.cosh(),n.precision=e,n.rounding=t)):new n(r.s)};h.inverseCosine=h.acos=function(){var e,t=this,r=t.constructor,n=t.abs().cmp(1),o=r.precision,i=r.rounding;return n!==-1?n===0?t.isNeg()?le(r,o,i):new r(0):new r(NaN):t.isZero()?le(r,o+4,i).times(.5):(r.precision=o+6,r.rounding=1,t=t.asin(),e=le(r,o+4,i).times(.5),r.precision=o,r.rounding=i,e.minus(t))};h.inverseHyperbolicCosine=h.acosh=function(){var e,t,r=this,n=r.constructor;return r.lte(1)?new n(r.eq(1)?0:NaN):r.isFinite()?(e=n.precision,t=n.rounding,n.precision=e+Math.max(Math.abs(r.e),r.sd())+4,n.rounding=1,F=!1,r=r.times(r).minus(1).sqrt().plus(r),F=!0,n.precision=e,n.rounding=t,r.ln()):new n(r)};h.inverseHyperbolicSine=h.asinh=function(){var e,t,r=this,n=r.constructor;return!r.isFinite()||r.isZero()?new n(r):(e=n.precision,t=n.rounding,n.precision=e+2*Math.max(Math.abs(r.e),r.sd())+6,n.rounding=1,F=!1,r=r.times(r).plus(1).sqrt().plus(r),F=!0,n.precision=e,n.rounding=t,r.ln())};h.inverseHyperbolicTangent=h.atanh=function(){var e,t,r,n,o=this,i=o.constructor;return o.isFinite()?o.e>=0?new i(o.abs().eq(1)?o.s/0:o.isZero()?o:NaN):(e=i.precision,t=i.rounding,n=o.sd(),Math.max(n,e)<2*-o.e-1?C(new i(o),e,t,!0):(i.precision=r=n-o.e,o=Z(o.plus(1),new i(1).minus(o),r+e,1),i.precision=e+4,i.rounding=1,o=o.ln(),i.precision=e,i.rounding=t,o.times(.5))):new i(NaN)};h.inverseSine=h.asin=function(){var e,t,r,n,o=this,i=o.constructor;return o.isZero()?new i(o):(t=o.abs().cmp(1),r=i.precision,n=i.rounding,t!==-1?t===0?(e=le(i,r+4,n).times(.5),e.s=o.s,e):new i(NaN):(i.precision=r+6,i.rounding=1,o=o.div(new i(1).minus(o.times(o)).sqrt().plus(1)).atan(),i.precision=r,i.rounding=n,o.times(2)))};h.inverseTangent=h.atan=function(){var e,t,r,n,o,i,s,a,c,u=this,d=u.constructor,l=d.precision,f=d.rounding;if(u.isFinite()){if(u.isZero())return new d(u);if(u.abs().eq(1)&&l+4<=Ut)return s=le(d,l+4,f).times(.25),s.s=u.s,s}else{if(!u.s)return new d(NaN);if(l+4<=Ut)return s=le(d,l+4,f).times(.5),s.s=u.s,s}for(d.precision=a=l+10,d.rounding=1,r=Math.min(28,a/v+2|0),e=r;e;--e)u=u.div(u.times(u).plus(1).sqrt().plus(1));for(F=!1,t=Math.ceil(a/v),n=1,c=u.times(u),s=new d(u),o=u;e!==-1;)if(o=o.times(c),i=s.minus(o.div(n+=2)),o=o.times(c),s=i.plus(o.div(n+=2)),s.d[t]!==void 0)for(e=t;s.d[e]===i.d[e]&&e--;);return r&&(s=s.times(2<<r-1)),F=!0,C(s,d.precision=l,d.rounding=f,!0)};h.isFinite=function(){return!!this.d};h.isInteger=h.isInt=function(){return!!this.d&&ie(this.e/v)>this.d.length-2};h.isNaN=function(){return!this.s};h.isNegative=h.isNeg=function(){return this.s<0};h.isPositive=h.isPos=function(){return this.s>0};h.isZero=function(){return!!this.d&&this.d[0]===0};h.lessThan=h.lt=function(e){return this.cmp(e)<0};h.lessThanOrEqualTo=h.lte=function(e){return this.cmp(e)<1};h.logarithm=h.log=function(e){var t,r,n,o,i,s,a,c,u=this,d=u.constructor,l=d.precision,f=d.rounding,p=5;if(e==null)e=new d(10),t=!0;else{if(e=new d(e),r=e.d,e.s<0||!r||!r[0]||e.eq(1))return new d(NaN);t=e.eq(10)}if(r=u.d,u.s<0||!r||!r[0]||u.eq(1))return new d(r&&!r[0]?-1/0:u.s!=1?NaN:r?0:1/0);if(t)if(r.length>1)i=!0;else{for(o=r[0];o%10===0;)o/=10;i=o!==1}if(F=!1,a=l+p,s=Be(u,a),n=t?yt(d,a+10):Be(e,a),c=Z(s,n,a,1),Ze(c.d,o=l,f))do if(a+=10,s=Be(u,a),n=t?yt(d,a+10):Be(e,a),c=Z(s,n,a,1),!i){+oe(c.d).slice(o+1,o+15)+1==1e14&&(c=C(c,l+1,0));break}while(Ze(c.d,o+=10,f));return F=!0,C(c,l,f)};h.minus=h.sub=function(e){var t,r,n,o,i,s,a,c,u,d,l,f,p=this,m=p.constructor;if(e=new m(e),!p.d||!e.d)return!p.s||!e.s?e=new m(NaN):p.d?e.s=-e.s:e=new m(e.d||p.s!==e.s?p:NaN),e;if(p.s!=e.s)return e.s=-e.s,p.plus(e);if(u=p.d,f=e.d,a=m.precision,c=m.rounding,!u[0]||!f[0]){if(f[0])e.s=-e.s;else if(u[0])e=new m(p);else return new m(c===3?-0:0);return F?C(e,a,c):e}if(r=ie(e.e/v),d=ie(p.e/v),u=u.slice(),i=d-r,i){for(l=i<0,l?(t=u,i=-i,s=f.length):(t=f,r=d,s=u.length),n=Math.max(Math.ceil(a/v),s)+2,i>n&&(i=n,t.length=1),t.reverse(),n=i;n--;)t.push(0);t.reverse()}else{for(n=u.length,s=f.length,l=n<s,l&&(s=n),n=0;n<s;n++)if(u[n]!=f[n]){l=u[n]<f[n];break}i=0}for(l&&(t=u,u=f,f=t,e.s=-e.s),s=u.length,n=f.length-s;n>0;--n)u[s++]=0;for(n=f.length;n>i;){if(u[--n]<f[n]){for(o=n;o&&u[--o]===0;)u[o]=de-1;--u[o],u[n]+=de}u[n]-=f[n]}for(;u[--s]===0;)u.pop();for(;u[0]===0;u.shift())--r;return u[0]?(e.d=u,e.e=bt(u,r),F?C(e,a,c):e):new m(c===3?-0:0)};h.modulo=h.mod=function(e){var t,r=this,n=r.constructor;return e=new n(e),!r.d||!e.s||e.d&&!e.d[0]?new n(NaN):!e.d||r.d&&!r.d[0]?C(new n(r),n.precision,n.rounding):(F=!1,n.modulo==9?(t=Z(r,e.abs(),0,3,1),t.s*=e.s):t=Z(r,e,0,n.modulo,1),t=t.times(e),F=!0,r.minus(t))};h.naturalExponential=h.exp=function(){return qt(this)};h.naturalLogarithm=h.ln=function(){return Be(this)};h.negated=h.neg=function(){var e=new this.constructor(this);return e.s=-e.s,C(e)};h.plus=h.add=function(e){var t,r,n,o,i,s,a,c,u,d,l=this,f=l.constructor;if(e=new f(e),!l.d||!e.d)return!l.s||!e.s?e=new f(NaN):l.d||(e=new f(e.d||l.s===e.s?l:NaN)),e;if(l.s!=e.s)return e.s=-e.s,l.minus(e);if(u=l.d,d=e.d,a=f.precision,c=f.rounding,!u[0]||!d[0])return d[0]||(e=new f(l)),F?C(e,a,c):e;if(i=ie(l.e/v),n=ie(e.e/v),u=u.slice(),o=i-n,o){for(o<0?(r=u,o=-o,s=d.length):(r=d,n=i,s=u.length),i=Math.ceil(a/v),s=i>s?i+1:s+1,o>s&&(o=s,r.length=1),r.reverse();o--;)r.push(0);r.reverse()}for(s=u.length,o=d.length,s-o<0&&(o=s,r=d,d=u,u=r),t=0;o;)t=(u[--o]=u[o]+d[o]+t)/de|0,u[o]%=de;for(t&&(u.unshift(t),++n),s=u.length;u[--s]==0;)u.pop();return e.d=u,e.e=bt(u,n),F?C(e,a,c):e};h.precision=h.sd=function(e){var t,r=this;if(e!==void 0&&e!==!!e&&e!==1&&e!==0)throw Error(Re+e);return r.d?(t=zr(r.d),e&&r.e+1>t&&(t=r.e+1)):t=NaN,t};h.round=function(){var e=this,t=e.constructor;return C(new t(e),e.e+1,t.rounding)};h.sine=h.sin=function(){var e,t,r=this,n=r.constructor;return r.isFinite()?r.isZero()?new n(r):(e=n.precision,t=n.rounding,n.precision=e+Math.max(r.e,r.sd())+v,n.rounding=1,r=ao(n,Xr(n,r)),n.precision=e,n.rounding=t,C(we>2?r.neg():r,e,t,!0)):new n(NaN)};h.squareRoot=h.sqrt=function(){var e,t,r,n,o,i,s=this,a=s.d,c=s.e,u=s.s,d=s.constructor;if(u!==1||!a||!a[0])return new d(!u||u<0&&(!a||a[0])?NaN:a?s:1/0);for(F=!1,u=Math.sqrt(+s),u==0||u==1/0?(t=oe(a),(t.length+c)%2==0&&(t+="0"),u=Math.sqrt(t),c=ie((c+1)/2)-(c<0||c%2),u==1/0?t="5e"+c:(t=u.toExponential(),t=t.slice(0,t.indexOf("e")+1)+c),n=new d(t)):n=new d(u.toString()),r=(c=d.precision)+3;;)if(i=n,n=i.plus(Z(s,i,r+2,1)).times(.5),oe(i.d).slice(0,r)===(t=oe(n.d)).slice(0,r))if(t=t.slice(r-3,r+1),t=="9999"||!o&&t=="4999"){if(!o&&(C(i,c+1,0),i.times(i).eq(s))){n=i;break}r+=4,o=1}else{(!+t||!+t.slice(1)&&t.charAt(0)=="5")&&(C(n,c+1,1),e=!n.times(n).eq(s));break}return F=!0,C(n,c,d.rounding,e)};h.tangent=h.tan=function(){var e,t,r=this,n=r.constructor;return r.isFinite()?r.isZero()?new n(r):(e=n.precision,t=n.rounding,n.precision=e+10,n.rounding=1,r=r.sin(),r.s=1,r=Z(r,new n(1).minus(r.times(r)).sqrt(),e+10,0),n.precision=e,n.rounding=t,C(we==2||we==4?r.neg():r,e,t,!0)):new n(NaN)};h.times=h.mul=function(e){var t,r,n,o,i,s,a,c,u,d=this,l=d.constructor,f=d.d,p=(e=new l(e)).d;if(e.s*=d.s,!f||!f[0]||!p||!p[0])return new l(!e.s||f&&!f[0]&&!p||p&&!p[0]&&!f?NaN:!f||!p?e.s/0:e.s*0);for(r=ie(d.e/v)+ie(e.e/v),c=f.length,u=p.length,c<u&&(i=f,f=p,p=i,s=c,c=u,u=s),i=[],s=c+u,n=s;n--;)i.push(0);for(n=u;--n>=0;){for(t=0,o=c+n;o>n;)a=i[o]+p[n]*f[o-n-1]+t,i[o--]=a%de|0,t=a/de|0;i[o]=(i[o]+t)%de|0}for(;!i[--s];)i.pop();return t?++r:i.shift(),e.d=i,e.e=bt(i,r),F?C(e,l.precision,l.rounding):e};h.toBinary=function(e,t){return jt(this,2,e,t)};h.toDecimalPlaces=h.toDP=function(e,t){var r=this,n=r.constructor;return r=new n(r),e===void 0?r:(ae(e,0,Ce),t===void 0?t=n.rounding:ae(t,0,8),C(r,e+r.e+1,t))};h.toExponential=function(e,t){var r,n=this,o=n.constructor;return e===void 0?r=pe(n,!0):(ae(e,0,Ce),t===void 0?t=o.rounding:ae(t,0,8),n=C(new o(n),e+1,t),r=pe(n,!0,e+1)),n.isNeg()&&!n.isZero()?"-"+r:r};h.toFixed=function(e,t){var r,n,o=this,i=o.constructor;return e===void 0?r=pe(o):(ae(e,0,Ce),t===void 0?t=i.rounding:ae(t,0,8),n=C(new i(o),e+o.e+1,t),r=pe(n,!1,e+n.e+1)),o.isNeg()&&!o.isZero()?"-"+r:r};h.toFraction=function(e){var t,r,n,o,i,s,a,c,u,d,l,f,p=this,m=p.d,g=p.constructor;if(!m)return new g(p);if(u=r=new g(1),n=c=new g(0),t=new g(n),i=t.e=zr(m)-p.e-1,s=i%v,t.d[0]=re(10,s<0?v+s:s),e==null)e=i>0?t:u;else{if(a=new g(e),!a.isInt()||a.lt(u))throw Error(Re+a);e=a.gt(t)?i>0?t:u:a}for(F=!1,a=new g(oe(m)),d=g.precision,g.precision=i=m.length*v*2;l=Z(a,t,0,1,1),o=r.plus(l.times(n)),o.cmp(e)!=1;)r=n,n=o,o=u,u=c.plus(l.times(o)),c=o,o=t,t=a.minus(l.times(o)),a=o;return o=Z(e.minus(r),n,0,1,1),c=c.plus(o.times(u)),r=r.plus(o.times(n)),c.s=u.s=p.s,f=Z(u,n,i,1).minus(p).abs().cmp(Z(c,r,i,1).minus(p).abs())<1?[u,n]:[c,r],g.precision=d,F=!0,f};h.toHexadecimal=h.toHex=function(e,t){return jt(this,16,e,t)};h.toNearest=function(e,t){var r=this,n=r.constructor;if(r=new n(r),e==null){if(!r.d)return r;e=new n(1),t=n.rounding}else{if(e=new n(e),t===void 0?t=n.rounding:ae(t,0,8),!r.d)return e.s?r:e;if(!e.d)return e.s&&(e.s=r.s),e}return e.d[0]?(F=!1,r=Z(r,e,0,t,1).times(e),F=!0,C(r)):(e.s=r.s,r=e),r};h.toNumber=function(){return+this};h.toOctal=function(e,t){return jt(this,8,e,t)};h.toPower=h.pow=function(e){var t,r,n,o,i,s,a=this,c=a.constructor,u=+(e=new c(e));if(!a.d||!e.d||!a.d[0]||!e.d[0])return new c(re(+a,u));if(a=new c(a),a.eq(1))return a;if(n=c.precision,i=c.rounding,e.eq(1))return C(a,n,i);if(t=ie(e.e/v),t>=e.d.length-1&&(r=u<0?-u:u)<=no)return o=Zr(c,a,r,n),e.s<0?new c(1).div(o):C(o,n,i);if(s=a.s,s<0){if(t<e.d.length-1)return new c(NaN);if((e.d[t]&1)==0&&(s=1),a.e==0&&a.d[0]==1&&a.d.length==1)return a.s=s,a}return r=re(+a,u),t=r==0||!isFinite(r)?ie(u*(Math.log("0."+oe(a.d))/Math.LN10+a.e+1)):new c(r+"").e,t>c.maxE+1||t<c.minE-1?new c(t>0?s/0:0):(F=!1,c.rounding=a.s=1,r=Math.min(12,(t+"").length),o=qt(e.times(Be(a,n+r)),n),o.d&&(o=C(o,n+5,1),Ze(o.d,n,i)&&(t=n+10,o=C(qt(e.times(Be(a,t+r)),t),t+5,1),+oe(o.d).slice(n+1,n+15)+1==1e14&&(o=C(o,n+1,0)))),o.s=s,F=!0,c.rounding=i,C(o,n,i))};h.toPrecision=function(e,t){var r,n=this,o=n.constructor;return e===void 0?r=pe(n,n.e<=o.toExpNeg||n.e>=o.toExpPos):(ae(e,1,Ce),t===void 0?t=o.rounding:ae(t,0,8),n=C(new o(n),e,t),r=pe(n,e<=n.e||n.e<=o.toExpNeg,e)),n.isNeg()&&!n.isZero()?"-"+r:r};h.toSignificantDigits=h.toSD=function(e,t){var r=this,n=r.constructor;return e===void 0?(e=n.precision,t=n.rounding):(ae(e,1,Ce),t===void 0?t=n.rounding:ae(t,0,8)),C(new n(r),e,t)};h.toString=function(){var e=this,t=e.constructor,r=pe(e,e.e<=t.toExpNeg||e.e>=t.toExpPos);return e.isNeg()&&!e.isZero()?"-"+r:r};h.truncated=h.trunc=function(){return C(new this.constructor(this),this.e+1,1)};h.valueOf=h.toJSON=function(){var e=this,t=e.constructor,r=pe(e,e.e<=t.toExpNeg||e.e>=t.toExpPos);return e.isNeg()?"-"+r:r};function oe(e){var t,r,n,o=e.length-1,i="",s=e[0];if(o>0){for(i+=s,t=1;t<o;t++)n=e[t]+"",r=v-n.length,r&&(i+=Le(r)),i+=n;s=e[t],n=s+"",r=v-n.length,r&&(i+=Le(r))}else if(s===0)return"0";for(;s%10===0;)s/=10;return i+s}function ae(e,t,r){if(e!==~~e||e<t||e>r)throw Error(Re+e)}function Ze(e,t,r,n){var o,i,s,a;for(i=e[0];i>=10;i/=10)--t;return--t<0?(t+=v,o=0):(o=Math.ceil((t+1)/v),t%=v),i=re(10,v-t),a=e[o]%i|0,n==null?t<3?(t==0?a=a/100|0:t==1&&(a=a/10|0),s=r<4&&a==99999||r>3&&a==49999||a==5e4||a==0):s=(r<4&&a+1==i||r>3&&a+1==i/2)&&(e[o+1]/i/100|0)==re(10,t-2)-1||(a==i/2||a==0)&&(e[o+1]/i/100|0)==0:t<4?(t==0?a=a/1e3|0:t==1?a=a/100|0:t==2&&(a=a/10|0),s=(n||r<4)&&a==9999||!n&&r>3&&a==4999):s=((n||r<4)&&a+1==i||!n&&r>3&&a+1==i/2)&&(e[o+1]/i/1e3|0)==re(10,t-3)-1,s}function pt(e,t,r){for(var n,o=[0],i,s=0,a=e.length;s<a;){for(i=o.length;i--;)o[i]*=t;for(o[0]+=Ot.indexOf(e.charAt(s++)),n=0;n<o.length;n++)o[n]>r-1&&(o[n+1]===void 0&&(o[n+1]=0),o[n+1]+=o[n]/r|0,o[n]%=r)}return o.reverse()}function io(e,t){var r,n,o;if(t.isZero())return t;n=t.d.length,n<32?(r=Math.ceil(n/3),o=(1/wt(4,r)).toString()):(r=16,o="2.3283064365386962890625e-10"),e.precision+=r,t=qe(e,1,t.times(o),new e(1));for(var i=r;i--;){var s=t.times(t);t=s.times(s).minus(s).times(8).plus(1)}return e.precision-=r,t}var Z=function(){function e(n,o,i){var s,a=0,c=n.length;for(n=n.slice();c--;)s=n[c]*o+a,n[c]=s%i|0,a=s/i|0;return a&&n.unshift(a),n}function t(n,o,i,s){var a,c;if(i!=s)c=i>s?1:-1;else for(a=c=0;a<i;a++)if(n[a]!=o[a]){c=n[a]>o[a]?1:-1;break}return c}function r(n,o,i,s){for(var a=0;i--;)n[i]-=a,a=n[i]<o[i]?1:0,n[i]=a*s+n[i]-o[i];for(;!n[0]&&n.length>1;)n.shift()}return function(n,o,i,s,a,c){var u,d,l,f,p,m,g,b,x,I,k,w,A,P,R,L,V,B,N,K,E=n.constructor,S=n.s==o.s?1:-1,D=n.d,M=o.d;if(!D||!D[0]||!M||!M[0])return new E(!n.s||!o.s||(D?M&&D[0]==M[0]:!M)?NaN:D&&D[0]==0||!M?S*0:S/0);for(c?(p=1,d=n.e-o.e):(c=de,p=v,d=ie(n.e/p)-ie(o.e/p)),N=M.length,V=D.length,x=new E(S),I=x.d=[],l=0;M[l]==(D[l]||0);l++);if(M[l]>(D[l]||0)&&d--,i==null?(P=i=E.precision,s=E.rounding):a?P=i+(n.e-o.e)+1:P=i,P<0)I.push(1),m=!0;else{if(P=P/p+2|0,l=0,N==1){for(f=0,M=M[0],P++;(l<V||f)&&P--;l++)R=f*c+(D[l]||0),I[l]=R/M|0,f=R%M|0;m=f||l<V}else{for(f=c/(M[0]+1)|0,f>1&&(M=e(M,f,c),D=e(D,f,c),N=M.length,V=D.length),L=N,k=D.slice(0,N),w=k.length;w<N;)k[w++]=0;K=M.slice(),K.unshift(0),B=M[0],M[1]>=c/2&&++B;do f=0,u=t(M,k,N,w),u<0?(A=k[0],N!=w&&(A=A*c+(k[1]||0)),f=A/B|0,f>1?(f>=c&&(f=c-1),g=e(M,f,c),b=g.length,w=k.length,u=t(g,k,b,w),u==1&&(f--,r(g,N<b?K:M,b,c))):(f==0&&(u=f=1),g=M.slice()),b=g.length,b<w&&g.unshift(0),r(k,g,w,c),u==-1&&(w=k.length,u=t(M,k,N,w),u<1&&(f++,r(k,N<w?K:M,w,c))),w=k.length):u===0&&(f++,k=[0]),I[l++]=f,u&&k[0]?k[w++]=D[L]||0:(k=[D[L]],w=1);while((L++<V||k[0]!==void 0)&&P--);m=k[0]!==void 0}I[0]||I.shift()}if(p==1)x.e=d,Ur=m;else{for(l=1,f=I[0];f>=10;f/=10)l++;x.e=l+d*p-1,C(x,a?i+x.e+1:i,s,m)}return x}}();function C(e,t,r,n){var o,i,s,a,c,u,d,l,f,p=e.constructor;e:if(t!=null){if(l=e.d,!l)return e;for(o=1,a=l[0];a>=10;a/=10)o++;if(i=t-o,i<0)i+=v,s=t,d=l[f=0],c=d/re(10,o-s-1)%10|0;else if(f=Math.ceil((i+1)/v),a=l.length,f>=a)if(n){for(;a++<=f;)l.push(0);d=c=0,o=1,i%=v,s=i-v+1}else break e;else{for(d=a=l[f],o=1;a>=10;a/=10)o++;i%=v,s=i-v+o,c=s<0?0:d/re(10,o-s-1)%10|0}if(n=n||t<0||l[f+1]!==void 0||(s<0?d:d%re(10,o-s-1)),u=r<4?(c||n)&&(r==0||r==(e.s<0?3:2)):c>5||c==5&&(r==4||n||r==6&&(i>0?s>0?d/re(10,o-s):0:l[f-1])%10&1||r==(e.s<0?8:7)),t<1||!l[0])return l.length=0,u?(t-=e.e+1,l[0]=re(10,(v-t%v)%v),e.e=-t||0):l[0]=e.e=0,e;if(i==0?(l.length=f,a=1,f--):(l.length=f+1,a=re(10,v-i),l[f]=s>0?(d/re(10,o-s)%re(10,s)|0)*a:0),u)for(;;)if(f==0){for(i=1,s=l[0];s>=10;s/=10)i++;for(s=l[0]+=a,a=1;s>=10;s/=10)a++;i!=a&&(e.e++,l[0]==de&&(l[0]=1));break}else{if(l[f]+=a,l[f]!=de)break;l[f--]=0,a=1}for(i=l.length;l[--i]===0;)l.pop()}return F&&(e.e>p.maxE?(e.d=null,e.e=NaN):e.e<p.minE&&(e.e=0,e.d=[0])),e}function pe(e,t,r){if(!e.isFinite())return Qr(e);var n,o=e.e,i=oe(e.d),s=i.length;return t?(r&&(n=r-s)>0?i=i.charAt(0)+"."+i.slice(1)+Le(n):s>1&&(i=i.charAt(0)+"."+i.slice(1)),i=i+(e.e<0?"e":"e+")+e.e):o<0?(i="0."+Le(-o-1)+i,r&&(n=r-s)>0&&(i+=Le(n))):o>=s?(i+=Le(o+1-s),r&&(n=r-o-1)>0&&(i=i+"."+Le(n))):((n=o+1)<s&&(i=i.slice(0,n)+"."+i.slice(n)),r&&(n=r-s)>0&&(o+1===s&&(i+="."),i+=Le(n))),i}function bt(e,t){var r=e[0];for(t*=v;r>=10;r/=10)t++;return t}function yt(e,t,r){if(t>oo)throw F=!0,r&&(e.precision=r),Error(qr);return C(new e(mt),t,1,!0)}function le(e,t,r){if(t>Ut)throw Error(qr);return C(new e(gt),t,r,!0)}function zr(e){var t=e.length-1,r=t*v+1;if(t=e[t],t){for(;t%10==0;t/=10)r--;for(t=e[0];t>=10;t/=10)r++}return r}function Le(e){for(var t="";e--;)t+="0";return t}function Zr(e,t,r,n){var o,i=new e(1),s=Math.ceil(n/v+4);for(F=!1;;){if(r%2&&(i=i.times(t),Or(i.d,s)&&(o=!0)),r=ie(r/2),r===0){r=i.d.length-1,o&&i.d[r]===0&&++i.d[r];break}t=t.times(t),Or(t.d,s)}return F=!0,i}function Dr(e){return e.d[e.d.length-1]&1}function Jr(e,t,r){for(var n,o=new e(t[0]),i=0;++i<t.length;)if(n=new e(t[i]),n.s)o[r](n)&&(o=n);else{o=n;break}return o}function qt(e,t){var r,n,o,i,s,a,c,u=0,d=0,l=0,f=e.constructor,p=f.rounding,m=f.precision;if(!e.d||!e.d[0]||e.e>17)return new f(e.d?e.d[0]?e.s<0?0:1/0:1:e.s?e.s<0?0:e:0/0);for(t==null?(F=!1,c=m):c=t,a=new f(.03125);e.e>-2;)e=e.times(a),l+=5;for(n=Math.log(re(2,l))/Math.LN10*2+5|0,c+=n,r=i=s=new f(1),f.precision=c;;){if(i=C(i.times(e),c,1),r=r.times(++d),a=s.plus(Z(i,r,c,1)),oe(a.d).slice(0,c)===oe(s.d).slice(0,c)){for(o=l;o--;)s=C(s.times(s),c,1);if(t==null)if(u<3&&Ze(s.d,c-n,p,u))f.precision=c+=10,r=i=a=new f(1),d=0,u++;else return C(s,f.precision=m,p,F=!0);else return f.precision=m,s}s=a}}function Be(e,t){var r,n,o,i,s,a,c,u,d,l,f,p=1,m=10,g=e,b=g.d,x=g.constructor,I=x.rounding,k=x.precision;if(g.s<0||!b||!b[0]||!g.e&&b[0]==1&&b.length==1)return new x(b&&!b[0]?-1/0:g.s!=1?NaN:b?0:g);if(t==null?(F=!1,d=k):d=t,x.precision=d+=m,r=oe(b),n=r.charAt(0),Math.abs(i=g.e)<15e14){for(;n<7&&n!=1||n==1&&r.charAt(1)>3;)g=g.times(e),r=oe(g.d),n=r.charAt(0),p++;i=g.e,n>1?(g=new x("0."+r),i++):g=new x(n+"."+r.slice(1))}else return u=yt(x,d+2,k).times(i+""),g=Be(new x(n+"."+r.slice(1)),d-m).plus(u),x.precision=k,t==null?C(g,k,I,F=!0):g;for(l=g,c=s=g=Z(g.minus(1),g.plus(1),d,1),f=C(g.times(g),d,1),o=3;;){if(s=C(s.times(f),d,1),u=c.plus(Z(s,new x(o),d,1)),oe(u.d).slice(0,d)===oe(c.d).slice(0,d))if(c=c.times(2),i!==0&&(c=c.plus(yt(x,d+2,k).times(i+""))),c=Z(c,new x(p),d,1),t==null)if(Ze(c.d,d-m,I,a))x.precision=d+=m,u=s=g=Z(l.minus(1),l.plus(1),d,1),f=C(g.times(g),d,1),o=a=1;else return C(c,x.precision=k,I,F=!0);else return x.precision=k,c;c=u,o+=2}}function Qr(e){return String(e.s*e.s/0)}function Gt(e,t){var r,n,o;for((r=t.indexOf("."))>-1&&(t=t.replace(".","")),(n=t.search(/e/i))>0?(r<0&&(r=n),r+=+t.slice(n+1),t=t.substring(0,n)):r<0&&(r=t.length),n=0;t.charCodeAt(n)===48;n++);for(o=t.length;t.charCodeAt(o-1)===48;--o);if(t=t.slice(n,o),t){if(o-=n,e.e=r=r-n-1,e.d=[],n=(r+1)%v,r<0&&(n+=v),n<o){for(n&&e.d.push(+t.slice(0,n)),o-=v;n<o;)e.d.push(+t.slice(n,n+=v));t=t.slice(n),n=v-t.length}else n-=o;for(;n--;)t+="0";e.d.push(+t),F&&(e.e>e.constructor.maxE?(e.d=null,e.e=NaN):e.e<e.constructor.minE&&(e.e=0,e.d=[0]))}else e.e=0,e.d=[0];return e}function so(e,t){var r,n,o,i,s,a,c,u,d;if(t.indexOf("_")>-1){if(t=t.replace(/(\d)_(?=\d)/g,"$1"),Hr.test(t))return Gt(e,t)}else if(t==="Infinity"||t==="NaN")return+t||(e.s=NaN),e.e=NaN,e.d=null,e;if(to.test(t))r=16,t=t.toLowerCase();else if(eo.test(t))r=2;else if(ro.test(t))r=8;else throw Error(Re+t);for(i=t.search(/p/i),i>0?(c=+t.slice(i+1),t=t.substring(2,i)):t=t.slice(2),i=t.indexOf("."),s=i>=0,n=e.constructor,s&&(t=t.replace(".",""),a=t.length,i=a-i,o=Zr(n,new n(r),i,i*2)),u=pt(t,r,de),d=u.length-1,i=d;u[i]===0;--i)u.pop();return i<0?new n(e.s*0):(e.e=bt(u,d),e.d=u,F=!1,s&&(e=Z(e,o,a*4)),c&&(e=e.times(Math.abs(c)<54?re(2,c):Je.pow(2,c))),F=!0,e)}function ao(e,t){var r,n=t.d.length;if(n<3)return t.isZero()?t:qe(e,2,t,t);r=1.4*Math.sqrt(n),r=r>16?16:r|0,t=t.times(1/wt(5,r)),t=qe(e,2,t,t);for(var o,i=new e(5),s=new e(16),a=new e(20);r--;)o=t.times(t),t=t.times(i.plus(o.times(s.times(o).minus(a))));return t}function qe(e,t,r,n,o){var i,s,a,c,u=1,d=e.precision,l=Math.ceil(d/v);for(F=!1,c=r.times(r),a=new e(n);;){if(s=Z(a.times(c),new e(t++*t++),d,1),a=o?n.plus(s):n.minus(s),n=Z(s.times(c),new e(t++*t++),d,1),s=a.plus(n),s.d[l]!==void 0){for(i=l;s.d[i]===a.d[i]&&i--;);if(i==-1)break}i=a,a=n,n=s,s=i,u++}return F=!0,s.d.length=l+1,s}function wt(e,t){for(var r=e;--t;)r*=e;return r}function Xr(e,t){var r,n=t.s<0,o=le(e,e.precision,1),i=o.times(.5);if(t=t.abs(),t.lte(i))return we=n?4:1,t;if(r=t.divToInt(o),r.isZero())we=n?3:2;else{if(t=t.minus(r.times(o)),t.lte(i))return we=Dr(r)?n?2:3:n?4:1,t;we=Dr(r)?n?1:4:n?3:2}return t.minus(o).abs()}function jt(e,t,r,n){var o,i,s,a,c,u,d,l,f,p=e.constructor,m=r!==void 0;if(m?(ae(r,1,Ce),n===void 0?n=p.rounding:ae(n,0,8)):(r=p.precision,n=p.rounding),!e.isFinite())d=Qr(e);else{for(d=pe(e),s=d.indexOf("."),m?(o=2,t==16?r=r*4-3:t==8&&(r=r*3-2)):o=t,s>=0&&(d=d.replace(".",""),f=new p(1),f.e=d.length-s,f.d=pt(pe(f),10,o),f.e=f.d.length),l=pt(d,10,o),i=c=l.length;l[--c]==0;)l.pop();if(!l[0])d=m?"0p+0":"0";else{if(s<0?i--:(e=new p(e),e.d=l,e.e=i,e=Z(e,f,r,n,0,o),l=e.d,i=e.e,u=Ur),s=l[r],a=o/2,u=u||l[r+1]!==void 0,u=n<4?(s!==void 0||u)&&(n===0||n===(e.s<0?3:2)):s>a||s===a&&(n===4||u||n===6&&l[r-1]&1||n===(e.s<0?8:7)),l.length=r,u)for(;++l[--r]>o-1;)l[r]=0,r||(++i,l.unshift(1));for(c=l.length;!l[c-1];--c);for(s=0,d="";s<c;s++)d+=Ot.charAt(l[s]);if(m){if(c>1)if(t==16||t==8){for(s=t==16?4:3,--c;c%s;c++)d+="0";for(l=pt(d,o,t),c=l.length;!l[c-1];--c);for(s=1,d="1.";s<c;s++)d+=Ot.charAt(l[s])}else d=d.charAt(0)+"."+d.slice(1);d=d+(i<0?"p":"p+")+i}else if(i<0){for(;++i;)d="0"+d;d="0."+d}else if(++i>c)for(i-=c;i--;)d+="0";else i<c&&(d=d.slice(0,i)+"."+d.slice(i))}d=(t==16?"0x":t==2?"0b":t==8?"0o":"")+d}return e.s<0?"-"+d:d}function Or(e,t){if(e.length>t)return e.length=t,!0}function uo(e){return new this(e).abs()}function co(e){return new this(e).acos()}function lo(e){return new this(e).acosh()}function fo(e,t){return new this(e).plus(t)}function po(e){return new this(e).asin()}function mo(e){return new this(e).asinh()}function go(e){return new this(e).atan()}function yo(e){return new this(e).atanh()}function ho(e,t){e=new this(e),t=new this(t);var r,n=this.precision,o=this.rounding,i=n+4;return!e.s||!t.s?r=new this(NaN):!e.d&&!t.d?(r=le(this,i,1).times(t.s>0?.25:.75),r.s=e.s):!t.d||e.isZero()?(r=t.s<0?le(this,n,o):new this(0),r.s=e.s):!e.d||t.isZero()?(r=le(this,i,1).times(.5),r.s=e.s):t.s<0?(this.precision=i,this.rounding=1,r=this.atan(Z(e,t,i,1)),t=le(this,i,1),this.precision=n,this.rounding=o,r=e.s<0?r.minus(t):r.plus(t)):r=this.atan(Z(e,t,i,1)),r}function bo(e){return new this(e).cbrt()}function wo(e){return C(e=new this(e),e.e+1,2)}function To(e,t,r){return new this(e).clamp(t,r)}function Po(e){if(!e||typeof e!="object")throw Error(ht+"Object expected");var t,r,n,o=e.defaults===!0,i=["precision",1,Ce,"rounding",0,8,"toExpNeg",-Ue,0,"toExpPos",0,Ue,"maxE",0,Ue,"minE",-Ue,0,"modulo",0,9];for(t=0;t<i.length;t+=3)if(r=i[t],o&&(this[r]=Wt[r]),(n=e[r])!==void 0)if(ie(n)===n&&n>=i[t+1]&&n<=i[t+2])this[r]=n;else throw Error(Re+r+": "+n);if(r="crypto",o&&(this[r]=Wt[r]),(n=e[r])!==void 0)if(n===!0||n===!1||n===0||n===1)if(n)if(typeof crypto<"u"&&crypto&&(crypto.getRandomValues||crypto.randomBytes))this[r]=!0;else throw Error(Gr);else this[r]=!1;else throw Error(Re+r+": "+n);return this}function xo(e){return new this(e).cos()}function ko(e){return new this(e).cosh()}function Yr(e){var t,r,n;function o(i){var s,a,c,u=this;if(!(u instanceof o))return new o(i);if(u.constructor=o,Wr(i)){u.s=i.s,F?!i.d||i.e>o.maxE?(u.e=NaN,u.d=null):i.e<o.minE?(u.e=0,u.d=[0]):(u.e=i.e,u.d=i.d.slice()):(u.e=i.e,u.d=i.d?i.d.slice():i.d);return}if(c=typeof i,c==="number"){if(i===0){u.s=1/i<0?-1:1,u.e=0,u.d=[0];return}if(i<0?(i=-i,u.s=-1):u.s=1,i===~~i&&i<1e7){for(s=0,a=i;a>=10;a/=10)s++;F?s>o.maxE?(u.e=NaN,u.d=null):s<o.minE?(u.e=0,u.d=[0]):(u.e=s,u.d=[i]):(u.e=s,u.d=[i]);return}else if(i*0!==0){i||(u.s=NaN),u.e=NaN,u.d=null;return}return Gt(u,i.toString())}else if(c!=="string")throw Error(Re+i);return(a=i.charCodeAt(0))===45?(i=i.slice(1),u.s=-1):(a===43&&(i=i.slice(1)),u.s=1),Hr.test(i)?Gt(u,i):so(u,i)}if(o.prototype=h,o.ROUND_UP=0,o.ROUND_DOWN=1,o.ROUND_CEIL=2,o.ROUND_FLOOR=3,o.ROUND_HALF_UP=4,o.ROUND_HALF_DOWN=5,o.ROUND_HALF_EVEN=6,o.ROUND_HALF_CEIL=7,o.ROUND_HALF_FLOOR=8,o.EUCLID=9,o.config=o.set=Po,o.clone=Yr,o.isDecimal=Wr,o.abs=uo,o.acos=co,o.acosh=lo,o.add=fo,o.asin=po,o.asinh=mo,o.atan=go,o.atanh=yo,o.atan2=ho,o.cbrt=bo,o.ceil=wo,o.clamp=To,o.cos=xo,o.cosh=ko,o.div=Ao,o.exp=Io,o.floor=So,o.hypot=Lo,o.ln=Bo,o.log=Ro,o.log10=Ko,o.log2=Co,o.max=Mo,o.min=vo,o.mod=Vo,o.mul=No,o.pow=Eo,o.random=Fo,o.round=_o,o.sign=Do,o.sin=Oo,o.sinh=Wo,o.sqrt=Uo,o.sub=qo,o.sum=Go,o.tan=jo,o.tanh=Ho,o.trunc=zo,e===void 0&&(e={}),e&&e.defaults!==!0)for(n=["precision","rounding","toExpNeg","toExpPos","maxE","minE","modulo","crypto"],t=0;t<n.length;)e.hasOwnProperty(r=n[t++])||(e[r]=this[r]);return o.config(e),o}function Ao(e,t){return new this(e).div(t)}function Io(e){return new this(e).exp()}function So(e){return C(e=new this(e),e.e+1,3)}function Lo(){var e,t,r=new this(0);for(F=!1,e=0;e<arguments.length;)if(t=new this(arguments[e++]),t.d)r.d&&(r=r.plus(t.times(t)));else{if(t.s)return F=!0,new this(1/0);r=t}return F=!0,r.sqrt()}function Wr(e){return e instanceof Je||e&&e.toStringTag===jr||!1}function Bo(e){return new this(e).ln()}function Ro(e,t){return new this(e).log(t)}function Co(e){return new this(e).log(2)}function Ko(e){return new this(e).log(10)}function Mo(){return Jr(this,arguments,"lt")}function vo(){return Jr(this,arguments,"gt")}function Vo(e,t){return new this(e).mod(t)}function No(e,t){return new this(e).mul(t)}function Eo(e,t){return new this(e).pow(t)}function Fo(e){var t,r,n,o,i=0,s=new this(1),a=[];if(e===void 0?e=this.precision:ae(e,1,Ce),n=Math.ceil(e/v),this.crypto)if(crypto.getRandomValues)for(t=crypto.getRandomValues(new Uint32Array(n));i<n;)o=t[i],o>=429e7?t[i]=crypto.getRandomValues(new Uint32Array(1))[0]:a[i++]=o%1e7;else if(crypto.randomBytes){for(t=crypto.randomBytes(n*=4);i<n;)o=t[i]+(t[i+1]<<8)+(t[i+2]<<16)+((t[i+3]&127)<<24),o>=214e7?crypto.randomBytes(4).copy(t,i):(a.push(o%1e7),i+=4);i=n/4}else throw Error(Gr);else for(;i<n;)a[i++]=Math.random()*1e7|0;for(n=a[--i],e%=v,n&&e&&(o=re(10,v-e),a[i]=(n/o|0)*o);a[i]===0;i--)a.pop();if(i<0)r=0,a=[0];else{for(r=-1;a[0]===0;r-=v)a.shift();for(n=1,o=a[0];o>=10;o/=10)n++;n<v&&(r-=v-n)}return s.e=r,s.d=a,s}function _o(e){return C(e=new this(e),e.e+1,this.rounding)}function Do(e){return e=new this(e),e.d?e.d[0]?e.s:0*e.s:e.s||NaN}function Oo(e){return new this(e).sin()}function Wo(e){return new this(e).sinh()}function Uo(e){return new this(e).sqrt()}function qo(e,t){return new this(e).sub(t)}function Go(){var e=0,t=arguments,r=new this(t[e]);for(F=!1;r.s&&++e<t.length;)r=r.plus(t[e]);return F=!0,C(r,this.precision,this.rounding)}function jo(e){return new this(e).tan()}function Ho(e){return new this(e).tanh()}function zo(e){return C(e=new this(e),e.e+1,1)}h[Symbol.for("nodejs.util.inspect.custom")]=h.toString;h[Symbol.toStringTag]="Decimal";var Je=h.constructor=Yr(Wt);mt=new Je(mt);gt=new Je(gt);var Ht=Je;import ti from"big.js";import xt from"bn.js";import Zo from"toformat";var Jo=Zo,Qe=Jo;import Pt from"big.js";import Xo from"bn.js";import Yo from"decimal.js-light";import Xe from"bn.js";var $r=9007199254740991;function U(e){let t=$("Raydium_parseBigNumberish");if(e instanceof Xe)return e;if(typeof e=="string"){if(e.match(/^-?[0-9]+$/))return new Xe(e);t.logWithError(`invalid BigNumberish string: ${e}`)}return typeof e=="number"?(e%1&&t.logWithError(`BigNumberish number underflow: ${e}`),(e>=$r||e<=-$r)&&t.logWithError(`BigNumberish number overflow: ${e}`),new Xe(String(e))):typeof e=="bigint"?new Xe(e.toString()):(t.error(`invalid BigNumberish value: ${e}`),new Xe(0))}var Tt=$("module/fraction"),zt=Qe(Pt),Ye=Qe(Yo),$o={[0]:Ye.ROUND_DOWN,[1]:Ye.ROUND_HALF_UP,[2]:Ye.ROUND_UP},ei={[0]:Pt.roundDown,[1]:Pt.roundHalfUp,[2]:Pt.roundUp},j=class{constructor(t,r=new Xo(1)){this.numerator=U(t),this.denominator=U(r)}get quotient(){return this.numerator.div(this.denominator)}invert(){return new j(this.denominator,this.numerator)}add(t){let r=t instanceof j?t:new j(U(t));return this.denominator.eq(r.denominator)?new j(this.numerator.add(r.numerator),this.denominator):new j(this.numerator.mul(r.denominator).add(r.numerator.mul(this.denominator)),this.denominator.mul(r.denominator))}sub(t){let r=t instanceof j?t:new j(U(t));return this.denominator.eq(r.denominator)?new j(this.numerator.sub(r.numerator),this.denominator):new j(this.numerator.mul(r.denominator).sub(r.numerator.mul(this.denominator)),this.denominator.mul(r.denominator))}mul(t){let r=t instanceof j?t:new j(U(t));return new j(this.numerator.mul(r.numerator),this.denominator.mul(r.denominator))}div(t){let r=t instanceof j?t:new j(U(t));return new j(this.numerator.mul(r.denominator),this.denominator.mul(r.numerator))}toSignificant(t,r={groupSeparator:""},n=1){Number.isInteger(t)||Tt.logWithError(`${t} is not an integer.`),t<=0&&Tt.logWithError(`${t} is not positive.`),Ye.set({precision:t+1,rounding:$o[n]});let o=new Ye(this.numerator.toString()).div(this.denominator.toString()).toSignificantDigits(t);return o.toFormat(o.decimalPlaces(),r)}toFixed(t,r={groupSeparator:""},n=1){return Number.isInteger(t)||Tt.logWithError(`${t} is not an integer.`),t<0&&Tt.logWithError(`${t} is negative.`),zt.DP=t,zt.RM=ei[n]||1,new zt(this.numerator.toString()).div(this.denominator.toString()).toFormat(t,r)}isZero(){return this.numerator.isZero()}};var ri=$("Raydium_amount"),en=Qe(ti);function ni(e,t){let r="0",n="0";if(e.includes(".")){let o=e.split(".");o.length===2?([r,n]=o,n=n.padEnd(t,"0")):ri.logWithError(`invalid number string, num: ${e}`)}else r=e;return[r,n.slice(0,t)||n]}var Te=class extends j{constructor(r,n,o=!0,i){let s=new xt(0),a=Zt.pow(new xt(r.decimals));if(o)s=U(n);else{let c=new xt(0),u=new xt(0);if(typeof n=="string"||typeof n=="number"||typeof n=="bigint"){let[d,l]=ni(n.toString(),r.decimals);c=U(d),u=U(l)}c=c.mul(a),s=c.add(u)}super(s,a);this.logger=$(i||"TokenAmount"),this.token=r}get raw(){return this.numerator}isZero(){return this.raw.isZero()}gt(r){return this.token.equals(r.token)||this.logger.logWithError("gt token not equals"),this.raw.gt(r.raw)}lt(r){return this.token.equals(r.token)||this.logger.logWithError("lt token not equals"),this.raw.lt(r.raw)}add(r){return this.token.equals(r.token)||this.logger.logWithError("add token not equals"),new Te(this.token,this.raw.add(r.raw))}subtract(r){return this.token.equals(r.token)||this.logger.logWithError("sub token not equals"),new Te(this.token,this.raw.sub(r.raw))}toSignificant(r=this.token.decimals,n,o=0){return super.toSignificant(r,n,o)}toFixed(r=this.token.decimals,n,o=0){return r>this.token.decimals&&this.logger.logWithError("decimals overflow"),super.toFixed(r,n,o)}toExact(r={groupSeparator:""}){return en.DP=this.token.decimals,new en(this.numerator.toString()).div(this.denominator.toString()).toFormat(r)}};import{PublicKey as oi}from"@solana/web3.js";import{TOKEN_PROGRAM_ID as tn}from"@solana/spl-token";var rn={chainId:101,address:oi.default.toBase58(),programId:tn.toBase58(),decimals:9,symbol:"SOL",name:"solana",logoURI:"https://img-v1.raydium.io/icon/So11111111111111111111111111111111111111112.png",tags:[],priority:2,type:"raydium",extensions:{coingeckoId:"solana"}},se={chainId:101,address:"So11111111111111111111111111111111111111112",programId:tn.toBase58(),decimals:9,symbol:"WSOL",name:"Wrapped SOL",logoURI:"https://img-v1.raydium.io/icon/So11111111111111111111111111111111111111112.png",tags:[],priority:2,type:"raydium",extensions:{coingeckoId:"solana"}};import{PublicKey as Yt}from"@solana/web3.js";import{PublicKey as X,SystemProgram as nn,SYSVAR_RENT_PUBKEY as ii}from"@solana/web3.js";import{TOKEN_PROGRAM_ID as si}from"@solana/spl-token";function y({pubkey:e,isSigner:t=!1,isWritable:r=!0}){return{pubkey:e,isWritable:r,isSigner:t}}var Jt=[y({pubkey:si,isWritable:!1}),y({pubkey:nn.programId,isWritable:!1}),y({pubkey:ii,isWritable:!1})];function Qt({publicKey:e,transformSol:t}){let r=Xt(e.toString());if(r instanceof X)return t&&r.equals(ne)?be:r;if(t&&r.toString()===ne.toBase58())return be;if(typeof r=="string"){if(r===X.default.toBase58())return X.default;try{return new X(r)}catch{throw new Error("invalid public key")}}throw new Error("invalid public key")}function Xt(e){try{return new X(e)}catch{return e}}var pa=new X("MemoSq4gqABAXKb96qnH8TysNcWxMyWCqXgDLGmfcHr"),ma=new X("MemoSq4gqABAXKb96qnH8TysNcWxMyWCqXgDLGmfcHr"),ai=new X("SysvarRent111111111111111111111111111111111"),ga=new X("SysvarC1ock11111111111111111111111111111111"),ya=new X("metaqbxxUerdq28cj1RbAWkYQm3ybzjb6a8bt518x1s"),ui=new X("Sysvar1nstructions1111111111111111111111111"),ha=nn.programId,ba=new X("4k3Dyjzvzp8eMZWUXbBCjEvwSkkk59S5iCNLY3QrkX6R"),wa=new X("Ea5SjE2Y6yvCeW5dYTn7PYMuW5ikXkvbGdcmSnXeaLjS"),Ta=new X("SRMuApVNdxXokk5GT7XD5cUUgXMBCoAz2LHeuAoKWRt"),Pa=new X("EPjFWdd5AufqSSqeM2qN1xzybapC8G4wEGGkZwyTDt1v"),xa=new X("Es9vMFrzaCERmJfrF4H2FYD4KCoNkY11McCe8BenwNYB"),ka=new X("mSoLzYCxHdYgdzU16g5QSh3i5K3z3KZK7ytfqcJm7So"),Aa=new X("7dHbWXmci3dT8UFYWYZweBLXgycu7Y3iL6trKn1Y7ARj"),Ia=new X("USDH1SM1ojwWUga67PGrgFWUHibbjqMvuMaDkRJTgkX"),Sa=new X("NRVwhjBQiUPYtfDT5zRBVJajzFQHaBUNtC7SNVvqRFa"),La=new X("ANAxByE6G2WjFp7A4NqtWYXb3mgruyzZYg3spfxe6Lbo"),Ba=new X("7vfCXTUXx5WJV5JADk17DUJ4ksgau7utNKj4b963voxs"),be=new X("So11111111111111111111111111111111111111112"),ne=X.default;function ft(e){return Qt({publicKey:e,transformSol:!0})}var $t=class{constructor({mint:t,decimals:r,symbol:n,name:o,skipMint:i=!1,isToken2022:s=!1}){if(t===ne.toBase58()||t instanceof Yt&&ne.equals(t)){this.decimals=se.decimals,this.symbol=se.symbol,this.name=se.name,this.mint=new Yt(se.address),this.isToken2022=!1;return}this.decimals=r,this.symbol=n||t.toString().substring(0,6),this.name=o||t.toString().substring(0,6),this.mint=i?Yt.default:Qt({publicKey:t}),this.isToken2022=s}equals(t){return this===t?!0:this.mint.equals(t.mint)}},Fe=$t;Fe.WSOL=new $t(te(J({},se),{mint:se.address}));var er=class{constructor({decimals:t,symbol:r="UNKNOWN",name:n="UNKNOWN"}){this.decimals=t,this.symbol=r,this.name=n}equals(t){return this===t}},kt=er;kt.SOL=new er(rn);import ci from"bn.js";var on=new j(new ci(100)),Ge=class extends j{toSignificant(t=5,r,n){return this.mul(on).toSignificant(t,r,n)}toFixed(t=2,r,n){return this.mul(on).toFixed(t,r,n)}};var li=$("Raydium_price"),Pe=class extends j{constructor(r){let{baseToken:n,quoteToken:o,numerator:i,denominator:s}=r;super(i,s);this.baseToken=n,this.quoteToken=o,this.scalar=new j(tr(n.decimals),tr(o.decimals))}get raw(){return new j(this.numerator,this.denominator)}get adjusted(){return super.mul(this.scalar)}invert(){return new Pe({baseToken:this.quoteToken,quoteToken:this.baseToken,denominator:this.numerator,numerator:this.denominator})}mul(r){this.quoteToken!==r.baseToken&&li.logWithError("mul token not equals");let n=super.mul(r);return new Pe({baseToken:this.baseToken,quoteToken:r.quoteToken,denominator:n.denominator,numerator:n.numerator})}toSignificant(r=this.quoteToken.decimals,n,o){return this.adjusted.toSignificant(r,n,o)}toFixed(r=this.quoteToken.decimals,n,o){return this.adjusted.toFixed(r,n,o)}};import{PublicKey as di}from"@solana/web3.js";import fi from"bn.js";function sn(e){return typeof e=="object"&&e!==null&&![Fe,Te,di,j,fi,Pe,Ge].some(t=>typeof t=="object"&&e instanceof t)}function xe(e){return typeof e=="string"?Xt(e):Array.isArray(e)?e.map(t=>xe(t)):sn(e)?Object.fromEntries(Object.entries(e).map(([t,r])=>[t,xe(r)])):e}var rr=new ke(0),ku=new ke(1),Au=new ke(2),Iu=new ke(3),Su=new ke(5),Zt=new ke(10),Lu=new ke(100),Bu=new ke(1e3),Ru=new ke(1e4);function tr(e){return Zt.pow(U(e))}function Dt(e,t=1,r=[]){let n=[...e];if(t<=0)return r;for(;n.length;)r.push(n.splice(0,t));return r}import{PublicKey as wi}from"@solana/web3.js";import{TOKEN_PROGRAM_ID as Ti}from"@solana/spl-token";import{ComputeBudgetProgram as an,Keypair as cn,PublicKey as pi,Transaction as ln,TransactionMessage as mi,VersionedTransaction as dn}from"@solana/web3.js";var H={CreateAccount:"CreateAccount",InitAccount:"InitAccount",CreateATA:"CreateATA",CloseAccount:"CloseAccount",TransferAmount:"TransferAmount",InitMint:"InitMint",MintTo:"MintTo",InitMarket:"InitMarket",Util1216OwnerClaim:"Util1216OwnerClaim",SetComputeUnitPrice:"SetComputeUnitPrice",SetComputeUnitLimit:"SetComputeUnitLimit",ClmmCreatePool:"ClmmCreatePool",ClmmOpenPosition:"ClmmOpenPosition",ClmmIncreasePosition:"ClmmIncreasePosition",ClmmDecreasePosition:"ClmmDecreasePosition",ClmmClosePosition:"ClmmClosePosition",ClmmSwapBaseIn:"ClmmSwapBaseIn",ClmmSwapBaseOut:"ClmmSwapBaseOut",ClmmInitReward:"ClmmInitReward",ClmmSetReward:"ClmmSetReward",ClmmCollectReward:"ClmmCollectReward",ClmmLockPosition:"ClmmLockPosition",ClmmHarvestLockPosition:"ClmmHarvestLockPosition",AmmV4Swap:"AmmV4Swap",AmmV4AddLiquidity:"AmmV4AddLiquidity",AmmV4RemoveLiquidity:"AmmV4RemoveLiquidity",AmmV4SimulatePoolInfo:"AmmV4SimulatePoolInfo",AmmV4SwapBaseIn:"AmmV4SwapBaseIn",AmmV4SwapBaseOut:"AmmV4SwapBaseOut",AmmV4CreatePool:"AmmV4CreatePool",AmmV4InitPool:"AmmV4InitPool",AmmV5AddLiquidity:"AmmV5AddLiquidity",AmmV5RemoveLiquidity:"AmmV5RemoveLiquidity",AmmV5SimulatePoolInfo:"AmmV5SimulatePoolInfo",AmmV5SwapBaseIn:"AmmV5SwapBaseIn",AmmV5SwapBaseOut:"AmmV5SwapBaseOut",RouteSwap:"RouteSwap",RouteSwap1:"RouteSwap1",RouteSwap2:"RouteSwap2",FarmV3Deposit:"FarmV3Deposit",FarmV3Withdraw:"FarmV3Withdraw",FarmV3CreateLedger:"FarmV3CreateLedger",FarmV4Withdraw:"FarmV4Withdraw",FarmV5Deposit:"FarmV5Deposit",FarmV5Withdraw:"FarmV5Withdraw",FarmV5CreateLedger:"FarmV5CreateLedger",FarmV6Deposit:"FarmV6Deposit",FarmV6Withdraw:"FarmV6Withdraw",FarmV6Create:"FarmV6Create",FarmV6Restart:"FarmV6Restart",FarmV6CreatorAddReward:"FarmV6CreatorAddReward",FarmV6CreatorWithdraw:"FarmV6CreatorWithdraw",CpmmCreatePool:"CpmmCreatePool",CpmmAddLiquidity:"CpmmAddLiquidity",CpmmWithdrawLiquidity:"CpmmWithdrawLiquidity",CpmmSwapBaseIn:"CpmmSwapBaseIn",CpmmSwapBaseOut:"CpmmSwapBaseOut",CpmmLockLp:"CpmmLockLp",CpmmCollectLockFee:"CpmmCollectLockFee",TransferTip:"TransferTip"};import{TOKEN_PROGRAM_ID as gi}from"@solana/spl-token";var un=$("Raydium_txUtil"),fn=1644;function At(e){let t=[],r=[];return e.microLamports&&(t.push(an.setComputeUnitPrice({microLamports:e.microLamports})),r.push(H.SetComputeUnitPrice)),e.units&&(t.push(an.setComputeUnitLimit({units:e.units})),r.push(H.SetComputeUnitLimit)),{instructions:t,instructionTypes:r}}async function je(e,t){var n,o;let r=t!=null?t:"confirmed";return(o=await((n=e.getLatestBlockhash)==null?void 0:n.call(e,{commitment:r})))==null?void 0:o.blockhash}async function nr(e,t){return e.getSignatureStatuses([t]),new Promise((r,n)=>{let o=setTimeout(n,6e4);e.onSignature(t,i=>{if(clearTimeout(o),!i.err){r("");return}n(Object.assign(i.err,{txId:t}))},"confirmed")})}function yi(e,t){e.length<1&&un.logWithError(`no instructions provided: ${e.toString()}`),t.length<1&&un.logWithError(`no signers provided:, ${t.toString()}`);let r=new ln;r.recentBlockhash="11111111111111111111111111111111",r.feePayer=t[0],r.add(...e);try{return Buffer.from(r.serialize({verifySignatures:!1})).toString("base64").length<fn}catch{return!1}}function _e(e,t){let[r,n]=pi.findProgramAddressSync(e,t);return{publicKey:r,nonce:n}}function $e({instructions:e,payer:t,signers:r}){return yi(e,[t,...r])}function et({instructions:e,payer:t,lookupTableAddressAccount:r,recentBlockhash:n=cn.generate().publicKey.toString()}){let i=new mi({payerKey:t,recentBlockhash:n,instructions:e}).compileToV0Message(Object.values(r!=null?r:{}));try{return Buffer.from(new dn(i).serialize()).toString("base64").length<fn}catch{return!1}}var hi=e=>Buffer.isBuffer(e)?e:e instanceof Uint8Array?Buffer.from(e.buffer,e.byteOffset,e.byteLength):Buffer.from(e),bi=e=>{let t=e.serialize({requireAllSignatures:!1,verifySignatures:!1});e instanceof dn&&(t=hi(t));try{return t instanceof Buffer?t.toString("base64"):Buffer.from(t).toString("base64")}catch{return t.toString("base64")}};function De(e){let t=[];return e.forEach(r=>{r instanceof ln&&(r.recentBlockhash||(r.recentBlockhash=gi.toBase58()),r.feePayer||(r.feePayer=cn.generate().publicKey)),t.push(bi(r))}),console.log("simulate tx string:",t),t}function He(e,t,r){return _e([e.toBuffer(),(r!=null?r:Ti).toBuffer(),t.toBuffer()],new wi("ATokenGPvbdGVxr1b2hvZbsiqW5xWH25efTNsLJA8knL"))}import{PublicKey as _}from"@solana/web3.js";var pn=new _("EhhTKczWMGQt46ynNeRX1WfeagwwJd7ufHvCDjRxjo5Q"),mn=new _("CBuCnLe26faBpcBP2fktp4rp8abpcAnTWft6ZrP5Q4T"),gn=new _("9KEPoZmtHUrBbhWN1v1KWLMkkvwY6WLtAVUCPRtRjP4z"),tt=new _("FarmqiPv5eAj3j1GMdMCMUGXqPUvmquZtMy86QH6rzhG"),Qu=new _("CLaimxFqjHzgTJtAGHU47NPhg6qrc5sCnpC4tBLyABQS"),Xu=new _("srmqPvymJeFKQ4zGQed1GFppgkRHL9kaELCbyksJtPX"),Yu=new _("9xQeWvG816bUx9EPjHmaT23yvVM2ZWbrrpZb9PusVFin"),$u=new _("675kPX9MHTjS2zt1qfr1NYHuzeLXfQM9H24wFSUt1Mp8"),ec=new _("5quBtoiQqxF9Jv6KYKctB59NT3gtJD2Y65kdnB1Uev3h"),tc=new _("CDSr3ssLcRB6XYPJwAfFt18MZvEZp4LjHcvzBVZ45duo"),rc=new _("CAMMCzo5YL8w4VFF8KVHrK22GGUsp5VTaW7grrKgrWqK"),nc=new _("LockrWmn6K5twhz3y9w1dQERbmgSaRkfnTeTKbpofwE"),oc=new _("kN1kEznaF5Xbd8LYuqtEFcxzWSBk5Fv6ygX6SqEGJVy"),ic=new _("routeUGWgWzqBWFcrCfv8tritsqukccJPu3q5GPP3xS"),sc=new _("7YttLkHDoNj9wyDur5pM1ejNaAvT9X4eqaYcHQqtj2G5"),ac=new _("6FJon3QE27qgPVggARueB22hLvoh22VzJpXv4rBEoSLF"),uc=new _("CC12se5To1CdEuw7fDS27B7Geo5jJyL7t5UK2B44NgiH"),cc=new _("9HzJyW1qZsEiSfMUf6L2jo3CcTKAyBmSyKdwQeYisHrC"),lc=new _("DropEU8AvevN3UrXWXTMuz3rqnMczQVNjq3kcSdW2SQi"),dc=new _("CPMMoo8L3F4NbTegBCKVNunggL7H1ZpdTHKxQB5qKP1C"),fc=new _("GpMZbSM2GgvTKHJirzeGfMFoaZ8UR2X7F4v8vHTvxFbL"),pc=new _("DNXgeM9EiiaAbaWvwjHj9fQQLAX5ZsfHyvmYUNRAdNC8"),Pi=new _("CPMDWBwJDtYax9qW7AyRuVC19Cc4L4Vcy4n2BHAbHkCW"),xi=new _("7rQ1QFNosMkUCuh7Z7fPbTHvh73b68sQYdirycEzJVuw"),ki=new _("G11FKBRaAkHAKuLCgLM6K6NUc9rTjPAznRCjZifrTQe2"),mc=new _("LockrWmn6K5twhz3y9w1dQERbmgSaRkfnTeTKbpofwE"),Ai=new _("DLockwT7X7sxtLmGH9g5kmfcjaBtncdbUmi738m5bvQC"),gc=new _("3f7GcQFG397GAaEnv51zR6tsTVihYRydnydDD1cXekxH"),Ii=new _("7AFUeLVRjBfzqK3tTGw8hN48KLQWSk6DTE8xprWdPqix"),yc=new _("LanMV9sAd7wArD4vJFi2qDdfnVhFxYSUg6eADduJ3uj"),hc=new _("WLHv2UAZm6z4KyaaELi5pjdbJh6RESMva1Rnn8pJVVh"),Si=new _("LanD8FpTBBvzZFXjTxsAoipkFsxPUCDB4qAqKxYDiNP"),Li=new _("HYNHiyKJ3gGVFvyxJAurK7qr7P2o5J9THmvCGMdULtpW");var bc={AMM_V4:new _("HWy1jotHpo6UqeQxx49dpYYdQB8wj9Qk9MdxwjLvDHB8"),AMM_STABLE:new _("DDg4VmQaJV9ogWce7LpcjBA9bv22wRp5uaTPa5pGjijF"),CLMM_PROGRAM_ID:new _("devi51mZmdwUJGU9hjN27vEz64Gps7uUefqxg27EAtH"),CLMM_LOCK_PROGRAM_ID:new _("DLockwT7X7sxtLmGH9g5kmfcjaBtncdbUmi738m5bvQC"),CLMM_LOCK_AUTH_ID:new _("8qmHNvu2Kr2C7U8mJL4Vz1vTDxMhVuXKREwU7TNoaVEo"),FARM_PROGRAM_ID_V3:new _("85BFyr98MbCUU9MVTEgzx1nbhWACbJqLzho6zd6DZcWL"),FARM_PROGRAM_ID_V5:new _("EcLzTrNg9V7qhcdyXDe2qjtPkiGzDM2UbdRaeaadU5r2"),FARM_PROGRAM_ID_V6:new _("Farm2hJLcqPtPg8M4rR6DMrsRNc5TPm5Cs4bVQrMe2T7"),OPEN_BOOK_PROGRAM:new _("EoTcMgcDRTJVZDMZWBoU6rhYHZfkNTVEAfz3uUJRcYGj"),SERUM_PROGRAM_ID_V3:_.default,UTIL1216:_.default,Router:new _("BVChZ3XFEwTMUk1o9i3HAf91H6mFxSwa5X2wFAWhYPhU"),CREATE_CPMM_POOL_PROGRAM:Pi,CREATE_CPMM_POOL_AUTH:xi,CREATE_CPMM_POOL_FEE_ACC:ki,LOCK_CPMM_PROGRAM:Ai,LOCK_CPMM_AUTH:Ii,LAUNCHPAD_PROGRAM:Si,LAUNCHPAD_AUTH:Li,FEE_DESTINATION_ID:new _("3XMrhbv989VxAMi3DErLV9eJht1pHppW5LbKxe9fkEFR")};import Pc from"bn.js";import{PublicKey as yn,AddressLookupTableAccount as It}from"@solana/web3.js";async function or({connection:e,address:t}){let r=await _r(e,[...new Set(t.map(o=>o.toString()))].map(o=>new yn(o))),n={};for(let o=0;o<t.length;o++){let i=r[o],s=t[o];if(!i)continue;let a=new It({key:s,state:It.deserialize(i.data)});n[s.toString()]=a,St[s.toString()]=a}return n}var St={AcL1Vo8oy1ULiavEcjSUcwfBSForXMudcZvDZy5nzJkU:new It({key:new yn("AcL1Vo8oy1ULiavEcjSUcwfBSForXMudcZvDZy5nzJkU"),state:It.deserialize(Buffer.from("AQAAAP//////////I1rcEwAAAAAvAQYwun9CU6c5Ikm2pAj+D9IEnCOR45nK+SFTGSdpd6J6AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAbd9uHXZaGT2cvhRs7reawctIXtX1s3kTqM9YV+/wCpBt324e51j94YQl285GzN2rYa/E2DuQ0n/r35KNihi/wFSlNQ+F3IgtYUpVZyeIopbd8eq6vQpgZ4iEky9O72oAVKU1qZKSEGTSTocWDaOHx8NbXdvJK7geQfqEBBBUSNBqfVFxksXFEhjMlMPUrxf1ja7gibof1E49vZigAAAAAGp9UXGMd0yShWY5hpHV62i164o5tLbVxzVVshAAAAAIyXJY9OJInxuz0QKRSODYMLWhOZ2v8QhASOe9jb6fhZC3BlsePRfEU4nVJ/awTDzVi4bHMaoP21SbbRvAP4KUbIScv+6Yw2LHF/6K0ZjUPibbSWXCirYPGuuVl7zT789IUPLW4CpHr4JNCatp3ELXDLKMv6JJ+37le50lbBJ2LvBkX2T9y7AHdNGviJAqQNtlDUDCnauQRWybsLji6nPM8Qkw5asQRvCdB3MbX6IEBwytOrpM32l4jQygKG9TKgR0vZScQ2AsM/IHeQ7RajUkyhuZdc8SGiqQz/7H34torNR/Wir3sl0ruUrVxJWEZfUg+QLNAxxODdBi53/OP7Ioil1cqeBM9dtZC3FLov4yyxWRM/wcGStyJX/QfTnLBAHqkqWotPKVlShCVQqpP9W5W1rOao65IMk5QuQ2kMIOxzDMKAy2vjGSxQODgBz0QwGA+eP4ZjIjrIAQaXENv31QfLlOdXSRCkaybRniDHF4C8YcwhcvsqrOVuTP4B2Na+9wLdtrB31uz2rtlFI5kahdsnp/d1SrASDInYCtTYtdoke4kX+hoKWcEWM4Tle8pTUkUVv4BxS6fje/EzKBE4Qu/YsA/yfEEFGcr8Z57VKDw8uQzpiru7g4lvjnfapW62W030syevD8k07SGoxUHiuT/ai7gAHWWhDsVmg/C63ajgpkH7Sn3GdutArDTfyqOkdqv4/IPC/EFFy7mGkfDd2C57N5a/4jC+BbmJy7wQaSEZr0CQU88lPtUxIVvzGjC95b8Ooss2TqmkrayGKofkPMGQn7Ux+9lfwBSNfxwH8NgbpqC/7LNlV4I7nCvsXf3p+ohQk9NrAJb2KAFpUqEIJ9ZBV7BYDzHF/ORKYlgtvPnXjudZQ6CEo5OzUDaNIomTCCsvhD16TxJjsbgne1kGnQPCFSoaxUbq2V1bPMFQ3VYP6wDZ9bKStCFKx9A3tNbwZFC5ZGAN83MFK7XoTy+OmmcFEr6rLOjfSuTfPvHJkSVxW6Qllwkl67XcBi5v00u2gQsbu+38sp+rd5pA/LvyWj4P94ZGZwc1tE2P88xekCLcAwZGb+UhFzL/7K26csOb57yM5bvF9xJrLEObOkAAAAAn+HWRkdcPKyFFMnVwEoD7vnD0jCKFIU1sImubYCxNTSVzsKpaQX+fzNxrLAI3L14JQnJx/D6Uk2LADIHGqnGELzjEbkBDAlaM77NkXMPfqXNLSveCkWI7UEgNs31WEWB6XHSYI/v5DklHOb4QTtDOR804PVbi3fjloZeLR2F8d4FuZmMMO7ck3Fnkn2zEMG5gOmqsygb6PjTitArVl52NhcSznTxVnguaIJxiZkAnurDmn3MWR0PC2GLghp2KJqHCc6QQ85odeIjFHKOlRlJyeSXVJmL8vb1UgOzsbJPVP8p6zM4M3C1Sd7uWIHP33G42AP2Zg8ucn/n6meQjjD266JgCWdxZD6PXs9CsnIeL7SSG0/6lGb9xfP0ZcWkCXB/3hjxHYVXjra/GPOeXGk0fLLKjCbk+mgs2w6d2oCwimBipTzuoZ30GiI8ij8VRzD5CzMWtu2m21eDBIfjGAEo4pQeNNonKcqzV/cleX8ySZLOHsz8PtBCrLqF+VkLm9hOzIT+6i/nIf6keR4GWKMOD4AvqfpjHoD4DuhBpz8P28+DxkGrDXXr/nr20x291VPvcTU/b+b+o2kC9G0kcXeTlLjU6a2TQXWlZ4gBUdBl1jgT7mObSTpLblNiXZsLkbmVXZwvFKXua5cUKlWed/w30skmEUraTuQqtqr5fHZPW9n57EmeTif6LjHL2YJFZkQU+TrJmFzqzmF4/b8OwrPQAprl8mX3q4LUIdAS/a+11B6DWD1Xk2++Sn94dLC4xjkO4Wtlw8c4XuzciVbepHOmnoWzVu/0y3KCrLCSfQxQ3br8DJCoVzhgtPsS2nZZjsBGIZgnU0QpMv+2MnRsnKwdp1VsrCX84j/qvaZn4WhKunippgTbN2EUs0tPTP55Qfgj+nKmjtWW5IYs72FrEwJKYoNfsmqaF4o5pf4v9zgPwVwY/5I4XJKUL2L25m9kAQcW/K+H1RTFEUoj8Z4ajpOmAB/dG0COmCphVMW2CCMvnxhcGiSgPnpDuWu6qiJ7NG7ye5kvHgefgqPLeicspNJ5EpL3XiRNLM2tmJLI1awAwOyd6iHv0dCkMYRKaa6rcaZeYwmKCkckm0kM2JNmnmmAaBQQ7mwmIM0IMxX4f5W6j9PqZWcJxF7r17T/lQBAmcjoupRiJifbnXCNUv9GhpRF19WcBdeKbivRJVlGop6I2RS6lGImJ9udcI1S/0aGlEXX1ZwF14puK9ElWUainojZFYVHLHD6dIP2ESjqBzg3ol1/wB7+/ylGwd9LS7wSZ2A630CJSVKwH47K9P4bB8PEQP8BwjMFa7xQHOqZFP1XqaQ==","base64"))})};import{PublicKey as Oe,sendAndConfirmTransaction as ir,SystemProgram as hn,Transaction as rt,TransactionMessage as Ke,VersionedTransaction as Me}from"@solana/web3.js";import Ri from"axios";import{LAMPORTS_PER_SOL as wn}from"@solana/web3.js";var Ci="http://sg-sender.helius-rpc.com/fast",Dc=.001*wn,bn=["4ACfpUFoaSD9bfPdeu6DBt89gB6ENTeHBXCAi87NhDEE","D2L6yPZ2FmmmTKPgzaMKdhu6EWZcTpLy1Vhx8uvZe7NZ","9bnz4RShgq1hAnLnZbP8kbgBg1kEmcJBYQq3gQbmnSta","5VY91ws6B2hMmBFRsXkoAAdsPHBJwRfBht4DXox3xkwn","2nyhqdwKcJZR2vcqCyrYsaPVdAnFoJjiksCXJ7hfEYgD","2q5pghRs6arqVjRvT5gfgWfWcHWmw1ZuCzphgd5KfWGJ","wyvPkWjVZz1M8fHQnMMCDTQDbkManefNNhweYk5WkcF","3KCKozbAaF75qEU33jtzozcJ29yJuaLJTy2jFdzUY8bT","4vieeGHPYPG2MmyPRcYjdiDmmhN3ww7hsFNap8pVN3Ey","4TQLFNWK8AovT1gFvda5jfw2oJeRMKEmw7aH6MGBJ3or"].map(e=>new Oe(e)),Lt=2e3;async function Ki(e){let t=Buffer.from(e.serialize()).toString("base64"),n=await(await fetch(Ci,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({jsonrpc:"2.0",id:Date.now().toString(),method:"sendTransaction",params:[t,{encoding:"base64",skipPreflight:!0,maxRetries:0}]})})).json();if(console.log("Helius response:",JSON.stringify(n,null,2)),n.error)throw new Error(n.error.message);let o=n.result;return console.log("Transaction sent:",o),o}var Bt=class{constructor(t){this.instructions=[];this.endInstructions=[];this.lookupTableAddress=[];this.signers=[];this.instructionTypes=[];this.endInstructionTypes=[];this.connection=t.connection,this.feePayer=t.feePayer,this.signAllTransactions=t.signAllTransactions,this.owner=t.owner,this.cluster=t.cluster,this.blockhashCommitment=t.blockhashCommitment,this.loopMultiTxStatus=!!t.loopMultiTxStatus}get AllTxData(){return{instructions:this.instructions,endInstructions:this.endInstructions,signers:this.signers,instructionTypes:this.instructionTypes,endInstructionTypes:this.endInstructionTypes,lookupTableAddress:this.lookupTableAddress}}get allInstructions(){return[...this.instructions,...this.endInstructions]}async getComputeBudgetConfig(){var n;let t=(await Ri.get(`https://solanacompass.com/api/fees?cacheFreshTime=${3e5}`)).data,{avg:r}=(n=t==null?void 0:t[15])!=null?n:{};if(!!r)return{units:6e5,microLamports:Math.min(Math.ceil(r*1e6/6e5),25e3)}}addCustomComputeBudget(t){if(t){let{instructions:r,instructionTypes:n}=At(t);return this.instructions.unshift(...r),this.instructionTypes.unshift(...n),!0}return!1}addTipInstruction(t){var r;return t?(this.endInstructions.push(hn.transfer({fromPubkey:(r=t.feePayer)!=null?r:this.feePayer,toPubkey:new Oe(t.address),lamports:BigInt(t.amount.toString())})),this.endInstructionTypes.push(H.TransferTip),!0):!1}async calComputeBudget({config:t,defaultIns:r}){try{let n=t||await this.getComputeBudgetConfig();if(this.addCustomComputeBudget(n))return;r&&this.instructions.unshift(...r)}catch{r&&this.instructions.unshift(...r)}}addInstruction({instructions:t=[],endInstructions:r=[],signers:n=[],instructionTypes:o=[],endInstructionTypes:i=[],lookupTableAddress:s=[]}){return this.instructions.push(...t),this.endInstructions.push(...r),this.signers.push(...n),this.instructionTypes.push(...o),this.endInstructionTypes.push(...i),this.lookupTableAddress.push(...s.filter(a=>a!==Oe.default.toString())),this}async versionBuild({txVersion:t,extInfo:r}){return t===0?await this.buildV0(J({},r||{})):this.build(r)}build(t){var n;let r=new rt;return this.allInstructions.length&&r.add(...this.allInstructions),r.feePayer=this.feePayer,((n=this.owner)==null?void 0:n.signer)&&!this.signers.some(o=>o.publicKey.equals(this.owner.publicKey))&&this.signers.push(this.owner.signer),{builder:this,transaction:r,signers:this.signers,instructionTypes:[...this.instructionTypes,...this.endInstructionTypes],execute:async o=>{var d;let{recentBlockHash:i,skipPreflight:s=!0,sendAndConfirm:a,notSendToRpc:c}=o||{},u=i!=null?i:await je(this.connection,this.blockhashCommitment);if(r.recentBlockhash=u,this.signers.length&&r.sign(...this.signers),De([r]),console.log("SEND 1"),(d=this.owner)!=null&&d.isKeyPair)return{txId:a?await ir(this.connection,r,this.signers.find(f=>f.publicKey.equals(this.owner.publicKey))?this.signers:[...this.signers,this.owner.signer],{skipPreflight:s}):await this.connection.sendRawTransaction(r.serialize(),{skipPreflight:s}),signedTx:r};if(this.signAllTransactions){let l=await this.signAllTransactions([r]);if(this.signers.length)for(let f of l)try{f.sign(...this.signers)}catch{}return{txId:c?"":await this.connection.sendRawTransaction(l[0].serialize(),{skipPreflight:s}),signedTx:l[0]}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:t||{}}}buildMultiTx(t){var u;let{extraPreBuildData:r=[],extInfo:n}=t,{transaction:o}=this.build(n),i=r.filter(d=>d.transaction.instructions.length>0),s=[o,...i.map(d=>d.transaction)],a=[this.signers,...i.map(d=>d.signers)],c=[...this.instructionTypes,...i.map(d=>d.instructionTypes).flat()];return(u=this.owner)!=null&&u.signer&&a.forEach(d=>{d.some(l=>l.publicKey.equals(this.owner.publicKey))||this.signers.push(this.owner.signer)}),{builder:this,transactions:s,signers:a,instructionTypes:c,execute:async d=>{var x;let{sequentially:l,onTxUpdate:f,skipTxCount:p=0,recentBlockHash:m,skipPreflight:g=!0}=d||{},b=m!=null?m:await je(this.connection,this.blockhashCommitment);if((x=this.owner)!=null&&x.isKeyPair){if(l){let I=[],k=0;for(let w of s){if(++k,k<=p)continue;let A=await ir(this.connection,w,this.signers.find(P=>P.publicKey.equals(this.owner.publicKey))?this.signers:[...this.signers,this.owner.signer],{skipPreflight:g});I.push(A)}return{txIds:I,signedTxs:s}}return{txIds:await await Promise.all(s.map(async I=>(I.recentBlockhash=b,await this.connection.sendRawTransaction(I.serialize(),{skipPreflight:g})))),signedTxs:s}}if(this.signAllTransactions){let I=s.map((w,A)=>(w.recentBlockhash=b,a[A].length&&w.sign(...a[A]),w));De(I),console.log("SEND 2");let k=await this.signAllTransactions(I);if(l){let w=0,A=[],P=async()=>{if(!k[w])return;let R=await this.connection.sendRawTransaction(k[w].serialize(),{skipPreflight:g});A.push({txId:R,status:"sent",signedTx:k[w]}),f==null||f([...A]),w++;let L=!1,V=null,B=null,N=K=>{V!==null&&clearInterval(V),B!==null&&this.connection.removeSignatureListener(B);let E=A.findIndex(S=>S.txId===R);if(E>-1){if(A[E].status==="error"||A[E].status==="success")return;A[E].status=K.err?"error":"success"}f==null||f([...A]),K.err||P()};this.loopMultiTxStatus&&(V=setInterval(async()=>{var K;if(L){clearInterval(V);return}try{let E=await this.connection.getTransaction(R,{commitment:"confirmed",maxSupportedTransactionVersion:0});E&&(L=!0,clearInterval(V),N({err:((K=E.meta)==null?void 0:K.err)||null}),console.log("tx status from getTransaction:",R))}catch(E){L=!0,clearInterval(V),console.error("getTransaction timeout:",E,R)}},Lt)),B=this.connection.onSignature(R,K=>{if(L){this.connection.removeSignatureListener(B);return}L=!0,N(K)},"confirmed"),this.connection.getSignatureStatus(R)};return await P(),{txIds:A.map(R=>R.txId),signedTxs:k}}else{let w=[];for(let A=0;A<k.length;A+=1){let P=await this.connection.sendRawTransaction(k[A].serialize(),{skipPreflight:g});w.push(P)}return{txIds:w,signedTxs:k}}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:n||{}}}async versionMultiBuild({extraPreBuildData:t,txVersion:r,extInfo:n}){return r===0?await this.buildV0MultiTx({extraPreBuildData:t,buildProps:n||{}}):this.buildMultiTx({extraPreBuildData:t,extInfo:n})}async buildV0(t){var g;let m=t||{},{lookupTableCache:r={},lookupTableAddress:n=[],forerunCreate:o,recentBlockhash:i}=m,s=dt(m,["lookupTableCache","lookupTableAddress","forerunCreate","recentBlockhash"]),a=J(J({},this.cluster==="devnet"?{}:St),r),c=Array.from(new Set([...n,...this.lookupTableAddress])),u=[];for(let b of c)a[b]===void 0&&u.push(new Oe(b));let d=await or({connection:this.connection,address:u});for(let[b,x]of Object.entries(d))a[b]=x;let l=o?Oe.default.toBase58():i!=null?i:await je(this.connection,this.blockhashCommitment),f=new Ke({payerKey:this.feePayer,recentBlockhash:l,instructions:[...this.allInstructions]}).compileToV0Message(Object.values(a));((g=this.owner)==null?void 0:g.signer)&&!this.signers.some(b=>b.publicKey.equals(this.owner.publicKey))&&this.signers.push(this.owner.signer);let p=new Me(f);return p.sign(this.signers),{builder:this,transaction:p,signers:this.signers,instructionTypes:[...this.instructionTypes,...this.endInstructionTypes],execute:async b=>{var w;let{skipPreflight:x=!0,sendAndConfirm:I,notSendToRpc:k}=b||{};if(De([p]),console.log("SEND 3"),(w=this.owner)!=null&&w.isKeyPair){let A=await this.connection.sendTransaction(p,{skipPreflight:x});return I&&await nr(this.connection,A),{txId:A,signedTx:p}}if(this.signAllTransactions){let A=await this.signAllTransactions([p]);if(this.signers.length)for(let P of A)try{P.sign(this.signers)}catch{}return{txId:k?"":await this.connection.sendTransaction(A[0],{skipPreflight:x}),signedTx:A[0]}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:s||{}}}async buildV0MultiTx(t){var u;let{extraPreBuildData:r=[],buildProps:n}=t,{transaction:o}=await this.buildV0(n),i=r.filter(d=>d.builder.instructions.length>0),s=[o,...i.map(d=>d.transaction)],a=[this.signers,...i.map(d=>d.signers)],c=[...this.instructionTypes,...i.map(d=>d.instructionTypes).flat()];return(u=this.owner)!=null&&u.signer&&a.forEach(d=>{d.some(l=>l.publicKey.equals(this.owner.publicKey))||this.signers.push(this.owner.signer)}),s.forEach(async(d,l)=>{d.sign(a[l])}),{builder:this,transactions:s,signers:a,instructionTypes:c,buildProps:n,execute:async d=>{var g;let{sequentially:l,onTxUpdate:f,recentBlockHash:p,skipPreflight:m=!0}=d||{};if(p&&s.forEach(b=>b.message.recentBlockhash=p),De(s),console.log("SEND 4"),(g=this.owner)!=null&&g.isKeyPair){if(l){let b=[];for(let x of s){let I=await this.connection.sendTransaction(x,{skipPreflight:m});await nr(this.connection,I),b.push(I)}return{txIds:b,signedTxs:s}}return{txIds:await Promise.all(s.map(async b=>await this.connection.sendTransaction(b,{skipPreflight:m}))),signedTxs:s}}if(this.signAllTransactions){let b=await this.signAllTransactions(s);if(l){let x=0,I=[],k=async()=>{if(!b[x])return;let w=await this.connection.sendTransaction(b[x],{skipPreflight:m});I.push({txId:w,status:"sent",signedTx:b[x]}),f==null||f([...I]),x++;let A=!1,P=null,R=null,L=V=>{P!==null&&clearInterval(P),R!==null&&this.connection.removeSignatureListener(R);let B=I.findIndex(N=>N.txId===w);if(B>-1){if(I[B].status==="error"||I[B].status==="success")return;I[B].status=V.err?"error":"success"}f==null||f([...I]),V.err||k()};this.loopMultiTxStatus&&(P=setInterval(async()=>{var V;if(A){clearInterval(P);return}try{let B=await this.connection.getTransaction(w,{commitment:"confirmed",maxSupportedTransactionVersion:0});B&&(A=!0,clearInterval(P),L({err:((V=B.meta)==null?void 0:V.err)||null}),console.log("tx status from getTransaction:",w))}catch(B){A=!0,clearInterval(P),console.error("getTransaction timeout:",B,w)}},Lt)),R=this.connection.onSignature(w,V=>{if(A){this.connection.removeSignatureListener(R);return}A=!0,L(V)},"confirmed"),this.connection.getSignatureStatus(w)};return k(),{txIds:[],signedTxs:b}}else{let x=[];for(let I=0;I<b.length;I+=1){let k=await this.connection.sendTransaction(b[I],{skipPreflight:m});x.push(k)}return{txIds:x,signedTxs:b}}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:n||{}}}async sizeCheckBuild(t){var f;let l=t||{},{splitIns:r=[],computeBudgetConfig:n}=l,o=dt(l,["splitIns","computeBudgetConfig"]),i=n?At(n):{instructions:[],instructionTypes:[]},s=this.signers.reduce((p,m)=>te(J({},p),{[m.publicKey.toBase58()]:m}),{}),a=[],c=[],u=[],d=0;if(this.allInstructions.forEach(p=>{let m=[...u,p],g=n?[...i.instructions,...m]:m,x=[...new Set(m.map(I=>I.keys.filter(k=>k.isSigner).map(k=>k.pubkey.toString())).flat()).values()].map(I=>new Oe(I));if(p!==r[d]&&u.length<12&&($e({instructions:g,payer:this.feePayer,signers:x})||$e({instructions:m,payer:this.feePayer,signers:x})))u.push(p);else{if(u.length===0)throw Error("item ins too big");d+=p===r[d]?1:0,$e({instructions:n?[...i.instructions,...u]:[...u],payer:this.feePayer,signers:x})?a.push(new rt().add(...i.instructions,...u)):a.push(new rt().add(...u)),c.push(Array.from(new Set(u.map(I=>I.keys.filter(k=>k.isSigner).map(k=>k.pubkey.toString())).flat())).map(I=>s[I]).filter(I=>I!==void 0)),u=[p]}}),u.length>0){let m=[...new Set(u.map(g=>g.keys.filter(b=>b.isSigner).map(b=>b.pubkey.toString())).flat()).values()].map(g=>s[g]).filter(g=>g!==void 0);$e({instructions:n?[...i.instructions,...u]:[...u],payer:this.feePayer,signers:m.map(g=>g.publicKey)})?a.push(new rt().add(...i.instructions,...u)):a.push(new rt().add(...u)),c.push(m)}return a.forEach(p=>p.feePayer=this.feePayer),(f=this.owner)!=null&&f.signer&&c.forEach(p=>{p.some(m=>m.publicKey.equals(this.owner.publicKey))||p.push(this.owner.signer)}),{builder:this,transactions:a,signers:c,instructionTypes:this.instructionTypes,execute:async p=>{var w;let{sequentially:m,onTxUpdate:g,skipTxCount:b=0,recentBlockHash:x,skipPreflight:I=!0}=p||{},k=x!=null?x:await je(this.connection,this.blockhashCommitment);if(a.forEach(async(A,P)=>{A.recentBlockhash=k,c[P].length&&A.sign(...c[P])}),De(a),console.log("SEND 5"),console.log("sizeCheckBuild"),(w=this.owner)!=null&&w.isKeyPair){if(m){let A=0,P=[];for(let R of a){if(++A,A<=b){P.push("tx skipped");continue}let L=await ir(this.connection,R,this.signers.find(V=>V.publicKey.equals(this.owner.publicKey))?this.signers:[...this.signers,this.owner.signer],{skipPreflight:I});P.push(L)}return{txIds:P,signedTxs:a}}return{txIds:await Promise.all(a.map(async A=>await this.connection.sendRawTransaction(A.serialize(),{skipPreflight:I}))),signedTxs:a}}if(this.signAllTransactions){let A=await this.signAllTransactions(a.slice(b,a.length)),P=[...a.slice(0,b),...A];if(m){let R=0,L=[],V=async()=>{if(!P[R])return;R<b&&(L.push({txId:"",status:"success",signedTx:P[R]}),g==null||g([...L]),R++,V());let B=await this.connection.sendRawTransaction(P[R].serialize(),{skipPreflight:I});L.push({txId:B,status:"sent",signedTx:P[R]}),g==null||g([...L]),R++;let N=!1,K=null,E=null,S=D=>{K!==null&&clearInterval(K),E!==null&&this.connection.removeSignatureListener(E);let M=L.findIndex(ge=>ge.txId===B);if(M>-1){if(L[M].status==="error"||L[M].status==="success")return;L[M].status=D.err?"error":"success"}g==null||g([...L]),D.err||V()};this.loopMultiTxStatus&&(K=setInterval(async()=>{var D;if(N){clearInterval(K);return}try{let M=await this.connection.getTransaction(B,{commitment:"confirmed",maxSupportedTransactionVersion:0});M&&(N=!0,clearInterval(K),S({err:((D=M.meta)==null?void 0:D.err)||null}),console.log("tx status from getTransaction:",B))}catch(M){N=!0,clearInterval(K),console.error("getTransaction timeout:",M,B)}},Lt)),E=this.connection.onSignature(B,D=>{if(N){this.connection.removeSignatureListener(E);return}N=!0,S(D)},"confirmed"),this.connection.getSignatureStatus(B)};return await V(),{txIds:L.map(B=>B.txId),signedTxs:P}}else{let R=[];for(let L=0;L<P.length;L+=1){let V=await this.connection.sendRawTransaction(P[L].serialize(),{skipPreflight:I});R.push(V)}return{txIds:R,signedTxs:P}}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:o||{}}}async sizeCheckBuildV0(t){var k;let I=t||{},{computeBudgetConfig:r,splitIns:n=[],lookupTableCache:o={},lookupTableAddress:i=[]}=I,s=dt(I,["computeBudgetConfig","splitIns","lookupTableCache","lookupTableAddress"]),a=J(J({},this.cluster==="devnet"?{}:St),o),c=Array.from(new Set([...this.lookupTableAddress,...i])),u=[];for(let w of c)a[w]===void 0&&u.push(new Oe(w));let d=await or({connection:this.connection,address:u});for(let[w,A]of Object.entries(d))a[w]=A;let l=r?At(r):{instructions:[],instructionTypes:[]},f=await je(this.connection,this.blockhashCommitment),p=this.signers.reduce((w,A)=>te(J({},w),{[A.publicKey.toBase58()]:A}),{}),m=[],g=[],b=[],x=0;if(this.allInstructions.forEach(w=>{let A=[...b,w],P=r?[...l.instructions,...A]:A;if(w!==n[x]&&b.length<12&&(et({instructions:P,payer:this.feePayer,lookupTableAddressAccount:a})||et({instructions:A,payer:this.feePayer,lookupTableAddressAccount:a})))b.push(w);else{if(b.length===0)throw Error("item ins too big");x+=w===n[x]?1:0;let R={};for(let L of[...new Set(c)])a[L]!==void 0&&(R[L]=a[L]);if(r&&et({instructions:[...l.instructions,...b],payer:this.feePayer,lookupTableAddressAccount:a,recentBlockhash:f})){let L=new Ke({payerKey:this.feePayer,recentBlockhash:f,instructions:[...l.instructions,...b]}).compileToV0Message(Object.values(a));m.push(new Me(L))}else{let L=new Ke({payerKey:this.feePayer,recentBlockhash:f,instructions:[...b]}).compileToV0Message(Object.values(a));m.push(new Me(L))}g.push(Array.from(new Set(b.map(L=>L.keys.filter(V=>V.isSigner).map(V=>V.pubkey.toString())).flat())).map(L=>p[L]).filter(L=>L!==void 0)),b=[w]}}),b.length>0){let A=[...new Set(b.map(S=>S.keys.filter(D=>D.isSigner).map(D=>D.pubkey.toString())).flat()).values()].map(S=>p[S]).filter(S=>S!==void 0),P=bn[Math.floor(Math.random()*bn.length)],R=hn.transfer({fromPubkey:this.feePayer,toPubkey:P,lamports:Math.floor(.001*wn)});if(r&&et({instructions:[R,...l.instructions,...b],payer:this.feePayer,lookupTableAddressAccount:a,recentBlockhash:f})){console.log("MESSAGE 1");let S=new Ke({payerKey:this.feePayer,recentBlockhash:f,instructions:[R,...b]}).compileToV0Message(Object.values(a));m.push(new Me(S))}else{console.log("MESSAGE 2");let S=new Ke({payerKey:this.feePayer,recentBlockhash:f,instructions:[R,...b]}).compileToV0Message(Object.values(a));m.push(new Me(S))}let L=new Ke({payerKey:this.feePayer,recentBlockhash:f,instructions:[R]}).compileToV0Message([]),V=new Me(L);console.log("\u{1F4E6} Tip-only tx size:",V.serialize().length);let B=new Ke({payerKey:this.feePayer,recentBlockhash:f,instructions:[...l.instructions]}).compileToV0Message(Object.values(a)),N=new Me(B);console.log("\u{1F4E6} computeTx-only tx size:",N.serialize().length),g.push(A);let K=new Ke({payerKey:this.feePayer,recentBlockhash:f,instructions:[...b]}).compileToV0Message([]),E=new Me(K);console.log("\u{1F4E6} instructionTx-only tx size:",E.serialize().length),g.push(A)}return(k=this.owner)!=null&&k.signer&&g.forEach(w=>{w.some(A=>A.publicKey.equals(this.owner.publicKey))||w.push(this.owner.signer)}),m.forEach((w,A)=>{w.sign(g[A]),console.log(`Tx #${A+1} size (bytes):`,w.serialize().length)}),{builder:this,transactions:m,buildProps:t,signers:g,instructionTypes:this.instructionTypes,execute:async w=>{var B;let{sequentially:A,onTxUpdate:P,skipTxCount:R=0,recentBlockHash:L,skipPreflight:V=!0}=w||{};if(m.map(async(N,K)=>{g[K].length&&N.sign(g[K]),L&&(N.message.recentBlockhash=L)}),De(m),console.log("SEND 6"),console.log("sizeCheckBuildV0"),(B=this.owner)!=null&&B.isKeyPair){console.log("send transactions using Helius Sender");for(let N of m){let K=await Ki(N);console.log("Sent tx:",K)}return{txIds:[],signedTxs:[]}}if(this.signAllTransactions){let N=await this.signAllTransactions(m.slice(R,m.length)),K=[...m.slice(0,R),...N];if(A){let E=0,S=[],D=async()=>{if(!K[E])return;if(E<R){S.push({txId:"",status:"success",signedTx:K[E]}),P==null||P([...S]),E++,D();return}let M=await this.connection.sendTransaction(K[E],{skipPreflight:V});S.push({txId:M,status:"sent",signedTx:K[E]}),P==null||P([...S]),E++;let ge=!1,ye=null,ct=null,Mr=Ee=>{ye!==null&&clearInterval(ye),ct!==null&&this.connection.removeSignatureListener(ct);let he=S.findIndex(zn=>zn.txId===M);if(he>-1){if(S[he].status==="error"||S[he].status==="success")return;S[he].status=Ee.err?"error":"success"}P==null||P([...S]),Ee.err||D()};this.loopMultiTxStatus&&(ye=setInterval(async()=>{var Ee;if(ge){clearInterval(ye);return}try{let he=await this.connection.getTransaction(M,{commitment:"confirmed",maxSupportedTransactionVersion:0});he&&(ge=!0,clearInterval(ye),Mr({err:((Ee=he.meta)==null?void 0:Ee.err)||null}),console.log("tx status from getTransaction:",M))}catch(he){ge=!0,clearInterval(ye),console.error("getTransaction timeout:",he,M)}},Lt)),ct=this.connection.onSignature(M,Ee=>{if(ge){this.connection.removeSignatureListener(ct);return}ge=!0,Mr(Ee)},"confirmed"),this.connection.getSignatureStatus(M)};return D(),{txIds:[],signedTxs:K}}else{let E=[];for(let S=0;S<K.length;S+=1){let D=await this.connection.sendTransaction(K[S],{skipPreflight:V});E.push(D)}return{txIds:E,signedTxs:K}}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:s||{}}}};import Mi from"bn.js";var Uc=new Mi(1e6);import{Keypair as Hi,PublicKey as zi}from"@solana/web3.js";import Sd from"bn.js";import{TOKEN_PROGRAM_ID as Zi}from"@solana/spl-token";function vi(e){return e instanceof Uint8Array||e!=null&&typeof e=="object"&&e.constructor.name==="Uint8Array"}function sr(e,...t){if(!vi(e))throw new Error("Uint8Array expected");if(t.length>0&&!t.includes(e.length))throw new Error(`Uint8Array expected of length ${t}, not of length=${e.length}`)}function ar(e,t=!0){if(e.destroyed)throw new Error("Hash instance has been destroyed");if(t&&e.finished)throw new Error("Hash#digest() has already been called")}function Tn(e,t){sr(e);let r=t.outputLen;if(e.length<r)throw new Error(`digestInto() expects output buffer of length at least ${r}`)}var Ct=e=>new DataView(e.buffer,e.byteOffset,e.byteLength),fe=(e,t)=>e<<32-t|e>>>t;var dl=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;function Vi(e){if(typeof e!="string")throw new Error(`utf8ToBytes expected string, got ${typeof e}`);return new Uint8Array(new TextEncoder().encode(e))}function ur(e){return typeof e=="string"&&(e=Vi(e)),sr(e),e}var Rt=class{clone(){return this._cloneInto()}},fl={}.toString;function Pn(e){let t=n=>e().update(ur(n)).digest(),r=e();return t.outputLen=r.outputLen,t.blockLen=r.blockLen,t.create=()=>e(),t}function Ni(e,t,r,n){if(typeof e.setBigUint64=="function")return e.setBigUint64(t,r,n);let o=BigInt(32),i=BigInt(4294967295),s=Number(r>>o&i),a=Number(r&i),c=n?4:0,u=n?0:4;e.setUint32(t+c,s,n),e.setUint32(t+u,a,n)}var xn=(e,t,r)=>e&t^~e&r,kn=(e,t,r)=>e&t^e&r^t&r,Kt=class extends Rt{constructor(t,r,n,o){super(),this.blockLen=t,this.outputLen=r,this.padOffset=n,this.isLE=o,this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.buffer=new Uint8Array(t),this.view=Ct(this.buffer)}update(t){ar(this);let{view:r,buffer:n,blockLen:o}=this;t=ur(t);let i=t.length;for(let s=0;s<i;){let a=Math.min(o-this.pos,i-s);if(a===o){let c=Ct(t);for(;o<=i-s;s+=o)this.process(c,s);continue}n.set(t.subarray(s,s+a),this.pos),this.pos+=a,s+=a,this.pos===o&&(this.process(r,0),this.pos=0)}return this.length+=t.length,this.roundClean(),this}digestInto(t){ar(this),Tn(t,this),this.finished=!0;let{buffer:r,view:n,blockLen:o,isLE:i}=this,{pos:s}=this;r[s++]=128,this.buffer.subarray(s).fill(0),this.padOffset>o-s&&(this.process(n,0),s=0);for(let l=s;l<o;l++)r[l]=0;Ni(n,o-8,BigInt(this.length*8),i),this.process(n,0);let a=Ct(t),c=this.outputLen;if(c%4)throw new Error("_sha2: outputLen should be aligned to 32bit");let u=c/4,d=this.get();if(u>d.length)throw new Error("_sha2: outputLen bigger than state");for(let l=0;l<u;l++)a.setUint32(4*l,d[l],i)}digest(){let{buffer:t,outputLen:r}=this;this.digestInto(t);let n=t.slice(0,r);return this.destroy(),n}_cloneInto(t){t||(t=new this.constructor),t.set(...this.get());let{blockLen:r,buffer:n,length:o,finished:i,destroyed:s,pos:a}=this;return t.length=o,t.pos=a,t.finished=i,t.destroyed=s,o%r&&t.buffer.set(n),t}};var Ei=new Uint32Array([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),ve=new Uint32Array([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),Ve=new Uint32Array(64),cr=class extends Kt{constructor(){super(64,32,8,!1),this.A=ve[0]|0,this.B=ve[1]|0,this.C=ve[2]|0,this.D=ve[3]|0,this.E=ve[4]|0,this.F=ve[5]|0,this.G=ve[6]|0,this.H=ve[7]|0}get(){let{A:t,B:r,C:n,D:o,E:i,F:s,G:a,H:c}=this;return[t,r,n,o,i,s,a,c]}set(t,r,n,o,i,s,a,c){this.A=t|0,this.B=r|0,this.C=n|0,this.D=o|0,this.E=i|0,this.F=s|0,this.G=a|0,this.H=c|0}process(t,r){for(let l=0;l<16;l++,r+=4)Ve[l]=t.getUint32(r,!1);for(let l=16;l<64;l++){let f=Ve[l-15],p=Ve[l-2],m=fe(f,7)^fe(f,18)^f>>>3,g=fe(p,17)^fe(p,19)^p>>>10;Ve[l]=g+Ve[l-7]+m+Ve[l-16]|0}let{A:n,B:o,C:i,D:s,E:a,F:c,G:u,H:d}=this;for(let l=0;l<64;l++){let f=fe(a,6)^fe(a,11)^fe(a,25),p=d+f+xn(a,c,u)+Ei[l]+Ve[l]|0,g=(fe(n,2)^fe(n,13)^fe(n,22))+kn(n,o,i)|0;d=u,u=c,c=a,a=s+p|0,s=i,i=o,o=n,n=p+g|0}n=n+this.A|0,o=o+this.B|0,i=i+this.C|0,s=s+this.D|0,a=a+this.E|0,c=c+this.F|0,u=u+this.G|0,d=d+this.H|0,this.set(n,o,i,s,a,c,u,d)}roundClean(){Ve.fill(0)}destroy(){this.set(0,0,0,0,0,0,0,0),this.buffer.fill(0)}};var An=Pn(()=>new cr);import{PublicKey as qi}from"@solana/web3.js";import Bn,{isBN as Rn}from"bn.js";import{bits as Pl,BitStructure as xl,blob as Fi,Blob as kl,cstr as Al,f32 as Il,f32be as Sl,f64 as Ll,f64be as Bl,greedy as Rl,Layout as _i,ns64 as Cl,ns64be as Kl,nu64 as Ml,nu64be as vl,offset as Vl,s16 as Nl,s16be as El,s24 as Fl,s24be as _l,s32 as Dl,s32be as Ol,s40 as Wl,s40be as Ul,s48 as ql,s48be as Gl,s8 as jl,seq as Di,struct as Hl,Structure as Oi,u16 as zl,u16be as Zl,u24 as Jl,u24be as Ql,u32 as Xl,u32be as Yl,u40 as $l,u40be as ed,u48 as td,u48be as rd,u8 as Wi,UInt as Ui,union as nd,Union as od,unionLayoutDiscriminator as id,utf8 as sd}from"@solana/buffer-layout";var lr=_i,In=Oi;var dr=Ui;var Sn=Wi;var Ln=Di;var We=Fi;var ze=class extends lr{constructor(r,n,o){super(r,o);this.blob=We(r),this.signed=n}decode(r,n=0){let o=new Bn(this.blob.decode(r,n),10,"le");return this.signed?o.fromTwos(this.span*8).clone():o}encode(r,n,o=0){return typeof r=="number"&&(r=new Bn(r)),this.signed&&(r=r.toTwos(this.span*8)),this.blob.encode(r.toArrayLike(Buffer,"le",this.span),n,o)}};function ee(e){return new dr(1,e)}function nt(e){return new dr(4,e)}function T(e){return new ze(8,!1,e)}function Ae(e){return new ze(16,!1,e)}function Cn(e){return new ze(1,!0,e)}function vt(e){return new ze(8,!0,e)}var Mt=class extends lr{constructor(r,n,o,i){super(r.span,i);this.layout=r,this.decoder=n,this.encoder=o}decode(r,n){return this.decoder(this.layout.decode(r,n))}encode(r,n,o){return this.layout.encode(this.encoder(r),n,o)}getSpan(r,n){return this.layout.getSpan(r,n)}};function q(e){return new Mt(We(32),t=>new qi(t),t=>t.toBuffer(),e)}function Vt(e){return new Mt(Sn(),Gi,ji,e)}function Gi(e){if(e===0)return!1;if(e===1)return!0;throw new Error("Invalid bool: "+e)}function ji(e){return e?1:0}var fr=class extends In{decode(t,r){return super.decode(t,r)}};function Q(e,t,r){return new fr(e,t,r)}function Y(e,t,r){let n,o=typeof t=="number"?t:Rn(t)?t.toNumber():new Proxy(t,{get(i,s){if(!n){let a=Reflect.get(i,"count");n=Rn(a)?a.toNumber():a,Reflect.set(i,"count",n)}return Reflect.get(i,s)},set(i,s,a){return s==="count"&&(n=a),Reflect.set(i,s,a)}});return Ln(e,o,r)}var ot=Q([q("mint"),q("owner"),T("amount"),nt("delegateOption"),q("delegate"),ee("state"),nt("isNativeOption"),T("isNative"),T("delegatedAmount"),nt("closeAuthorityOption"),q("closeAuthority")]);var Kd=$("Raydium_Util");function Nt({fromPublicKey:e,programId:t=Zi,assignSeed:r}){let n=r?btoa(r).slice(0,32):Hi.generate().publicKey.toBase58().slice(0,32);return{publicKey:Ji(e,n,t),seed:n}}function Ji(e,t,r){let n=Buffer.concat([e.toBuffer(),Buffer.from(t),r.toBuffer()]),o=An(n);return new zi(o)}import{PublicKey as Qi,SystemProgram as Xi}from"@solana/web3.js";import Yi from"bn.js";import{createCloseAccountInstruction as $i,createInitializeAccountInstruction as es,createTransferInstruction as Ud,TOKEN_PROGRAM_ID as it}from"@solana/spl-token";function ts(e){let{mint:t,tokenAccount:r,owner:n,programId:o=it}=e;return es(r,t,n,o)}function rs(e){let{tokenAccount:t,payer:r,multiSigners:n=[],owner:o,programId:i=it}=e;return $i(t,r,o,n,i)}async function pr(e){let{connection:t,amount:r,commitment:n,payer:o,owner:i,skipCloseAccount:s}=e,a=await t.getMinimumBalanceForRentExemption(ot.span,n),c=U(r).add(new Yi(a)),u=Nt({fromPublicKey:o,programId:it});return{addresses:{newAccount:u.publicKey},signers:[],instructions:[Xi.createAccountWithSeed({fromPubkey:o,basePubkey:o,seed:u.seed,newAccountPubkey:u.publicKey,lamports:c.toNumber(),space:ot.span,programId:it}),ts({mint:new Qi(se.address),tokenAccount:u.publicKey,owner:i,programId:it})],instructionTypes:[H.CreateAccount,H.InitAccount],endInstructionTypes:s?[]:[H.CloseAccount],endInstructions:s?[]:[rs({tokenAccount:u.publicKey,payer:o,owner:i})]}}var mr=(...e)=>e.map(t=>{try{return typeof t=="object"?JSON.stringify(t):t}catch{return t}}).join(", "),st=class{constructor({scope:t,moduleName:r}){this.disabled=!1;this.scope=t,this.logger=$(r)}createTxBuilder(t){return this.scope.checkOwner(),new Bt({connection:this.scope.connection,feePayer:t||this.scope.ownerPubKey,cluster:this.scope.cluster,owner:this.scope.owner,blockhashCommitment:this.scope.blockhashCommitment,loopMultiTxStatus:this.scope.loopMultiTxStatus,api:this.scope.api,signAllTransactions:this.scope.signAllTransactions})}logDebug(...t){this.logger.debug(mr(t))}logInfo(...t){this.logger.info(mr(t))}logAndCreateError(...t){let r=mr(t);throw new Error(r)}checkDisabled(){(this.disabled||!this.scope)&&this.logAndCreateError("module not working")}};import{PublicKey as vn}from"@solana/web3.js";var gr=Q([ee("instruction")]),yr=Q([ee("instruction")]),ns=Q([T("rewardState"),T("rewardOpenTime"),T("rewardEndTime"),T("rewardLastUpdateTime"),T("totalReward"),T("totalRewardEmissioned"),T("rewardClaimed"),T("rewardPerSecond"),Ae("accRewardPerShare"),q("rewardVault"),q("rewardMint"),q("rewardSender"),T("rewardType"),Y(T(),15,"padding")]),os=Q([T("state"),T("nonce"),q("lpVault"),q("rewardVault"),q(),q(),T(),T(),T("totalReward"),Ae("perShareReward"),T("lastSlot"),T("perSlotReward")]),is=Q([T("state"),T("nonce"),q("lpVault"),q("rewardVaultA"),T("totalRewardA"),Ae("perShareRewardA"),T("perSlotRewardA"),ee("option"),q("rewardVaultB"),We(7),T("totalRewardB"),Ae("perShareRewardB"),T("perSlotRewardB"),T("lastSlot"),q()]),ss=Q([T(),T("state"),T("nonce"),T("validRewardTokenNum"),Ae("rewardMultiplier"),T("rewardPeriodMax"),T("rewardPeriodMin"),T("rewardPeriodExtend"),q("lpMint"),q("lpVault"),Y(ns,5,"rewardInfos"),q("creator"),q(),Y(T(),32,"padding")]),as=new Proxy(os,{get(e,t,r){return t==="decode"?(...n)=>{let o=e.decode(...n);return te(J({},o),{version:3,rewardInfos:[{rewardVault:o.rewardVault,totalReward:o.totalReward,perSlotReward:o.perSlotReward,perShareReward:o.perShareReward}]})}:Reflect.get(e,t,r)}}),us=new Proxy(is,{get(e,t,r){return t==="decode"?(...n)=>{let o=e.decode(...n);return te(J({},o),{version:5,rewardInfos:[{rewardVault:o.rewardVaultA,totalReward:o.totalRewardA,perSlotReward:o.perSlotRewardA,perShareReward:o.perShareRewardA},{rewardVault:o.rewardVaultB,totalReward:o.totalRewardB,perSlotReward:o.perSlotRewardB,perShareReward:o.perShareRewardB}]})}:Reflect.get(e,t,r)}}),Et=new Proxy(ss,{get(e,t,r){return t==="decode"?(...n)=>{let o=e.decode(...n);return te(J({},o),{version:6,rewardInfos:o.rewardInfos.map(i=>{var s;return te(J({},i),{rewardType:((s=Object.entries(Ne).find(a=>String(a[1])===i.rewardType.toString()))!=null?s:["Standard SPL"])[0]})})})}:Reflect.get(e,t,r)}}),cs=Q([T("isSet"),T("rewardPerSecond"),T("rewardOpenTime"),T("rewardEndTime"),T("rewardType")]),hr=Q([ee("instruction"),T("nonce"),Y(cs,5,"rewardTimeInfo")]),br=Q([ee("instruction"),T("rewardReopenTime"),T("rewardEndTime"),T("rewardPerSecond")]),wr=Q([ee("instruction"),T("isSet"),T("rewardPerSecond"),T("rewardOpenTime"),T("rewardEndTime"),T("rewardType")]),nf=Q([T("state"),q("id"),q("owner"),T("deposited"),Y(T(),1,"rewardDebts")]),Tr=Q([T("state"),q("id"),q("owner"),T("deposited"),Y(Ae(),1,"rewardDebts"),T(""),T("voteLockedBalance"),Y(T(),15)]),of=Q([T("state"),q("id"),q("owner"),T("deposited"),Y(T(),2,"rewardDebts")]),Kn=Q([T("state"),q("id"),q("owner"),T("deposited"),Y(Ae(),2,"rewardDebts"),Y(T(),17)]),Mn=Q([T(),T("state"),q("id"),q("owner"),T("deposited"),Y(Ae(),5,"rewardDebts"),Y(T(),16)]),ue=Q([ee("instruction"),T("amount")]),ls=Q([q("mint"),q("grantAuthority"),T("baselineVoteWeightScaledFactor"),T("maxExtraLockupVoteWeightScaledFactor"),T("lockupSaturationSecs"),Cn("digitShift"),Y(ee(),7,"reserved1"),Y(T(),7,"reserved2")]),ds=Q([We(8),q("governanceProgramId"),q("realm"),q("realmGoverningTokenMint"),q("realmAuthority"),Y(ee(),32,"reserved1"),Y(ls,4,"votingMints"),vt("timeOffset"),ee("bump"),Y(ee(),7,"reserved2"),Y(T(),11,"reserved3")]),fs=Q([vt("startTime"),vt("endTime"),ee("kind"),Y(ee(),15,"reserved")]),ps=Q([Y(fs,1,"lockup"),T("amountDeposited_native"),T("amountInitiallyLockedNative"),Vt("isUsed"),Vt("allowClawback"),ee("votingMintConfigIdx"),Y(ee(),29,"reserved")]),ms=Q([We(8),q("voterAuthority"),q("registrar"),Y(ps,32,"deposits"),ee("voterBump"),ee("voterWweightRecordBump"),Y(ee(),94,"reserved")]);var pf=$("Raydium_farm_config"),Vn=new vn("4k3Dyjzvzp8eMZWUXbBCjEvwSkkk59S5iCNLY3QrkX6R"),Nn=new vn("FrspKwj8i3pNmKwXreTveC4fu7KL5ZbGeXdZBe2XViu1");var En={3:Tr,5:Kn,6:Mn},Pr=e=>[3,4,5,6].indexOf(e)!==-1,xr=e=>{var s;let{version:t,rewardInfos:r,rewardTokenAccountsPublicKeys:n}=e,o=`rewardInfo:${JSON.stringify(r)}, rewardAccount:${JSON.stringify(n)}`,i={3:()=>{if(r.length!==1||n.length!==1)return`rewardInfos or rewardTokenAccounts lengths not equal 1: ${o}`},5:()=>{if(r.length!==n.length)return`rewardInfos and rewardTokenAccounts lengths not equal: ${o}`},6:()=>{if(!n.length||r.length!==n.length)return`no rewardTokenAccounts or rewardInfos and rewardTokenAccounts lengths not equal: ${o}`}};return(s=i[t])==null?void 0:s.call(i)},Ne={"Standard SPL":0,"Option tokens":1},Ie={[pn.toString()]:3,[mn.toString()]:4,[gn.toString()]:5,[tt.toString()]:6};import{PublicKey as G,SystemProgram as Dn,SYSVAR_CLOCK_PUBKEY as ut,SYSVAR_RENT_PUBKEY as hs,TransactionInstruction as ce}from"@solana/web3.js";import On from"bn.js";import{ASSOCIATED_TOKEN_PROGRAM_ID as Hf,createAssociatedTokenAccountIdempotentInstruction as zf,TOKEN_PROGRAM_ID as Se}from"@solana/spl-token";import gs from"bn.js";var ys=$("Raydium.farm.util");function at({programId:e,poolId:t,mint:r,type:n}){let{publicKey:o}=_e([t.toBuffer(),r.toBuffer(),Buffer.from(n==="lpVault"?"lp_vault_associated_seed":n==="rewardVault"?"reward_vault_associated_seed":"","utf-8")],e);return o}function me({programId:e,poolId:t,owner:r,version:n}){let{publicKey:o}=_e([t.toBuffer(),r.toBuffer(),Buffer.from(n===6?"farmer_info_associated_seed":"staker_info_v2_associated_seed","utf-8")],e);return o}var Fn=({programId:e,poolId:t})=>_e([t.toBuffer()],e);function _n(e){return{isSet:new gs(1),rewardPerSecond:U(e.perSecond),rewardOpenTime:U(e.openTime),rewardEndTime:U(e.endTime),rewardType:U(Ne[e.rewardType])}}function kr(e){return U(e.endTime).sub(U(e.openTime)).mul(U(e.perSecond))}function Ar(e){let t=En[e];return t||ys.logWithError("invalid version",e),t}var bs=$("Raydium_farm_instruction"),op={voterStakeRegistryCreateVoter:Buffer.from([6,24,245,52,243,255,148,25]),voterStakeRegistryCreateDepositEntry:Buffer.from([185,131,167,186,159,125,19,67]),voterStakeRegistryDeposit:Buffer.from([242,35,198,137,82,225,242,182]),voterStakeRegistryWithdraw:Buffer.from([183,18,70,156,148,109,161,34]),voterStakeRegistryUpdateVoterWeightRecord:Buffer.from([45,185,3,36,109,190,115,169])};function Ir(e){let{version:t,id:r,ledger:n,programId:o,owner:i}=e,s={3:9,5:10}[t];s||bs.logWithError(`invalid farm pool version: ${t}`);let a=Buffer.alloc(gr.span);gr.encode({instruction:s},a);let c=[y({pubkey:r}),y({pubkey:n}),y({pubkey:i,isWritable:!1}),y({pubkey:Dn.programId,isWritable:!1}),y({pubkey:hs,isWritable:!1})];return{instruction:new ce({programId:o,keys:c,data:a}),instructionType:H.FarmV3CreateLedger}}function Wn(e){var n;let t=Buffer.alloc(hr.span);hr.encode({instruction:0,nonce:new On(e.nonce),rewardTimeInfo:e.rewardInfoConfig},t);let r=[...Jt,y({pubkey:e.farmId}),y({pubkey:e.farmAuthority,isWritable:!1}),y({pubkey:e.lpVault}),y({pubkey:e.lpMint,isWritable:!1}),y({pubkey:e.lockVault}),y({pubkey:e.lockMint,isWritable:!1}),y({pubkey:(n=e.lockUserAccount)!=null?n:ne}),y({pubkey:e.owner,isWritable:!1,isSigner:!0})];for(let o of e.rewardInfo)r.push(y({pubkey:o.rewardMint,isWritable:!1}),y({pubkey:o.rewardVault}),y({pubkey:o.userRewardToken}));return{instruction:new ce({programId:e.programId,keys:r,data:t}),instructionType:H.FarmV6Create}}function Un(e){let t=Buffer.alloc(yr.span);yr.encode({instruction:5},t);let r=[y({pubkey:Se,isWritable:!1}),y({pubkey:e.id}),y({pubkey:e.authority,isWritable:!1}),y({pubkey:e.lpVault,isWritable:!1}),y({pubkey:e.rewardVault}),y({pubkey:e.userRewardToken}),y({pubkey:e.owner,isWritable:!1,isSigner:!0})];return{instruction:new ce({programId:e.programId,keys:r,data:t}),instructionType:H.FarmV6CreatorWithdraw}}function Sr({payer:e,rewardVault:t,userRewardTokenPub:r,farmKeys:n,rewardInfo:o}){let i=Buffer.alloc(br.span);br.encode({instruction:3,rewardReopenTime:U(o.openTime),rewardEndTime:U(o.endTime),rewardPerSecond:U(o.perSecond)},i);let s=[y({pubkey:Se,isWritable:!1}),y({pubkey:n.id}),y({pubkey:n.lpVault,isWritable:!1}),y({pubkey:t}),y({pubkey:r}),y({pubkey:e,isWritable:!1,isSigner:!0})];return new ce({programId:n.programId,keys:s,data:i})}function Lr({payer:e,userRewardTokenPub:t,farmKeys:r,rewardVault:n,rewardInfo:o}){let i=Buffer.alloc(wr.span);wr.encode({instruction:4,isSet:new On(1),rewardPerSecond:U(o.perSecond),rewardOpenTime:U(o.openTime),rewardEndTime:U(o.endTime),rewardType:U(Ne[o.rewardType])},i);let s=[...Jt,y({pubkey:r.id}),y({pubkey:r.authority,isWritable:!1}),y({pubkey:o.mint,isWritable:!1}),y({pubkey:n}),y({pubkey:t}),y({pubkey:e,isWritable:!1,isSigner:!0})];return new ce({programId:r.programId,keys:s,data:i})}function Br(e){let{farmInfo:t,farmKeys:r,lpAccount:n,rewardAccounts:o,owner:i,amount:s}=e,[a,c]=[new G(t.programId),new G(t.id)],u=me({programId:a,poolId:c,owner:i,version:6}),d=Buffer.alloc(ue.span);ue.encode({instruction:2,amount:U(s)},d);let l=[y({pubkey:Se,isWritable:!1}),y({pubkey:c}),y({pubkey:new G(r.authority),isWritable:!1}),y({pubkey:new G(r.lpVault)}),y({pubkey:u}),y({pubkey:i,isWritable:!1,isSigner:!0}),y({pubkey:n})];for(let f=0;f<r.rewardInfos.length;f++)l.push(y({pubkey:new G(r.rewardInfos[f].vault)})),l.push(y({pubkey:o[f]}));return new ce({programId:a,keys:l,data:d})}function Rr(e){let{farmInfo:t,farmKeys:r,lpAccount:n,rewardAccounts:o,owner:i,amount:s,userAuxiliaryLedgers:a}=e,[c,u]=[new G(t.programId),new G(t.id)],d=me({programId:c,poolId:u,owner:i,version:5}),l=Buffer.alloc(ue.span);ue.encode({instruction:12,amount:U(s)},l);let f=[y({pubkey:u}),y({pubkey:new G(r.authority),isWritable:!1}),y({pubkey:d}),y({pubkey:i,isWritable:!1,isSigner:!0}),y({pubkey:n}),y({pubkey:new G(r.lpVault)}),y({pubkey:o[0]}),y({pubkey:new G(r.rewardInfos[0].vault)}),y({pubkey:ut,isWritable:!1}),y({pubkey:Se,isWritable:!1})];for(let p=1;p<r.rewardInfos.length;p++)f.push(y({pubkey:o[p]})),f.push(y({pubkey:new G(r.rewardInfos[p].vault)}));if(a)for(let p of a)f.push(y({pubkey:p}));return new ce({programId:c,keys:f,data:l})}function qn(e){let{farmInfo:t,farmKeys:r,lpAccount:n,rewardAccounts:o,owner:i,amount:s,userAuxiliaryLedgers:a}=e,[c,u]=[new G(t.programId),new G(t.id)],d=Q([ee("instruction"),T("amount")]),l=[y({pubkey:u}),y({pubkey:new G(r.authority),isWritable:!1}),y({pubkey:a[0]}),y({pubkey:i,isSigner:!0,isWritable:!1}),y({pubkey:n}),y({pubkey:new G(r.lpVault)}),y({pubkey:o[0]}),y({pubkey:new G(r.rewardInfos[0].vault)}),y({pubkey:ut,isWritable:!1}),y({pubkey:Se,isWritable:!1}),y({pubkey:o[1]}),y({pubkey:new G(r.rewardInfos[1].vault)})],f=Buffer.alloc(d.span);return d.encode({instruction:2,amount:s},f),new ce({keys:l,programId:c,data:f})}function Cr(e){let{farmInfo:t,farmKeys:r,lpAccount:n,rewardAccounts:o,owner:i,amount:s,userAuxiliaryLedgers:a}=e,[c,u]=[new G(t.programId),new G(t.id)],d=me({programId:c,poolId:u,owner:i,version:3}),l=Buffer.alloc(ue.span);ue.encode({instruction:11,amount:U(s)},l);let f=[y({pubkey:u}),y({pubkey:new G(r.authority),isWritable:!1}),y({pubkey:d}),y({pubkey:i,isWritable:!1,isSigner:!0}),y({pubkey:n}),y({pubkey:new G(r.lpVault)}),y({pubkey:o[0]}),y({pubkey:new G(r.rewardInfos[0].vault)}),y({pubkey:ut,isWritable:!1}),y({pubkey:Se,isWritable:!1})];if(a)for(let p of a)f.push(y({pubkey:p}));return new ce({programId:c,keys:f,data:l})}function Gn(e){let{farmInfo:t,farmKeys:r,lpAccount:n,rewardAccounts:o,owner:i,amount:s,userAuxiliaryLedgers:a}=e,[c,u]=[new G(t.programId),new G(t.id)],d=me({programId:c,poolId:u,owner:i,version:3}),l=Buffer.alloc(ue.span);ue.encode({instruction:10,amount:U(s)},l);let f=[y({pubkey:u}),y({pubkey:new G(r.authority),isWritable:!1}),y({pubkey:d}),y({pubkey:i,isWritable:!1,isSigner:!0}),y({pubkey:n}),y({pubkey:new G(r.lpVault)}),y({pubkey:o[0]}),y({pubkey:new G(r.rewardInfos[0].vault)}),y({pubkey:ut,isWritable:!1}),y({pubkey:Se,isWritable:!1})];if(a)for(let p of a)f.push(y({pubkey:p}));return new ce({programId:c,keys:f,data:l})}function jn(e){let{farmInfo:t,farmKeys:r,lpAccount:n,rewardAccounts:o,owner:i,amount:s,userAuxiliaryLedgers:a}=e,[c,u]=[new G(t.programId),new G(t.id)],d=me({programId:c,poolId:u,owner:i,version:5}),l=Buffer.alloc(ue.span);ue.encode({instruction:11,amount:U(s)},l);let f=[y({pubkey:u}),y({pubkey:new G(r.authority),isWritable:!1}),y({pubkey:d}),y({pubkey:i,isWritable:!1,isSigner:!0}),y({pubkey:n}),y({pubkey:new G(r.lpVault)}),y({pubkey:o[0]}),y({pubkey:new G(r.rewardInfos[0].vault)}),y({pubkey:ut,isWritable:!1}),y({pubkey:Se,isWritable:!1})];for(let p=1;p<r.rewardInfos.length;p++)f.push(y({pubkey:o[p]})),f.push(y({pubkey:new G(r.rewardInfos[p].vault)}));if(a)for(let p of a)f.push(y({pubkey:p}));return new ce({programId:c,keys:f,data:l})}function Hn(e){let{farmInfo:t,farmKeys:r,lpAccount:n,rewardAccounts:o,owner:i,amount:s}=e,[a,c]=[new G(t.programId),new G(t.id)],u=me({programId:a,poolId:c,owner:i,version:6}),d=Buffer.alloc(ue.span);ue.encode({instruction:1,amount:U(s)},d);let l=[y({pubkey:Se,isWritable:!1}),y({pubkey:Dn.programId,isWritable:!1}),y({pubkey:c}),y({pubkey:new G(r.authority),isWritable:!1}),y({pubkey:new G(r.lpVault)}),y({pubkey:u}),y({pubkey:i,isWritable:!1,isSigner:!0}),y({pubkey:n})];for(let f=0;f<r.rewardInfos.length;f++)l.push(y({pubkey:new G(r.rewardInfos[f].vault)})),l.push(y({pubkey:o[f]}));return new ce({programId:a,keys:l,data:d})}var Kr=class extends st{async _getUserRewardInfo({payer:t,rewardInfo:r}){if(r.mint.equals(ne)){let n=await pr({connection:this.scope.connection,owner:this.scope.ownerPubKey,payer:t,amount:kr(te(J({},r),{openTime:r.openTime.toString(),endTime:r.endTime.toString()}))});return{rewardPubKey:n.addresses.newAccount,newInstruction:n}}return{rewardPubKey:await this.scope.account.getCreatedTokenAccount({mint:r.mint,associatedOnly:!1})}}async create({poolInfo:t,rewardInfos:r,payer:n,programId:o=tt,txVersion:i,feePayer:s}){this.checkDisabled(),this.scope.checkOwner();let c={lpMint:new z(t.lpMint.address),lockInfo:{lockMint:Vn,lockVault:Nn},version:6,rewardInfos:r,programId:o},u=this.createTxBuilder(s),d=n!=null?n:this.scope.ownerPubKey,l=Nt({fromPublicKey:d,programId:c.programId}),f=await this.scope.connection.getMinimumBalanceForRentExemption(Et.span);u.addInstruction({instructions:[ws.createAccountWithSeed({fromPubkey:d,basePubkey:d,seed:l.seed,newAccountPubkey:l.publicKey,lamports:f,space:Et.span,programId:c.programId})]});let{publicKey:p,nonce:m}=Fn({programId:new z(c.programId),poolId:l.publicKey}),g=at({programId:c.programId,poolId:l.publicKey,mint:c.lpMint,type:"lpVault"}),b=[],x=[];for(let P of c.rewardInfos){P.openTime>=P.endTime&&this.logAndCreateError("start time error","rewardInfo.rewardOpenTime",P.openTime.toString()),isNaN(Ne[P.rewardType])&&this.logAndCreateError("rewardType error",P.rewardType),Number(P.perSecond)<=0&&this.logAndCreateError("rewardPerSecond error",P.perSecond),b.push(_n(P));let{rewardPubKey:R,newInstruction:L}=await this._getUserRewardInfo({rewardInfo:P,payer:d});L&&u.addInstruction(L),R||this.logAndCreateError("cannot found target token accounts",this.scope.account.tokenAccounts);let V=P.mint.equals(ne)?new z(se.address):P.mint;x.push({rewardMint:V,rewardVault:at({programId:c.programId,poolId:l.publicKey,mint:V,type:"rewardVault"}),userRewardToken:R})}let{account:I,instructionParams:k}=await this.scope.account.getOrCreateTokenAccount({mint:new z(c.lockInfo.lockMint),owner:this.scope.ownerPubKey,skipCloseAccount:!1,createInfo:{payer:this.scope.ownerPubKey,amount:0},associatedOnly:!1});k&&u.addInstruction(k),I||this.logAndCreateError("cannot found lock vault","tokenAccounts",this.scope.account.tokenAccounts);let{instruction:w,instructionType:A}=Wn({farmId:l.publicKey,owner:this.scope.ownerPubKey,farmAuthority:p,lpVault:g,lpMint:c.lpMint,lockVault:c.lockInfo.lockVault,lockMint:c.lockInfo.lockMint,lockUserAccount:I,programId:c.programId,rewardInfo:x,rewardInfoConfig:b,nonce:m});return u.addInstruction({instructions:[w],instructionTypes:[A]}).versionBuild({txVersion:i,extInfo:{farmId:l.publicKey,farmAuthority:p,lpVault:g,lockUserAccount:I,nonce:m}})}async restartReward({farmInfo:t,payer:r,newRewardInfo:n,txVersion:o,feePayer:i}){var x;let s=Ie[t.programId];s!==6&&this.logAndCreateError("invalid farm version ",s);let a=xe((await this.scope.api.fetchFarmKeysById({ids:t.id}))[0]),c={id:a.id,rewardInfos:t.rewardInfos,lpVault:a.lpVault,programId:a.programId};n.openTime>=n.endTime&&this.logAndCreateError("start time error","newRewardInfo",n);let u=r||this.scope.ownerPubKey,d=n.mint.equals(ne)?new z(se.address):n.mint,l=c.rewardInfos.findIndex(I=>new z(I.mint.address).equals(d)),f=a.rewardInfos[l];f||this.logAndCreateError("configuration does not exist","rewardMint",d);let p=(x=f.vault)!=null?x:ne,m=this.createTxBuilder(i),{rewardPubKey:g,newInstruction:b}=await this._getUserRewardInfo({rewardInfo:n,payer:u});return b&&m.addInstruction(b),g||this.logAndCreateError("cannot found target token accounts",this.scope.account.tokenAccounts),m.addInstruction({instructions:[Sr({payer:this.scope.ownerPubKey,rewardVault:p,userRewardTokenPub:g,farmKeys:c,rewardInfo:n})],instructionTypes:[H.FarmV6Restart]}).versionBuild({txVersion:o})}async restartRewards({farmInfo:t,payer:r,newRewardInfos:n,txVersion:o,feePayer:i}){var l;let s=Ie[t.programId];s!==6&&this.logAndCreateError("invalid farm version ",s);let a=xe((await this.scope.api.fetchFarmKeysById({ids:t.id}))[0]),c={id:a.id,rewardInfos:t.rewardInfos,lpVault:a.lpVault,programId:a.programId};n.forEach(f=>{f.openTime>=f.endTime&&this.logAndCreateError("start time error","newRewardInfo",f)});let u=r||this.scope.ownerPubKey,d=this.createTxBuilder(i);for(let f of n){let p=f.mint.equals(ne)?new z(se.address):f.mint,m=c.rewardInfos.findIndex(w=>new z(w.mint.address).equals(p)),g=a.rewardInfos[m];g||this.logAndCreateError("configuration does not exist","rewardMint",p);let b=(l=g.vault)!=null?l:ne,{rewardPubKey:x,newInstruction:I}=await this._getUserRewardInfo({rewardInfo:f,payer:u});I&&d.addInstruction(I),x||this.logAndCreateError("cannot found target token accounts",this.scope.account.tokenAccounts);let k=Sr({payer:this.scope.ownerPubKey,rewardVault:b,userRewardTokenPub:x,farmKeys:c,rewardInfo:f});d.addInstruction({instructions:[k],instructionTypes:[H.FarmV6Restart]})}return d.versionBuild({txVersion:o})}async addNewRewardToken(t){let{txVersion:r,farmInfo:n,newRewardInfo:o,payer:i,feePayer:s}=t,a=Ie[n.programId];a!==6&&this.logAndCreateError("invalid farm version ",a);let c=xe((await this.scope.api.fetchFarmKeysById({ids:n.id}))[0]),u=i!=null?i:this.scope.ownerPubKey,d=this.createTxBuilder(s),l=o.mint.equals(ne)?new z(se.address):o.mint,f=at({programId:new z(n.programId),poolId:new z(n.id),mint:l,type:"rewardVault"}),{rewardPubKey:p,newInstruction:m}=await this._getUserRewardInfo({rewardInfo:o,payer:u});return m&&d.addInstruction(m),p||this.logAndCreateError("annot found target token accounts",this.scope.account.tokenAccounts),o.mint=l,d.addInstruction({instructions:[Lr({payer:this.scope.ownerPubKey,userRewardTokenPub:p,farmKeys:c,rewardVault:f,rewardInfo:o})],instructionTypes:[H.FarmV6CreatorAddReward]}).versionBuild({txVersion:r})}async addNewRewardsToken(t){let{txVersion:r,farmInfo:n,newRewardInfos:o,payer:i,feePayer:s}=t,a=Ie[n.programId];a!==6&&this.logAndCreateError("invalid farm version ",a);let c=xe((await this.scope.api.fetchFarmKeysById({ids:n.id}))[0]),u=i!=null?i:this.scope.ownerPubKey,d=this.createTxBuilder(s);for(let l of o){let f=l.mint.equals(ne)?new z(se.address):l.mint,p=at({programId:new z(n.programId),poolId:new z(n.id),mint:f,type:"rewardVault"}),{rewardPubKey:m,newInstruction:g}=await this._getUserRewardInfo({rewardInfo:l,payer:u});g&&d.addInstruction(g),m||this.logAndCreateError("cannot found target token accounts",this.scope.account.tokenAccounts);let b=Lr({payer:this.scope.ownerPubKey,userRewardTokenPub:m,farmKeys:c,rewardVault:p,rewardInfo:te(J({},l),{mint:f})});d.addInstruction({instructions:[b],instructionTypes:[H.FarmV6CreatorAddReward]})}return d.versionBuild({txVersion:r})}async deposit(t){let{txVersion:r,farmInfo:n,amount:o,feePayer:i,useSOLBalance:s,associatedOnly:a=!0,checkCreateATAOwner:c=!1,userAuxiliaryLedgers:u,computeBudgetConfig:d,txTipConfig:l}=t;this.scope.availability.addFarm===!1&&this.logAndCreateError("farm deposit feature disabled in your region");let{rewardInfos:f,programId:p}=n,m=Ie[p];m===4&&this.logAndCreateError("V4 has suspended deposits:",n.programId),Pr(m)||this.logAndCreateError("invalid farm program:",n.programId);let[g,b]=[new z(n.programId),new z(n.id)],x=(await this.scope.api.fetchFarmKeysById({ids:n.id}))[0],I=me({programId:g,poolId:b,owner:this.scope.ownerPubKey,version:m}),k=this.createTxBuilder(i);k.addCustomComputeBudget(d),k.addTipInstruction(l);let w={};for(let S of this.scope.account.tokenAccounts)if(a){let D=He(this.scope.ownerPubKey,S.mint,S.programId).publicKey;S.publicKey&&D.equals(S.publicKey)&&(w[S.mint.toString()]=S.publicKey)}else w[S.mint.toString()]=S.publicKey;let A=x.lpMint,P=w[A.address];P||this.logAndCreateError("you don't have any lp","lp zero",w);let R=[];for(let S of f){let D=s&&S.mint.address===be.toString(),M=w[S.mint.address];if(!M){let{account:ge,instructionParams:ye}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:S.mint.programId,mint:new z(S.mint.address),notUseTokenAccount:D,createInfo:{payer:i||this.scope.ownerPubKey,amount:0},owner:this.scope.ownerPubKey,skipCloseAccount:!D,associatedOnly:D?!1:a,checkCreateATAOwner:c});M=ge,ye&&k.addInstruction(ye)}w[S.mint.address]=M,R.push(M)}let L,V=await this.scope.connection.getAccountInfo(I);if(V&&(L=Ar(m).decode(V.data)),n.programId!==tt.toString()&&!L){let{instruction:S,instructionType:D}=Ir({id:b,programId:g,version:m,ledger:I,owner:this.scope.ownerPubKey});k.addInstruction({instructions:[S],instructionTypes:[D]})}let B=xr({version:m,rewardInfos:f,rewardTokenAccountsPublicKeys:R});B&&this.logAndCreateError(B);let N={amount:U(o),owner:this.scope.ownerPubKey,farmInfo:n,farmKeys:x,lpAccount:P,rewardAccounts:R,userAuxiliaryLedgers:u==null?void 0:u.map(S=>new z(S))},K=m===6?Hn(N):m===5?jn(N):Gn(N),E={3:H.FarmV3Deposit,5:H.FarmV5Deposit,6:H.FarmV6Deposit};return k.addInstruction({instructions:[K],instructionTypes:[E[m]]}).versionBuild({txVersion:r})}async withdraw(t){let{txVersion:r,farmInfo:n,amount:o,deposited:i,useSOLBalance:s,feePayer:a,associatedOnly:c=!0,checkCreateATAOwner:u=!1,userAuxiliaryLedgers:d,computeBudgetConfig:l,txTipConfig:f}=t,{rewardInfos:p}=n;this.scope.availability.removeFarm===!1&&this.logAndCreateError("farm withdraw feature disabled in your region");let m=Ie[n.programId];Pr(m)||this.logAndCreateError("invalid farm program:",n.programId);let g=(await this.scope.api.fetchFarmKeysById({ids:n.id}))[0],b=this.createTxBuilder(a);b.addCustomComputeBudget(l),b.addTipInstruction(f);let x={};for(let B of this.scope.account.tokenAccounts)if(c){let N=He(this.scope.ownerPubKey,B.mint).publicKey;B.publicKey&&N.equals(B.publicKey)&&(x[B.mint.toString()]=B.publicKey)}else x[B.mint.toString()]=B.publicKey;if(m!==4){let B=me({programId:new z(n.programId),poolId:new z(n.id),owner:this.scope.ownerPubKey,version:m}),N=await this.scope.connection.getAccountInfo(B);if(N)Ar(m).decode(N.data).deposited.isZero()&&this.logAndCreateError("no deposited lp",{farmId:n.id});else if(m!==6){let{instruction:K,instructionType:E}=Ir({id:new z(g.id),programId:new z(g.programId),version:m,ledger:B,owner:this.scope.ownerPubKey});b.addInstruction({instructions:[K],instructionTypes:[E]})}}i&&i.isZero()&&!(d||[]).length&&this.logAndCreateError("no deposited lp",{farmId:n.id});let I=g.lpMint.address,k=s&&I===be.toString(),w=x[I.toString()];if(!w){let{account:B,instructionParams:N}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:g.lpMint.programId,mint:new z(I),notUseTokenAccount:k,createInfo:{payer:a||this.scope.ownerPubKey,amount:0},owner:this.scope.ownerPubKey,skipCloseAccount:!0,associatedOnly:k?!1:c,checkCreateATAOwner:u});w=B,N&&b.addInstruction(N)}x[I.toString()]=w;let A=[];for(let B of p){let N=s&&B.mint.address===be.toString(),K=x[B.mint.address];if(!K){let{account:E,instructionParams:S}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:B.mint.programId,mint:new z(B.mint.address),notUseTokenAccount:N,createInfo:{payer:a||this.scope.ownerPubKey,amount:0},owner:this.scope.ownerPubKey,skipCloseAccount:!N,associatedOnly:N?!1:c,checkCreateATAOwner:u});K=E,S&&b.addInstruction(S)}x[B.mint.address]=K,A.push(K)}let P=xr({version:m,rewardInfos:p,rewardTokenAccountsPublicKeys:A});P&&this.logAndCreateError(P);let R={amount:U(o),owner:this.scope.ownerPubKey,farmInfo:n,farmKeys:g,lpAccount:w,rewardAccounts:A,userAuxiliaryLedgers:d==null?void 0:d.map(B=>new z(B))},L=m===6?Br(R):m===5?Rr(R):m===4?qn(R):Cr(R),V={3:H.FarmV3Withdraw,4:H.FarmV4Withdraw,5:H.FarmV5Withdraw,6:H.FarmV6Withdraw};return b.addInstruction({instructions:[L],instructionTypes:[V[m]]}).versionBuild({txVersion:r})}async withdrawFarmReward({farmInfo:t,withdrawMint:r,txVersion:n,computeBudgetConfig:o,txTipConfig:i,feePayer:s}){var g;this.scope.checkOwner();let a=xe((await this.scope.api.fetchFarmKeysById({ids:t.id}))[0]),c=Ie[t.programId];c!==6&&this.logAndCreateError("invalid farm version",c);let u=a.rewardInfos.find(b=>ft(b.mint.address).equals(ft(r)));u||this.logAndCreateError("withdraw mint error","rewardInfos",t);let d=(g=u==null?void 0:u.vault)!=null?g:ne,l=this.createTxBuilder(s),f;if(r.equals(ne)||r.equals(z.default)){let b=await pr({connection:this.scope.connection,owner:this.scope.ownerPubKey,payer:this.scope.ownerPubKey,amount:kr(te(J({},u),{openTime:u.openTime,endTime:u.endTime,perSecond:new Ht(u.perSecond).mul(10**u.mint.decimals).toString()}))});f=b.addresses.newAccount,l.addInstruction(b)}else{let b=await this.scope.account.getCreatedTokenAccount({mint:r});b===null?(f=await this.scope.account.getAssociatedTokenAccount(r),l.addInstruction({instructions:[Ts(this.scope.ownerPubKey,f,this.scope.ownerPubKey,r)],instructionTypes:[H.CreateATA]})):f=b}let{instruction:p,instructionType:m}=Un({programId:a.programId,id:a.id,authority:a.authority,lpVault:a.lpVault,rewardVault:d,userRewardToken:f,owner:this.scope.ownerPubKey});return l.addCustomComputeBudget(o),l.addTipInstruction(i),l.addInstruction({instructions:[p],instructionTypes:[m]}).versionBuild({txVersion:n})}async harvestAllRewards(t){let{farmInfoList:r,useSOLBalance:n,feePayer:o,associatedOnly:i=!0,checkCreateATAOwner:s=!1,userAuxiliaryLedgers:a,txVersion:c,computeBudgetConfig:u}=t,d=this.createTxBuilder(o),l={};for(let m of this.scope.account.tokenAccounts)if(i){let g=He(this.scope.ownerPubKey,m.mint).publicKey;m.publicKey&&g.equals(m.publicKey)&&(l[m.mint.toString()]=m.publicKey)}else l[m.mint.toString()]=m.publicKey;let p=(await this.scope.api.fetchFarmKeysById({ids:Object.values(r).map(m=>m.id).join(",")})).reduce((m,g)=>te(J({},m),{[g.id]:g}),{});for(let m of Object.values(r)){let{programId:g,lpMint:b,rewardInfos:x,id:I}=m,k=Ie[g],w=b.address,A=n&&w===be.toString(),P=l[w];if(!P){let{account:K,instructionParams:E}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:b.programId,mint:new z(w),notUseTokenAccount:A,createInfo:{payer:o||this.scope.ownerPubKey,amount:0},owner:this.scope.ownerPubKey,skipCloseAccount:!0,associatedOnly:A?!1:i,checkCreateATAOwner:s});P=K,E&&d.addInstruction(E)}l[w.toString()]=P;let R=[];for(let K of x){let E=n&&K.mint.address===be.toString(),S=l[K.mint.address];if(!S){let{account:D,instructionParams:M}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:K.mint.programId,mint:new z(K.mint.address),notUseTokenAccount:E,createInfo:{payer:o||this.scope.ownerPubKey,amount:0},owner:this.scope.ownerPubKey,skipCloseAccount:!E,associatedOnly:E?!1:i,checkCreateATAOwner:s});S=D,M&&d.addInstruction(M)}l[K.mint.address]=S,R.push(S)}let L=p[I],V={amount:rr,owner:this.scope.ownerPubKey,farmInfo:m,farmKeys:L,lpAccount:P,rewardAccounts:R,userAuxiliaryLedgers:a==null?void 0:a.map(K=>new z(K))},B=k===6?Br(V):k===5?Rr(V):Cr(V),N={3:H.FarmV3Withdraw,5:H.FarmV5Withdraw,6:H.FarmV6Withdraw};d.addInstruction({instructions:[B],instructionTypes:[N[k]]})}return c===1?d.sizeCheckBuild({computeBudgetConfig:u}):d.sizeCheckBuildV0({computeBudgetConfig:u})}};export{Kr as default};
/*! noble-hashes - MIT License (c) 2022 Paul Miller (paulmillr.com) */
//# sourceMappingURL=farm.mjs.map