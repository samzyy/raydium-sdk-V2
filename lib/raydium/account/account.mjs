var Hn=Object.defineProperty,jn=Object.defineProperties;var zn=Object.getOwnPropertyDescriptors;var Ue=Object.getOwnPropertySymbols;var jt=Object.prototype.hasOwnProperty,zt=Object.prototype.propertyIsEnumerable;var Ht=(e,t,n)=>t in e?Hn(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,q=(e,t)=>{for(var n in t||(t={}))jt.call(t,n)&&Ht(e,n,t[n]);if(Ue)for(var n of Ue(t))zt.call(t,n)&&Ht(e,n,t[n]);return e},ie=(e,t)=>jn(e,zn(t));var ye=(e,t)=>{var n={};for(var r in e)jt.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(e!=null&&Ue)for(var r of Ue(e))t.indexOf(r)<0&&zt.call(e,r)&&(n[r]=e[r]);return n};import{PublicKey as ft,SystemProgram as qo}from"@solana/web3.js";import{PublicKey as Qn}from"@solana/web3.js";import{get as Zt,set as Zn}from"lodash";var pt=class{constructor(t){this.logLevel=t.logLevel!==void 0?t.logLevel:0,this.name=t.name}set level(t){this.logLevel=t}get time(){return Date.now().toString()}get moduleName(){return this.name}isLogLevel(t){return t<=this.logLevel}error(...t){return this.isLogLevel(0)?(console.error(this.time,this.name,"sdk logger error",...t),this):this}logWithError(...t){let n=t.map(r=>typeof r=="object"?JSON.stringify(r):r).join(", ");throw new Error(n)}warning(...t){return this.isLogLevel(1)?(console.warn(this.time,this.name,"sdk logger warning",...t),this):this}info(...t){return this.isLogLevel(2)?(console.info(this.time,this.name,"sdk logger info",...t),this):this}debug(...t){return this.isLogLevel(3)?(console.debug(this.time,this.name,"sdk logger debug",...t),this):this}},Jt={},Jn={};function z(e){let t=Zt(Jt,e);if(!t){let n=Zt(Jn,e);t=new pt({name:e,logLevel:n}),Zn(Jt,e,t)}return t}import{MINT_SIZE as ti,TOKEN_PROGRAM_ID as ni,getTransferFeeConfig as ri,unpackMint as oi}from"@solana/spl-token";var mt=z("Raydium_accountInfo_util");async function Qt(e,t,n){let{batchRequest:r,commitment:o="confirmed",chunkCount:i=100}=q({batchRequest:!1},n),s=dt(t,i),c=new Array(s.length).fill([]);if(r){let u=s.map(f=>{let p=e._buildArgs([f.map(m=>m.toBase58())],o,"base64");return{methodName:"getMultipleAccounts",args:p}}),a=dt(u,10);c=(await(await Promise.all(a.map(async f=>await e._rpcBatchRequest(f)))).flat()).map(f=>(f.error&&mt.logWithError(`failed to get info for multiple accounts, RPC_ERROR, ${f.error.message}`),f.result.value.map(p=>{if(p){let{data:m,executable:d,lamports:g,owner:y,rentEpoch:x}=p;return m.length!==2&&m[1]!=="base64"&&mt.logWithError("info must be base64 encoded, RPC_ERROR"),{data:Buffer.from(m[0],"base64"),executable:d,lamports:g,owner:new Qn(y),rentEpoch:x}}return null})))}else try{c=await Promise.all(s.map(u=>e.getMultipleAccountsInfo(u,o)))}catch(u){u instanceof Error&&mt.logWithError(`failed to get info for multiple accounts, RPC_ERROR, ${u.message}`)}return c.flat()}import oe from"bn.js";var Pe=9e15,le=1e9,ht="0123456789abcdef",qe="2.3025850929940456840179914546843642076011014886287729760333279009675726096773524802359972050895982983419677840422862486334095254650828067566662873690987816894829072083255546808437998948262331985283935053089653777326288461633662222876982198867465436674744042432743651550489343149393914796194044002221051017141748003688084012647080685567743216228355220114804663715659121373450747856947683463616792101806445070648000277502684916746550586856935673420670581136429224554405758925724208241314695689016758940256776311356919292033376587141660230105703089634572075440370847469940168269282808481184289314848524948644871927809676271275775397027668605952496716674183485704422507197965004714951050492214776567636938662976979522110718264549734772662425709429322582798502585509785265383207606726317164309505995087807523710333101197857547331541421808427543863591778117054309827482385045648019095610299291824318237525357709750539565187697510374970888692180205189339507238539205144634197265287286965110862571492198849978748873771345686209167058",Ge="3.1415926535897932384626433832795028841971693993751058209749445923078164062862089986280348253421170679821480865132823066470938446095505822317253594081284811174502841027019385211055596446229489549303819644288109756659334461284756482337867831652712019091456485669234603486104543266482133936072602491412737245870066063155881748815209209628292540917153643678925903600113305305488204665213841469519415116094330572703657595919530921861173819326117931051185480744623799627495673518857527248912279381830119491298336733624406566430860213949463952247371907021798609437027705392171762931767523846748184676694051320005681271452635608277857713427577896091736371787214684409012249534301465495853710507922796892589235420199561121290219608640344181598136297747713099605187072113499999983729780499510597317328160963185950244594553469083026425223082533446850352619311881710100031378387528865875332083814206171776691473035982534904287554687311595628638823537875937519577818577805321712268066130019278766111959092164201989380952572010654858632789",gt={precision:20,rounding:4,modulo:1,toExpNeg:-7,toExpPos:21,minE:-Pe,maxE:Pe,crypto:!1},en,ne,B=!0,je="[DecimalError] ",ue=je+"Invalid argument: ",tn=je+"Precision limit exceeded",nn=je+"crypto unavailable",rn="[object Decimal]",Z=Math.floor,H=Math.pow,Xn=/^0b([01]+(\.[01]*)?|\.[01]+)(p[+-]?\d+)?$/i,Yn=/^0x([0-9a-f]+(\.[0-9a-f]*)?|\.[0-9a-f]+)(p[+-]?\d+)?$/i,$n=/^0o([0-7]+(\.[0-7]*)?|\.[0-7]+)(p[+-]?\d+)?$/i,on=/^(\d+(\.\d*)?|\.\d+)(e[+-]?\d+)?$/i,X=1e7,S=7,er=9007199254740991,tr=qe.length-1,bt=Ge.length-1,h={toStringTag:rn};h.absoluteValue=h.abs=function(){var e=new this.constructor(this);return e.s<0&&(e.s=1),A(e)};h.ceil=function(){return A(new this.constructor(this),this.e+1,2)};h.clampedTo=h.clamp=function(e,t){var n,r=this,o=r.constructor;if(e=new o(e),t=new o(t),!e.s||!t.s)return new o(NaN);if(e.gt(t))throw Error(ue+t);return n=r.cmp(e),n<0?e:r.cmp(t)>0?t:new o(r)};h.comparedTo=h.cmp=function(e){var t,n,r,o,i=this,s=i.d,c=(e=new i.constructor(e)).d,u=i.s,a=e.s;if(!s||!c)return!u||!a?NaN:u!==a?u:s===c?0:!s^u<0?1:-1;if(!s[0]||!c[0])return s[0]?u:c[0]?-a:0;if(u!==a)return u;if(i.e!==e.e)return i.e>e.e^u<0?1:-1;for(r=s.length,o=c.length,t=0,n=r<o?r:o;t<n;++t)if(s[t]!==c[t])return s[t]>c[t]^u<0?1:-1;return r===o?0:r>o^u<0?1:-1};h.cosine=h.cos=function(){var e,t,n=this,r=n.constructor;return n.d?n.d[0]?(e=r.precision,t=r.rounding,r.precision=e+Math.max(n.e,n.sd())+S,r.rounding=1,n=nr(r,ln(r,n)),r.precision=e,r.rounding=t,A(ne==2||ne==3?n.neg():n,e,t,!0)):new r(1):new r(NaN)};h.cubeRoot=h.cbrt=function(){var e,t,n,r,o,i,s,c,u,a,l=this,f=l.constructor;if(!l.isFinite()||l.isZero())return new f(l);for(B=!1,i=l.s*H(l.s*l,1/3),!i||Math.abs(i)==1/0?(n=j(l.d),e=l.e,(i=(e-n.length+1)%3)&&(n+=i==1||i==-2?"0":"00"),i=H(n,1/3),e=Z((e+1)/3)-(e%3==(e<0?-1:2)),i==1/0?n="5e"+e:(n=i.toExponential(),n=n.slice(0,n.indexOf("e")+1)+e),r=new f(n),r.s=l.s):r=new f(i.toString()),s=(e=f.precision)+3;;)if(c=r,u=c.times(c).times(c),a=u.plus(l),r=V(a.plus(l).times(c),a.plus(u),s+2,1),j(c.d).slice(0,s)===(n=j(r.d)).slice(0,s))if(n=n.slice(s-3,s+1),n=="9999"||!o&&n=="4999"){if(!o&&(A(c,e+1,0),c.times(c).times(c).eq(l))){r=c;break}s+=4,o=1}else{(!+n||!+n.slice(1)&&n.charAt(0)=="5")&&(A(r,e+1,1),t=!r.times(r).times(r).eq(l));break}return B=!0,A(r,e,f.rounding,t)};h.decimalPlaces=h.dp=function(){var e,t=this.d,n=NaN;if(t){if(e=t.length-1,n=(e-Z(this.e/S))*S,e=t[e],e)for(;e%10==0;e/=10)n--;n<0&&(n=0)}return n};h.dividedBy=h.div=function(e){return V(this,new this.constructor(e))};h.dividedToIntegerBy=h.divToInt=function(e){var t=this,n=t.constructor;return A(V(t,new n(e),0,1,1),n.precision,n.rounding)};h.equals=h.eq=function(e){return this.cmp(e)===0};h.floor=function(){return A(new this.constructor(this),this.e+1,3)};h.greaterThan=h.gt=function(e){return this.cmp(e)>0};h.greaterThanOrEqualTo=h.gte=function(e){var t=this.cmp(e);return t==1||t===0};h.hyperbolicCosine=h.cosh=function(){var e,t,n,r,o,i=this,s=i.constructor,c=new s(1);if(!i.isFinite())return new s(i.s?1/0:NaN);if(i.isZero())return c;n=s.precision,r=s.rounding,s.precision=n+Math.max(i.e,i.sd())+4,s.rounding=1,o=i.d.length,o<32?(e=Math.ceil(o/3),t=(1/Ze(4,e)).toString()):(e=16,t="2.3283064365386962890625e-10"),i=Ae(s,1,i.times(t),new s(1),!0);for(var u,a=e,l=new s(8);a--;)u=i.times(i),i=c.minus(u.times(l.minus(u.times(l))));return A(i,s.precision=n,s.rounding=r,!0)};h.hyperbolicSine=h.sinh=function(){var e,t,n,r,o=this,i=o.constructor;if(!o.isFinite()||o.isZero())return new i(o);if(t=i.precision,n=i.rounding,i.precision=t+Math.max(o.e,o.sd())+4,i.rounding=1,r=o.d.length,r<3)o=Ae(i,2,o,o,!0);else{e=1.4*Math.sqrt(r),e=e>16?16:e|0,o=o.times(1/Ze(5,e)),o=Ae(i,2,o,o,!0);for(var s,c=new i(5),u=new i(16),a=new i(20);e--;)s=o.times(o),o=o.times(c.plus(s.times(u.times(s).plus(a))))}return i.precision=t,i.rounding=n,A(o,t,n,!0)};h.hyperbolicTangent=h.tanh=function(){var e,t,n=this,r=n.constructor;return n.isFinite()?n.isZero()?new r(n):(e=r.precision,t=r.rounding,r.precision=e+7,r.rounding=1,V(n.sinh(),n.cosh(),r.precision=e,r.rounding=t)):new r(n.s)};h.inverseCosine=h.acos=function(){var e,t=this,n=t.constructor,r=t.abs().cmp(1),o=n.precision,i=n.rounding;return r!==-1?r===0?t.isNeg()?Q(n,o,i):new n(0):new n(NaN):t.isZero()?Q(n,o+4,i).times(.5):(n.precision=o+6,n.rounding=1,t=t.asin(),e=Q(n,o+4,i).times(.5),n.precision=o,n.rounding=i,e.minus(t))};h.inverseHyperbolicCosine=h.acosh=function(){var e,t,n=this,r=n.constructor;return n.lte(1)?new r(n.eq(1)?0:NaN):n.isFinite()?(e=r.precision,t=r.rounding,r.precision=e+Math.max(Math.abs(n.e),n.sd())+4,r.rounding=1,B=!1,n=n.times(n).minus(1).sqrt().plus(n),B=!0,r.precision=e,r.rounding=t,n.ln()):new r(n)};h.inverseHyperbolicSine=h.asinh=function(){var e,t,n=this,r=n.constructor;return!n.isFinite()||n.isZero()?new r(n):(e=r.precision,t=r.rounding,r.precision=e+2*Math.max(Math.abs(n.e),n.sd())+6,r.rounding=1,B=!1,n=n.times(n).plus(1).sqrt().plus(n),B=!0,r.precision=e,r.rounding=t,n.ln())};h.inverseHyperbolicTangent=h.atanh=function(){var e,t,n,r,o=this,i=o.constructor;return o.isFinite()?o.e>=0?new i(o.abs().eq(1)?o.s/0:o.isZero()?o:NaN):(e=i.precision,t=i.rounding,r=o.sd(),Math.max(r,e)<2*-o.e-1?A(new i(o),e,t,!0):(i.precision=n=r-o.e,o=V(o.plus(1),new i(1).minus(o),n+e,1),i.precision=e+4,i.rounding=1,o=o.ln(),i.precision=e,i.rounding=t,o.times(.5))):new i(NaN)};h.inverseSine=h.asin=function(){var e,t,n,r,o=this,i=o.constructor;return o.isZero()?new i(o):(t=o.abs().cmp(1),n=i.precision,r=i.rounding,t!==-1?t===0?(e=Q(i,n+4,r).times(.5),e.s=o.s,e):new i(NaN):(i.precision=n+6,i.rounding=1,o=o.div(new i(1).minus(o.times(o)).sqrt().plus(1)).atan(),i.precision=n,i.rounding=r,o.times(2)))};h.inverseTangent=h.atan=function(){var e,t,n,r,o,i,s,c,u,a=this,l=a.constructor,f=l.precision,p=l.rounding;if(a.isFinite()){if(a.isZero())return new l(a);if(a.abs().eq(1)&&f+4<=bt)return s=Q(l,f+4,p).times(.25),s.s=a.s,s}else{if(!a.s)return new l(NaN);if(f+4<=bt)return s=Q(l,f+4,p).times(.5),s.s=a.s,s}for(l.precision=c=f+10,l.rounding=1,n=Math.min(28,c/S+2|0),e=n;e;--e)a=a.div(a.times(a).plus(1).sqrt().plus(1));for(B=!1,t=Math.ceil(c/S),r=1,u=a.times(a),s=new l(a),o=a;e!==-1;)if(o=o.times(u),i=s.minus(o.div(r+=2)),o=o.times(u),s=i.plus(o.div(r+=2)),s.d[t]!==void 0)for(e=t;s.d[e]===i.d[e]&&e--;);return n&&(s=s.times(2<<n-1)),B=!0,A(s,l.precision=f,l.rounding=p,!0)};h.isFinite=function(){return!!this.d};h.isInteger=h.isInt=function(){return!!this.d&&Z(this.e/S)>this.d.length-2};h.isNaN=function(){return!this.s};h.isNegative=h.isNeg=function(){return this.s<0};h.isPositive=h.isPos=function(){return this.s>0};h.isZero=function(){return!!this.d&&this.d[0]===0};h.lessThan=h.lt=function(e){return this.cmp(e)<0};h.lessThanOrEqualTo=h.lte=function(e){return this.cmp(e)<1};h.logarithm=h.log=function(e){var t,n,r,o,i,s,c,u,a=this,l=a.constructor,f=l.precision,p=l.rounding,m=5;if(e==null)e=new l(10),t=!0;else{if(e=new l(e),n=e.d,e.s<0||!n||!n[0]||e.eq(1))return new l(NaN);t=e.eq(10)}if(n=a.d,a.s<0||!n||!n[0]||a.eq(1))return new l(n&&!n[0]?-1/0:a.s!=1?NaN:n?0:1/0);if(t)if(n.length>1)i=!0;else{for(o=n[0];o%10===0;)o/=10;i=o!==1}if(B=!1,c=f+m,s=ae(a,c),r=t?He(l,c+10):ae(e,c),u=V(s,r,c,1),Ie(u.d,o=f,p))do if(c+=10,s=ae(a,c),r=t?He(l,c+10):ae(e,c),u=V(s,r,c,1),!i){+j(u.d).slice(o+1,o+15)+1==1e14&&(u=A(u,f+1,0));break}while(Ie(u.d,o+=10,p));return B=!0,A(u,f,p)};h.minus=h.sub=function(e){var t,n,r,o,i,s,c,u,a,l,f,p,m=this,d=m.constructor;if(e=new d(e),!m.d||!e.d)return!m.s||!e.s?e=new d(NaN):m.d?e.s=-e.s:e=new d(e.d||m.s!==e.s?m:NaN),e;if(m.s!=e.s)return e.s=-e.s,m.plus(e);if(a=m.d,p=e.d,c=d.precision,u=d.rounding,!a[0]||!p[0]){if(p[0])e.s=-e.s;else if(a[0])e=new d(m);else return new d(u===3?-0:0);return B?A(e,c,u):e}if(n=Z(e.e/S),l=Z(m.e/S),a=a.slice(),i=l-n,i){for(f=i<0,f?(t=a,i=-i,s=p.length):(t=p,n=l,s=a.length),r=Math.max(Math.ceil(c/S),s)+2,i>r&&(i=r,t.length=1),t.reverse(),r=i;r--;)t.push(0);t.reverse()}else{for(r=a.length,s=p.length,f=r<s,f&&(s=r),r=0;r<s;r++)if(a[r]!=p[r]){f=a[r]<p[r];break}i=0}for(f&&(t=a,a=p,p=t,e.s=-e.s),s=a.length,r=p.length-s;r>0;--r)a[s++]=0;for(r=p.length;r>i;){if(a[--r]<p[r]){for(o=r;o&&a[--o]===0;)a[o]=X-1;--a[o],a[r]+=X}a[r]-=p[r]}for(;a[--s]===0;)a.pop();for(;a[0]===0;a.shift())--n;return a[0]?(e.d=a,e.e=ze(a,n),B?A(e,c,u):e):new d(u===3?-0:0)};h.modulo=h.mod=function(e){var t,n=this,r=n.constructor;return e=new r(e),!n.d||!e.s||e.d&&!e.d[0]?new r(NaN):!e.d||n.d&&!n.d[0]?A(new r(n),r.precision,r.rounding):(B=!1,r.modulo==9?(t=V(n,e.abs(),0,3,1),t.s*=e.s):t=V(n,e,0,r.modulo,1),t=t.times(e),B=!0,n.minus(t))};h.naturalExponential=h.exp=function(){return yt(this)};h.naturalLogarithm=h.ln=function(){return ae(this)};h.negated=h.neg=function(){var e=new this.constructor(this);return e.s=-e.s,A(e)};h.plus=h.add=function(e){var t,n,r,o,i,s,c,u,a,l,f=this,p=f.constructor;if(e=new p(e),!f.d||!e.d)return!f.s||!e.s?e=new p(NaN):f.d||(e=new p(e.d||f.s===e.s?f:NaN)),e;if(f.s!=e.s)return e.s=-e.s,f.minus(e);if(a=f.d,l=e.d,c=p.precision,u=p.rounding,!a[0]||!l[0])return l[0]||(e=new p(f)),B?A(e,c,u):e;if(i=Z(f.e/S),r=Z(e.e/S),a=a.slice(),o=i-r,o){for(o<0?(n=a,o=-o,s=l.length):(n=l,r=i,s=a.length),i=Math.ceil(c/S),s=i>s?i+1:s+1,o>s&&(o=s,n.length=1),n.reverse();o--;)n.push(0);n.reverse()}for(s=a.length,o=l.length,s-o<0&&(o=s,n=l,l=a,a=n),t=0;o;)t=(a[--o]=a[o]+l[o]+t)/X|0,a[o]%=X;for(t&&(a.unshift(t),++r),s=a.length;a[--s]==0;)a.pop();return e.d=a,e.e=ze(a,r),B?A(e,c,u):e};h.precision=h.sd=function(e){var t,n=this;if(e!==void 0&&e!==!!e&&e!==1&&e!==0)throw Error(ue+e);return n.d?(t=sn(n.d),e&&n.e+1>t&&(t=n.e+1)):t=NaN,t};h.round=function(){var e=this,t=e.constructor;return A(new t(e),e.e+1,t.rounding)};h.sine=h.sin=function(){var e,t,n=this,r=n.constructor;return n.isFinite()?n.isZero()?new r(n):(e=r.precision,t=r.rounding,r.precision=e+Math.max(n.e,n.sd())+S,r.rounding=1,n=or(r,ln(r,n)),r.precision=e,r.rounding=t,A(ne>2?n.neg():n,e,t,!0)):new r(NaN)};h.squareRoot=h.sqrt=function(){var e,t,n,r,o,i,s=this,c=s.d,u=s.e,a=s.s,l=s.constructor;if(a!==1||!c||!c[0])return new l(!a||a<0&&(!c||c[0])?NaN:c?s:1/0);for(B=!1,a=Math.sqrt(+s),a==0||a==1/0?(t=j(c),(t.length+u)%2==0&&(t+="0"),a=Math.sqrt(t),u=Z((u+1)/2)-(u<0||u%2),a==1/0?t="5e"+u:(t=a.toExponential(),t=t.slice(0,t.indexOf("e")+1)+u),r=new l(t)):r=new l(a.toString()),n=(u=l.precision)+3;;)if(i=r,r=i.plus(V(s,i,n+2,1)).times(.5),j(i.d).slice(0,n)===(t=j(r.d)).slice(0,n))if(t=t.slice(n-3,n+1),t=="9999"||!o&&t=="4999"){if(!o&&(A(i,u+1,0),i.times(i).eq(s))){r=i;break}n+=4,o=1}else{(!+t||!+t.slice(1)&&t.charAt(0)=="5")&&(A(r,u+1,1),e=!r.times(r).eq(s));break}return B=!0,A(r,u,l.rounding,e)};h.tangent=h.tan=function(){var e,t,n=this,r=n.constructor;return n.isFinite()?n.isZero()?new r(n):(e=r.precision,t=r.rounding,r.precision=e+10,r.rounding=1,n=n.sin(),n.s=1,n=V(n,new r(1).minus(n.times(n)).sqrt(),e+10,0),r.precision=e,r.rounding=t,A(ne==2||ne==4?n.neg():n,e,t,!0)):new r(NaN)};h.times=h.mul=function(e){var t,n,r,o,i,s,c,u,a,l=this,f=l.constructor,p=l.d,m=(e=new f(e)).d;if(e.s*=l.s,!p||!p[0]||!m||!m[0])return new f(!e.s||p&&!p[0]&&!m||m&&!m[0]&&!p?NaN:!p||!m?e.s/0:e.s*0);for(n=Z(l.e/S)+Z(e.e/S),u=p.length,a=m.length,u<a&&(i=p,p=m,m=i,s=u,u=a,a=s),i=[],s=u+a,r=s;r--;)i.push(0);for(r=a;--r>=0;){for(t=0,o=u+r;o>r;)c=i[o]+m[r]*p[o-r-1]+t,i[o--]=c%X|0,t=c/X|0;i[o]=(i[o]+t)%X|0}for(;!i[--s];)i.pop();return t?++n:i.shift(),e.d=i,e.e=ze(i,n),B?A(e,f.precision,f.rounding):e};h.toBinary=function(e,t){return Tt(this,2,e,t)};h.toDecimalPlaces=h.toDP=function(e,t){var n=this,r=n.constructor;return n=new r(n),e===void 0?n:(J(e,0,le),t===void 0?t=r.rounding:J(t,0,8),A(n,e+n.e+1,t))};h.toExponential=function(e,t){var n,r=this,o=r.constructor;return e===void 0?n=ee(r,!0):(J(e,0,le),t===void 0?t=o.rounding:J(t,0,8),r=A(new o(r),e+1,t),n=ee(r,!0,e+1)),r.isNeg()&&!r.isZero()?"-"+n:n};h.toFixed=function(e,t){var n,r,o=this,i=o.constructor;return e===void 0?n=ee(o):(J(e,0,le),t===void 0?t=i.rounding:J(t,0,8),r=A(new i(o),e+o.e+1,t),n=ee(r,!1,e+r.e+1)),o.isNeg()&&!o.isZero()?"-"+n:n};h.toFraction=function(e){var t,n,r,o,i,s,c,u,a,l,f,p,m=this,d=m.d,g=m.constructor;if(!d)return new g(m);if(a=n=new g(1),r=u=new g(0),t=new g(r),i=t.e=sn(d)-m.e-1,s=i%S,t.d[0]=H(10,s<0?S+s:s),e==null)e=i>0?t:a;else{if(c=new g(e),!c.isInt()||c.lt(a))throw Error(ue+c);e=c.gt(t)?i>0?t:a:c}for(B=!1,c=new g(j(d)),l=g.precision,g.precision=i=d.length*S*2;f=V(c,t,0,1,1),o=n.plus(f.times(r)),o.cmp(e)!=1;)n=r,r=o,o=a,a=u.plus(f.times(o)),u=o,o=t,t=c.minus(f.times(o)),c=o;return o=V(e.minus(n),r,0,1,1),u=u.plus(o.times(a)),n=n.plus(o.times(r)),u.s=a.s=m.s,p=V(a,r,i,1).minus(m).abs().cmp(V(u,n,i,1).minus(m).abs())<1?[a,r]:[u,n],g.precision=l,B=!0,p};h.toHexadecimal=h.toHex=function(e,t){return Tt(this,16,e,t)};h.toNearest=function(e,t){var n=this,r=n.constructor;if(n=new r(n),e==null){if(!n.d)return n;e=new r(1),t=r.rounding}else{if(e=new r(e),t===void 0?t=r.rounding:J(t,0,8),!n.d)return e.s?n:e;if(!e.d)return e.s&&(e.s=n.s),e}return e.d[0]?(B=!1,n=V(n,e,0,t,1).times(e),B=!0,A(n)):(e.s=n.s,n=e),n};h.toNumber=function(){return+this};h.toOctal=function(e,t){return Tt(this,8,e,t)};h.toPower=h.pow=function(e){var t,n,r,o,i,s,c=this,u=c.constructor,a=+(e=new u(e));if(!c.d||!e.d||!c.d[0]||!e.d[0])return new u(H(+c,a));if(c=new u(c),c.eq(1))return c;if(r=u.precision,i=u.rounding,e.eq(1))return A(c,r,i);if(t=Z(e.e/S),t>=e.d.length-1&&(n=a<0?-a:a)<=er)return o=cn(u,c,n,r),e.s<0?new u(1).div(o):A(o,r,i);if(s=c.s,s<0){if(t<e.d.length-1)return new u(NaN);if((e.d[t]&1)==0&&(s=1),c.e==0&&c.d[0]==1&&c.d.length==1)return c.s=s,c}return n=H(+c,a),t=n==0||!isFinite(n)?Z(a*(Math.log("0."+j(c.d))/Math.LN10+c.e+1)):new u(n+"").e,t>u.maxE+1||t<u.minE-1?new u(t>0?s/0:0):(B=!1,u.rounding=c.s=1,n=Math.min(12,(t+"").length),o=yt(e.times(ae(c,r+n)),r),o.d&&(o=A(o,r+5,1),Ie(o.d,r,i)&&(t=r+10,o=A(yt(e.times(ae(c,t+n)),t),t+5,1),+j(o.d).slice(r+1,r+15)+1==1e14&&(o=A(o,r+1,0)))),o.s=s,B=!0,u.rounding=i,A(o,r,i))};h.toPrecision=function(e,t){var n,r=this,o=r.constructor;return e===void 0?n=ee(r,r.e<=o.toExpNeg||r.e>=o.toExpPos):(J(e,1,le),t===void 0?t=o.rounding:J(t,0,8),r=A(new o(r),e,t),n=ee(r,e<=r.e||r.e<=o.toExpNeg,e)),r.isNeg()&&!r.isZero()?"-"+n:n};h.toSignificantDigits=h.toSD=function(e,t){var n=this,r=n.constructor;return e===void 0?(e=r.precision,t=r.rounding):(J(e,1,le),t===void 0?t=r.rounding:J(t,0,8)),A(new r(n),e,t)};h.toString=function(){var e=this,t=e.constructor,n=ee(e,e.e<=t.toExpNeg||e.e>=t.toExpPos);return e.isNeg()&&!e.isZero()?"-"+n:n};h.truncated=h.trunc=function(){return A(new this.constructor(this),this.e+1,1)};h.valueOf=h.toJSON=function(){var e=this,t=e.constructor,n=ee(e,e.e<=t.toExpNeg||e.e>=t.toExpPos);return e.isNeg()?"-"+n:n};function j(e){var t,n,r,o=e.length-1,i="",s=e[0];if(o>0){for(i+=s,t=1;t<o;t++)r=e[t]+"",n=S-r.length,n&&(i+=ce(n)),i+=r;s=e[t],r=s+"",n=S-r.length,n&&(i+=ce(n))}else if(s===0)return"0";for(;s%10===0;)s/=10;return i+s}function J(e,t,n){if(e!==~~e||e<t||e>n)throw Error(ue+e)}function Ie(e,t,n,r){var o,i,s,c;for(i=e[0];i>=10;i/=10)--t;return--t<0?(t+=S,o=0):(o=Math.ceil((t+1)/S),t%=S),i=H(10,S-t),c=e[o]%i|0,r==null?t<3?(t==0?c=c/100|0:t==1&&(c=c/10|0),s=n<4&&c==99999||n>3&&c==49999||c==5e4||c==0):s=(n<4&&c+1==i||n>3&&c+1==i/2)&&(e[o+1]/i/100|0)==H(10,t-2)-1||(c==i/2||c==0)&&(e[o+1]/i/100|0)==0:t<4?(t==0?c=c/1e3|0:t==1?c=c/100|0:t==2&&(c=c/10|0),s=(r||n<4)&&c==9999||!r&&n>3&&c==4999):s=((r||n<4)&&c+1==i||!r&&n>3&&c+1==i/2)&&(e[o+1]/i/1e3|0)==H(10,t-3)-1,s}function We(e,t,n){for(var r,o=[0],i,s=0,c=e.length;s<c;){for(i=o.length;i--;)o[i]*=t;for(o[0]+=ht.indexOf(e.charAt(s++)),r=0;r<o.length;r++)o[r]>n-1&&(o[r+1]===void 0&&(o[r+1]=0),o[r+1]+=o[r]/n|0,o[r]%=n)}return o.reverse()}function nr(e,t){var n,r,o;if(t.isZero())return t;r=t.d.length,r<32?(n=Math.ceil(r/3),o=(1/Ze(4,n)).toString()):(n=16,o="2.3283064365386962890625e-10"),e.precision+=n,t=Ae(e,1,t.times(o),new e(1));for(var i=n;i--;){var s=t.times(t);t=s.times(s).minus(s).times(8).plus(1)}return e.precision-=n,t}var V=function(){function e(r,o,i){var s,c=0,u=r.length;for(r=r.slice();u--;)s=r[u]*o+c,r[u]=s%i|0,c=s/i|0;return c&&r.unshift(c),r}function t(r,o,i,s){var c,u;if(i!=s)u=i>s?1:-1;else for(c=u=0;c<i;c++)if(r[c]!=o[c]){u=r[c]>o[c]?1:-1;break}return u}function n(r,o,i,s){for(var c=0;i--;)r[i]-=c,c=r[i]<o[i]?1:0,r[i]=c*s+r[i]-o[i];for(;!r[0]&&r.length>1;)r.shift()}return function(r,o,i,s,c,u){var a,l,f,p,m,d,g,y,x,P,T,w,b,k,N,C,_,v,F,M,O=r.constructor,K=r.s==o.s?1:-1,D=r.d,L=o.d;if(!D||!D[0]||!L||!L[0])return new O(!r.s||!o.s||(D?L&&D[0]==L[0]:!L)?NaN:D&&D[0]==0||!L?K*0:K/0);for(u?(m=1,l=r.e-o.e):(u=X,m=S,l=Z(r.e/m)-Z(o.e/m)),F=L.length,_=D.length,x=new O(K),P=x.d=[],f=0;L[f]==(D[f]||0);f++);if(L[f]>(D[f]||0)&&l--,i==null?(k=i=O.precision,s=O.rounding):c?k=i+(r.e-o.e)+1:k=i,k<0)P.push(1),d=!0;else{if(k=k/m+2|0,f=0,F==1){for(p=0,L=L[0],k++;(f<_||p)&&k--;f++)N=p*u+(D[f]||0),P[f]=N/L|0,p=N%L|0;d=p||f<_}else{for(p=u/(L[0]+1)|0,p>1&&(L=e(L,p,u),D=e(D,p,u),F=L.length,_=D.length),C=F,T=D.slice(0,F),w=T.length;w<F;)T[w++]=0;M=L.slice(),M.unshift(0),v=L[0],L[1]>=u/2&&++v;do p=0,a=t(L,T,F,w),a<0?(b=T[0],F!=w&&(b=b*u+(T[1]||0)),p=b/v|0,p>1?(p>=u&&(p=u-1),g=e(L,p,u),y=g.length,w=T.length,a=t(g,T,y,w),a==1&&(p--,n(g,F<y?M:L,y,u))):(p==0&&(a=p=1),g=L.slice()),y=g.length,y<w&&g.unshift(0),n(T,g,w,u),a==-1&&(w=T.length,a=t(L,T,F,w),a<1&&(p++,n(T,F<w?M:L,w,u))),w=T.length):a===0&&(p++,T=[0]),P[f++]=p,a&&T[0]?T[w++]=D[C]||0:(T=[D[C]],w=1);while((C++<_||T[0]!==void 0)&&k--);d=T[0]!==void 0}P[0]||P.shift()}if(m==1)x.e=l,en=d;else{for(f=1,p=P[0];p>=10;p/=10)f++;x.e=f+l*m-1,A(x,c?i+x.e+1:i,s,d)}return x}}();function A(e,t,n,r){var o,i,s,c,u,a,l,f,p,m=e.constructor;e:if(t!=null){if(f=e.d,!f)return e;for(o=1,c=f[0];c>=10;c/=10)o++;if(i=t-o,i<0)i+=S,s=t,l=f[p=0],u=l/H(10,o-s-1)%10|0;else if(p=Math.ceil((i+1)/S),c=f.length,p>=c)if(r){for(;c++<=p;)f.push(0);l=u=0,o=1,i%=S,s=i-S+1}else break e;else{for(l=c=f[p],o=1;c>=10;c/=10)o++;i%=S,s=i-S+o,u=s<0?0:l/H(10,o-s-1)%10|0}if(r=r||t<0||f[p+1]!==void 0||(s<0?l:l%H(10,o-s-1)),a=n<4?(u||r)&&(n==0||n==(e.s<0?3:2)):u>5||u==5&&(n==4||r||n==6&&(i>0?s>0?l/H(10,o-s):0:f[p-1])%10&1||n==(e.s<0?8:7)),t<1||!f[0])return f.length=0,a?(t-=e.e+1,f[0]=H(10,(S-t%S)%S),e.e=-t||0):f[0]=e.e=0,e;if(i==0?(f.length=p,c=1,p--):(f.length=p+1,c=H(10,S-i),f[p]=s>0?(l/H(10,o-s)%H(10,s)|0)*c:0),a)for(;;)if(p==0){for(i=1,s=f[0];s>=10;s/=10)i++;for(s=f[0]+=c,c=1;s>=10;s/=10)c++;i!=c&&(e.e++,f[0]==X&&(f[0]=1));break}else{if(f[p]+=c,f[p]!=X)break;f[p--]=0,c=1}for(i=f.length;f[--i]===0;)f.pop()}return B&&(e.e>m.maxE?(e.d=null,e.e=NaN):e.e<m.minE&&(e.e=0,e.d=[0])),e}function ee(e,t,n){if(!e.isFinite())return un(e);var r,o=e.e,i=j(e.d),s=i.length;return t?(n&&(r=n-s)>0?i=i.charAt(0)+"."+i.slice(1)+ce(r):s>1&&(i=i.charAt(0)+"."+i.slice(1)),i=i+(e.e<0?"e":"e+")+e.e):o<0?(i="0."+ce(-o-1)+i,n&&(r=n-s)>0&&(i+=ce(r))):o>=s?(i+=ce(o+1-s),n&&(r=n-o-1)>0&&(i=i+"."+ce(r))):((r=o+1)<s&&(i=i.slice(0,r)+"."+i.slice(r)),n&&(r=n-s)>0&&(o+1===s&&(i+="."),i+=ce(r))),i}function ze(e,t){var n=e[0];for(t*=S;n>=10;n/=10)t++;return t}function He(e,t,n){if(t>tr)throw B=!0,n&&(e.precision=n),Error(tn);return A(new e(qe),t,1,!0)}function Q(e,t,n){if(t>bt)throw Error(tn);return A(new e(Ge),t,n,!0)}function sn(e){var t=e.length-1,n=t*S+1;if(t=e[t],t){for(;t%10==0;t/=10)n--;for(t=e[0];t>=10;t/=10)n++}return n}function ce(e){for(var t="";e--;)t+="0";return t}function cn(e,t,n,r){var o,i=new e(1),s=Math.ceil(r/S+4);for(B=!1;;){if(n%2&&(i=i.times(t),Yt(i.d,s)&&(o=!0)),n=Z(n/2),n===0){n=i.d.length-1,o&&i.d[n]===0&&++i.d[n];break}t=t.times(t),Yt(t.d,s)}return B=!0,i}function Xt(e){return e.d[e.d.length-1]&1}function an(e,t,n){for(var r,o=new e(t[0]),i=0;++i<t.length;)if(r=new e(t[i]),r.s)o[n](r)&&(o=r);else{o=r;break}return o}function yt(e,t){var n,r,o,i,s,c,u,a=0,l=0,f=0,p=e.constructor,m=p.rounding,d=p.precision;if(!e.d||!e.d[0]||e.e>17)return new p(e.d?e.d[0]?e.s<0?0:1/0:1:e.s?e.s<0?0:e:0/0);for(t==null?(B=!1,u=d):u=t,c=new p(.03125);e.e>-2;)e=e.times(c),f+=5;for(r=Math.log(H(2,f))/Math.LN10*2+5|0,u+=r,n=i=s=new p(1),p.precision=u;;){if(i=A(i.times(e),u,1),n=n.times(++l),c=s.plus(V(i,n,u,1)),j(c.d).slice(0,u)===j(s.d).slice(0,u)){for(o=f;o--;)s=A(s.times(s),u,1);if(t==null)if(a<3&&Ie(s.d,u-r,m,a))p.precision=u+=10,n=i=c=new p(1),l=0,a++;else return A(s,p.precision=d,m,B=!0);else return p.precision=d,s}s=c}}function ae(e,t){var n,r,o,i,s,c,u,a,l,f,p,m=1,d=10,g=e,y=g.d,x=g.constructor,P=x.rounding,T=x.precision;if(g.s<0||!y||!y[0]||!g.e&&y[0]==1&&y.length==1)return new x(y&&!y[0]?-1/0:g.s!=1?NaN:y?0:g);if(t==null?(B=!1,l=T):l=t,x.precision=l+=d,n=j(y),r=n.charAt(0),Math.abs(i=g.e)<15e14){for(;r<7&&r!=1||r==1&&n.charAt(1)>3;)g=g.times(e),n=j(g.d),r=n.charAt(0),m++;i=g.e,r>1?(g=new x("0."+n),i++):g=new x(r+"."+n.slice(1))}else return a=He(x,l+2,T).times(i+""),g=ae(new x(r+"."+n.slice(1)),l-d).plus(a),x.precision=T,t==null?A(g,T,P,B=!0):g;for(f=g,u=s=g=V(g.minus(1),g.plus(1),l,1),p=A(g.times(g),l,1),o=3;;){if(s=A(s.times(p),l,1),a=u.plus(V(s,new x(o),l,1)),j(a.d).slice(0,l)===j(u.d).slice(0,l))if(u=u.times(2),i!==0&&(u=u.plus(He(x,l+2,T).times(i+""))),u=V(u,new x(m),l,1),t==null)if(Ie(u.d,l-d,P,c))x.precision=l+=d,a=s=g=V(f.minus(1),f.plus(1),l,1),p=A(g.times(g),l,1),o=c=1;else return A(u,x.precision=T,P,B=!0);else return x.precision=T,u;u=a,o+=2}}function un(e){return String(e.s*e.s/0)}function wt(e,t){var n,r,o;for((n=t.indexOf("."))>-1&&(t=t.replace(".","")),(r=t.search(/e/i))>0?(n<0&&(n=r),n+=+t.slice(r+1),t=t.substring(0,r)):n<0&&(n=t.length),r=0;t.charCodeAt(r)===48;r++);for(o=t.length;t.charCodeAt(o-1)===48;--o);if(t=t.slice(r,o),t){if(o-=r,e.e=n=n-r-1,e.d=[],r=(n+1)%S,n<0&&(r+=S),r<o){for(r&&e.d.push(+t.slice(0,r)),o-=S;r<o;)e.d.push(+t.slice(r,r+=S));t=t.slice(r),r=S-t.length}else r-=o;for(;r--;)t+="0";e.d.push(+t),B&&(e.e>e.constructor.maxE?(e.d=null,e.e=NaN):e.e<e.constructor.minE&&(e.e=0,e.d=[0]))}else e.e=0,e.d=[0];return e}function rr(e,t){var n,r,o,i,s,c,u,a,l;if(t.indexOf("_")>-1){if(t=t.replace(/(\d)_(?=\d)/g,"$1"),on.test(t))return wt(e,t)}else if(t==="Infinity"||t==="NaN")return+t||(e.s=NaN),e.e=NaN,e.d=null,e;if(Yn.test(t))n=16,t=t.toLowerCase();else if(Xn.test(t))n=2;else if($n.test(t))n=8;else throw Error(ue+t);for(i=t.search(/p/i),i>0?(u=+t.slice(i+1),t=t.substring(2,i)):t=t.slice(2),i=t.indexOf("."),s=i>=0,r=e.constructor,s&&(t=t.replace(".",""),c=t.length,i=c-i,o=cn(r,new r(n),i,i*2)),a=We(t,n,X),l=a.length-1,i=l;a[i]===0;--i)a.pop();return i<0?new r(e.s*0):(e.e=ze(a,l),e.d=a,B=!1,s&&(e=V(e,o,c*4)),u&&(e=e.times(Math.abs(u)<54?H(2,u):Je.pow(2,u))),B=!0,e)}function or(e,t){var n,r=t.d.length;if(r<3)return t.isZero()?t:Ae(e,2,t,t);n=1.4*Math.sqrt(r),n=n>16?16:n|0,t=t.times(1/Ze(5,n)),t=Ae(e,2,t,t);for(var o,i=new e(5),s=new e(16),c=new e(20);n--;)o=t.times(t),t=t.times(i.plus(o.times(s.times(o).minus(c))));return t}function Ae(e,t,n,r,o){var i,s,c,u,a=1,l=e.precision,f=Math.ceil(l/S);for(B=!1,u=n.times(n),c=new e(r);;){if(s=V(c.times(u),new e(t++*t++),l,1),c=o?r.plus(s):r.minus(s),r=V(s.times(u),new e(t++*t++),l,1),s=c.plus(r),s.d[f]!==void 0){for(i=f;s.d[i]===c.d[i]&&i--;);if(i==-1)break}i=c,c=r,r=s,s=i,a++}return B=!0,s.d.length=f+1,s}function Ze(e,t){for(var n=e;--t;)n*=e;return n}function ln(e,t){var n,r=t.s<0,o=Q(e,e.precision,1),i=o.times(.5);if(t=t.abs(),t.lte(i))return ne=r?4:1,t;if(n=t.divToInt(o),n.isZero())ne=r?3:2;else{if(t=t.minus(n.times(o)),t.lte(i))return ne=Xt(n)?r?2:3:r?4:1,t;ne=Xt(n)?r?1:4:r?3:2}return t.minus(o).abs()}function Tt(e,t,n,r){var o,i,s,c,u,a,l,f,p,m=e.constructor,d=n!==void 0;if(d?(J(n,1,le),r===void 0?r=m.rounding:J(r,0,8)):(n=m.precision,r=m.rounding),!e.isFinite())l=un(e);else{for(l=ee(e),s=l.indexOf("."),d?(o=2,t==16?n=n*4-3:t==8&&(n=n*3-2)):o=t,s>=0&&(l=l.replace(".",""),p=new m(1),p.e=l.length-s,p.d=We(ee(p),10,o),p.e=p.d.length),f=We(l,10,o),i=u=f.length;f[--u]==0;)f.pop();if(!f[0])l=d?"0p+0":"0";else{if(s<0?i--:(e=new m(e),e.d=f,e.e=i,e=V(e,p,n,r,0,o),f=e.d,i=e.e,a=en),s=f[n],c=o/2,a=a||f[n+1]!==void 0,a=r<4?(s!==void 0||a)&&(r===0||r===(e.s<0?3:2)):s>c||s===c&&(r===4||a||r===6&&f[n-1]&1||r===(e.s<0?8:7)),f.length=n,a)for(;++f[--n]>o-1;)f[n]=0,n||(++i,f.unshift(1));for(u=f.length;!f[u-1];--u);for(s=0,l="";s<u;s++)l+=ht.charAt(f[s]);if(d){if(u>1)if(t==16||t==8){for(s=t==16?4:3,--u;u%s;u++)l+="0";for(f=We(l,o,t),u=f.length;!f[u-1];--u);for(s=1,l="1.";s<u;s++)l+=ht.charAt(f[s])}else l=l.charAt(0)+"."+l.slice(1);l=l+(i<0?"p":"p+")+i}else if(i<0){for(;++i;)l="0"+l;l="0."+l}else if(++i>u)for(i-=u;i--;)l+="0";else i<u&&(l=l.slice(0,i)+"."+l.slice(i))}l=(t==16?"0x":t==2?"0b":t==8?"0o":"")+l}return e.s<0?"-"+l:l}function Yt(e,t){if(e.length>t)return e.length=t,!0}function ir(e){return new this(e).abs()}function sr(e){return new this(e).acos()}function cr(e){return new this(e).acosh()}function ar(e,t){return new this(e).plus(t)}function ur(e){return new this(e).asin()}function lr(e){return new this(e).asinh()}function fr(e){return new this(e).atan()}function pr(e){return new this(e).atanh()}function mr(e,t){e=new this(e),t=new this(t);var n,r=this.precision,o=this.rounding,i=r+4;return!e.s||!t.s?n=new this(NaN):!e.d&&!t.d?(n=Q(this,i,1).times(t.s>0?.25:.75),n.s=e.s):!t.d||e.isZero()?(n=t.s<0?Q(this,r,o):new this(0),n.s=e.s):!e.d||t.isZero()?(n=Q(this,i,1).times(.5),n.s=e.s):t.s<0?(this.precision=i,this.rounding=1,n=this.atan(V(e,t,i,1)),t=Q(this,i,1),this.precision=r,this.rounding=o,n=e.s<0?n.minus(t):n.plus(t)):n=this.atan(V(e,t,i,1)),n}function dr(e){return new this(e).cbrt()}function hr(e){return A(e=new this(e),e.e+1,2)}function gr(e,t,n){return new this(e).clamp(t,n)}function br(e){if(!e||typeof e!="object")throw Error(je+"Object expected");var t,n,r,o=e.defaults===!0,i=["precision",1,le,"rounding",0,8,"toExpNeg",-Pe,0,"toExpPos",0,Pe,"maxE",0,Pe,"minE",-Pe,0,"modulo",0,9];for(t=0;t<i.length;t+=3)if(n=i[t],o&&(this[n]=gt[n]),(r=e[n])!==void 0)if(Z(r)===r&&r>=i[t+1]&&r<=i[t+2])this[n]=r;else throw Error(ue+n+": "+r);if(n="crypto",o&&(this[n]=gt[n]),(r=e[n])!==void 0)if(r===!0||r===!1||r===0||r===1)if(r)if(typeof crypto<"u"&&crypto&&(crypto.getRandomValues||crypto.randomBytes))this[n]=!0;else throw Error(nn);else this[n]=!1;else throw Error(ue+n+": "+r);return this}function yr(e){return new this(e).cos()}function wr(e){return new this(e).cosh()}function fn(e){var t,n,r;function o(i){var s,c,u,a=this;if(!(a instanceof o))return new o(i);if(a.constructor=o,$t(i)){a.s=i.s,B?!i.d||i.e>o.maxE?(a.e=NaN,a.d=null):i.e<o.minE?(a.e=0,a.d=[0]):(a.e=i.e,a.d=i.d.slice()):(a.e=i.e,a.d=i.d?i.d.slice():i.d);return}if(u=typeof i,u==="number"){if(i===0){a.s=1/i<0?-1:1,a.e=0,a.d=[0];return}if(i<0?(i=-i,a.s=-1):a.s=1,i===~~i&&i<1e7){for(s=0,c=i;c>=10;c/=10)s++;B?s>o.maxE?(a.e=NaN,a.d=null):s<o.minE?(a.e=0,a.d=[0]):(a.e=s,a.d=[i]):(a.e=s,a.d=[i]);return}else if(i*0!==0){i||(a.s=NaN),a.e=NaN,a.d=null;return}return wt(a,i.toString())}else if(u!=="string")throw Error(ue+i);return(c=i.charCodeAt(0))===45?(i=i.slice(1),a.s=-1):(c===43&&(i=i.slice(1)),a.s=1),on.test(i)?wt(a,i):rr(a,i)}if(o.prototype=h,o.ROUND_UP=0,o.ROUND_DOWN=1,o.ROUND_CEIL=2,o.ROUND_FLOOR=3,o.ROUND_HALF_UP=4,o.ROUND_HALF_DOWN=5,o.ROUND_HALF_EVEN=6,o.ROUND_HALF_CEIL=7,o.ROUND_HALF_FLOOR=8,o.EUCLID=9,o.config=o.set=br,o.clone=fn,o.isDecimal=$t,o.abs=ir,o.acos=sr,o.acosh=cr,o.add=ar,o.asin=ur,o.asinh=lr,o.atan=fr,o.atanh=pr,o.atan2=mr,o.cbrt=dr,o.ceil=hr,o.clamp=gr,o.cos=yr,o.cosh=wr,o.div=Tr,o.exp=xr,o.floor=Pr,o.hypot=Ar,o.ln=kr,o.log=Sr,o.log10=Br,o.log2=Cr,o.max=Ir,o.min=Lr,o.mod=Nr,o.mul=Er,o.pow=Rr,o.random=_r,o.round=Mr,o.sign=Dr,o.sin=vr,o.sinh=Or,o.sqrt=Kr,o.sub=Fr,o.sum=Vr,o.tan=Ur,o.tanh=Wr,o.trunc=qr,e===void 0&&(e={}),e&&e.defaults!==!0)for(r=["precision","rounding","toExpNeg","toExpPos","maxE","minE","modulo","crypto"],t=0;t<r.length;)e.hasOwnProperty(n=r[t++])||(e[n]=this[n]);return o.config(e),o}function Tr(e,t){return new this(e).div(t)}function xr(e){return new this(e).exp()}function Pr(e){return A(e=new this(e),e.e+1,3)}function Ar(){var e,t,n=new this(0);for(B=!1,e=0;e<arguments.length;)if(t=new this(arguments[e++]),t.d)n.d&&(n=n.plus(t.times(t)));else{if(t.s)return B=!0,new this(1/0);n=t}return B=!0,n.sqrt()}function $t(e){return e instanceof Je||e&&e.toStringTag===rn||!1}function kr(e){return new this(e).ln()}function Sr(e,t){return new this(e).log(t)}function Cr(e){return new this(e).log(2)}function Br(e){return new this(e).log(10)}function Ir(){return an(this,arguments,"lt")}function Lr(){return an(this,arguments,"gt")}function Nr(e,t){return new this(e).mod(t)}function Er(e,t){return new this(e).mul(t)}function Rr(e,t){return new this(e).pow(t)}function _r(e){var t,n,r,o,i=0,s=new this(1),c=[];if(e===void 0?e=this.precision:J(e,1,le),r=Math.ceil(e/S),this.crypto)if(crypto.getRandomValues)for(t=crypto.getRandomValues(new Uint32Array(r));i<r;)o=t[i],o>=429e7?t[i]=crypto.getRandomValues(new Uint32Array(1))[0]:c[i++]=o%1e7;else if(crypto.randomBytes){for(t=crypto.randomBytes(r*=4);i<r;)o=t[i]+(t[i+1]<<8)+(t[i+2]<<16)+((t[i+3]&127)<<24),o>=214e7?crypto.randomBytes(4).copy(t,i):(c.push(o%1e7),i+=4);i=r/4}else throw Error(nn);else for(;i<r;)c[i++]=Math.random()*1e7|0;for(r=c[--i],e%=S,r&&e&&(o=H(10,S-e),c[i]=(r/o|0)*o);c[i]===0;i--)c.pop();if(i<0)n=0,c=[0];else{for(n=-1;c[0]===0;n-=S)c.shift();for(r=1,o=c[0];o>=10;o/=10)r++;r<S&&(n-=S-r)}return s.e=n,s.d=c,s}function Mr(e){return A(e=new this(e),e.e+1,this.rounding)}function Dr(e){return e=new this(e),e.d?e.d[0]?e.s:0*e.s:e.s||NaN}function vr(e){return new this(e).sin()}function Or(e){return new this(e).sinh()}function Kr(e){return new this(e).sqrt()}function Fr(e,t){return new this(e).sub(t)}function Vr(){var e=0,t=arguments,n=new this(t[e]);for(B=!1;n.s&&++e<t.length;)n=n.plus(t[e]);return B=!0,A(n,this.precision,this.rounding)}function Ur(e){return new this(e).tan()}function Wr(e){return new this(e).tanh()}function qr(e){return A(e=new this(e),e.e+1,1)}h[Symbol.for("nodejs.util.inspect.custom")]=h.toString;h[Symbol.toStringTag]="Decimal";var Je=h.constructor=fn(gt);qe=new Je(qe);Ge=new Je(Ge);import Xr from"big.js";import Ai from"bn.js";import Gr from"toformat";var Hr=Gr,Le=Hr;import Xe from"big.js";import zr from"bn.js";import Zr from"decimal.js-light";import Ne from"bn.js";var pn=9007199254740991;function Y(e){let t=z("Raydium_parseBigNumberish");if(e instanceof Ne)return e;if(typeof e=="string"){if(e.match(/^-?[0-9]+$/))return new Ne(e);t.logWithError(`invalid BigNumberish string: ${e}`)}return typeof e=="number"?(e%1&&t.logWithError(`BigNumberish number underflow: ${e}`),(e>=pn||e<=-pn)&&t.logWithError(`BigNumberish number overflow: ${e}`),new Ne(String(e))):typeof e=="bigint"?new Ne(e.toString()):(t.error(`invalid BigNumberish value: ${e}`),new Ne(0))}var Qe=z("module/fraction"),xt=Le(Xe),Ee=Le(Zr),Jr={[0]:Ee.ROUND_DOWN,[1]:Ee.ROUND_HALF_UP,[2]:Ee.ROUND_UP},Qr={[0]:Xe.roundDown,[1]:Xe.roundHalfUp,[2]:Xe.roundUp},U=class{constructor(t,n=new zr(1)){this.numerator=Y(t),this.denominator=Y(n)}get quotient(){return this.numerator.div(this.denominator)}invert(){return new U(this.denominator,this.numerator)}add(t){let n=t instanceof U?t:new U(Y(t));return this.denominator.eq(n.denominator)?new U(this.numerator.add(n.numerator),this.denominator):new U(this.numerator.mul(n.denominator).add(n.numerator.mul(this.denominator)),this.denominator.mul(n.denominator))}sub(t){let n=t instanceof U?t:new U(Y(t));return this.denominator.eq(n.denominator)?new U(this.numerator.sub(n.numerator),this.denominator):new U(this.numerator.mul(n.denominator).sub(n.numerator.mul(this.denominator)),this.denominator.mul(n.denominator))}mul(t){let n=t instanceof U?t:new U(Y(t));return new U(this.numerator.mul(n.numerator),this.denominator.mul(n.denominator))}div(t){let n=t instanceof U?t:new U(Y(t));return new U(this.numerator.mul(n.denominator),this.denominator.mul(n.numerator))}toSignificant(t,n={groupSeparator:""},r=1){Number.isInteger(t)||Qe.logWithError(`${t} is not an integer.`),t<=0&&Qe.logWithError(`${t} is not positive.`),Ee.set({precision:t+1,rounding:Jr[r]});let o=new Ee(this.numerator.toString()).div(this.denominator.toString()).toSignificantDigits(t);return o.toFormat(o.decimalPlaces(),n)}toFixed(t,n={groupSeparator:""},r=1){return Number.isInteger(t)||Qe.logWithError(`${t} is not an integer.`),t<0&&Qe.logWithError(`${t} is negative.`),xt.DP=t,xt.RM=Qr[r]||1,new xt(this.numerator.toString()).div(this.denominator.toString()).toFormat(t,n)}isZero(){return this.numerator.isZero()}};var Ri=z("Raydium_amount"),_i=Le(Xr);import{PublicKey as $r}from"@solana/web3.js";import{TOKEN_PROGRAM_ID as mn}from"@solana/spl-token";var dn={chainId:101,address:$r.default.toBase58(),programId:mn.toBase58(),decimals:9,symbol:"SOL",name:"solana",logoURI:"https://img-v1.raydium.io/icon/So11111111111111111111111111111111111111112.png",tags:[],priority:2,type:"raydium",extensions:{coingeckoId:"solana"}},re={chainId:101,address:"So11111111111111111111111111111111111111112",programId:mn.toBase58(),decimals:9,symbol:"WSOL",name:"Wrapped SOL",logoURI:"https://img-v1.raydium.io/icon/So11111111111111111111111111111111111111112.png",tags:[],priority:2,type:"raydium",extensions:{coingeckoId:"solana"}};import{PublicKey as At}from"@solana/web3.js";import{PublicKey as W,SystemProgram as hn,SYSVAR_RENT_PUBKEY as eo}from"@solana/web3.js";import{TOKEN_PROGRAM_ID as to}from"@solana/spl-token";function Pt({pubkey:e,isSigner:t=!1,isWritable:n=!0}){return{pubkey:e,isWritable:n,isSigner:t}}var Ui=[Pt({pubkey:to,isWritable:!1}),Pt({pubkey:hn.programId,isWritable:!1}),Pt({pubkey:eo,isWritable:!1})];function gn({publicKey:e,transformSol:t}){let n=bn(e.toString());if(n instanceof W)return t&&n.equals(Re)?se:n;if(t&&n.toString()===Re.toBase58())return se;if(typeof n=="string"){if(n===W.default.toBase58())return W.default;try{return new W(n)}catch{throw new Error("invalid public key")}}throw new Error("invalid public key")}function bn(e){try{return new W(e)}catch{return e}}var Wi=new W("MemoSq4gqABAXKb96qnH8TysNcWxMyWCqXgDLGmfcHr"),qi=new W("MemoSq4gqABAXKb96qnH8TysNcWxMyWCqXgDLGmfcHr"),Gi=new W("SysvarRent111111111111111111111111111111111"),Hi=new W("SysvarC1ock11111111111111111111111111111111"),ji=new W("metaqbxxUerdq28cj1RbAWkYQm3ybzjb6a8bt518x1s"),zi=new W("Sysvar1nstructions1111111111111111111111111"),Zi=hn.programId,Ji=new W("4k3Dyjzvzp8eMZWUXbBCjEvwSkkk59S5iCNLY3QrkX6R"),Qi=new W("Ea5SjE2Y6yvCeW5dYTn7PYMuW5ikXkvbGdcmSnXeaLjS"),Xi=new W("SRMuApVNdxXokk5GT7XD5cUUgXMBCoAz2LHeuAoKWRt"),Yi=new W("EPjFWdd5AufqSSqeM2qN1xzybapC8G4wEGGkZwyTDt1v"),$i=new W("Es9vMFrzaCERmJfrF4H2FYD4KCoNkY11McCe8BenwNYB"),es=new W("mSoLzYCxHdYgdzU16g5QSh3i5K3z3KZK7ytfqcJm7So"),ts=new W("7dHbWXmci3dT8UFYWYZweBLXgycu7Y3iL6trKn1Y7ARj"),ns=new W("USDH1SM1ojwWUga67PGrgFWUHibbjqMvuMaDkRJTgkX"),rs=new W("NRVwhjBQiUPYtfDT5zRBVJajzFQHaBUNtC7SNVvqRFa"),os=new W("ANAxByE6G2WjFp7A4NqtWYXb3mgruyzZYg3spfxe6Lbo"),is=new W("7vfCXTUXx5WJV5JADk17DUJ4ksgau7utNKj4b963voxs"),se=new W("So11111111111111111111111111111111111111112"),Re=W.default;var kt=class{constructor({mint:t,decimals:n,symbol:r,name:o,skipMint:i=!1,isToken2022:s=!1}){if(t===Re.toBase58()||t instanceof At&&Re.equals(t)){this.decimals=re.decimals,this.symbol=re.symbol,this.name=re.name,this.mint=new At(re.address),this.isToken2022=!1;return}this.decimals=n,this.symbol=r||t.toString().substring(0,6),this.name=o||t.toString().substring(0,6),this.mint=i?At.default:gn({publicKey:t}),this.isToken2022=s}equals(t){return this===t?!0:this.mint.equals(t.mint)}},ke=kt;ke.WSOL=new kt(ie(q({},re),{mint:re.address}));var St=class{constructor({decimals:t,symbol:n="UNKNOWN",name:r="UNKNOWN"}){this.decimals=t,this.symbol=n,this.name=r}equals(t){return this===t}},Ye=St;Ye.SOL=new St(dn);import no from"bn.js";var bs=new U(new no(100));var As=z("Raydium_price");import{PublicKey as Vs}from"@solana/web3.js";import Ws from"bn.js";var ro=new oe(0),cc=new oe(1),ac=new oe(2),uc=new oe(3),lc=new oe(5),Yr=new oe(10),fc=new oe(100),pc=new oe(1e3),mc=new oe(1e4);function dt(e,t=1,n=[]){let r=[...e];if(t<=0)return n;for(;r.length;)n.push(r.splice(0,t));return n}import{PublicKey as lo}from"@solana/web3.js";import{TOKEN_PROGRAM_ID as fo}from"@solana/spl-token";import{ComputeBudgetProgram as xn,Keypair as An,PublicKey as oo,Transaction as kn,TransactionMessage as io,VersionedTransaction as Sn}from"@solana/web3.js";var G={CreateAccount:"CreateAccount",InitAccount:"InitAccount",CreateATA:"CreateATA",CloseAccount:"CloseAccount",TransferAmount:"TransferAmount",InitMint:"InitMint",MintTo:"MintTo",InitMarket:"InitMarket",Util1216OwnerClaim:"Util1216OwnerClaim",SetComputeUnitPrice:"SetComputeUnitPrice",SetComputeUnitLimit:"SetComputeUnitLimit",ClmmCreatePool:"ClmmCreatePool",ClmmOpenPosition:"ClmmOpenPosition",ClmmIncreasePosition:"ClmmIncreasePosition",ClmmDecreasePosition:"ClmmDecreasePosition",ClmmClosePosition:"ClmmClosePosition",ClmmSwapBaseIn:"ClmmSwapBaseIn",ClmmSwapBaseOut:"ClmmSwapBaseOut",ClmmInitReward:"ClmmInitReward",ClmmSetReward:"ClmmSetReward",ClmmCollectReward:"ClmmCollectReward",ClmmLockPosition:"ClmmLockPosition",ClmmHarvestLockPosition:"ClmmHarvestLockPosition",AmmV4Swap:"AmmV4Swap",AmmV4AddLiquidity:"AmmV4AddLiquidity",AmmV4RemoveLiquidity:"AmmV4RemoveLiquidity",AmmV4SimulatePoolInfo:"AmmV4SimulatePoolInfo",AmmV4SwapBaseIn:"AmmV4SwapBaseIn",AmmV4SwapBaseOut:"AmmV4SwapBaseOut",AmmV4CreatePool:"AmmV4CreatePool",AmmV4InitPool:"AmmV4InitPool",AmmV5AddLiquidity:"AmmV5AddLiquidity",AmmV5RemoveLiquidity:"AmmV5RemoveLiquidity",AmmV5SimulatePoolInfo:"AmmV5SimulatePoolInfo",AmmV5SwapBaseIn:"AmmV5SwapBaseIn",AmmV5SwapBaseOut:"AmmV5SwapBaseOut",RouteSwap:"RouteSwap",RouteSwap1:"RouteSwap1",RouteSwap2:"RouteSwap2",FarmV3Deposit:"FarmV3Deposit",FarmV3Withdraw:"FarmV3Withdraw",FarmV3CreateLedger:"FarmV3CreateLedger",FarmV4Withdraw:"FarmV4Withdraw",FarmV5Deposit:"FarmV5Deposit",FarmV5Withdraw:"FarmV5Withdraw",FarmV5CreateLedger:"FarmV5CreateLedger",FarmV6Deposit:"FarmV6Deposit",FarmV6Withdraw:"FarmV6Withdraw",FarmV6Create:"FarmV6Create",FarmV6Restart:"FarmV6Restart",FarmV6CreatorAddReward:"FarmV6CreatorAddReward",FarmV6CreatorWithdraw:"FarmV6CreatorWithdraw",CpmmCreatePool:"CpmmCreatePool",CpmmAddLiquidity:"CpmmAddLiquidity",CpmmWithdrawLiquidity:"CpmmWithdrawLiquidity",CpmmSwapBaseIn:"CpmmSwapBaseIn",CpmmSwapBaseOut:"CpmmSwapBaseOut",CpmmLockLp:"CpmmLockLp",CpmmCollectLockFee:"CpmmCollectLockFee",TransferTip:"TransferTip"};import{TOKEN_PROGRAM_ID as so}from"@solana/spl-token";var Pn=z("Raydium_txUtil"),Cn=1644;function $e(e){let t=[],n=[];return e.microLamports&&(t.push(xn.setComputeUnitPrice({microLamports:e.microLamports})),n.push(G.SetComputeUnitPrice)),e.units&&(t.push(xn.setComputeUnitLimit({units:e.units})),n.push(G.SetComputeUnitLimit)),{instructions:t,instructionTypes:n}}async function Se(e,t){var r,o;let n=t!=null?t:"confirmed";return(o=await((r=e.getLatestBlockhash)==null?void 0:r.call(e,{commitment:n})))==null?void 0:o.blockhash}async function Ct(e,t){return e.getSignatureStatuses([t]),new Promise((n,r)=>{let o=setTimeout(r,6e4);e.onSignature(t,i=>{if(clearTimeout(o),!i.err){n("");return}r(Object.assign(i.err,{txId:t}))},"confirmed")})}function co(e,t){e.length<1&&Pn.logWithError(`no instructions provided: ${e.toString()}`),t.length<1&&Pn.logWithError(`no signers provided:, ${t.toString()}`);let n=new kn;n.recentBlockhash="11111111111111111111111111111111",n.feePayer=t[0],n.add(...e);try{return Buffer.from(n.serialize({verifySignatures:!1})).toString("base64").length<Cn}catch{return!1}}function Bn(e,t){let[n,r]=oo.findProgramAddressSync(e,t);return{publicKey:n,nonce:r}}function _e({instructions:e,payer:t,signers:n}){return co(e,[t,...n])}function Me({instructions:e,payer:t,lookupTableAddressAccount:n,recentBlockhash:r=An.generate().publicKey.toString()}){let i=new io({payerKey:t,recentBlockhash:r,instructions:e}).compileToV0Message(Object.values(n!=null?n:{}));try{return Buffer.from(new Sn(i).serialize()).toString("base64").length<Cn}catch{return!1}}var ao=e=>Buffer.isBuffer(e)?e:e instanceof Uint8Array?Buffer.from(e.buffer,e.byteOffset,e.byteLength):Buffer.from(e),uo=e=>{let t=e.serialize({requireAllSignatures:!1,verifySignatures:!1});e instanceof Sn&&(t=ao(t));try{return t instanceof Buffer?t.toString("base64"):Buffer.from(t).toString("base64")}catch{return t.toString("base64")}};function we(e){let t=[];return e.forEach(n=>{n instanceof kn&&(n.recentBlockhash||(n.recentBlockhash=so.toBase58()),n.feePayer||(n.feePayer=An.generate().publicKey)),t.push(uo(n))}),console.log("simulate tx string:",t),t}function et(e,t,n){return Bn([e.toBuffer(),(n!=null?n:fo).toBuffer(),t.toBuffer()],new lo("ATokenGPvbdGVxr1b2hvZbsiqW5xWH25efTNsLJA8knL"))}import{PublicKey as I}from"@solana/web3.js";var Mc=new I("EhhTKczWMGQt46ynNeRX1WfeagwwJd7ufHvCDjRxjo5Q"),Dc=new I("CBuCnLe26faBpcBP2fktp4rp8abpcAnTWft6ZrP5Q4T"),vc=new I("9KEPoZmtHUrBbhWN1v1KWLMkkvwY6WLtAVUCPRtRjP4z"),Oc=new I("FarmqiPv5eAj3j1GMdMCMUGXqPUvmquZtMy86QH6rzhG"),Kc=new I("CLaimxFqjHzgTJtAGHU47NPhg6qrc5sCnpC4tBLyABQS"),Fc=new I("srmqPvymJeFKQ4zGQed1GFppgkRHL9kaELCbyksJtPX"),Vc=new I("9xQeWvG816bUx9EPjHmaT23yvVM2ZWbrrpZb9PusVFin"),Uc=new I("675kPX9MHTjS2zt1qfr1NYHuzeLXfQM9H24wFSUt1Mp8"),Wc=new I("5quBtoiQqxF9Jv6KYKctB59NT3gtJD2Y65kdnB1Uev3h"),qc=new I("CDSr3ssLcRB6XYPJwAfFt18MZvEZp4LjHcvzBVZ45duo"),Gc=new I("CAMMCzo5YL8w4VFF8KVHrK22GGUsp5VTaW7grrKgrWqK"),Hc=new I("LockrWmn6K5twhz3y9w1dQERbmgSaRkfnTeTKbpofwE"),jc=new I("kN1kEznaF5Xbd8LYuqtEFcxzWSBk5Fv6ygX6SqEGJVy"),zc=new I("routeUGWgWzqBWFcrCfv8tritsqukccJPu3q5GPP3xS"),Zc=new I("7YttLkHDoNj9wyDur5pM1ejNaAvT9X4eqaYcHQqtj2G5"),Jc=new I("6FJon3QE27qgPVggARueB22hLvoh22VzJpXv4rBEoSLF"),Qc=new I("CC12se5To1CdEuw7fDS27B7Geo5jJyL7t5UK2B44NgiH"),Xc=new I("9HzJyW1qZsEiSfMUf6L2jo3CcTKAyBmSyKdwQeYisHrC"),Yc=new I("DropEU8AvevN3UrXWXTMuz3rqnMczQVNjq3kcSdW2SQi"),$c=new I("CPMMoo8L3F4NbTegBCKVNunggL7H1ZpdTHKxQB5qKP1C"),ea=new I("GpMZbSM2GgvTKHJirzeGfMFoaZ8UR2X7F4v8vHTvxFbL"),ta=new I("DNXgeM9EiiaAbaWvwjHj9fQQLAX5ZsfHyvmYUNRAdNC8"),po=new I("CPMDWBwJDtYax9qW7AyRuVC19Cc4L4Vcy4n2BHAbHkCW"),mo=new I("7rQ1QFNosMkUCuh7Z7fPbTHvh73b68sQYdirycEzJVuw"),ho=new I("G11FKBRaAkHAKuLCgLM6K6NUc9rTjPAznRCjZifrTQe2"),na=new I("LockrWmn6K5twhz3y9w1dQERbmgSaRkfnTeTKbpofwE"),go=new I("DLockwT7X7sxtLmGH9g5kmfcjaBtncdbUmi738m5bvQC"),ra=new I("3f7GcQFG397GAaEnv51zR6tsTVihYRydnydDD1cXekxH"),bo=new I("7AFUeLVRjBfzqK3tTGw8hN48KLQWSk6DTE8xprWdPqix"),oa=new I("LanMV9sAd7wArD4vJFi2qDdfnVhFxYSUg6eADduJ3uj"),ia=new I("WLHv2UAZm6z4KyaaELi5pjdbJh6RESMva1Rnn8pJVVh"),yo=new I("LanD8FpTBBvzZFXjTxsAoipkFsxPUCDB4qAqKxYDiNP"),wo=new I("HYNHiyKJ3gGVFvyxJAurK7qr7P2o5J9THmvCGMdULtpW");var sa={AMM_V4:new I("HWy1jotHpo6UqeQxx49dpYYdQB8wj9Qk9MdxwjLvDHB8"),AMM_STABLE:new I("DDg4VmQaJV9ogWce7LpcjBA9bv22wRp5uaTPa5pGjijF"),CLMM_PROGRAM_ID:new I("devi51mZmdwUJGU9hjN27vEz64Gps7uUefqxg27EAtH"),CLMM_LOCK_PROGRAM_ID:new I("DLockwT7X7sxtLmGH9g5kmfcjaBtncdbUmi738m5bvQC"),CLMM_LOCK_AUTH_ID:new I("8qmHNvu2Kr2C7U8mJL4Vz1vTDxMhVuXKREwU7TNoaVEo"),FARM_PROGRAM_ID_V3:new I("85BFyr98MbCUU9MVTEgzx1nbhWACbJqLzho6zd6DZcWL"),FARM_PROGRAM_ID_V5:new I("EcLzTrNg9V7qhcdyXDe2qjtPkiGzDM2UbdRaeaadU5r2"),FARM_PROGRAM_ID_V6:new I("Farm2hJLcqPtPg8M4rR6DMrsRNc5TPm5Cs4bVQrMe2T7"),OPEN_BOOK_PROGRAM:new I("EoTcMgcDRTJVZDMZWBoU6rhYHZfkNTVEAfz3uUJRcYGj"),SERUM_PROGRAM_ID_V3:I.default,UTIL1216:I.default,Router:new I("BVChZ3XFEwTMUk1o9i3HAf91H6mFxSwa5X2wFAWhYPhU"),CREATE_CPMM_POOL_PROGRAM:po,CREATE_CPMM_POOL_AUTH:mo,CREATE_CPMM_POOL_FEE_ACC:ho,LOCK_CPMM_PROGRAM:go,LOCK_CPMM_AUTH:bo,LAUNCHPAD_PROGRAM:yo,LAUNCHPAD_AUTH:wo,FEE_DESTINATION_ID:new I("3XMrhbv989VxAMi3DErLV9eJht1pHppW5LbKxe9fkEFR")};import ua from"bn.js";import{PublicKey as In,AddressLookupTableAccount as tt}from"@solana/web3.js";async function Bt({connection:e,address:t}){let n=await Qt(e,[...new Set(t.map(o=>o.toString()))].map(o=>new In(o))),r={};for(let o=0;o<t.length;o++){let i=n[o],s=t[o];if(!i)continue;let c=new tt({key:s,state:tt.deserialize(i.data)});r[s.toString()]=c,nt[s.toString()]=c}return r}var nt={AcL1Vo8oy1ULiavEcjSUcwfBSForXMudcZvDZy5nzJkU:new tt({key:new In("AcL1Vo8oy1ULiavEcjSUcwfBSForXMudcZvDZy5nzJkU"),state:tt.deserialize(Buffer.from("AQAAAP//////////I1rcEwAAAAAvAQYwun9CU6c5Ikm2pAj+D9IEnCOR45nK+SFTGSdpd6J6AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAbd9uHXZaGT2cvhRs7reawctIXtX1s3kTqM9YV+/wCpBt324e51j94YQl285GzN2rYa/E2DuQ0n/r35KNihi/wFSlNQ+F3IgtYUpVZyeIopbd8eq6vQpgZ4iEky9O72oAVKU1qZKSEGTSTocWDaOHx8NbXdvJK7geQfqEBBBUSNBqfVFxksXFEhjMlMPUrxf1ja7gibof1E49vZigAAAAAGp9UXGMd0yShWY5hpHV62i164o5tLbVxzVVshAAAAAIyXJY9OJInxuz0QKRSODYMLWhOZ2v8QhASOe9jb6fhZC3BlsePRfEU4nVJ/awTDzVi4bHMaoP21SbbRvAP4KUbIScv+6Yw2LHF/6K0ZjUPibbSWXCirYPGuuVl7zT789IUPLW4CpHr4JNCatp3ELXDLKMv6JJ+37le50lbBJ2LvBkX2T9y7AHdNGviJAqQNtlDUDCnauQRWybsLji6nPM8Qkw5asQRvCdB3MbX6IEBwytOrpM32l4jQygKG9TKgR0vZScQ2AsM/IHeQ7RajUkyhuZdc8SGiqQz/7H34torNR/Wir3sl0ruUrVxJWEZfUg+QLNAxxODdBi53/OP7Ioil1cqeBM9dtZC3FLov4yyxWRM/wcGStyJX/QfTnLBAHqkqWotPKVlShCVQqpP9W5W1rOao65IMk5QuQ2kMIOxzDMKAy2vjGSxQODgBz0QwGA+eP4ZjIjrIAQaXENv31QfLlOdXSRCkaybRniDHF4C8YcwhcvsqrOVuTP4B2Na+9wLdtrB31uz2rtlFI5kahdsnp/d1SrASDInYCtTYtdoke4kX+hoKWcEWM4Tle8pTUkUVv4BxS6fje/EzKBE4Qu/YsA/yfEEFGcr8Z57VKDw8uQzpiru7g4lvjnfapW62W030syevD8k07SGoxUHiuT/ai7gAHWWhDsVmg/C63ajgpkH7Sn3GdutArDTfyqOkdqv4/IPC/EFFy7mGkfDd2C57N5a/4jC+BbmJy7wQaSEZr0CQU88lPtUxIVvzGjC95b8Ooss2TqmkrayGKofkPMGQn7Ux+9lfwBSNfxwH8NgbpqC/7LNlV4I7nCvsXf3p+ohQk9NrAJb2KAFpUqEIJ9ZBV7BYDzHF/ORKYlgtvPnXjudZQ6CEo5OzUDaNIomTCCsvhD16TxJjsbgne1kGnQPCFSoaxUbq2V1bPMFQ3VYP6wDZ9bKStCFKx9A3tNbwZFC5ZGAN83MFK7XoTy+OmmcFEr6rLOjfSuTfPvHJkSVxW6Qllwkl67XcBi5v00u2gQsbu+38sp+rd5pA/LvyWj4P94ZGZwc1tE2P88xekCLcAwZGb+UhFzL/7K26csOb57yM5bvF9xJrLEObOkAAAAAn+HWRkdcPKyFFMnVwEoD7vnD0jCKFIU1sImubYCxNTSVzsKpaQX+fzNxrLAI3L14JQnJx/D6Uk2LADIHGqnGELzjEbkBDAlaM77NkXMPfqXNLSveCkWI7UEgNs31WEWB6XHSYI/v5DklHOb4QTtDOR804PVbi3fjloZeLR2F8d4FuZmMMO7ck3Fnkn2zEMG5gOmqsygb6PjTitArVl52NhcSznTxVnguaIJxiZkAnurDmn3MWR0PC2GLghp2KJqHCc6QQ85odeIjFHKOlRlJyeSXVJmL8vb1UgOzsbJPVP8p6zM4M3C1Sd7uWIHP33G42AP2Zg8ucn/n6meQjjD266JgCWdxZD6PXs9CsnIeL7SSG0/6lGb9xfP0ZcWkCXB/3hjxHYVXjra/GPOeXGk0fLLKjCbk+mgs2w6d2oCwimBipTzuoZ30GiI8ij8VRzD5CzMWtu2m21eDBIfjGAEo4pQeNNonKcqzV/cleX8ySZLOHsz8PtBCrLqF+VkLm9hOzIT+6i/nIf6keR4GWKMOD4AvqfpjHoD4DuhBpz8P28+DxkGrDXXr/nr20x291VPvcTU/b+b+o2kC9G0kcXeTlLjU6a2TQXWlZ4gBUdBl1jgT7mObSTpLblNiXZsLkbmVXZwvFKXua5cUKlWed/w30skmEUraTuQqtqr5fHZPW9n57EmeTif6LjHL2YJFZkQU+TrJmFzqzmF4/b8OwrPQAprl8mX3q4LUIdAS/a+11B6DWD1Xk2++Sn94dLC4xjkO4Wtlw8c4XuzciVbepHOmnoWzVu/0y3KCrLCSfQxQ3br8DJCoVzhgtPsS2nZZjsBGIZgnU0QpMv+2MnRsnKwdp1VsrCX84j/qvaZn4WhKunippgTbN2EUs0tPTP55Qfgj+nKmjtWW5IYs72FrEwJKYoNfsmqaF4o5pf4v9zgPwVwY/5I4XJKUL2L25m9kAQcW/K+H1RTFEUoj8Z4ajpOmAB/dG0COmCphVMW2CCMvnxhcGiSgPnpDuWu6qiJ7NG7ye5kvHgefgqPLeicspNJ5EpL3XiRNLM2tmJLI1awAwOyd6iHv0dCkMYRKaa6rcaZeYwmKCkckm0kM2JNmnmmAaBQQ7mwmIM0IMxX4f5W6j9PqZWcJxF7r17T/lQBAmcjoupRiJifbnXCNUv9GhpRF19WcBdeKbivRJVlGop6I2RS6lGImJ9udcI1S/0aGlEXX1ZwF14puK9ElWUainojZFYVHLHD6dIP2ESjqBzg3ol1/wB7+/ylGwd9LS7wSZ2A630CJSVKwH47K9P4bB8PEQP8BwjMFa7xQHOqZFP1XqaQ==","base64"))})};import{PublicKey as Te,sendAndConfirmTransaction as It,SystemProgram as Ln,Transaction as De,TransactionMessage as fe,VersionedTransaction as pe}from"@solana/web3.js";import To from"axios";import{LAMPORTS_PER_SOL as En}from"@solana/web3.js";var xo="http://sg-sender.helius-rpc.com/fast",Ia=.001*En,Nn=["4ACfpUFoaSD9bfPdeu6DBt89gB6ENTeHBXCAi87NhDEE","D2L6yPZ2FmmmTKPgzaMKdhu6EWZcTpLy1Vhx8uvZe7NZ","9bnz4RShgq1hAnLnZbP8kbgBg1kEmcJBYQq3gQbmnSta","5VY91ws6B2hMmBFRsXkoAAdsPHBJwRfBht4DXox3xkwn","2nyhqdwKcJZR2vcqCyrYsaPVdAnFoJjiksCXJ7hfEYgD","2q5pghRs6arqVjRvT5gfgWfWcHWmw1ZuCzphgd5KfWGJ","wyvPkWjVZz1M8fHQnMMCDTQDbkManefNNhweYk5WkcF","3KCKozbAaF75qEU33jtzozcJ29yJuaLJTy2jFdzUY8bT","4vieeGHPYPG2MmyPRcYjdiDmmhN3ww7hsFNap8pVN3Ey","4TQLFNWK8AovT1gFvda5jfw2oJeRMKEmw7aH6MGBJ3or"].map(e=>new Te(e)),rt=2e3;async function Po(e){let t=Buffer.from(e.serialize()).toString("base64"),r=await(await fetch(xo,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({jsonrpc:"2.0",id:Date.now().toString(),method:"sendTransaction",params:[t,{encoding:"base64",skipPreflight:!0,maxRetries:0}]})})).json();if(console.log("Helius response:",JSON.stringify(r,null,2)),r.error)throw new Error(r.error.message);let o=r.result;return console.log("Transaction sent:",o),o}var ot=class{constructor(t){this.instructions=[];this.endInstructions=[];this.lookupTableAddress=[];this.signers=[];this.instructionTypes=[];this.endInstructionTypes=[];this.connection=t.connection,this.feePayer=t.feePayer,this.signAllTransactions=t.signAllTransactions,this.owner=t.owner,this.cluster=t.cluster,this.blockhashCommitment=t.blockhashCommitment,this.loopMultiTxStatus=!!t.loopMultiTxStatus}get AllTxData(){return{instructions:this.instructions,endInstructions:this.endInstructions,signers:this.signers,instructionTypes:this.instructionTypes,endInstructionTypes:this.endInstructionTypes,lookupTableAddress:this.lookupTableAddress}}get allInstructions(){return[...this.instructions,...this.endInstructions]}async getComputeBudgetConfig(){var r;let t=(await To.get(`https://solanacompass.com/api/fees?cacheFreshTime=${3e5}`)).data,{avg:n}=(r=t==null?void 0:t[15])!=null?r:{};if(!!n)return{units:6e5,microLamports:Math.min(Math.ceil(n*1e6/6e5),25e3)}}addCustomComputeBudget(t){if(t){let{instructions:n,instructionTypes:r}=$e(t);return this.instructions.unshift(...n),this.instructionTypes.unshift(...r),!0}return!1}addTipInstruction(t){var n;return t?(this.endInstructions.push(Ln.transfer({fromPubkey:(n=t.feePayer)!=null?n:this.feePayer,toPubkey:new Te(t.address),lamports:BigInt(t.amount.toString())})),this.endInstructionTypes.push(G.TransferTip),!0):!1}async calComputeBudget({config:t,defaultIns:n}){try{let r=t||await this.getComputeBudgetConfig();if(this.addCustomComputeBudget(r))return;n&&this.instructions.unshift(...n)}catch{n&&this.instructions.unshift(...n)}}addInstruction({instructions:t=[],endInstructions:n=[],signers:r=[],instructionTypes:o=[],endInstructionTypes:i=[],lookupTableAddress:s=[]}){return this.instructions.push(...t),this.endInstructions.push(...n),this.signers.push(...r),this.instructionTypes.push(...o),this.endInstructionTypes.push(...i),this.lookupTableAddress.push(...s.filter(c=>c!==Te.default.toString())),this}async versionBuild({txVersion:t,extInfo:n}){return t===0?await this.buildV0(q({},n||{})):this.build(n)}build(t){var r;let n=new De;return this.allInstructions.length&&n.add(...this.allInstructions),n.feePayer=this.feePayer,((r=this.owner)==null?void 0:r.signer)&&!this.signers.some(o=>o.publicKey.equals(this.owner.publicKey))&&this.signers.push(this.owner.signer),{builder:this,transaction:n,signers:this.signers,instructionTypes:[...this.instructionTypes,...this.endInstructionTypes],execute:async o=>{var l;let{recentBlockHash:i,skipPreflight:s=!0,sendAndConfirm:c,notSendToRpc:u}=o||{},a=i!=null?i:await Se(this.connection,this.blockhashCommitment);if(n.recentBlockhash=a,this.signers.length&&n.sign(...this.signers),we([n]),console.log("SEND 1"),(l=this.owner)!=null&&l.isKeyPair)return{txId:c?await It(this.connection,n,this.signers.find(p=>p.publicKey.equals(this.owner.publicKey))?this.signers:[...this.signers,this.owner.signer],{skipPreflight:s}):await this.connection.sendRawTransaction(n.serialize(),{skipPreflight:s}),signedTx:n};if(this.signAllTransactions){let f=await this.signAllTransactions([n]);if(this.signers.length)for(let p of f)try{p.sign(...this.signers)}catch{}return{txId:u?"":await this.connection.sendRawTransaction(f[0].serialize(),{skipPreflight:s}),signedTx:f[0]}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:t||{}}}buildMultiTx(t){var a;let{extraPreBuildData:n=[],extInfo:r}=t,{transaction:o}=this.build(r),i=n.filter(l=>l.transaction.instructions.length>0),s=[o,...i.map(l=>l.transaction)],c=[this.signers,...i.map(l=>l.signers)],u=[...this.instructionTypes,...i.map(l=>l.instructionTypes).flat()];return(a=this.owner)!=null&&a.signer&&c.forEach(l=>{l.some(f=>f.publicKey.equals(this.owner.publicKey))||this.signers.push(this.owner.signer)}),{builder:this,transactions:s,signers:c,instructionTypes:u,execute:async l=>{var x;let{sequentially:f,onTxUpdate:p,skipTxCount:m=0,recentBlockHash:d,skipPreflight:g=!0}=l||{},y=d!=null?d:await Se(this.connection,this.blockhashCommitment);if((x=this.owner)!=null&&x.isKeyPair){if(f){let P=[],T=0;for(let w of s){if(++T,T<=m)continue;let b=await It(this.connection,w,this.signers.find(k=>k.publicKey.equals(this.owner.publicKey))?this.signers:[...this.signers,this.owner.signer],{skipPreflight:g});P.push(b)}return{txIds:P,signedTxs:s}}return{txIds:await await Promise.all(s.map(async P=>(P.recentBlockhash=y,await this.connection.sendRawTransaction(P.serialize(),{skipPreflight:g})))),signedTxs:s}}if(this.signAllTransactions){let P=s.map((w,b)=>(w.recentBlockhash=y,c[b].length&&w.sign(...c[b]),w));we(P),console.log("SEND 2");let T=await this.signAllTransactions(P);if(f){let w=0,b=[],k=async()=>{if(!T[w])return;let N=await this.connection.sendRawTransaction(T[w].serialize(),{skipPreflight:g});b.push({txId:N,status:"sent",signedTx:T[w]}),p==null||p([...b]),w++;let C=!1,_=null,v=null,F=M=>{_!==null&&clearInterval(_),v!==null&&this.connection.removeSignatureListener(v);let O=b.findIndex(K=>K.txId===N);if(O>-1){if(b[O].status==="error"||b[O].status==="success")return;b[O].status=M.err?"error":"success"}p==null||p([...b]),M.err||k()};this.loopMultiTxStatus&&(_=setInterval(async()=>{var M;if(C){clearInterval(_);return}try{let O=await this.connection.getTransaction(N,{commitment:"confirmed",maxSupportedTransactionVersion:0});O&&(C=!0,clearInterval(_),F({err:((M=O.meta)==null?void 0:M.err)||null}),console.log("tx status from getTransaction:",N))}catch(O){C=!0,clearInterval(_),console.error("getTransaction timeout:",O,N)}},rt)),v=this.connection.onSignature(N,M=>{if(C){this.connection.removeSignatureListener(v);return}C=!0,F(M)},"confirmed"),this.connection.getSignatureStatus(N)};return await k(),{txIds:b.map(N=>N.txId),signedTxs:T}}else{let w=[];for(let b=0;b<T.length;b+=1){let k=await this.connection.sendRawTransaction(T[b].serialize(),{skipPreflight:g});w.push(k)}return{txIds:w,signedTxs:T}}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:r||{}}}async versionMultiBuild({extraPreBuildData:t,txVersion:n,extInfo:r}){return n===0?await this.buildV0MultiTx({extraPreBuildData:t,buildProps:r||{}}):this.buildMultiTx({extraPreBuildData:t,extInfo:r})}async buildV0(t){var g;let d=t||{},{lookupTableCache:n={},lookupTableAddress:r=[],forerunCreate:o,recentBlockhash:i}=d,s=ye(d,["lookupTableCache","lookupTableAddress","forerunCreate","recentBlockhash"]),c=q(q({},this.cluster==="devnet"?{}:nt),n),u=Array.from(new Set([...r,...this.lookupTableAddress])),a=[];for(let y of u)c[y]===void 0&&a.push(new Te(y));let l=await Bt({connection:this.connection,address:a});for(let[y,x]of Object.entries(l))c[y]=x;let f=o?Te.default.toBase58():i!=null?i:await Se(this.connection,this.blockhashCommitment),p=new fe({payerKey:this.feePayer,recentBlockhash:f,instructions:[...this.allInstructions]}).compileToV0Message(Object.values(c));((g=this.owner)==null?void 0:g.signer)&&!this.signers.some(y=>y.publicKey.equals(this.owner.publicKey))&&this.signers.push(this.owner.signer);let m=new pe(p);return m.sign(this.signers),{builder:this,transaction:m,signers:this.signers,instructionTypes:[...this.instructionTypes,...this.endInstructionTypes],execute:async y=>{var w;let{skipPreflight:x=!0,sendAndConfirm:P,notSendToRpc:T}=y||{};if(we([m]),console.log("SEND 3"),(w=this.owner)!=null&&w.isKeyPair){let b=await this.connection.sendTransaction(m,{skipPreflight:x});return P&&await Ct(this.connection,b),{txId:b,signedTx:m}}if(this.signAllTransactions){let b=await this.signAllTransactions([m]);if(this.signers.length)for(let k of b)try{k.sign(this.signers)}catch{}return{txId:T?"":await this.connection.sendTransaction(b[0],{skipPreflight:x}),signedTx:b[0]}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:s||{}}}async buildV0MultiTx(t){var a;let{extraPreBuildData:n=[],buildProps:r}=t,{transaction:o}=await this.buildV0(r),i=n.filter(l=>l.builder.instructions.length>0),s=[o,...i.map(l=>l.transaction)],c=[this.signers,...i.map(l=>l.signers)],u=[...this.instructionTypes,...i.map(l=>l.instructionTypes).flat()];return(a=this.owner)!=null&&a.signer&&c.forEach(l=>{l.some(f=>f.publicKey.equals(this.owner.publicKey))||this.signers.push(this.owner.signer)}),s.forEach(async(l,f)=>{l.sign(c[f])}),{builder:this,transactions:s,signers:c,instructionTypes:u,buildProps:r,execute:async l=>{var g;let{sequentially:f,onTxUpdate:p,recentBlockHash:m,skipPreflight:d=!0}=l||{};if(m&&s.forEach(y=>y.message.recentBlockhash=m),we(s),console.log("SEND 4"),(g=this.owner)!=null&&g.isKeyPair){if(f){let y=[];for(let x of s){let P=await this.connection.sendTransaction(x,{skipPreflight:d});await Ct(this.connection,P),y.push(P)}return{txIds:y,signedTxs:s}}return{txIds:await Promise.all(s.map(async y=>await this.connection.sendTransaction(y,{skipPreflight:d}))),signedTxs:s}}if(this.signAllTransactions){let y=await this.signAllTransactions(s);if(f){let x=0,P=[],T=async()=>{if(!y[x])return;let w=await this.connection.sendTransaction(y[x],{skipPreflight:d});P.push({txId:w,status:"sent",signedTx:y[x]}),p==null||p([...P]),x++;let b=!1,k=null,N=null,C=_=>{k!==null&&clearInterval(k),N!==null&&this.connection.removeSignatureListener(N);let v=P.findIndex(F=>F.txId===w);if(v>-1){if(P[v].status==="error"||P[v].status==="success")return;P[v].status=_.err?"error":"success"}p==null||p([...P]),_.err||T()};this.loopMultiTxStatus&&(k=setInterval(async()=>{var _;if(b){clearInterval(k);return}try{let v=await this.connection.getTransaction(w,{commitment:"confirmed",maxSupportedTransactionVersion:0});v&&(b=!0,clearInterval(k),C({err:((_=v.meta)==null?void 0:_.err)||null}),console.log("tx status from getTransaction:",w))}catch(v){b=!0,clearInterval(k),console.error("getTransaction timeout:",v,w)}},rt)),N=this.connection.onSignature(w,_=>{if(b){this.connection.removeSignatureListener(N);return}b=!0,C(_)},"confirmed"),this.connection.getSignatureStatus(w)};return T(),{txIds:[],signedTxs:y}}else{let x=[];for(let P=0;P<y.length;P+=1){let T=await this.connection.sendTransaction(y[P],{skipPreflight:d});x.push(T)}return{txIds:x,signedTxs:y}}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:r||{}}}async sizeCheckBuild(t){var p;let f=t||{},{splitIns:n=[],computeBudgetConfig:r}=f,o=ye(f,["splitIns","computeBudgetConfig"]),i=r?$e(r):{instructions:[],instructionTypes:[]},s=this.signers.reduce((m,d)=>ie(q({},m),{[d.publicKey.toBase58()]:d}),{}),c=[],u=[],a=[],l=0;if(this.allInstructions.forEach(m=>{let d=[...a,m],g=r?[...i.instructions,...d]:d,x=[...new Set(d.map(P=>P.keys.filter(T=>T.isSigner).map(T=>T.pubkey.toString())).flat()).values()].map(P=>new Te(P));if(m!==n[l]&&a.length<12&&(_e({instructions:g,payer:this.feePayer,signers:x})||_e({instructions:d,payer:this.feePayer,signers:x})))a.push(m);else{if(a.length===0)throw Error("item ins too big");l+=m===n[l]?1:0,_e({instructions:r?[...i.instructions,...a]:[...a],payer:this.feePayer,signers:x})?c.push(new De().add(...i.instructions,...a)):c.push(new De().add(...a)),u.push(Array.from(new Set(a.map(P=>P.keys.filter(T=>T.isSigner).map(T=>T.pubkey.toString())).flat())).map(P=>s[P]).filter(P=>P!==void 0)),a=[m]}}),a.length>0){let d=[...new Set(a.map(g=>g.keys.filter(y=>y.isSigner).map(y=>y.pubkey.toString())).flat()).values()].map(g=>s[g]).filter(g=>g!==void 0);_e({instructions:r?[...i.instructions,...a]:[...a],payer:this.feePayer,signers:d.map(g=>g.publicKey)})?c.push(new De().add(...i.instructions,...a)):c.push(new De().add(...a)),u.push(d)}return c.forEach(m=>m.feePayer=this.feePayer),(p=this.owner)!=null&&p.signer&&u.forEach(m=>{m.some(d=>d.publicKey.equals(this.owner.publicKey))||m.push(this.owner.signer)}),{builder:this,transactions:c,signers:u,instructionTypes:this.instructionTypes,execute:async m=>{var w;let{sequentially:d,onTxUpdate:g,skipTxCount:y=0,recentBlockHash:x,skipPreflight:P=!0}=m||{},T=x!=null?x:await Se(this.connection,this.blockhashCommitment);if(c.forEach(async(b,k)=>{b.recentBlockhash=T,u[k].length&&b.sign(...u[k])}),we(c),console.log("SEND 5"),console.log("sizeCheckBuild"),(w=this.owner)!=null&&w.isKeyPair){if(d){let b=0,k=[];for(let N of c){if(++b,b<=y){k.push("tx skipped");continue}let C=await It(this.connection,N,this.signers.find(_=>_.publicKey.equals(this.owner.publicKey))?this.signers:[...this.signers,this.owner.signer],{skipPreflight:P});k.push(C)}return{txIds:k,signedTxs:c}}return{txIds:await Promise.all(c.map(async b=>await this.connection.sendRawTransaction(b.serialize(),{skipPreflight:P}))),signedTxs:c}}if(this.signAllTransactions){let b=await this.signAllTransactions(c.slice(y,c.length)),k=[...c.slice(0,y),...b];if(d){let N=0,C=[],_=async()=>{if(!k[N])return;N<y&&(C.push({txId:"",status:"success",signedTx:k[N]}),g==null||g([...C]),N++,_());let v=await this.connection.sendRawTransaction(k[N].serialize(),{skipPreflight:P});C.push({txId:v,status:"sent",signedTx:k[N]}),g==null||g([...C]),N++;let F=!1,M=null,O=null,K=D=>{M!==null&&clearInterval(M),O!==null&&this.connection.removeSignatureListener(O);let L=C.findIndex(ge=>ge.txId===v);if(L>-1){if(C[L].status==="error"||C[L].status==="success")return;C[L].status=D.err?"error":"success"}g==null||g([...C]),D.err||_()};this.loopMultiTxStatus&&(M=setInterval(async()=>{var D;if(F){clearInterval(M);return}try{let L=await this.connection.getTransaction(v,{commitment:"confirmed",maxSupportedTransactionVersion:0});L&&(F=!0,clearInterval(M),K({err:((D=L.meta)==null?void 0:D.err)||null}),console.log("tx status from getTransaction:",v))}catch(L){F=!0,clearInterval(M),console.error("getTransaction timeout:",L,v)}},rt)),O=this.connection.onSignature(v,D=>{if(F){this.connection.removeSignatureListener(O);return}F=!0,K(D)},"confirmed"),this.connection.getSignatureStatus(v)};return await _(),{txIds:C.map(v=>v.txId),signedTxs:k}}else{let N=[];for(let C=0;C<k.length;C+=1){let _=await this.connection.sendRawTransaction(k[C].serialize(),{skipPreflight:P});N.push(_)}return{txIds:N,signedTxs:k}}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:o||{}}}async sizeCheckBuildV0(t){var T;let P=t||{},{computeBudgetConfig:n,splitIns:r=[],lookupTableCache:o={},lookupTableAddress:i=[]}=P,s=ye(P,["computeBudgetConfig","splitIns","lookupTableCache","lookupTableAddress"]),c=q(q({},this.cluster==="devnet"?{}:nt),o),u=Array.from(new Set([...this.lookupTableAddress,...i])),a=[];for(let w of u)c[w]===void 0&&a.push(new Te(w));let l=await Bt({connection:this.connection,address:a});for(let[w,b]of Object.entries(l))c[w]=b;let f=n?$e(n):{instructions:[],instructionTypes:[]},p=await Se(this.connection,this.blockhashCommitment),m=this.signers.reduce((w,b)=>ie(q({},w),{[b.publicKey.toBase58()]:b}),{}),d=[],g=[],y=[],x=0;if(this.allInstructions.forEach(w=>{let b=[...y,w],k=n?[...f.instructions,...b]:b;if(w!==r[x]&&y.length<12&&(Me({instructions:k,payer:this.feePayer,lookupTableAddressAccount:c})||Me({instructions:b,payer:this.feePayer,lookupTableAddressAccount:c})))y.push(w);else{if(y.length===0)throw Error("item ins too big");x+=w===r[x]?1:0;let N={};for(let C of[...new Set(u)])c[C]!==void 0&&(N[C]=c[C]);if(n&&Me({instructions:[...f.instructions,...y],payer:this.feePayer,lookupTableAddressAccount:c,recentBlockhash:p})){let C=new fe({payerKey:this.feePayer,recentBlockhash:p,instructions:[...f.instructions,...y]}).compileToV0Message(Object.values(c));d.push(new pe(C))}else{let C=new fe({payerKey:this.feePayer,recentBlockhash:p,instructions:[...y]}).compileToV0Message(Object.values(c));d.push(new pe(C))}g.push(Array.from(new Set(y.map(C=>C.keys.filter(_=>_.isSigner).map(_=>_.pubkey.toString())).flat())).map(C=>m[C]).filter(C=>C!==void 0)),y=[w]}}),y.length>0){let b=[...new Set(y.map(K=>K.keys.filter(D=>D.isSigner).map(D=>D.pubkey.toString())).flat()).values()].map(K=>m[K]).filter(K=>K!==void 0),k=Nn[Math.floor(Math.random()*Nn.length)],N=Ln.transfer({fromPubkey:this.feePayer,toPubkey:k,lamports:Math.floor(.001*En)});if(n&&Me({instructions:[N,...f.instructions,...y],payer:this.feePayer,lookupTableAddressAccount:c,recentBlockhash:p})){console.log("MESSAGE 1");let K=new fe({payerKey:this.feePayer,recentBlockhash:p,instructions:[N,...y]}).compileToV0Message(Object.values(c));d.push(new pe(K))}else{console.log("MESSAGE 2");let K=new fe({payerKey:this.feePayer,recentBlockhash:p,instructions:[N,...y]}).compileToV0Message(Object.values(c));d.push(new pe(K))}let C=new fe({payerKey:this.feePayer,recentBlockhash:p,instructions:[N]}).compileToV0Message([]),_=new pe(C);console.log("\u{1F4E6} Tip-only tx size:",_.serialize().length);let v=new fe({payerKey:this.feePayer,recentBlockhash:p,instructions:[...f.instructions]}).compileToV0Message(Object.values(c)),F=new pe(v);console.log("\u{1F4E6} computeTx-only tx size:",F.serialize().length),g.push(b);let M=new fe({payerKey:this.feePayer,recentBlockhash:p,instructions:[...y]}).compileToV0Message([]),O=new pe(M);console.log("\u{1F4E6} instructionTx-only tx size:",O.serialize().length),g.push(b)}return(T=this.owner)!=null&&T.signer&&g.forEach(w=>{w.some(b=>b.publicKey.equals(this.owner.publicKey))||w.push(this.owner.signer)}),d.forEach((w,b)=>{w.sign(g[b]),console.log(`Tx #${b+1} size (bytes):`,w.serialize().length)}),{builder:this,transactions:d,buildProps:t,signers:g,instructionTypes:this.instructionTypes,execute:async w=>{var v;let{sequentially:b,onTxUpdate:k,skipTxCount:N=0,recentBlockHash:C,skipPreflight:_=!0}=w||{};if(d.map(async(F,M)=>{g[M].length&&F.sign(g[M]),C&&(F.message.recentBlockhash=C)}),we(d),console.log("SEND 6"),console.log("sizeCheckBuildV0"),(v=this.owner)!=null&&v.isKeyPair){console.log("send transactions using Helius Sender");for(let F of d){let M=await Po(F);console.log("Sent tx:",M)}return{txIds:[],signedTxs:[]}}if(this.signAllTransactions){let F=await this.signAllTransactions(d.slice(N,d.length)),M=[...d.slice(0,N),...F];if(b){let O=0,K=[],D=async()=>{if(!M[O])return;if(O<N){K.push({txId:"",status:"success",signedTx:M[O]}),k==null||k([...K]),O++,D();return}let L=await this.connection.sendTransaction(M[O],{skipPreflight:_});K.push({txId:L,status:"sent",signedTx:M[O]}),k==null||k([...K]),O++;let ge=!1,xe=null,Ve=null,Gt=be=>{xe!==null&&clearInterval(xe),Ve!==null&&this.connection.removeSignatureListener(Ve);let te=K.findIndex(Gn=>Gn.txId===L);if(te>-1){if(K[te].status==="error"||K[te].status==="success")return;K[te].status=be.err?"error":"success"}k==null||k([...K]),be.err||D()};this.loopMultiTxStatus&&(xe=setInterval(async()=>{var be;if(ge){clearInterval(xe);return}try{let te=await this.connection.getTransaction(L,{commitment:"confirmed",maxSupportedTransactionVersion:0});te&&(ge=!0,clearInterval(xe),Gt({err:((be=te.meta)==null?void 0:be.err)||null}),console.log("tx status from getTransaction:",L))}catch(te){ge=!0,clearInterval(xe),console.error("getTransaction timeout:",te,L)}},rt)),Ve=this.connection.onSignature(L,be=>{if(ge){this.connection.removeSignatureListener(Ve);return}ge=!0,Gt(be)},"confirmed"),this.connection.getSignatureStatus(L)};return D(),{txIds:[],signedTxs:M}}else{let O=[];for(let K=0;K<M.length;K+=1){let D=await this.connection.sendTransaction(M[K],{skipPreflight:_});O.push(D)}return{txIds:O,signedTxs:M}}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:s||{}}}};import Ao from"bn.js";var Ea=new Ao(1e6);import{AccountLayout as Be,createAssociatedTokenAccountIdempotentInstruction as Wt,TOKEN_PROGRAM_ID as he,TOKEN_2022_PROGRAM_ID as Go}from"@solana/spl-token";var Lt=(...e)=>e.map(t=>{try{return typeof t=="object"?JSON.stringify(t):t}catch{return t}}).join(", "),ve=class{constructor({scope:t,moduleName:n}){this.disabled=!1;this.scope=t,this.logger=z(n)}createTxBuilder(t){return this.scope.checkOwner(),new ot({connection:this.scope.connection,feePayer:t||this.scope.ownerPubKey,cluster:this.scope.cluster,owner:this.scope.owner,blockhashCommitment:this.scope.blockhashCommitment,loopMultiTxStatus:this.scope.loopMultiTxStatus,api:this.scope.api,signAllTransactions:this.scope.signAllTransactions})}logDebug(...t){this.logger.debug(Lt(t))}logInfo(...t){this.logger.info(Lt(t))}logAndCreateError(...t){let n=Lt(t);throw new Error(n)}checkDisabled(){(this.disabled||!this.scope)&&this.logAndCreateError("module not working")}};import{PublicKey as Oo,SystemProgram as Ko}from"@solana/web3.js";import Fo from"bn.js";import{createCloseAccountInstruction as Vo,createInitializeAccountInstruction as Uo,createTransferInstruction as Wo,TOKEN_PROGRAM_ID as Ce}from"@solana/spl-token";import{Keypair as _o,PublicKey as Un}from"@solana/web3.js";import Mo from"bn.js";import{TOKEN_PROGRAM_ID as Do}from"@solana/spl-token";function ko(e){return e instanceof Uint8Array||e!=null&&typeof e=="object"&&e.constructor.name==="Uint8Array"}function Nt(e,...t){if(!ko(e))throw new Error("Uint8Array expected");if(t.length>0&&!t.includes(e.length))throw new Error(`Uint8Array expected of length ${t}, not of length=${e.length}`)}function Et(e,t=!0){if(e.destroyed)throw new Error("Hash instance has been destroyed");if(t&&e.finished)throw new Error("Hash#digest() has already been called")}function Rn(e,t){Nt(e);let n=t.outputLen;if(e.length<n)throw new Error(`digestInto() expects output buffer of length at least ${n}`)}var st=e=>new DataView(e.buffer,e.byteOffset,e.byteLength),$=(e,t)=>e<<32-t|e>>>t;var ou=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;function So(e){if(typeof e!="string")throw new Error(`utf8ToBytes expected string, got ${typeof e}`);return new Uint8Array(new TextEncoder().encode(e))}function Rt(e){return typeof e=="string"&&(e=So(e)),Nt(e),e}var it=class{clone(){return this._cloneInto()}},iu={}.toString;function _n(e){let t=r=>e().update(Rt(r)).digest(),n=e();return t.outputLen=n.outputLen,t.blockLen=n.blockLen,t.create=()=>e(),t}function Co(e,t,n,r){if(typeof e.setBigUint64=="function")return e.setBigUint64(t,n,r);let o=BigInt(32),i=BigInt(4294967295),s=Number(n>>o&i),c=Number(n&i),u=r?4:0,a=r?0:4;e.setUint32(t+u,s,r),e.setUint32(t+a,c,r)}var Mn=(e,t,n)=>e&t^~e&n,Dn=(e,t,n)=>e&t^e&n^t&n,ct=class extends it{constructor(t,n,r,o){super(),this.blockLen=t,this.outputLen=n,this.padOffset=r,this.isLE=o,this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.buffer=new Uint8Array(t),this.view=st(this.buffer)}update(t){Et(this);let{view:n,buffer:r,blockLen:o}=this;t=Rt(t);let i=t.length;for(let s=0;s<i;){let c=Math.min(o-this.pos,i-s);if(c===o){let u=st(t);for(;o<=i-s;s+=o)this.process(u,s);continue}r.set(t.subarray(s,s+c),this.pos),this.pos+=c,s+=c,this.pos===o&&(this.process(n,0),this.pos=0)}return this.length+=t.length,this.roundClean(),this}digestInto(t){Et(this),Rn(t,this),this.finished=!0;let{buffer:n,view:r,blockLen:o,isLE:i}=this,{pos:s}=this;n[s++]=128,this.buffer.subarray(s).fill(0),this.padOffset>o-s&&(this.process(r,0),s=0);for(let f=s;f<o;f++)n[f]=0;Co(r,o-8,BigInt(this.length*8),i),this.process(r,0);let c=st(t),u=this.outputLen;if(u%4)throw new Error("_sha2: outputLen should be aligned to 32bit");let a=u/4,l=this.get();if(a>l.length)throw new Error("_sha2: outputLen bigger than state");for(let f=0;f<a;f++)c.setUint32(4*f,l[f],i)}digest(){let{buffer:t,outputLen:n}=this;this.digestInto(t);let r=t.slice(0,n);return this.destroy(),r}_cloneInto(t){t||(t=new this.constructor),t.set(...this.get());let{blockLen:n,buffer:r,length:o,finished:i,destroyed:s,pos:c}=this;return t.length=o,t.pos=c,t.finished=i,t.destroyed=s,o%n&&t.buffer.set(r),t}};var Bo=new Uint32Array([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),me=new Uint32Array([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),de=new Uint32Array(64),_t=class extends ct{constructor(){super(64,32,8,!1),this.A=me[0]|0,this.B=me[1]|0,this.C=me[2]|0,this.D=me[3]|0,this.E=me[4]|0,this.F=me[5]|0,this.G=me[6]|0,this.H=me[7]|0}get(){let{A:t,B:n,C:r,D:o,E:i,F:s,G:c,H:u}=this;return[t,n,r,o,i,s,c,u]}set(t,n,r,o,i,s,c,u){this.A=t|0,this.B=n|0,this.C=r|0,this.D=o|0,this.E=i|0,this.F=s|0,this.G=c|0,this.H=u|0}process(t,n){for(let f=0;f<16;f++,n+=4)de[f]=t.getUint32(n,!1);for(let f=16;f<64;f++){let p=de[f-15],m=de[f-2],d=$(p,7)^$(p,18)^p>>>3,g=$(m,17)^$(m,19)^m>>>10;de[f]=g+de[f-7]+d+de[f-16]|0}let{A:r,B:o,C:i,D:s,E:c,F:u,G:a,H:l}=this;for(let f=0;f<64;f++){let p=$(c,6)^$(c,11)^$(c,25),m=l+p+Mn(c,u,a)+Bo[f]+de[f]|0,g=($(r,2)^$(r,13)^$(r,22))+Dn(r,o,i)|0;l=a,a=u,u=c,c=s+m|0,s=i,i=o,o=r,r=m+g|0}r=r+this.A|0,o=o+this.B|0,i=i+this.C|0,s=s+this.D|0,c=c+this.E|0,u=u+this.F|0,a=a+this.G|0,l=l+this.H|0,this.set(r,o,i,s,c,u,a,l)}roundClean(){de.fill(0)}destroy(){this.set(0,0,0,0,0,0,0,0),this.buffer.fill(0)}};var vn=_n(()=>new _t);import{PublicKey as Ro}from"@solana/web3.js";import Kn,{isBN as ml}from"bn.js";import{bits as du,BitStructure as hu,blob as Io,Blob as gu,cstr as bu,f32 as yu,f32be as wu,f64 as Tu,f64be as xu,greedy as Pu,Layout as Lo,ns64 as Au,ns64be as ku,nu64 as Su,nu64be as Cu,offset as Bu,s16 as Iu,s16be as Lu,s24 as Nu,s24be as Eu,s32 as Ru,s32be as _u,s40 as Mu,s40be as Du,s48 as vu,s48be as Ou,s8 as Ku,seq as Fu,struct as Vu,Structure as No,u16 as Uu,u16be as Wu,u24 as qu,u24be as Gu,u32 as Hu,u32be as ju,u40 as zu,u40be as Zu,u48 as Ju,u48be as Qu,u8 as Xu,UInt as Eo,union as Yu,Union as $u,unionLayoutDiscriminator as el,utf8 as tl}from"@solana/buffer-layout";var Mt=Lo,On=No;var Dt=Eo;var vt=Io;var Ot=class extends Mt{constructor(n,r,o){super(n,o);this.blob=vt(n),this.signed=r}decode(n,r=0){let o=new Kn(this.blob.decode(n,r),10,"le");return this.signed?o.fromTwos(this.span*8).clone():o}encode(n,r,o=0){return typeof n=="number"&&(n=new Kn(n)),this.signed&&(n=n.toTwos(this.span*8)),this.blob.encode(n.toArrayLike(Buffer,"le",this.span),r,o)}};function Fn(e){return new Dt(1,e)}function at(e){return new Dt(4,e)}function ut(e){return new Ot(8,!1,e)}var Kt=class extends Mt{constructor(n,r,o,i){super(n.span,i);this.layout=n,this.decoder=r,this.encoder=o}decode(n,r){return this.decoder(this.layout.decode(n,r))}encode(n,r,o){return this.layout.encode(this.encoder(n),r,o)}getSpan(n,r){return this.layout.getSpan(n,r)}};function Oe(e){return new Kt(vt(32),t=>new Ro(t),t=>t.toBuffer(),e)}var Ft=class extends On{decode(t,n){return super.decode(t,n)}};function Vn(e,t,n){return new Ft(e,t,n)}var Ke=Vn([Oe("mint"),Oe("owner"),ut("amount"),at("delegateOption"),Oe("delegate"),Fn("state"),at("isNativeOption"),ut("isNative"),ut("delegatedAmount"),at("closeAuthorityOption"),Oe("closeAuthority")]);var Il=z("Raydium_Util");function Wn({owner:e,solAccountResp:t,tokenAccountResp:n}){let r=[],o=[];for(let{pubkey:i,account:s}of n.value){let c=Ke.decode(s.data),{mint:u,amount:a}=c;r.push({publicKey:i,mint:u,amount:a,isAssociated:et(e,u,s.owner).publicKey.equals(i),isNative:!1,programId:s.owner}),o.push({pubkey:i,accountInfo:c,programId:s.owner})}return t&&r.push({mint:Un.default,amount:new Mo(String(t.lamports)),isNative:!0,programId:t.owner}),{tokenAccounts:r,tokenAccountRawInfos:o}}function lt({fromPublicKey:e,programId:t=Do,assignSeed:n}){let r=n?btoa(n).slice(0,32):_o.generate().publicKey.toBase58().slice(0,32);return{publicKey:vo(e,r,t),seed:r}}function vo(e,t,n){let r=Buffer.concat([e.toBuffer(),Buffer.from(t),n.toBuffer()]),o=vn(r);return new Un(o)}function Vt(e){let{mint:t,tokenAccount:n,owner:r,programId:o=Ce}=e;return Uo(n,t,r,o)}function Fe(e){let{tokenAccount:t,payer:n,multiSigners:r=[],owner:o,programId:i=Ce}=e;return Vo(t,n,o,r,i)}async function Ut(e){let{connection:t,amount:n,commitment:r,payer:o,owner:i,skipCloseAccount:s}=e,c=await t.getMinimumBalanceForRentExemption(Ke.span,r),u=Y(n).add(new Fo(c)),a=lt({fromPublicKey:o,programId:Ce});return{addresses:{newAccount:a.publicKey},signers:[],instructions:[Ko.createAccountWithSeed({fromPubkey:o,basePubkey:o,seed:a.seed,newAccountPubkey:a.publicKey,lamports:u.toNumber(),space:Ke.span,programId:Ce}),Vt({mint:new Oo(re.address),tokenAccount:a.publicKey,owner:i,programId:Ce})],instructionTypes:[G.CreateAccount,G.InitAccount],endInstructionTypes:s?[]:[G.CloseAccount],endInstructions:s?[]:[Fe({tokenAccount:a.publicKey,payer:o,owner:i})]}}function qn({source:e,destination:t,owner:n,amount:r,multiSigners:o=[],tokenProgram:i=Ce}){return Wo(e,t,n,BigInt(String(r)),o,i)}var qt=class extends ve{constructor(n){super(n);this._tokenAccounts=[];this._tokenAccountRawInfos=[];this._accountListener=[];this._clientOwnedToken=!1;this._notSubscribeAccountChange=!1;this._accountFetchTime=0;let{tokenAccounts:r,tokenAccountRawInfos:o,notSubscribeAccountChange:i}=n;this._tokenAccounts=r||[],this._tokenAccountRawInfos=o||[],this._notSubscribeAccountChange=i!=null?i:!0,this._clientOwnedToken=!!(r||o)}get tokenAccounts(){return this._tokenAccounts}get tokenAccountRawInfos(){return this._tokenAccountRawInfos}set notSubscribeAccountChange(n){this._notSubscribeAccountChange=n}updateTokenAccount({tokenAccounts:n,tokenAccountRawInfos:r}){return n&&(this._tokenAccounts=n),r&&(this._tokenAccountRawInfos=r),this._accountChangeListenerId&&this.scope.connection.removeAccountChangeListener(this._accountChangeListenerId),this._accountChangeListenerId=void 0,this._clientOwnedToken=!0,this}addAccountChangeListener(n){return this._accountListener.push(n),this}removeAccountChangeListener(n){return this._accountListener=this._accountListener.filter(r=>r!==n),this}getAssociatedTokenAccount(n,r){return et(this.scope.ownerPubKey,n,r).publicKey}resetTokenAccounts(){this._clientOwnedToken||(this._tokenAccounts=[],this._tokenAccountRawInfos=[])}async fetchWalletTokenAccounts(n){if(this._clientOwnedToken||!(n!=null&&n.forceUpdate)&&this._tokenAccounts.length&&Date.now()-this._accountFetchTime<(this._notSubscribeAccountChange?1e3*5:1e3*60*3))return{tokenAccounts:this._tokenAccounts,tokenAccountRawInfos:this._tokenAccountRawInfos};this.scope.checkOwner();let o=q(q({},{}),n),[i,s,c]=await Promise.all([this.scope.connection.getAccountInfo(this.scope.ownerPubKey,o.commitment),this.scope.connection.getTokenAccountsByOwner(this.scope.ownerPubKey,{programId:he},o.commitment),this.scope.connection.getTokenAccountsByOwner(this.scope.ownerPubKey,{programId:Go},o.commitment)]),{tokenAccounts:u,tokenAccountRawInfos:a}=Wn({owner:this.scope.ownerPubKey,solAccountResp:i,tokenAccountResp:{context:s.context,value:[...s.value,...c.value]}});return this._tokenAccounts=u,this._tokenAccountRawInfos=a,this._accountFetchTime=Date.now(),this._notSubscribeAccountChange||(this._accountChangeListenerId&&this.scope.connection.removeAccountChangeListener(this._accountChangeListenerId),this._accountChangeListenerId=this.scope.connection.onAccountChange(this.scope.ownerPubKey,()=>{this.fetchWalletTokenAccounts({forceUpdate:!0}),this._accountListener.forEach(l=>l({tokenAccounts:this._tokenAccounts,tokenAccountRawInfos:this._tokenAccountRawInfos}))},{commitment:n==null?void 0:n.commitment})),{tokenAccounts:u,tokenAccountRawInfos:a}}clearAccountChangeCkb(){this._accountChangeListenerId!==void 0&&this.scope.connection.removeAccountChangeListener(this._accountChangeListenerId)}async getCreatedTokenAccount({mint:n,programId:r=he,associatedOnly:o=!0}){await this.fetchWalletTokenAccounts();let i=this._tokenAccounts.filter(({mint:c})=>c==null?void 0:c.equals(n)).sort((c,u)=>c.amount.lt(u.amount)?1:-1),s=this.getAssociatedTokenAccount(n,r);for(let c of i){let{publicKey:u}=c;if(u&&(!o||o&&s.equals(u)))return u}}async getOrCreateTokenAccount(n){var g,y,x,P;await this.fetchWalletTokenAccounts();let{mint:r,createInfo:o,associatedOnly:i,owner:s,notUseTokenAccount:c=!1,skipCloseAccount:u=!1,checkCreateATAOwner:a=!1,assignSeed:l}=n,f=new ft(n.tokenProgram||he),p=this.getAssociatedTokenAccount(r,new ft(f)),m=(c?[]:this.tokenAccountRawInfos).filter(T=>T.accountInfo.mint.equals(r)&&(!i||T.pubkey.equals(p))).sort((T,w)=>T.accountInfo.amount.lt(w.accountInfo.amount)?1:-1);if(o===void 0||m.length>0)return m.length>0?{account:m[0].pubkey}:{};let d={instructions:[],endInstructions:[],signers:[],instructionTypes:[],endInstructionTypes:[]};if(i){let T=Wt(s,p,s,r,f),w=this.tokenAccountRawInfos.find(b=>b.pubkey.equals(p));if(a){let b=await this.scope.connection.getAccountInfo(p);if(b===null)(g=d.instructions)==null||g.push(T),d.instructionTypes.push(G.CreateATA);else if(!(b.owner.equals(f)&&Be.decode(b.data).mint.equals(r)&&Be.decode(b.data).owner.equals(s)))throw Error(`create ata check error -> mint: ${r.toString()}, ata: ${p.toString()}`)}else w===void 0&&(d.instructions.push(T),d.instructionTypes.push(G.CreateATA));if(r.equals(se)&&o.amount){let b=await Ut({connection:this.scope.connection,owner:this.scope.ownerPubKey,payer:o.payer||this.scope.ownerPubKey,amount:(y=o.amount)!=null?y:0,skipCloseAccount:u});d.instructions.push(...b.instructions||[]),d.endInstructions.push(...b.endInstructions||[]),d.instructionTypes.push(...b.instructionTypes||[]),d.endInstructionTypes.push(...b.endInstructionTypes||[]),o.amount&&(d.instructions.push(qn({source:b.addresses.newAccount,destination:p,owner:this.scope.ownerPubKey,amount:o.amount,tokenProgram:he})),d.instructionTypes.push(G.TransferAmount))}return!u&&w===void 0&&(d.endInstructions.push(Fe({owner:s,payer:o.payer||s,tokenAccount:p,programId:f})),d.endInstructionTypes.push(G.CloseAccount)),{account:p,instructionParams:d}}else{let T=lt({fromPublicKey:s,programId:f,assignSeed:l}),w=await this.scope.connection.getMinimumBalanceForRentExemption(Be.span),b=qo.createAccountWithSeed({fromPubkey:s,basePubkey:s,seed:T.seed,newAccountPubkey:T.publicKey,lamports:w+Number((P=(x=o.amount)==null?void 0:x.toString())!=null?P:0),space:Be.span,programId:f});return d.instructions.push(b,Vt({mint:r,tokenAccount:T.publicKey,owner:this.scope.ownerPubKey,programId:f})),d.instructionTypes.push(G.CreateAccount),d.instructionTypes.push(G.InitAccount),u||(d.endInstructions.push(Fe({owner:s,payer:o.payer||s,tokenAccount:T.publicKey,programId:f})),d.endInstructionTypes.push(G.CloseAccount)),{account:T.publicKey,instructionParams:d}}}async checkOrCreateAta({mint:n,programId:r=he,autoUnwrapWSOLToSOL:o}){var u;await this.fetchWalletTokenAccounts();let i=(u=this.scope.account.tokenAccounts.find(({mint:a})=>(a==null?void 0:a.toBase58())===n.toBase58()))==null?void 0:u.publicKey,s=this.scope.ownerPubKey,c={};if(!i){let a=this.getAssociatedTokenAccount(n,r),l=await Wt(s,a,s,n,r);c.instructions=[l],c.instructionTypes=[G.CreateATA],i=a}return o&&se.toBase58()===n.toBase58()&&(c.endInstructions=[Fe({owner:s,payer:s,tokenAccount:i,programId:r})],c.endInstructionTypes=[G.CloseAccount]),{pubKey:i,newInstructions:c}}async handleTokenAccount(n){let{side:r,amount:o,mint:i,programId:s=he,tokenAccount:c,payer:u=this.scope.ownerPubKey,bypassAssociatedCheck:a,skipCloseAccount:l,checkCreateATAOwner:f}=n,p=this.getAssociatedTokenAccount(i,s);if(new ft(se).equals(i)){let m=await Ut({connection:this.scope.connection,owner:this.scope.ownerPubKey,payer:u,amount:o,skipCloseAccount:l});return q({tokenAccount:m.addresses.newAccount},m)}else if(!c||r==="out"&&!p.equals(c)&&!a){let m=[],d=Wt(this.scope.ownerPubKey,p,this.scope.ownerPubKey,i,s);if(f){let g=await this.scope.connection.getAccountInfo(p);if(g===null)m.push(d);else if(!(g.owner.equals(he)&&Be.decode(g.data).mint.equals(i)&&Be.decode(g.data).owner.equals(this.scope.ownerPubKey)))throw Error(`create ata check error -> mint: ${i.toString()}, ata: ${p.toString()}`)}else m.push(d);return{tokenAccount:p,instructions:m,instructionTypes:[G.CreateATA]}}return{tokenAccount:c}}async processTokenAccount(n){let{mint:r,programId:o=he,amount:i,useSOLBalance:s,handleTokenAccount:c,feePayer:u}=n,a,l=this.createTxBuilder(u);if(r.equals(new ft(se))&&s){let f=await this.handleTokenAccount({side:"in",amount:i||0,mint:r,bypassAssociatedCheck:!0,programId:o}),{tokenAccount:m}=f,d=ye(f,["tokenAccount"]);a=m,l.addInstruction(d)}else if(a=await this.getCreatedTokenAccount({mint:r,associatedOnly:!1,programId:o}),!a&&c){let p=await this.scope.account.handleTokenAccount({side:"in",amount:0,mint:r,bypassAssociatedCheck:!0,programId:o}),{tokenAccount:m}=p,d=ye(p,["tokenAccount"]);a=m,l.addInstruction(d)}return q({tokenAccount:a},l.AllTxData)}};export{qt as default};
/*! noble-hashes - MIT License (c) 2022 Paul Miller (paulmillr.com) */
//# sourceMappingURL=account.mjs.map