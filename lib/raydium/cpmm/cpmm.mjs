var nr=Object.defineProperty,ir=Object.defineProperties;var rr=Object.getOwnPropertyDescriptors;var At=Object.getOwnPropertySymbols;var _n=Object.prototype.hasOwnProperty,Vn=Object.prototype.propertyIsEnumerable;var Wn=(n,e,t)=>e in n?nr(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t,U=(n,e)=>{for(var t in e||(e={}))_n.call(e,t)&&Wn(n,t,e[t]);if(At)for(var t of At(e))Vn.call(e,t)&&Wn(n,t,e[t]);return n},Z=(n,e)=>ir(n,rr(e));var he=(n,e)=>{var t={};for(var i in n)_n.call(n,i)&&e.indexOf(i)<0&&(t[i]=n[i]);if(n!=null&&At)for(var i of At(n))e.indexOf(i)<0&&Vn.call(n,i)&&(t[i]=n[i]);return t};import{PublicKey as I}from"@solana/web3.js";import{AccountLayout as Bs,NATIVE_MINT as Jt,TOKEN_PROGRAM_ID as ge}from"@solana/spl-token";import ke from"bn.js";var ze=9e15,Ne=1e9,$t="0123456789abcdef",Tt="2.3025850929940456840179914546843642076011014886287729760333279009675726096773524802359972050895982983419677840422862486334095254650828067566662873690987816894829072083255546808437998948262331985283935053089653777326288461633662222876982198867465436674744042432743651550489343149393914796194044002221051017141748003688084012647080685567743216228355220114804663715659121373450747856947683463616792101806445070648000277502684916746550586856935673420670581136429224554405758925724208241314695689016758940256776311356919292033376587141660230105703089634572075440370847469940168269282808481184289314848524948644871927809676271275775397027668605952496716674183485704422507197965004714951050492214776567636938662976979522110718264549734772662425709429322582798502585509785265383207606726317164309505995087807523710333101197857547331541421808427543863591778117054309827482385045648019095610299291824318237525357709750539565187697510374970888692180205189339507238539205144634197265287286965110862571492198849978748873771345686209167058",ht="3.1415926535897932384626433832795028841971693993751058209749445923078164062862089986280348253421170679821480865132823066470938446095505822317253594081284811174502841027019385211055596446229489549303819644288109756659334461284756482337867831652712019091456485669234603486104543266482133936072602491412737245870066063155881748815209209628292540917153643678925903600113305305488204665213841469519415116094330572703657595919530921861173819326117931051185480744623799627495673518857527248912279381830119491298336733624406566430860213949463952247371907021798609437027705392171762931767523846748184676694051320005681271452635608277857713427577896091736371787214684409012249534301465495853710507922796892589235420199561121290219608640344181598136297747713099605187072113499999983729780499510597317328160963185950244594553469083026425223082533446850352619311881710100031378387528865875332083814206171776691473035982534904287554687311595628638823537875937519577818577805321712268066130019278766111959092164201989380952572010654858632789",en={precision:20,rounding:4,modulo:1,toExpNeg:-7,toExpPos:21,minE:-ze,maxE:ze,crypto:!1},Xn,Be,W=!0,xt="[DecimalError] ",Ke=xt+"Invalid argument: ",zn=xt+"Precision limit exceeded",Hn=xt+"crypto unavailable",Zn="[object Decimal]",re=Math.floor,ee=Math.pow,or=/^0b([01]+(\.[01]*)?|\.[01]+)(p[+-]?\d+)?$/i,sr=/^0x([0-9a-f]+(\.[0-9a-f]*)?|\.[0-9a-f]+)(p[+-]?\d+)?$/i,ar=/^0o([0-7]+(\.[0-7]*)?|\.[0-7]+)(p[+-]?\d+)?$/i,jn=/^(\d+(\.\d*)?|\.\d+)(e[+-]?\d+)?$/i,pe=1e7,F=7,ur=9007199254740991,cr=Tt.length-1,tn=ht.length-1,y={toStringTag:Zn};y.absoluteValue=y.abs=function(){var n=new this.constructor(this);return n.s<0&&(n.s=1),L(n)};y.ceil=function(){return L(new this.constructor(this),this.e+1,2)};y.clampedTo=y.clamp=function(n,e){var t,i=this,r=i.constructor;if(n=new r(n),e=new r(e),!n.s||!e.s)return new r(NaN);if(n.gt(e))throw Error(Ke+e);return t=i.cmp(n),t<0?n:i.cmp(e)>0?e:new r(i)};y.comparedTo=y.cmp=function(n){var e,t,i,r,o=this,s=o.d,a=(n=new o.constructor(n)).d,c=o.s,u=n.s;if(!s||!a)return!c||!u?NaN:c!==u?c:s===a?0:!s^c<0?1:-1;if(!s[0]||!a[0])return s[0]?c:a[0]?-u:0;if(c!==u)return c;if(o.e!==n.e)return o.e>n.e^c<0?1:-1;for(i=s.length,r=a.length,e=0,t=i<r?i:r;e<t;++e)if(s[e]!==a[e])return s[e]>a[e]^c<0?1:-1;return i===r?0:i>r^c<0?1:-1};y.cosine=y.cos=function(){var n,e,t=this,i=t.constructor;return t.d?t.d[0]?(n=i.precision,e=i.rounding,i.precision=n+Math.max(t.e,t.sd())+F,i.rounding=1,t=lr(i,ei(i,t)),i.precision=n,i.rounding=e,L(Be==2||Be==3?t.neg():t,n,e,!0)):new i(1):new i(NaN)};y.cubeRoot=y.cbrt=function(){var n,e,t,i,r,o,s,a,c,u,l=this,m=l.constructor;if(!l.isFinite()||l.isZero())return new m(l);for(W=!1,o=l.s*ee(l.s*l,1/3),!o||Math.abs(o)==1/0?(t=ie(l.d),n=l.e,(o=(n-t.length+1)%3)&&(t+=o==1||o==-2?"0":"00"),o=ee(t,1/3),n=re((n+1)/3)-(n%3==(n<0?-1:2)),o==1/0?t="5e"+n:(t=o.toExponential(),t=t.slice(0,t.indexOf("e")+1)+n),i=new m(t),i.s=l.s):i=new m(o.toString()),s=(n=m.precision)+3;;)if(a=i,c=a.times(a).times(a),u=c.plus(l),i=X(u.plus(l).times(a),u.plus(c),s+2,1),ie(a.d).slice(0,s)===(t=ie(i.d)).slice(0,s))if(t=t.slice(s-3,s+1),t=="9999"||!r&&t=="4999"){if(!r&&(L(a,n+1,0),a.times(a).times(a).eq(l))){i=a;break}s+=4,r=1}else{(!+t||!+t.slice(1)&&t.charAt(0)=="5")&&(L(i,n+1,1),e=!i.times(i).times(i).eq(l));break}return W=!0,L(i,n,m.rounding,e)};y.decimalPlaces=y.dp=function(){var n,e=this.d,t=NaN;if(e){if(n=e.length-1,t=(n-re(this.e/F))*F,n=e[n],n)for(;n%10==0;n/=10)t--;t<0&&(t=0)}return t};y.dividedBy=y.div=function(n){return X(this,new this.constructor(n))};y.dividedToIntegerBy=y.divToInt=function(n){var e=this,t=e.constructor;return L(X(e,new t(n),0,1,1),t.precision,t.rounding)};y.equals=y.eq=function(n){return this.cmp(n)===0};y.floor=function(){return L(new this.constructor(this),this.e+1,3)};y.greaterThan=y.gt=function(n){return this.cmp(n)>0};y.greaterThanOrEqualTo=y.gte=function(n){var e=this.cmp(n);return e==1||e===0};y.hyperbolicCosine=y.cosh=function(){var n,e,t,i,r,o=this,s=o.constructor,a=new s(1);if(!o.isFinite())return new s(o.s?1/0:NaN);if(o.isZero())return a;t=s.precision,i=s.rounding,s.precision=t+Math.max(o.e,o.sd())+4,s.rounding=1,r=o.d.length,r<32?(n=Math.ceil(r/3),e=(1/St(4,n)).toString()):(n=16,e="2.3283064365386962890625e-10"),o=He(s,1,o.times(e),new s(1),!0);for(var c,u=n,l=new s(8);u--;)c=o.times(o),o=a.minus(c.times(l.minus(c.times(l))));return L(o,s.precision=t,s.rounding=i,!0)};y.hyperbolicSine=y.sinh=function(){var n,e,t,i,r=this,o=r.constructor;if(!r.isFinite()||r.isZero())return new o(r);if(e=o.precision,t=o.rounding,o.precision=e+Math.max(r.e,r.sd())+4,o.rounding=1,i=r.d.length,i<3)r=He(o,2,r,r,!0);else{n=1.4*Math.sqrt(i),n=n>16?16:n|0,r=r.times(1/St(5,n)),r=He(o,2,r,r,!0);for(var s,a=new o(5),c=new o(16),u=new o(20);n--;)s=r.times(r),r=r.times(a.plus(s.times(c.times(s).plus(u))))}return o.precision=e,o.rounding=t,L(r,e,t,!0)};y.hyperbolicTangent=y.tanh=function(){var n,e,t=this,i=t.constructor;return t.isFinite()?t.isZero()?new i(t):(n=i.precision,e=i.rounding,i.precision=n+7,i.rounding=1,X(t.sinh(),t.cosh(),i.precision=n,i.rounding=e)):new i(t.s)};y.inverseCosine=y.acos=function(){var n,e=this,t=e.constructor,i=e.abs().cmp(1),r=t.precision,o=t.rounding;return i!==-1?i===0?e.isNeg()?de(t,r,o):new t(0):new t(NaN):e.isZero()?de(t,r+4,o).times(.5):(t.precision=r+6,t.rounding=1,e=e.asin(),n=de(t,r+4,o).times(.5),t.precision=r,t.rounding=o,n.minus(e))};y.inverseHyperbolicCosine=y.acosh=function(){var n,e,t=this,i=t.constructor;return t.lte(1)?new i(t.eq(1)?0:NaN):t.isFinite()?(n=i.precision,e=i.rounding,i.precision=n+Math.max(Math.abs(t.e),t.sd())+4,i.rounding=1,W=!1,t=t.times(t).minus(1).sqrt().plus(t),W=!0,i.precision=n,i.rounding=e,t.ln()):new i(t)};y.inverseHyperbolicSine=y.asinh=function(){var n,e,t=this,i=t.constructor;return!t.isFinite()||t.isZero()?new i(t):(n=i.precision,e=i.rounding,i.precision=n+2*Math.max(Math.abs(t.e),t.sd())+6,i.rounding=1,W=!1,t=t.times(t).plus(1).sqrt().plus(t),W=!0,i.precision=n,i.rounding=e,t.ln())};y.inverseHyperbolicTangent=y.atanh=function(){var n,e,t,i,r=this,o=r.constructor;return r.isFinite()?r.e>=0?new o(r.abs().eq(1)?r.s/0:r.isZero()?r:NaN):(n=o.precision,e=o.rounding,i=r.sd(),Math.max(i,n)<2*-r.e-1?L(new o(r),n,e,!0):(o.precision=t=i-r.e,r=X(r.plus(1),new o(1).minus(r),t+n,1),o.precision=n+4,o.rounding=1,r=r.ln(),o.precision=n,o.rounding=e,r.times(.5))):new o(NaN)};y.inverseSine=y.asin=function(){var n,e,t,i,r=this,o=r.constructor;return r.isZero()?new o(r):(e=r.abs().cmp(1),t=o.precision,i=o.rounding,e!==-1?e===0?(n=de(o,t+4,i).times(.5),n.s=r.s,n):new o(NaN):(o.precision=t+6,o.rounding=1,r=r.div(new o(1).minus(r.times(r)).sqrt().plus(1)).atan(),o.precision=t,o.rounding=i,r.times(2)))};y.inverseTangent=y.atan=function(){var n,e,t,i,r,o,s,a,c,u=this,l=u.constructor,m=l.precision,d=l.rounding;if(u.isFinite()){if(u.isZero())return new l(u);if(u.abs().eq(1)&&m+4<=tn)return s=de(l,m+4,d).times(.25),s.s=u.s,s}else{if(!u.s)return new l(NaN);if(m+4<=tn)return s=de(l,m+4,d).times(.5),s.s=u.s,s}for(l.precision=a=m+10,l.rounding=1,t=Math.min(28,a/F+2|0),n=t;n;--n)u=u.div(u.times(u).plus(1).sqrt().plus(1));for(W=!1,e=Math.ceil(a/F),i=1,c=u.times(u),s=new l(u),r=u;n!==-1;)if(r=r.times(c),o=s.minus(r.div(i+=2)),r=r.times(c),s=o.plus(r.div(i+=2)),s.d[e]!==void 0)for(n=e;s.d[n]===o.d[n]&&n--;);return t&&(s=s.times(2<<t-1)),W=!0,L(s,l.precision=m,l.rounding=d,!0)};y.isFinite=function(){return!!this.d};y.isInteger=y.isInt=function(){return!!this.d&&re(this.e/F)>this.d.length-2};y.isNaN=function(){return!this.s};y.isNegative=y.isNeg=function(){return this.s<0};y.isPositive=y.isPos=function(){return this.s>0};y.isZero=function(){return!!this.d&&this.d[0]===0};y.lessThan=y.lt=function(n){return this.cmp(n)<0};y.lessThanOrEqualTo=y.lte=function(n){return this.cmp(n)<1};y.logarithm=y.log=function(n){var e,t,i,r,o,s,a,c,u=this,l=u.constructor,m=l.precision,d=l.rounding,p=5;if(n==null)n=new l(10),e=!0;else{if(n=new l(n),t=n.d,n.s<0||!t||!t[0]||n.eq(1))return new l(NaN);e=n.eq(10)}if(t=u.d,u.s<0||!t||!t[0]||u.eq(1))return new l(t&&!t[0]?-1/0:u.s!=1?NaN:t?0:1/0);if(e)if(t.length>1)o=!0;else{for(r=t[0];r%10===0;)r/=10;o=r!==1}if(W=!1,a=m+p,s=Ce(u,a),i=e?Bt(l,a+10):Ce(n,a),c=X(s,i,a,1),nt(c.d,r=m,d))do if(a+=10,s=Ce(u,a),i=e?Bt(l,a+10):Ce(n,a),c=X(s,i,a,1),!o){+ie(c.d).slice(r+1,r+15)+1==1e14&&(c=L(c,m+1,0));break}while(nt(c.d,r+=10,d));return W=!0,L(c,m,d)};y.minus=y.sub=function(n){var e,t,i,r,o,s,a,c,u,l,m,d,p=this,b=p.constructor;if(n=new b(n),!p.d||!n.d)return!p.s||!n.s?n=new b(NaN):p.d?n.s=-n.s:n=new b(n.d||p.s!==n.s?p:NaN),n;if(p.s!=n.s)return n.s=-n.s,p.plus(n);if(u=p.d,d=n.d,a=b.precision,c=b.rounding,!u[0]||!d[0]){if(d[0])n.s=-n.s;else if(u[0])n=new b(p);else return new b(c===3?-0:0);return W?L(n,a,c):n}if(t=re(n.e/F),l=re(p.e/F),u=u.slice(),o=l-t,o){for(m=o<0,m?(e=u,o=-o,s=d.length):(e=d,t=l,s=u.length),i=Math.max(Math.ceil(a/F),s)+2,o>i&&(o=i,e.length=1),e.reverse(),i=o;i--;)e.push(0);e.reverse()}else{for(i=u.length,s=d.length,m=i<s,m&&(s=i),i=0;i<s;i++)if(u[i]!=d[i]){m=u[i]<d[i];break}o=0}for(m&&(e=u,u=d,d=e,n.s=-n.s),s=u.length,i=d.length-s;i>0;--i)u[s++]=0;for(i=d.length;i>o;){if(u[--i]<d[i]){for(r=i;r&&u[--r]===0;)u[r]=pe-1;--u[r],u[i]+=pe}u[i]-=d[i]}for(;u[--s]===0;)u.pop();for(;u[0]===0;u.shift())--t;return u[0]?(n.d=u,n.e=It(u,t),W?L(n,a,c):n):new b(c===3?-0:0)};y.modulo=y.mod=function(n){var e,t=this,i=t.constructor;return n=new i(n),!t.d||!n.s||n.d&&!n.d[0]?new i(NaN):!n.d||t.d&&!t.d[0]?L(new i(t),i.precision,i.rounding):(W=!1,i.modulo==9?(e=X(t,n.abs(),0,3,1),e.s*=n.s):e=X(t,n,0,i.modulo,1),e=e.times(n),W=!0,t.minus(e))};y.naturalExponential=y.exp=function(){return nn(this)};y.naturalLogarithm=y.ln=function(){return Ce(this)};y.negated=y.neg=function(){var n=new this.constructor(this);return n.s=-n.s,L(n)};y.plus=y.add=function(n){var e,t,i,r,o,s,a,c,u,l,m=this,d=m.constructor;if(n=new d(n),!m.d||!n.d)return!m.s||!n.s?n=new d(NaN):m.d||(n=new d(n.d||m.s===n.s?m:NaN)),n;if(m.s!=n.s)return n.s=-n.s,m.minus(n);if(u=m.d,l=n.d,a=d.precision,c=d.rounding,!u[0]||!l[0])return l[0]||(n=new d(m)),W?L(n,a,c):n;if(o=re(m.e/F),i=re(n.e/F),u=u.slice(),r=o-i,r){for(r<0?(t=u,r=-r,s=l.length):(t=l,i=o,s=u.length),o=Math.ceil(a/F),s=o>s?o+1:s+1,r>s&&(r=s,t.length=1),t.reverse();r--;)t.push(0);t.reverse()}for(s=u.length,r=l.length,s-r<0&&(r=s,t=l,l=u,u=t),e=0;r;)e=(u[--r]=u[r]+l[r]+e)/pe|0,u[r]%=pe;for(e&&(u.unshift(e),++i),s=u.length;u[--s]==0;)u.pop();return n.d=u,n.e=It(u,i),W?L(n,a,c):n};y.precision=y.sd=function(n){var e,t=this;if(n!==void 0&&n!==!!n&&n!==1&&n!==0)throw Error(Ke+n);return t.d?(e=Qn(t.d),n&&t.e+1>e&&(e=t.e+1)):e=NaN,e};y.round=function(){var n=this,e=n.constructor;return L(new e(n),n.e+1,e.rounding)};y.sine=y.sin=function(){var n,e,t=this,i=t.constructor;return t.isFinite()?t.isZero()?new i(t):(n=i.precision,e=i.rounding,i.precision=n+Math.max(t.e,t.sd())+F,i.rounding=1,t=dr(i,ei(i,t)),i.precision=n,i.rounding=e,L(Be>2?t.neg():t,n,e,!0)):new i(NaN)};y.squareRoot=y.sqrt=function(){var n,e,t,i,r,o,s=this,a=s.d,c=s.e,u=s.s,l=s.constructor;if(u!==1||!a||!a[0])return new l(!u||u<0&&(!a||a[0])?NaN:a?s:1/0);for(W=!1,u=Math.sqrt(+s),u==0||u==1/0?(e=ie(a),(e.length+c)%2==0&&(e+="0"),u=Math.sqrt(e),c=re((c+1)/2)-(c<0||c%2),u==1/0?e="5e"+c:(e=u.toExponential(),e=e.slice(0,e.indexOf("e")+1)+c),i=new l(e)):i=new l(u.toString()),t=(c=l.precision)+3;;)if(o=i,i=o.plus(X(s,o,t+2,1)).times(.5),ie(o.d).slice(0,t)===(e=ie(i.d)).slice(0,t))if(e=e.slice(t-3,t+1),e=="9999"||!r&&e=="4999"){if(!r&&(L(o,c+1,0),o.times(o).eq(s))){i=o;break}t+=4,r=1}else{(!+e||!+e.slice(1)&&e.charAt(0)=="5")&&(L(i,c+1,1),n=!i.times(i).eq(s));break}return W=!0,L(i,c,l.rounding,n)};y.tangent=y.tan=function(){var n,e,t=this,i=t.constructor;return t.isFinite()?t.isZero()?new i(t):(n=i.precision,e=i.rounding,i.precision=n+10,i.rounding=1,t=t.sin(),t.s=1,t=X(t,new i(1).minus(t.times(t)).sqrt(),n+10,0),i.precision=n,i.rounding=e,L(Be==2||Be==4?t.neg():t,n,e,!0)):new i(NaN)};y.times=y.mul=function(n){var e,t,i,r,o,s,a,c,u,l=this,m=l.constructor,d=l.d,p=(n=new m(n)).d;if(n.s*=l.s,!d||!d[0]||!p||!p[0])return new m(!n.s||d&&!d[0]&&!p||p&&!p[0]&&!d?NaN:!d||!p?n.s/0:n.s*0);for(t=re(l.e/F)+re(n.e/F),c=d.length,u=p.length,c<u&&(o=d,d=p,p=o,s=c,c=u,u=s),o=[],s=c+u,i=s;i--;)o.push(0);for(i=u;--i>=0;){for(e=0,r=c+i;r>i;)a=o[r]+p[i]*d[r-i-1]+e,o[r--]=a%pe|0,e=a/pe|0;o[r]=(o[r]+e)%pe|0}for(;!o[--s];)o.pop();return e?++t:o.shift(),n.d=o,n.e=It(o,t),W?L(n,m.precision,m.rounding):n};y.toBinary=function(n,e){return on(this,2,n,e)};y.toDecimalPlaces=y.toDP=function(n,e){var t=this,i=t.constructor;return t=new i(t),n===void 0?t:(ae(n,0,Ne),e===void 0?e=i.rounding:ae(e,0,8),L(t,n+t.e+1,e))};y.toExponential=function(n,e){var t,i=this,r=i.constructor;return n===void 0?t=ye(i,!0):(ae(n,0,Ne),e===void 0?e=r.rounding:ae(e,0,8),i=L(new r(i),n+1,e),t=ye(i,!0,n+1)),i.isNeg()&&!i.isZero()?"-"+t:t};y.toFixed=function(n,e){var t,i,r=this,o=r.constructor;return n===void 0?t=ye(r):(ae(n,0,Ne),e===void 0?e=o.rounding:ae(e,0,8),i=L(new o(r),n+r.e+1,e),t=ye(i,!1,n+i.e+1)),r.isNeg()&&!r.isZero()?"-"+t:t};y.toFraction=function(n){var e,t,i,r,o,s,a,c,u,l,m,d,p=this,b=p.d,f=p.constructor;if(!b)return new f(p);if(u=t=new f(1),i=c=new f(0),e=new f(i),o=e.e=Qn(b)-p.e-1,s=o%F,e.d[0]=ee(10,s<0?F+s:s),n==null)n=o>0?e:u;else{if(a=new f(n),!a.isInt()||a.lt(u))throw Error(Ke+a);n=a.gt(e)?o>0?e:u:a}for(W=!1,a=new f(ie(b)),l=f.precision,f.precision=o=b.length*F*2;m=X(a,e,0,1,1),r=t.plus(m.times(i)),r.cmp(n)!=1;)t=i,i=r,r=u,u=c.plus(m.times(r)),c=r,r=e,e=a.minus(m.times(r)),a=r;return r=X(n.minus(t),i,0,1,1),c=c.plus(r.times(u)),t=t.plus(r.times(i)),c.s=u.s=p.s,d=X(u,i,o,1).minus(p).abs().cmp(X(c,t,o,1).minus(p).abs())<1?[u,i]:[c,t],f.precision=l,W=!0,d};y.toHexadecimal=y.toHex=function(n,e){return on(this,16,n,e)};y.toNearest=function(n,e){var t=this,i=t.constructor;if(t=new i(t),n==null){if(!t.d)return t;n=new i(1),e=i.rounding}else{if(n=new i(n),e===void 0?e=i.rounding:ae(e,0,8),!t.d)return n.s?t:n;if(!n.d)return n.s&&(n.s=t.s),n}return n.d[0]?(W=!1,t=X(t,n,0,e,1).times(n),W=!0,L(t)):(n.s=t.s,t=n),t};y.toNumber=function(){return+this};y.toOctal=function(n,e){return on(this,8,n,e)};y.toPower=y.pow=function(n){var e,t,i,r,o,s,a=this,c=a.constructor,u=+(n=new c(n));if(!a.d||!n.d||!a.d[0]||!n.d[0])return new c(ee(+a,u));if(a=new c(a),a.eq(1))return a;if(i=c.precision,o=c.rounding,n.eq(1))return L(a,i,o);if(e=re(n.e/F),e>=n.d.length-1&&(t=u<0?-u:u)<=ur)return r=Yn(c,a,t,i),n.s<0?new c(1).div(r):L(r,i,o);if(s=a.s,s<0){if(e<n.d.length-1)return new c(NaN);if((n.d[e]&1)==0&&(s=1),a.e==0&&a.d[0]==1&&a.d.length==1)return a.s=s,a}return t=ee(+a,u),e=t==0||!isFinite(t)?re(u*(Math.log("0."+ie(a.d))/Math.LN10+a.e+1)):new c(t+"").e,e>c.maxE+1||e<c.minE-1?new c(e>0?s/0:0):(W=!1,c.rounding=a.s=1,t=Math.min(12,(e+"").length),r=nn(n.times(Ce(a,i+t)),i),r.d&&(r=L(r,i+5,1),nt(r.d,i,o)&&(e=i+10,r=L(nn(n.times(Ce(a,e+t)),e),e+5,1),+ie(r.d).slice(i+1,i+15)+1==1e14&&(r=L(r,i+1,0)))),r.s=s,W=!0,c.rounding=o,L(r,i,o))};y.toPrecision=function(n,e){var t,i=this,r=i.constructor;return n===void 0?t=ye(i,i.e<=r.toExpNeg||i.e>=r.toExpPos):(ae(n,1,Ne),e===void 0?e=r.rounding:ae(e,0,8),i=L(new r(i),n,e),t=ye(i,n<=i.e||i.e<=r.toExpNeg,n)),i.isNeg()&&!i.isZero()?"-"+t:t};y.toSignificantDigits=y.toSD=function(n,e){var t=this,i=t.constructor;return n===void 0?(n=i.precision,e=i.rounding):(ae(n,1,Ne),e===void 0?e=i.rounding:ae(e,0,8)),L(new i(t),n,e)};y.toString=function(){var n=this,e=n.constructor,t=ye(n,n.e<=e.toExpNeg||n.e>=e.toExpPos);return n.isNeg()&&!n.isZero()?"-"+t:t};y.truncated=y.trunc=function(){return L(new this.constructor(this),this.e+1,1)};y.valueOf=y.toJSON=function(){var n=this,e=n.constructor,t=ye(n,n.e<=e.toExpNeg||n.e>=e.toExpPos);return n.isNeg()?"-"+t:t};function ie(n){var e,t,i,r=n.length-1,o="",s=n[0];if(r>0){for(o+=s,e=1;e<r;e++)i=n[e]+"",t=F-i.length,t&&(o+=Se(t)),o+=i;s=n[e],i=s+"",t=F-i.length,t&&(o+=Se(t))}else if(s===0)return"0";for(;s%10===0;)s/=10;return o+s}function ae(n,e,t){if(n!==~~n||n<e||n>t)throw Error(Ke+n)}function nt(n,e,t,i){var r,o,s,a;for(o=n[0];o>=10;o/=10)--e;return--e<0?(e+=F,r=0):(r=Math.ceil((e+1)/F),e%=F),o=ee(10,F-e),a=n[r]%o|0,i==null?e<3?(e==0?a=a/100|0:e==1&&(a=a/10|0),s=t<4&&a==99999||t>3&&a==49999||a==5e4||a==0):s=(t<4&&a+1==o||t>3&&a+1==o/2)&&(n[r+1]/o/100|0)==ee(10,e-2)-1||(a==o/2||a==0)&&(n[r+1]/o/100|0)==0:e<4?(e==0?a=a/1e3|0:e==1?a=a/100|0:e==2&&(a=a/10|0),s=(i||t<4)&&a==9999||!i&&t>3&&a==4999):s=((i||t<4)&&a+1==o||!i&&t>3&&a+1==o/2)&&(n[r+1]/o/1e3|0)==ee(10,e-3)-1,s}function kt(n,e,t){for(var i,r=[0],o,s=0,a=n.length;s<a;){for(o=r.length;o--;)r[o]*=e;for(r[0]+=$t.indexOf(n.charAt(s++)),i=0;i<r.length;i++)r[i]>t-1&&(r[i+1]===void 0&&(r[i+1]=0),r[i+1]+=r[i]/t|0,r[i]%=t)}return r.reverse()}function lr(n,e){var t,i,r;if(e.isZero())return e;i=e.d.length,i<32?(t=Math.ceil(i/3),r=(1/St(4,t)).toString()):(t=16,r="2.3283064365386962890625e-10"),n.precision+=t,e=He(n,1,e.times(r),new n(1));for(var o=t;o--;){var s=e.times(e);e=s.times(s).minus(s).times(8).plus(1)}return n.precision-=t,e}var X=function(){function n(i,r,o){var s,a=0,c=i.length;for(i=i.slice();c--;)s=i[c]*r+a,i[c]=s%o|0,a=s/o|0;return a&&i.unshift(a),i}function e(i,r,o,s){var a,c;if(o!=s)c=o>s?1:-1;else for(a=c=0;a<o;a++)if(i[a]!=r[a]){c=i[a]>r[a]?1:-1;break}return c}function t(i,r,o,s){for(var a=0;o--;)i[o]-=a,a=i[o]<r[o]?1:0,i[o]=a*s+i[o]-r[o];for(;!i[0]&&i.length>1;)i.shift()}return function(i,r,o,s,a,c){var u,l,m,d,p,b,f,g,A,w,k,P,T,h,x,B,M,C,D,E,v=i.constructor,q=i.s==r.s?1:-1,O=i.d,R=r.d;if(!O||!O[0]||!R||!R[0])return new v(!i.s||!r.s||(O?R&&O[0]==R[0]:!R)?NaN:O&&O[0]==0||!R?q*0:q/0);for(c?(p=1,l=i.e-r.e):(c=pe,p=F,l=re(i.e/p)-re(r.e/p)),D=R.length,M=O.length,A=new v(q),w=A.d=[],m=0;R[m]==(O[m]||0);m++);if(R[m]>(O[m]||0)&&l--,o==null?(h=o=v.precision,s=v.rounding):a?h=o+(i.e-r.e)+1:h=o,h<0)w.push(1),b=!0;else{if(h=h/p+2|0,m=0,D==1){for(d=0,R=R[0],h++;(m<M||d)&&h--;m++)x=d*c+(O[m]||0),w[m]=x/R|0,d=x%R|0;b=d||m<M}else{for(d=c/(R[0]+1)|0,d>1&&(R=n(R,d,c),O=n(O,d,c),D=R.length,M=O.length),B=D,k=O.slice(0,D),P=k.length;P<D;)k[P++]=0;E=R.slice(),E.unshift(0),C=R[0],R[1]>=c/2&&++C;do d=0,u=e(R,k,D,P),u<0?(T=k[0],D!=P&&(T=T*c+(k[1]||0)),d=T/C|0,d>1?(d>=c&&(d=c-1),f=n(R,d,c),g=f.length,P=k.length,u=e(f,k,g,P),u==1&&(d--,t(f,D<g?E:R,g,c))):(d==0&&(u=d=1),f=R.slice()),g=f.length,g<P&&f.unshift(0),t(k,f,P,c),u==-1&&(P=k.length,u=e(R,k,D,P),u<1&&(d++,t(k,D<P?E:R,P,c))),P=k.length):u===0&&(d++,k=[0]),w[m++]=d,u&&k[0]?k[P++]=O[B]||0:(k=[O[B]],P=1);while((B++<M||k[0]!==void 0)&&h--);b=k[0]!==void 0}w[0]||w.shift()}if(p==1)A.e=l,Xn=b;else{for(m=1,d=w[0];d>=10;d/=10)m++;A.e=m+l*p-1,L(A,a?o+A.e+1:o,s,b)}return A}}();function L(n,e,t,i){var r,o,s,a,c,u,l,m,d,p=n.constructor;e:if(e!=null){if(m=n.d,!m)return n;for(r=1,a=m[0];a>=10;a/=10)r++;if(o=e-r,o<0)o+=F,s=e,l=m[d=0],c=l/ee(10,r-s-1)%10|0;else if(d=Math.ceil((o+1)/F),a=m.length,d>=a)if(i){for(;a++<=d;)m.push(0);l=c=0,r=1,o%=F,s=o-F+1}else break e;else{for(l=a=m[d],r=1;a>=10;a/=10)r++;o%=F,s=o-F+r,c=s<0?0:l/ee(10,r-s-1)%10|0}if(i=i||e<0||m[d+1]!==void 0||(s<0?l:l%ee(10,r-s-1)),u=t<4?(c||i)&&(t==0||t==(n.s<0?3:2)):c>5||c==5&&(t==4||i||t==6&&(o>0?s>0?l/ee(10,r-s):0:m[d-1])%10&1||t==(n.s<0?8:7)),e<1||!m[0])return m.length=0,u?(e-=n.e+1,m[0]=ee(10,(F-e%F)%F),n.e=-e||0):m[0]=n.e=0,n;if(o==0?(m.length=d,a=1,d--):(m.length=d+1,a=ee(10,F-o),m[d]=s>0?(l/ee(10,r-s)%ee(10,s)|0)*a:0),u)for(;;)if(d==0){for(o=1,s=m[0];s>=10;s/=10)o++;for(s=m[0]+=a,a=1;s>=10;s/=10)a++;o!=a&&(n.e++,m[0]==pe&&(m[0]=1));break}else{if(m[d]+=a,m[d]!=pe)break;m[d--]=0,a=1}for(o=m.length;m[--o]===0;)m.pop()}return W&&(n.e>p.maxE?(n.d=null,n.e=NaN):n.e<p.minE&&(n.e=0,n.d=[0])),n}function ye(n,e,t){if(!n.isFinite())return $n(n);var i,r=n.e,o=ie(n.d),s=o.length;return e?(t&&(i=t-s)>0?o=o.charAt(0)+"."+o.slice(1)+Se(i):s>1&&(o=o.charAt(0)+"."+o.slice(1)),o=o+(n.e<0?"e":"e+")+n.e):r<0?(o="0."+Se(-r-1)+o,t&&(i=t-s)>0&&(o+=Se(i))):r>=s?(o+=Se(r+1-s),t&&(i=t-r-1)>0&&(o=o+"."+Se(i))):((i=r+1)<s&&(o=o.slice(0,i)+"."+o.slice(i)),t&&(i=t-s)>0&&(r+1===s&&(o+="."),o+=Se(i))),o}function It(n,e){var t=n[0];for(e*=F;t>=10;t/=10)e++;return e}function Bt(n,e,t){if(e>cr)throw W=!0,t&&(n.precision=t),Error(zn);return L(new n(Tt),e,1,!0)}function de(n,e,t){if(e>tn)throw Error(zn);return L(new n(ht),e,t,!0)}function Qn(n){var e=n.length-1,t=e*F+1;if(e=n[e],e){for(;e%10==0;e/=10)t--;for(e=n[0];e>=10;e/=10)t++}return t}function Se(n){for(var e="";n--;)e+="0";return e}function Yn(n,e,t,i){var r,o=new n(1),s=Math.ceil(i/F+4);for(W=!1;;){if(t%2&&(o=o.times(e),Un(o.d,s)&&(r=!0)),t=re(t/2),t===0){t=o.d.length-1,r&&o.d[t]===0&&++o.d[t];break}e=e.times(e),Un(e.d,s)}return W=!0,o}function qn(n){return n.d[n.d.length-1]&1}function Jn(n,e,t){for(var i,r=new n(e[0]),o=0;++o<e.length;)if(i=new n(e[o]),i.s)r[t](i)&&(r=i);else{r=i;break}return r}function nn(n,e){var t,i,r,o,s,a,c,u=0,l=0,m=0,d=n.constructor,p=d.rounding,b=d.precision;if(!n.d||!n.d[0]||n.e>17)return new d(n.d?n.d[0]?n.s<0?0:1/0:1:n.s?n.s<0?0:n:0/0);for(e==null?(W=!1,c=b):c=e,a=new d(.03125);n.e>-2;)n=n.times(a),m+=5;for(i=Math.log(ee(2,m))/Math.LN10*2+5|0,c+=i,t=o=s=new d(1),d.precision=c;;){if(o=L(o.times(n),c,1),t=t.times(++l),a=s.plus(X(o,t,c,1)),ie(a.d).slice(0,c)===ie(s.d).slice(0,c)){for(r=m;r--;)s=L(s.times(s),c,1);if(e==null)if(u<3&&nt(s.d,c-i,p,u))d.precision=c+=10,t=o=a=new d(1),l=0,u++;else return L(s,d.precision=b,p,W=!0);else return d.precision=b,s}s=a}}function Ce(n,e){var t,i,r,o,s,a,c,u,l,m,d,p=1,b=10,f=n,g=f.d,A=f.constructor,w=A.rounding,k=A.precision;if(f.s<0||!g||!g[0]||!f.e&&g[0]==1&&g.length==1)return new A(g&&!g[0]?-1/0:f.s!=1?NaN:g?0:f);if(e==null?(W=!1,l=k):l=e,A.precision=l+=b,t=ie(g),i=t.charAt(0),Math.abs(o=f.e)<15e14){for(;i<7&&i!=1||i==1&&t.charAt(1)>3;)f=f.times(n),t=ie(f.d),i=t.charAt(0),p++;o=f.e,i>1?(f=new A("0."+t),o++):f=new A(i+"."+t.slice(1))}else return u=Bt(A,l+2,k).times(o+""),f=Ce(new A(i+"."+t.slice(1)),l-b).plus(u),A.precision=k,e==null?L(f,k,w,W=!0):f;for(m=f,c=s=f=X(f.minus(1),f.plus(1),l,1),d=L(f.times(f),l,1),r=3;;){if(s=L(s.times(d),l,1),u=c.plus(X(s,new A(r),l,1)),ie(u.d).slice(0,l)===ie(c.d).slice(0,l))if(c=c.times(2),o!==0&&(c=c.plus(Bt(A,l+2,k).times(o+""))),c=X(c,new A(p),l,1),e==null)if(nt(c.d,l-b,w,a))A.precision=l+=b,u=s=f=X(m.minus(1),m.plus(1),l,1),d=L(f.times(f),l,1),r=a=1;else return L(c,A.precision=k,w,W=!0);else return A.precision=k,c;c=u,r+=2}}function $n(n){return String(n.s*n.s/0)}function rn(n,e){var t,i,r;for((t=e.indexOf("."))>-1&&(e=e.replace(".","")),(i=e.search(/e/i))>0?(t<0&&(t=i),t+=+e.slice(i+1),e=e.substring(0,i)):t<0&&(t=e.length),i=0;e.charCodeAt(i)===48;i++);for(r=e.length;e.charCodeAt(r-1)===48;--r);if(e=e.slice(i,r),e){if(r-=i,n.e=t=t-i-1,n.d=[],i=(t+1)%F,t<0&&(i+=F),i<r){for(i&&n.d.push(+e.slice(0,i)),r-=F;i<r;)n.d.push(+e.slice(i,i+=F));e=e.slice(i),i=F-e.length}else i-=r;for(;i--;)e+="0";n.d.push(+e),W&&(n.e>n.constructor.maxE?(n.d=null,n.e=NaN):n.e<n.constructor.minE&&(n.e=0,n.d=[0]))}else n.e=0,n.d=[0];return n}function mr(n,e){var t,i,r,o,s,a,c,u,l;if(e.indexOf("_")>-1){if(e=e.replace(/(\d)_(?=\d)/g,"$1"),jn.test(e))return rn(n,e)}else if(e==="Infinity"||e==="NaN")return+e||(n.s=NaN),n.e=NaN,n.d=null,n;if(sr.test(e))t=16,e=e.toLowerCase();else if(or.test(e))t=2;else if(ar.test(e))t=8;else throw Error(Ke+e);for(o=e.search(/p/i),o>0?(c=+e.slice(o+1),e=e.substring(2,o)):e=e.slice(2),o=e.indexOf("."),s=o>=0,i=n.constructor,s&&(e=e.replace(".",""),a=e.length,o=a-o,r=Yn(i,new i(t),o,o*2)),u=kt(e,t,pe),l=u.length-1,o=l;u[o]===0;--o)u.pop();return o<0?new i(n.s*0):(n.e=It(u,l),n.d=u,W=!1,s&&(n=X(n,r,a*4)),c&&(n=n.times(Math.abs(c)<54?ee(2,c):it.pow(2,c))),W=!0,n)}function dr(n,e){var t,i=e.d.length;if(i<3)return e.isZero()?e:He(n,2,e,e);t=1.4*Math.sqrt(i),t=t>16?16:t|0,e=e.times(1/St(5,t)),e=He(n,2,e,e);for(var r,o=new n(5),s=new n(16),a=new n(20);t--;)r=e.times(e),e=e.times(o.plus(r.times(s.times(r).minus(a))));return e}function He(n,e,t,i,r){var o,s,a,c,u=1,l=n.precision,m=Math.ceil(l/F);for(W=!1,c=t.times(t),a=new n(i);;){if(s=X(a.times(c),new n(e++*e++),l,1),a=r?i.plus(s):i.minus(s),i=X(s.times(c),new n(e++*e++),l,1),s=a.plus(i),s.d[m]!==void 0){for(o=m;s.d[o]===a.d[o]&&o--;);if(o==-1)break}o=a,a=i,i=s,s=o,u++}return W=!0,s.d.length=m+1,s}function St(n,e){for(var t=n;--e;)t*=n;return t}function ei(n,e){var t,i=e.s<0,r=de(n,n.precision,1),o=r.times(.5);if(e=e.abs(),e.lte(o))return Be=i?4:1,e;if(t=e.divToInt(r),t.isZero())Be=i?3:2;else{if(e=e.minus(t.times(r)),e.lte(o))return Be=qn(t)?i?2:3:i?4:1,e;Be=qn(t)?i?1:4:i?3:2}return e.minus(r).abs()}function on(n,e,t,i){var r,o,s,a,c,u,l,m,d,p=n.constructor,b=t!==void 0;if(b?(ae(t,1,Ne),i===void 0?i=p.rounding:ae(i,0,8)):(t=p.precision,i=p.rounding),!n.isFinite())l=$n(n);else{for(l=ye(n),s=l.indexOf("."),b?(r=2,e==16?t=t*4-3:e==8&&(t=t*3-2)):r=e,s>=0&&(l=l.replace(".",""),d=new p(1),d.e=l.length-s,d.d=kt(ye(d),10,r),d.e=d.d.length),m=kt(l,10,r),o=c=m.length;m[--c]==0;)m.pop();if(!m[0])l=b?"0p+0":"0";else{if(s<0?o--:(n=new p(n),n.d=m,n.e=o,n=X(n,d,t,i,0,r),m=n.d,o=n.e,u=Xn),s=m[t],a=r/2,u=u||m[t+1]!==void 0,u=i<4?(s!==void 0||u)&&(i===0||i===(n.s<0?3:2)):s>a||s===a&&(i===4||u||i===6&&m[t-1]&1||i===(n.s<0?8:7)),m.length=t,u)for(;++m[--t]>r-1;)m[t]=0,t||(++o,m.unshift(1));for(c=m.length;!m[c-1];--c);for(s=0,l="";s<c;s++)l+=$t.charAt(m[s]);if(b){if(c>1)if(e==16||e==8){for(s=e==16?4:3,--c;c%s;c++)l+="0";for(m=kt(l,r,e),c=m.length;!m[c-1];--c);for(s=1,l="1.";s<c;s++)l+=$t.charAt(m[s])}else l=l.charAt(0)+"."+l.slice(1);l=l+(o<0?"p":"p+")+o}else if(o<0){for(;++o;)l="0"+l;l="0."+l}else if(++o>c)for(o-=c;o--;)l+="0";else o<c&&(l=l.slice(0,o)+"."+l.slice(o))}l=(e==16?"0x":e==2?"0b":e==8?"0o":"")+l}return n.s<0?"-"+l:l}function Un(n,e){if(n.length>e)return n.length=e,!0}function pr(n){return new this(n).abs()}function fr(n){return new this(n).acos()}function br(n){return new this(n).acosh()}function gr(n,e){return new this(n).plus(e)}function yr(n){return new this(n).asin()}function wr(n){return new this(n).asinh()}function Pr(n){return new this(n).atan()}function Ar(n){return new this(n).atanh()}function kr(n,e){n=new this(n),e=new this(e);var t,i=this.precision,r=this.rounding,o=i+4;return!n.s||!e.s?t=new this(NaN):!n.d&&!e.d?(t=de(this,o,1).times(e.s>0?.25:.75),t.s=n.s):!e.d||n.isZero()?(t=e.s<0?de(this,i,r):new this(0),t.s=n.s):!n.d||e.isZero()?(t=de(this,o,1).times(.5),t.s=n.s):e.s<0?(this.precision=o,this.rounding=1,t=this.atan(X(n,e,o,1)),e=de(this,o,1),this.precision=i,this.rounding=r,t=n.s<0?t.minus(e):t.plus(e)):t=this.atan(X(n,e,o,1)),t}function Tr(n){return new this(n).cbrt()}function hr(n){return L(n=new this(n),n.e+1,2)}function Br(n,e,t){return new this(n).clamp(e,t)}function xr(n){if(!n||typeof n!="object")throw Error(xt+"Object expected");var e,t,i,r=n.defaults===!0,o=["precision",1,Ne,"rounding",0,8,"toExpNeg",-ze,0,"toExpPos",0,ze,"maxE",0,ze,"minE",-ze,0,"modulo",0,9];for(e=0;e<o.length;e+=3)if(t=o[e],r&&(this[t]=en[t]),(i=n[t])!==void 0)if(re(i)===i&&i>=o[e+1]&&i<=o[e+2])this[t]=i;else throw Error(Ke+t+": "+i);if(t="crypto",r&&(this[t]=en[t]),(i=n[t])!==void 0)if(i===!0||i===!1||i===0||i===1)if(i)if(typeof crypto<"u"&&crypto&&(crypto.getRandomValues||crypto.randomBytes))this[t]=!0;else throw Error(Hn);else this[t]=!1;else throw Error(Ke+t+": "+i);return this}function Ir(n){return new this(n).cos()}function Sr(n){return new this(n).cosh()}function ti(n){var e,t,i;function r(o){var s,a,c,u=this;if(!(u instanceof r))return new r(o);if(u.constructor=r,Gn(o)){u.s=o.s,W?!o.d||o.e>r.maxE?(u.e=NaN,u.d=null):o.e<r.minE?(u.e=0,u.d=[0]):(u.e=o.e,u.d=o.d.slice()):(u.e=o.e,u.d=o.d?o.d.slice():o.d);return}if(c=typeof o,c==="number"){if(o===0){u.s=1/o<0?-1:1,u.e=0,u.d=[0];return}if(o<0?(o=-o,u.s=-1):u.s=1,o===~~o&&o<1e7){for(s=0,a=o;a>=10;a/=10)s++;W?s>r.maxE?(u.e=NaN,u.d=null):s<r.minE?(u.e=0,u.d=[0]):(u.e=s,u.d=[o]):(u.e=s,u.d=[o]);return}else if(o*0!==0){o||(u.s=NaN),u.e=NaN,u.d=null;return}return rn(u,o.toString())}else if(c!=="string")throw Error(Ke+o);return(a=o.charCodeAt(0))===45?(o=o.slice(1),u.s=-1):(a===43&&(o=o.slice(1)),u.s=1),jn.test(o)?rn(u,o):mr(u,o)}if(r.prototype=y,r.ROUND_UP=0,r.ROUND_DOWN=1,r.ROUND_CEIL=2,r.ROUND_FLOOR=3,r.ROUND_HALF_UP=4,r.ROUND_HALF_DOWN=5,r.ROUND_HALF_EVEN=6,r.ROUND_HALF_CEIL=7,r.ROUND_HALF_FLOOR=8,r.EUCLID=9,r.config=r.set=xr,r.clone=ti,r.isDecimal=Gn,r.abs=pr,r.acos=fr,r.acosh=br,r.add=gr,r.asin=yr,r.asinh=wr,r.atan=Pr,r.atanh=Ar,r.atan2=kr,r.cbrt=Tr,r.ceil=hr,r.clamp=Br,r.cos=Ir,r.cosh=Sr,r.div=Cr,r.exp=Kr,r.floor=Nr,r.hypot=Lr,r.ln=Rr,r.log=Mr,r.log10=Fr,r.log2=Or,r.max=Er,r.min=vr,r.mod=Dr,r.mul=Wr,r.pow=_r,r.random=Vr,r.round=qr,r.sign=Ur,r.sin=Gr,r.sinh=Xr,r.sqrt=zr,r.sub=Hr,r.sum=Zr,r.tan=jr,r.tanh=Qr,r.trunc=Yr,n===void 0&&(n={}),n&&n.defaults!==!0)for(i=["precision","rounding","toExpNeg","toExpPos","maxE","minE","modulo","crypto"],e=0;e<i.length;)n.hasOwnProperty(t=i[e++])||(n[t]=this[t]);return r.config(n),r}function Cr(n,e){return new this(n).div(e)}function Kr(n){return new this(n).exp()}function Nr(n){return L(n=new this(n),n.e+1,3)}function Lr(){var n,e,t=new this(0);for(W=!1,n=0;n<arguments.length;)if(e=new this(arguments[n++]),e.d)t.d&&(t=t.plus(e.times(e)));else{if(e.s)return W=!0,new this(1/0);t=e}return W=!0,t.sqrt()}function Gn(n){return n instanceof it||n&&n.toStringTag===Zn||!1}function Rr(n){return new this(n).ln()}function Mr(n,e){return new this(n).log(e)}function Or(n){return new this(n).log(2)}function Fr(n){return new this(n).log(10)}function Er(){return Jn(this,arguments,"lt")}function vr(){return Jn(this,arguments,"gt")}function Dr(n,e){return new this(n).mod(e)}function Wr(n,e){return new this(n).mul(e)}function _r(n,e){return new this(n).pow(e)}function Vr(n){var e,t,i,r,o=0,s=new this(1),a=[];if(n===void 0?n=this.precision:ae(n,1,Ne),i=Math.ceil(n/F),this.crypto)if(crypto.getRandomValues)for(e=crypto.getRandomValues(new Uint32Array(i));o<i;)r=e[o],r>=429e7?e[o]=crypto.getRandomValues(new Uint32Array(1))[0]:a[o++]=r%1e7;else if(crypto.randomBytes){for(e=crypto.randomBytes(i*=4);o<i;)r=e[o]+(e[o+1]<<8)+(e[o+2]<<16)+((e[o+3]&127)<<24),r>=214e7?crypto.randomBytes(4).copy(e,o):(a.push(r%1e7),o+=4);o=i/4}else throw Error(Hn);else for(;o<i;)a[o++]=Math.random()*1e7|0;for(i=a[--o],n%=F,i&&n&&(r=ee(10,F-n),a[o]=(i/r|0)*r);a[o]===0;o--)a.pop();if(o<0)t=0,a=[0];else{for(t=-1;a[0]===0;t-=F)a.shift();for(i=1,r=a[0];r>=10;r/=10)i++;i<F&&(t-=F-i)}return s.e=t,s.d=a,s}function qr(n){return L(n=new this(n),n.e+1,this.rounding)}function Ur(n){return n=new this(n),n.d?n.d[0]?n.s:0*n.s:n.s||NaN}function Gr(n){return new this(n).sin()}function Xr(n){return new this(n).sinh()}function zr(n){return new this(n).sqrt()}function Hr(n,e){return new this(n).sub(e)}function Zr(){var n=0,e=arguments,t=new this(e[n]);for(W=!1;t.s&&++n<e.length;)t=t.plus(e[n]);return W=!0,L(t,this.precision,this.rounding)}function jr(n){return new this(n).tan()}function Qr(n){return new this(n).tanh()}function Yr(n){return L(n=new this(n),n.e+1,1)}y[Symbol.for("nodejs.util.inspect.custom")]=y.toString;y[Symbol.toStringTag]="Decimal";var it=y.constructor=ti(en);Tt=new it(Tt);ht=new it(ht);var te=it;import Do from"big.js";import Lc from"bn.js";import{get as ni,set as Jr}from"lodash";var sn=class{constructor(e){this.logLevel=e.logLevel!==void 0?e.logLevel:0,this.name=e.name}set level(e){this.logLevel=e}get time(){return Date.now().toString()}get moduleName(){return this.name}isLogLevel(e){return e<=this.logLevel}error(...e){return this.isLogLevel(0)?(console.error(this.time,this.name,"sdk logger error",...e),this):this}logWithError(...e){let t=e.map(i=>typeof i=="object"?JSON.stringify(i):i).join(", ");throw new Error(t)}warning(...e){return this.isLogLevel(1)?(console.warn(this.time,this.name,"sdk logger warning",...e),this):this}info(...e){return this.isLogLevel(2)?(console.info(this.time,this.name,"sdk logger info",...e),this):this}debug(...e){return this.isLogLevel(3)?(console.debug(this.time,this.name,"sdk logger debug",...e),this):this}},ii={},$r={};function ne(n){let e=ni(ii,n);if(!e){let t=ni($r,n);e=new sn({name:n,logLevel:t}),Jr(ii,n,e)}return e}import{PublicKey as ri}from"@solana/web3.js";import{MINT_SIZE as eo,TOKEN_PROGRAM_ID as to,getTransferFeeConfig as no,unpackMint as io}from"@solana/spl-token";var an=ne("Raydium_accountInfo_util");async function rt(n,e,t){let{batchRequest:i,commitment:r="confirmed",chunkCount:o=100}=U({batchRequest:!1},t),s=un(e,o),a=new Array(s.length).fill([]);if(i){let c=s.map(m=>{let d=n._buildArgs([m.map(p=>p.toBase58())],r,"base64");return{methodName:"getMultipleAccounts",args:d}}),u=un(c,10);a=(await(await Promise.all(u.map(async m=>await n._rpcBatchRequest(m)))).flat()).map(m=>(m.error&&an.logWithError(`failed to get info for multiple accounts, RPC_ERROR, ${m.error.message}`),m.result.value.map(d=>{if(d){let{data:p,executable:b,lamports:f,owner:g,rentEpoch:A}=d;return p.length!==2&&p[1]!=="base64"&&an.logWithError("info must be base64 encoded, RPC_ERROR"),{data:Buffer.from(p[0],"base64"),executable:b,lamports:f,owner:new ri(g),rentEpoch:A}}return null})))}else try{a=await Promise.all(s.map(c=>n.getMultipleAccountsInfo(c,r)))}catch(c){c instanceof Error&&an.logWithError(`failed to get info for multiple accounts, RPC_ERROR, ${c.message}`)}return a.flat()}async function De(n,e,t){let i=await rt(n,e.map(r=>r.pubkey),t);return e.map((r,o)=>Z(U({},r),{accountInfo:i[o]}))}async function cn({connection:n,mints:e,config:t}){var o,s,a;if(e.length===0)return{};let i=await De(n,e.map(c=>({pubkey:ot(c)})),t),r={};for(let c of i){if(!c.accountInfo||c.accountInfo.data.length<eo){console.log("invalid mint account",c.pubkey.toBase58());continue}let u=io(c.pubkey,c.accountInfo,(o=c.accountInfo)==null?void 0:o.owner);r[c.pubkey.toString()]=Z(U({},u),{programId:((s=c.accountInfo)==null?void 0:s.owner)||to,feeConfig:(a=no(u))!=null?a:void 0})}return r[ri.default.toBase58()]=r[ue.toBase58()],r}import st from"bn.js";var oi=9007199254740991;function we(n){let e=ne("Raydium_parseBigNumberish");if(n instanceof st)return n;if(typeof n=="string"){if(n.match(/^-?[0-9]+$/))return new st(n);e.logWithError(`invalid BigNumberish string: ${n}`)}return typeof n=="number"?(n%1&&e.logWithError(`BigNumberish number underflow: ${n}`),(n>=oi||n<=-oi)&&e.logWithError(`BigNumberish number overflow: ${n}`),new st(String(n))):typeof n=="bigint"?new st(n.toString()):(e.error(`invalid BigNumberish value: ${n}`),new st(0))}import{PublicKey as ro}from"@solana/web3.js";import{TOKEN_PROGRAM_ID as si}from"@solana/spl-token";var ln={chainId:101,address:ro.default.toBase58(),programId:si.toBase58(),decimals:9,symbol:"SOL",name:"solana",logoURI:"https://img-v1.raydium.io/icon/So11111111111111111111111111111111111111112.png",tags:[],priority:2,type:"raydium",extensions:{coingeckoId:"solana"}},Le={chainId:101,address:"So11111111111111111111111111111111111111112",programId:si.toBase58(),decimals:9,symbol:"WSOL",name:"Wrapped SOL",logoURI:"https://img-v1.raydium.io/icon/So11111111111111111111111111111111111111112.png",tags:[],priority:2,type:"raydium",extensions:{coingeckoId:"solana"}};import{PublicKey as pn}from"@solana/web3.js";import{PublicKey as Q,SystemProgram as ai,SYSVAR_RENT_PUBKEY as oo}from"@solana/web3.js";import{TOKEN_PROGRAM_ID as so}from"@solana/spl-token";function mn({pubkey:n,isSigner:e=!1,isWritable:t=!0}){return{pubkey:n,isWritable:t,isSigner:e}}var Zs=[mn({pubkey:so,isWritable:!1}),mn({pubkey:ai.programId,isWritable:!1}),mn({pubkey:oo,isWritable:!1})];function dn({publicKey:n,transformSol:e}){let t=ui(n.toString());if(t instanceof Q)return e&&t.equals(at)?ue:t;if(e&&t.toString()===at.toBase58())return ue;if(typeof t=="string"){if(t===Q.default.toBase58())return Q.default;try{return new Q(t)}catch{throw new Error("invalid public key")}}throw new Error("invalid public key")}function ui(n){try{return new Q(n)}catch{return n}}var ao=new Q("MemoSq4gqABAXKb96qnH8TysNcWxMyWCqXgDLGmfcHr"),Ct=new Q("MemoSq4gqABAXKb96qnH8TysNcWxMyWCqXgDLGmfcHr"),Kt=new Q("SysvarRent111111111111111111111111111111111"),js=new Q("SysvarC1ock11111111111111111111111111111111"),Ze=new Q("metaqbxxUerdq28cj1RbAWkYQm3ybzjb6a8bt518x1s"),Qs=new Q("Sysvar1nstructions1111111111111111111111111"),ci=ai.programId,Ys=new Q("4k3Dyjzvzp8eMZWUXbBCjEvwSkkk59S5iCNLY3QrkX6R"),Js=new Q("Ea5SjE2Y6yvCeW5dYTn7PYMuW5ikXkvbGdcmSnXeaLjS"),$s=new Q("SRMuApVNdxXokk5GT7XD5cUUgXMBCoAz2LHeuAoKWRt"),ea=new Q("EPjFWdd5AufqSSqeM2qN1xzybapC8G4wEGGkZwyTDt1v"),ta=new Q("Es9vMFrzaCERmJfrF4H2FYD4KCoNkY11McCe8BenwNYB"),na=new Q("mSoLzYCxHdYgdzU16g5QSh3i5K3z3KZK7ytfqcJm7So"),ia=new Q("7dHbWXmci3dT8UFYWYZweBLXgycu7Y3iL6trKn1Y7ARj"),ra=new Q("USDH1SM1ojwWUga67PGrgFWUHibbjqMvuMaDkRJTgkX"),oa=new Q("NRVwhjBQiUPYtfDT5zRBVJajzFQHaBUNtC7SNVvqRFa"),sa=new Q("ANAxByE6G2WjFp7A4NqtWYXb3mgruyzZYg3spfxe6Lbo"),aa=new Q("7vfCXTUXx5WJV5JADk17DUJ4ksgau7utNKj4b963voxs"),ue=new Q("So11111111111111111111111111111111111111112"),at=Q.default;function ot(n){return dn({publicKey:n,transformSol:!0})}var fn=class{constructor({mint:e,decimals:t,symbol:i,name:r,skipMint:o=!1,isToken2022:s=!1}){if(e===at.toBase58()||e instanceof pn&&at.equals(e)){this.decimals=Le.decimals,this.symbol=Le.symbol,this.name=Le.name,this.mint=new pn(Le.address),this.isToken2022=!1;return}this.decimals=t,this.symbol=i||e.toString().substring(0,6),this.name=r||e.toString().substring(0,6),this.mint=o?pn.default:dn({publicKey:e}),this.isToken2022=s}equals(e){return this===e?!0:this.mint.equals(e.mint)}},Re=fn;Re.WSOL=new fn(Z(U({},Le),{mint:Le.address}));var bn=class{constructor({decimals:e,symbol:t="UNKNOWN",name:i="UNKNOWN"}){this.decimals=e,this.symbol=t,this.name=i}equals(e){return this===e}},Nt=bn;Nt.SOL=new bn(ln);import uo from"toformat";var co=uo,ut=co;import Rt from"big.js";import mo from"bn.js";import po from"decimal.js-light";var Lt=ne("module/fraction"),gn=ut(Rt),ct=ut(po),fo={[0]:ct.ROUND_DOWN,[1]:ct.ROUND_HALF_UP,[2]:ct.ROUND_UP},bo={[0]:Rt.roundDown,[1]:Rt.roundHalfUp,[2]:Rt.roundUp},H=class{constructor(e,t=new mo(1)){this.numerator=we(e),this.denominator=we(t)}get quotient(){return this.numerator.div(this.denominator)}invert(){return new H(this.denominator,this.numerator)}add(e){let t=e instanceof H?e:new H(we(e));return this.denominator.eq(t.denominator)?new H(this.numerator.add(t.numerator),this.denominator):new H(this.numerator.mul(t.denominator).add(t.numerator.mul(this.denominator)),this.denominator.mul(t.denominator))}sub(e){let t=e instanceof H?e:new H(we(e));return this.denominator.eq(t.denominator)?new H(this.numerator.sub(t.numerator),this.denominator):new H(this.numerator.mul(t.denominator).sub(t.numerator.mul(this.denominator)),this.denominator.mul(t.denominator))}mul(e){let t=e instanceof H?e:new H(we(e));return new H(this.numerator.mul(t.numerator),this.denominator.mul(t.denominator))}div(e){let t=e instanceof H?e:new H(we(e));return new H(this.numerator.mul(t.denominator),this.denominator.mul(t.numerator))}toSignificant(e,t={groupSeparator:""},i=1){Number.isInteger(e)||Lt.logWithError(`${e} is not an integer.`),e<=0&&Lt.logWithError(`${e} is not positive.`),ct.set({precision:e+1,rounding:fo[i]});let r=new ct(this.numerator.toString()).div(this.denominator.toString()).toSignificantDigits(e);return r.toFormat(r.decimalPlaces(),t)}toFixed(e,t={groupSeparator:""},i=1){return Number.isInteger(e)||Lt.logWithError(`${e} is not an integer.`),e<0&&Lt.logWithError(`${e} is negative.`),gn.DP=e,gn.RM=bo[i]||1,new gn(this.numerator.toString()).div(this.denominator.toString()).toFormat(e,t)}isZero(){return this.numerator.isZero()}};import go from"bn.js";var li=new H(new go(100)),ce=class extends H{toSignificant(e=5,t,i){return this.mul(li).toSignificant(e,t,i)}toFixed(e=2,t,i){return this.mul(li).toFixed(e,t,i)}};var Oa=ne("Raydium_price");function un(n,e=1,t=[]){let i=[...n];if(e<=0)return t;for(;i.length;)t.push(i.splice(0,e));return t}import{PublicKey as ho}from"@solana/web3.js";import{TOKEN_PROGRAM_ID as Bo}from"@solana/spl-token";import{ComputeBudgetProgram as mi,Keypair as pi,PublicKey as yo,Transaction as fi,TransactionMessage as wo,VersionedTransaction as bi}from"@solana/web3.js";var oe={CreateAccount:"CreateAccount",InitAccount:"InitAccount",CreateATA:"CreateATA",CloseAccount:"CloseAccount",TransferAmount:"TransferAmount",InitMint:"InitMint",MintTo:"MintTo",InitMarket:"InitMarket",Util1216OwnerClaim:"Util1216OwnerClaim",SetComputeUnitPrice:"SetComputeUnitPrice",SetComputeUnitLimit:"SetComputeUnitLimit",ClmmCreatePool:"ClmmCreatePool",ClmmOpenPosition:"ClmmOpenPosition",ClmmIncreasePosition:"ClmmIncreasePosition",ClmmDecreasePosition:"ClmmDecreasePosition",ClmmClosePosition:"ClmmClosePosition",ClmmSwapBaseIn:"ClmmSwapBaseIn",ClmmSwapBaseOut:"ClmmSwapBaseOut",ClmmInitReward:"ClmmInitReward",ClmmSetReward:"ClmmSetReward",ClmmCollectReward:"ClmmCollectReward",ClmmLockPosition:"ClmmLockPosition",ClmmHarvestLockPosition:"ClmmHarvestLockPosition",AmmV4Swap:"AmmV4Swap",AmmV4AddLiquidity:"AmmV4AddLiquidity",AmmV4RemoveLiquidity:"AmmV4RemoveLiquidity",AmmV4SimulatePoolInfo:"AmmV4SimulatePoolInfo",AmmV4SwapBaseIn:"AmmV4SwapBaseIn",AmmV4SwapBaseOut:"AmmV4SwapBaseOut",AmmV4CreatePool:"AmmV4CreatePool",AmmV4InitPool:"AmmV4InitPool",AmmV5AddLiquidity:"AmmV5AddLiquidity",AmmV5RemoveLiquidity:"AmmV5RemoveLiquidity",AmmV5SimulatePoolInfo:"AmmV5SimulatePoolInfo",AmmV5SwapBaseIn:"AmmV5SwapBaseIn",AmmV5SwapBaseOut:"AmmV5SwapBaseOut",RouteSwap:"RouteSwap",RouteSwap1:"RouteSwap1",RouteSwap2:"RouteSwap2",FarmV3Deposit:"FarmV3Deposit",FarmV3Withdraw:"FarmV3Withdraw",FarmV3CreateLedger:"FarmV3CreateLedger",FarmV4Withdraw:"FarmV4Withdraw",FarmV5Deposit:"FarmV5Deposit",FarmV5Withdraw:"FarmV5Withdraw",FarmV5CreateLedger:"FarmV5CreateLedger",FarmV6Deposit:"FarmV6Deposit",FarmV6Withdraw:"FarmV6Withdraw",FarmV6Create:"FarmV6Create",FarmV6Restart:"FarmV6Restart",FarmV6CreatorAddReward:"FarmV6CreatorAddReward",FarmV6CreatorWithdraw:"FarmV6CreatorWithdraw",CpmmCreatePool:"CpmmCreatePool",CpmmAddLiquidity:"CpmmAddLiquidity",CpmmWithdrawLiquidity:"CpmmWithdrawLiquidity",CpmmSwapBaseIn:"CpmmSwapBaseIn",CpmmSwapBaseOut:"CpmmSwapBaseOut",CpmmLockLp:"CpmmLockLp",CpmmCollectLockFee:"CpmmCollectLockFee",TransferTip:"TransferTip"};import{TOKEN_PROGRAM_ID as Po}from"@solana/spl-token";var di=ne("Raydium_txUtil"),gi=1644;function Ot(n){let e=[],t=[];return n.microLamports&&(e.push(mi.setComputeUnitPrice({microLamports:n.microLamports})),t.push(oe.SetComputeUnitPrice)),n.units&&(e.push(mi.setComputeUnitLimit({units:n.units})),t.push(oe.SetComputeUnitLimit)),{instructions:e,instructionTypes:t}}async function je(n,e){var i,r;let t=e!=null?e:"confirmed";return(r=await((i=n.getLatestBlockhash)==null?void 0:i.call(n,{commitment:t})))==null?void 0:r.blockhash}async function Pn(n,e){return n.getSignatureStatuses([e]),new Promise((t,i)=>{let r=setTimeout(i,6e4);n.onSignature(e,o=>{if(clearTimeout(r),!o.err){t("");return}i(Object.assign(o.err,{txId:e}))},"confirmed")})}function Ao(n,e){n.length<1&&di.logWithError(`no instructions provided: ${n.toString()}`),e.length<1&&di.logWithError(`no signers provided:, ${e.toString()}`);let t=new fi;t.recentBlockhash="11111111111111111111111111111111",t.feePayer=e[0],t.add(...n);try{return Buffer.from(t.serialize({verifySignatures:!1})).toString("base64").length<gi}catch{return!1}}function fe(n,e){let[t,i]=yo.findProgramAddressSync(n,e);return{publicKey:t,nonce:i}}function lt({instructions:n,payer:e,signers:t}){return Ao(n,[e,...t])}function mt({instructions:n,payer:e,lookupTableAddressAccount:t,recentBlockhash:i=pi.generate().publicKey.toString()}){let o=new wo({payerKey:e,recentBlockhash:i,instructions:n}).compileToV0Message(Object.values(t!=null?t:{}));try{return Buffer.from(new bi(o).serialize()).toString("base64").length<gi}catch{return!1}}var ko=n=>Buffer.isBuffer(n)?n:n instanceof Uint8Array?Buffer.from(n.buffer,n.byteOffset,n.byteLength):Buffer.from(n),To=n=>{let e=n.serialize({requireAllSignatures:!1,verifySignatures:!1});n instanceof bi&&(e=ko(e));try{return e instanceof Buffer?e.toString("base64"):Buffer.from(e).toString("base64")}catch{return e.toString("base64")}};function We(n){let e=[];return n.forEach(t=>{t instanceof fi&&(t.recentBlockhash||(t.recentBlockhash=Po.toBase58()),t.feePayer||(t.feePayer=pi.generate().publicKey)),e.push(To(t))}),console.log("simulate tx string:",e),e}function Pe(n,e,t){return fe([n.toBuffer(),(t!=null?t:Bo).toBuffer(),e.toBuffer()],new ho("ATokenGPvbdGVxr1b2hvZbsiqW5xWH25efTNsLJA8knL"))}import{PublicKey as _}from"@solana/web3.js";var fu=new _("EhhTKczWMGQt46ynNeRX1WfeagwwJd7ufHvCDjRxjo5Q"),bu=new _("CBuCnLe26faBpcBP2fktp4rp8abpcAnTWft6ZrP5Q4T"),gu=new _("9KEPoZmtHUrBbhWN1v1KWLMkkvwY6WLtAVUCPRtRjP4z"),yu=new _("FarmqiPv5eAj3j1GMdMCMUGXqPUvmquZtMy86QH6rzhG"),wu=new _("CLaimxFqjHzgTJtAGHU47NPhg6qrc5sCnpC4tBLyABQS"),Pu=new _("srmqPvymJeFKQ4zGQed1GFppgkRHL9kaELCbyksJtPX"),Au=new _("9xQeWvG816bUx9EPjHmaT23yvVM2ZWbrrpZb9PusVFin"),ku=new _("675kPX9MHTjS2zt1qfr1NYHuzeLXfQM9H24wFSUt1Mp8"),Tu=new _("5quBtoiQqxF9Jv6KYKctB59NT3gtJD2Y65kdnB1Uev3h"),hu=new _("CDSr3ssLcRB6XYPJwAfFt18MZvEZp4LjHcvzBVZ45duo"),xo=new _("CAMMCzo5YL8w4VFF8KVHrK22GGUsp5VTaW7grrKgrWqK"),Io=new _("LockrWmn6K5twhz3y9w1dQERbmgSaRkfnTeTKbpofwE"),So=new _("kN1kEznaF5Xbd8LYuqtEFcxzWSBk5Fv6ygX6SqEGJVy"),Bu=new _("routeUGWgWzqBWFcrCfv8tritsqukccJPu3q5GPP3xS"),xu=new _("7YttLkHDoNj9wyDur5pM1ejNaAvT9X4eqaYcHQqtj2G5"),Iu=new _("6FJon3QE27qgPVggARueB22hLvoh22VzJpXv4rBEoSLF"),Su=new _("CC12se5To1CdEuw7fDS27B7Geo5jJyL7t5UK2B44NgiH"),Cu=new _("9HzJyW1qZsEiSfMUf6L2jo3CcTKAyBmSyKdwQeYisHrC"),Ku=new _("DropEU8AvevN3UrXWXTMuz3rqnMczQVNjq3kcSdW2SQi"),yi=new _("CPMMoo8L3F4NbTegBCKVNunggL7H1ZpdTHKxQB5qKP1C"),wi=new _("GpMZbSM2GgvTKHJirzeGfMFoaZ8UR2X7F4v8vHTvxFbL"),Nu=new _("DNXgeM9EiiaAbaWvwjHj9fQQLAX5ZsfHyvmYUNRAdNC8"),Co=new _("CPMDWBwJDtYax9qW7AyRuVC19Cc4L4Vcy4n2BHAbHkCW"),Ko=new _("7rQ1QFNosMkUCuh7Z7fPbTHvh73b68sQYdirycEzJVuw"),No=new _("G11FKBRaAkHAKuLCgLM6K6NUc9rTjPAznRCjZifrTQe2"),Ft=new _("LockrWmn6K5twhz3y9w1dQERbmgSaRkfnTeTKbpofwE"),Lo=new _("DLockwT7X7sxtLmGH9g5kmfcjaBtncdbUmi738m5bvQC"),Et=new _("3f7GcQFG397GAaEnv51zR6tsTVihYRydnydDD1cXekxH"),Ro=new _("7AFUeLVRjBfzqK3tTGw8hN48KLQWSk6DTE8xprWdPqix"),Lu=new _("LanMV9sAd7wArD4vJFi2qDdfnVhFxYSUg6eADduJ3uj"),Ru=new _("WLHv2UAZm6z4KyaaELi5pjdbJh6RESMva1Rnn8pJVVh"),Mo=new _("LanD8FpTBBvzZFXjTxsAoipkFsxPUCDB4qAqKxYDiNP"),Oo=new _("HYNHiyKJ3gGVFvyxJAurK7qr7P2o5J9THmvCGMdULtpW");var Mu={AMM_V4:new _("HWy1jotHpo6UqeQxx49dpYYdQB8wj9Qk9MdxwjLvDHB8"),AMM_STABLE:new _("DDg4VmQaJV9ogWce7LpcjBA9bv22wRp5uaTPa5pGjijF"),CLMM_PROGRAM_ID:new _("devi51mZmdwUJGU9hjN27vEz64Gps7uUefqxg27EAtH"),CLMM_LOCK_PROGRAM_ID:new _("DLockwT7X7sxtLmGH9g5kmfcjaBtncdbUmi738m5bvQC"),CLMM_LOCK_AUTH_ID:new _("8qmHNvu2Kr2C7U8mJL4Vz1vTDxMhVuXKREwU7TNoaVEo"),FARM_PROGRAM_ID_V3:new _("85BFyr98MbCUU9MVTEgzx1nbhWACbJqLzho6zd6DZcWL"),FARM_PROGRAM_ID_V5:new _("EcLzTrNg9V7qhcdyXDe2qjtPkiGzDM2UbdRaeaadU5r2"),FARM_PROGRAM_ID_V6:new _("Farm2hJLcqPtPg8M4rR6DMrsRNc5TPm5Cs4bVQrMe2T7"),OPEN_BOOK_PROGRAM:new _("EoTcMgcDRTJVZDMZWBoU6rhYHZfkNTVEAfz3uUJRcYGj"),SERUM_PROGRAM_ID_V3:_.default,UTIL1216:_.default,Router:new _("BVChZ3XFEwTMUk1o9i3HAf91H6mFxSwa5X2wFAWhYPhU"),CREATE_CPMM_POOL_PROGRAM:Co,CREATE_CPMM_POOL_AUTH:Ko,CREATE_CPMM_POOL_FEE_ACC:No,LOCK_CPMM_PROGRAM:Lo,LOCK_CPMM_AUTH:Ro,LAUNCHPAD_PROGRAM:Mo,LAUNCHPAD_AUTH:Oo,FEE_DESTINATION_ID:new _("3XMrhbv989VxAMi3DErLV9eJht1pHppW5LbKxe9fkEFR")};import be from"bn.js";var dt=1e4;function Ae(n,e,t,i){if(e===void 0)return{amount:n,fee:void 0,expirationTime:void 0};let r=Z(U({},e),{olderTransferFee:{epoch:BigInt(e.olderTransferFee.epoch),maximumFee:BigInt(e.olderTransferFee.maximumFee),transferFeeBasisPoints:e.olderTransferFee.transferFeeBasisPoints},newerTransferFee:{epoch:BigInt(e.newerTransferFee.epoch),maximumFee:BigInt(e.newerTransferFee.maximumFee),transferFeeBasisPoints:e.newerTransferFee.transferFeeBasisPoints}}),o=t.epoch<r.newerTransferFee.epoch?r.olderTransferFee:r.newerTransferFee,s=new be(o.maximumFee.toString()),a=t.epoch<r.newerTransferFee.epoch?(Number(r.newerTransferFee.epoch)*t.slotsInEpoch-t.absoluteSlot)*400/1e3:void 0;if(i)if(o.transferFeeBasisPoints===dt){let c=new be(o.maximumFee.toString());return{amount:n.add(c),fee:c,expirationTime:a}}else{let c=Qe(n.mul(new be(dt)),new be(dt-o.transferFeeBasisPoints)),u=new be(o.maximumFee.toString()),l=c.sub(n).gt(u)?n.add(u):c,m=Qe(l.mul(new be(o.transferFeeBasisPoints)),new be(dt)),d=m.gt(s)?s:m;return{amount:l,fee:d,expirationTime:a}}else{let c=Qe(n.mul(new be(o.transferFeeBasisPoints)),new be(dt)),u=c.gt(s)?s:c;return{amount:n,fee:u,expirationTime:a}}}function Qe(n,e){let{div:t,mod:i}=n.divmod(e);return i.gt(new be(0))?t.add(new be(1)):t}import{PublicKey as Pi,AddressLookupTableAccount as vt}from"@solana/web3.js";async function An({connection:n,address:e}){let t=await rt(n,[...new Set(e.map(r=>r.toString()))].map(r=>new Pi(r))),i={};for(let r=0;r<e.length;r++){let o=t[r],s=e[r];if(!o)continue;let a=new vt({key:s,state:vt.deserialize(o.data)});i[s.toString()]=a,Dt[s.toString()]=a}return i}var Dt={AcL1Vo8oy1ULiavEcjSUcwfBSForXMudcZvDZy5nzJkU:new vt({key:new Pi("AcL1Vo8oy1ULiavEcjSUcwfBSForXMudcZvDZy5nzJkU"),state:vt.deserialize(Buffer.from("AQAAAP//////////I1rcEwAAAAAvAQYwun9CU6c5Ikm2pAj+D9IEnCOR45nK+SFTGSdpd6J6AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAbd9uHXZaGT2cvhRs7reawctIXtX1s3kTqM9YV+/wCpBt324e51j94YQl285GzN2rYa/E2DuQ0n/r35KNihi/wFSlNQ+F3IgtYUpVZyeIopbd8eq6vQpgZ4iEky9O72oAVKU1qZKSEGTSTocWDaOHx8NbXdvJK7geQfqEBBBUSNBqfVFxksXFEhjMlMPUrxf1ja7gibof1E49vZigAAAAAGp9UXGMd0yShWY5hpHV62i164o5tLbVxzVVshAAAAAIyXJY9OJInxuz0QKRSODYMLWhOZ2v8QhASOe9jb6fhZC3BlsePRfEU4nVJ/awTDzVi4bHMaoP21SbbRvAP4KUbIScv+6Yw2LHF/6K0ZjUPibbSWXCirYPGuuVl7zT789IUPLW4CpHr4JNCatp3ELXDLKMv6JJ+37le50lbBJ2LvBkX2T9y7AHdNGviJAqQNtlDUDCnauQRWybsLji6nPM8Qkw5asQRvCdB3MbX6IEBwytOrpM32l4jQygKG9TKgR0vZScQ2AsM/IHeQ7RajUkyhuZdc8SGiqQz/7H34torNR/Wir3sl0ruUrVxJWEZfUg+QLNAxxODdBi53/OP7Ioil1cqeBM9dtZC3FLov4yyxWRM/wcGStyJX/QfTnLBAHqkqWotPKVlShCVQqpP9W5W1rOao65IMk5QuQ2kMIOxzDMKAy2vjGSxQODgBz0QwGA+eP4ZjIjrIAQaXENv31QfLlOdXSRCkaybRniDHF4C8YcwhcvsqrOVuTP4B2Na+9wLdtrB31uz2rtlFI5kahdsnp/d1SrASDInYCtTYtdoke4kX+hoKWcEWM4Tle8pTUkUVv4BxS6fje/EzKBE4Qu/YsA/yfEEFGcr8Z57VKDw8uQzpiru7g4lvjnfapW62W030syevD8k07SGoxUHiuT/ai7gAHWWhDsVmg/C63ajgpkH7Sn3GdutArDTfyqOkdqv4/IPC/EFFy7mGkfDd2C57N5a/4jC+BbmJy7wQaSEZr0CQU88lPtUxIVvzGjC95b8Ooss2TqmkrayGKofkPMGQn7Ux+9lfwBSNfxwH8NgbpqC/7LNlV4I7nCvsXf3p+ohQk9NrAJb2KAFpUqEIJ9ZBV7BYDzHF/ORKYlgtvPnXjudZQ6CEo5OzUDaNIomTCCsvhD16TxJjsbgne1kGnQPCFSoaxUbq2V1bPMFQ3VYP6wDZ9bKStCFKx9A3tNbwZFC5ZGAN83MFK7XoTy+OmmcFEr6rLOjfSuTfPvHJkSVxW6Qllwkl67XcBi5v00u2gQsbu+38sp+rd5pA/LvyWj4P94ZGZwc1tE2P88xekCLcAwZGb+UhFzL/7K26csOb57yM5bvF9xJrLEObOkAAAAAn+HWRkdcPKyFFMnVwEoD7vnD0jCKFIU1sImubYCxNTSVzsKpaQX+fzNxrLAI3L14JQnJx/D6Uk2LADIHGqnGELzjEbkBDAlaM77NkXMPfqXNLSveCkWI7UEgNs31WEWB6XHSYI/v5DklHOb4QTtDOR804PVbi3fjloZeLR2F8d4FuZmMMO7ck3Fnkn2zEMG5gOmqsygb6PjTitArVl52NhcSznTxVnguaIJxiZkAnurDmn3MWR0PC2GLghp2KJqHCc6QQ85odeIjFHKOlRlJyeSXVJmL8vb1UgOzsbJPVP8p6zM4M3C1Sd7uWIHP33G42AP2Zg8ucn/n6meQjjD266JgCWdxZD6PXs9CsnIeL7SSG0/6lGb9xfP0ZcWkCXB/3hjxHYVXjra/GPOeXGk0fLLKjCbk+mgs2w6d2oCwimBipTzuoZ30GiI8ij8VRzD5CzMWtu2m21eDBIfjGAEo4pQeNNonKcqzV/cleX8ySZLOHsz8PtBCrLqF+VkLm9hOzIT+6i/nIf6keR4GWKMOD4AvqfpjHoD4DuhBpz8P28+DxkGrDXXr/nr20x291VPvcTU/b+b+o2kC9G0kcXeTlLjU6a2TQXWlZ4gBUdBl1jgT7mObSTpLblNiXZsLkbmVXZwvFKXua5cUKlWed/w30skmEUraTuQqtqr5fHZPW9n57EmeTif6LjHL2YJFZkQU+TrJmFzqzmF4/b8OwrPQAprl8mX3q4LUIdAS/a+11B6DWD1Xk2++Sn94dLC4xjkO4Wtlw8c4XuzciVbepHOmnoWzVu/0y3KCrLCSfQxQ3br8DJCoVzhgtPsS2nZZjsBGIZgnU0QpMv+2MnRsnKwdp1VsrCX84j/qvaZn4WhKunippgTbN2EUs0tPTP55Qfgj+nKmjtWW5IYs72FrEwJKYoNfsmqaF4o5pf4v9zgPwVwY/5I4XJKUL2L25m9kAQcW/K+H1RTFEUoj8Z4ajpOmAB/dG0COmCphVMW2CCMvnxhcGiSgPnpDuWu6qiJ7NG7ye5kvHgefgqPLeicspNJ5EpL3XiRNLM2tmJLI1awAwOyd6iHv0dCkMYRKaa6rcaZeYwmKCkckm0kM2JNmnmmAaBQQ7mwmIM0IMxX4f5W6j9PqZWcJxF7r17T/lQBAmcjoupRiJifbnXCNUv9GhpRF19WcBdeKbivRJVlGop6I2RS6lGImJ9udcI1S/0aGlEXX1ZwF14puK9ElWUainojZFYVHLHD6dIP2ESjqBzg3ol1/wB7+/ylGwd9LS7wSZ2A630CJSVKwH47K9P4bB8PEQP8BwjMFa7xQHOqZFP1XqaQ==","base64"))})};import{PublicKey as _e,sendAndConfirmTransaction as kn,SystemProgram as Ai,Transaction as pt,TransactionMessage as Me,VersionedTransaction as Oe}from"@solana/web3.js";import Eo from"axios";import{LAMPORTS_PER_SOL as Ti}from"@solana/web3.js";var $u=.001*Ti,ki=["4ACfpUFoaSD9bfPdeu6DBt89gB6ENTeHBXCAi87NhDEE","D2L6yPZ2FmmmTKPgzaMKdhu6EWZcTpLy1Vhx8uvZe7NZ","9bnz4RShgq1hAnLnZbP8kbgBg1kEmcJBYQq3gQbmnSta","5VY91ws6B2hMmBFRsXkoAAdsPHBJwRfBht4DXox3xkwn","2nyhqdwKcJZR2vcqCyrYsaPVdAnFoJjiksCXJ7hfEYgD","2q5pghRs6arqVjRvT5gfgWfWcHWmw1ZuCzphgd5KfWGJ","wyvPkWjVZz1M8fHQnMMCDTQDbkManefNNhweYk5WkcF","3KCKozbAaF75qEU33jtzozcJ29yJuaLJTy2jFdzUY8bT","4vieeGHPYPG2MmyPRcYjdiDmmhN3ww7hsFNap8pVN3Ey","4TQLFNWK8AovT1gFvda5jfw2oJeRMKEmw7aH6MGBJ3or"].map(n=>new _e(n)),Wt=2e3;var _t=class{constructor(e){this.instructions=[];this.endInstructions=[];this.lookupTableAddress=[];this.signers=[];this.instructionTypes=[];this.endInstructionTypes=[];this.connection=e.connection,this.feePayer=e.feePayer,this.signAllTransactions=e.signAllTransactions,this.owner=e.owner,this.cluster=e.cluster,this.blockhashCommitment=e.blockhashCommitment,this.loopMultiTxStatus=!!e.loopMultiTxStatus}get AllTxData(){return{instructions:this.instructions,endInstructions:this.endInstructions,signers:this.signers,instructionTypes:this.instructionTypes,endInstructionTypes:this.endInstructionTypes,lookupTableAddress:this.lookupTableAddress}}get allInstructions(){return[...this.instructions,...this.endInstructions]}async getComputeBudgetConfig(){var i;let e=(await Eo.get(`https://solanacompass.com/api/fees?cacheFreshTime=${3e5}`)).data,{avg:t}=(i=e==null?void 0:e[15])!=null?i:{};if(!!t)return{units:6e5,microLamports:Math.min(Math.ceil(t*1e6/6e5),25e3)}}addCustomComputeBudget(e){if(e){let{instructions:t,instructionTypes:i}=Ot(e);return this.instructions.unshift(...t),this.instructionTypes.unshift(...i),!0}return!1}addTipInstruction(e){var t;return e?(this.endInstructions.push(Ai.transfer({fromPubkey:(t=e.feePayer)!=null?t:this.feePayer,toPubkey:new _e(e.address),lamports:BigInt(e.amount.toString())})),this.endInstructionTypes.push(oe.TransferTip),!0):!1}async calComputeBudget({config:e,defaultIns:t}){try{let i=e||await this.getComputeBudgetConfig();if(this.addCustomComputeBudget(i))return;t&&this.instructions.unshift(...t)}catch{t&&this.instructions.unshift(...t)}}addInstruction({instructions:e=[],endInstructions:t=[],signers:i=[],instructionTypes:r=[],endInstructionTypes:o=[],lookupTableAddress:s=[]}){return this.instructions.push(...e),this.endInstructions.push(...t),this.signers.push(...i),this.instructionTypes.push(...r),this.endInstructionTypes.push(...o),this.lookupTableAddress.push(...s.filter(a=>a!==_e.default.toString())),this}async versionBuild({txVersion:e,extInfo:t}){return e===0?await this.buildV0(U({},t||{})):this.build(t)}build(e){var i;let t=new pt;return this.allInstructions.length&&t.add(...this.allInstructions),t.feePayer=this.feePayer,((i=this.owner)==null?void 0:i.signer)&&!this.signers.some(r=>r.publicKey.equals(this.owner.publicKey))&&this.signers.push(this.owner.signer),{builder:this,transaction:t,signers:this.signers,instructionTypes:[...this.instructionTypes,...this.endInstructionTypes],execute:async r=>{var l;let{recentBlockHash:o,skipPreflight:s=!0,sendAndConfirm:a,notSendToRpc:c}=r||{},u=o!=null?o:await je(this.connection,this.blockhashCommitment);if(t.recentBlockhash=u,this.signers.length&&t.sign(...this.signers),We([t]),console.log("SEND 1"),(l=this.owner)!=null&&l.isKeyPair)return{txId:a?await kn(this.connection,t,this.signers.find(d=>d.publicKey.equals(this.owner.publicKey))?this.signers:[...this.signers,this.owner.signer],{skipPreflight:s}):await this.connection.sendRawTransaction(t.serialize(),{skipPreflight:s}),signedTx:t};if(this.signAllTransactions){let m=await this.signAllTransactions([t]);if(this.signers.length)for(let d of m)try{d.sign(...this.signers)}catch{}return{txId:c?"":await this.connection.sendRawTransaction(m[0].serialize(),{skipPreflight:s}),signedTx:m[0]}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:e||{}}}buildMultiTx(e){var u;let{extraPreBuildData:t=[],extInfo:i}=e,{transaction:r}=this.build(i),o=t.filter(l=>l.transaction.instructions.length>0),s=[r,...o.map(l=>l.transaction)],a=[this.signers,...o.map(l=>l.signers)],c=[...this.instructionTypes,...o.map(l=>l.instructionTypes).flat()];return(u=this.owner)!=null&&u.signer&&a.forEach(l=>{l.some(m=>m.publicKey.equals(this.owner.publicKey))||this.signers.push(this.owner.signer)}),{builder:this,transactions:s,signers:a,instructionTypes:c,execute:async l=>{var A;let{sequentially:m,onTxUpdate:d,skipTxCount:p=0,recentBlockHash:b,skipPreflight:f=!0}=l||{},g=b!=null?b:await je(this.connection,this.blockhashCommitment);if((A=this.owner)!=null&&A.isKeyPair){if(m){let w=[],k=0;for(let P of s){if(++k,k<=p)continue;let T=await kn(this.connection,P,this.signers.find(h=>h.publicKey.equals(this.owner.publicKey))?this.signers:[...this.signers,this.owner.signer],{skipPreflight:f});w.push(T)}return{txIds:w,signedTxs:s}}return{txIds:await await Promise.all(s.map(async w=>(w.recentBlockhash=g,await this.connection.sendRawTransaction(w.serialize(),{skipPreflight:f})))),signedTxs:s}}if(this.signAllTransactions){let w=s.map((P,T)=>(P.recentBlockhash=g,a[T].length&&P.sign(...a[T]),P));We(w),console.log("SEND 2");let k=await this.signAllTransactions(w);if(m){let P=0,T=[],h=async()=>{if(!k[P])return;let x=await this.connection.sendRawTransaction(k[P].serialize(),{skipPreflight:f});T.push({txId:x,status:"sent",signedTx:k[P]}),d==null||d([...T]),P++;let B=!1,M=null,C=null,D=E=>{M!==null&&clearInterval(M),C!==null&&this.connection.removeSignatureListener(C);let v=T.findIndex(q=>q.txId===x);if(v>-1){if(T[v].status==="error"||T[v].status==="success")return;T[v].status=E.err?"error":"success"}d==null||d([...T]),E.err||h()};this.loopMultiTxStatus&&(M=setInterval(async()=>{var E;if(B){clearInterval(M);return}try{let v=await this.connection.getTransaction(x,{commitment:"confirmed",maxSupportedTransactionVersion:0});v&&(B=!0,clearInterval(M),D({err:((E=v.meta)==null?void 0:E.err)||null}),console.log("tx status from getTransaction:",x))}catch(v){B=!0,clearInterval(M),console.error("getTransaction timeout:",v,x)}},Wt)),C=this.connection.onSignature(x,E=>{if(B){this.connection.removeSignatureListener(C);return}B=!0,D(E)},"confirmed"),this.connection.getSignatureStatus(x)};return await h(),{txIds:T.map(x=>x.txId),signedTxs:k}}else{let P=[];for(let T=0;T<k.length;T+=1){let h=await this.connection.sendRawTransaction(k[T].serialize(),{skipPreflight:f});P.push(h)}return{txIds:P,signedTxs:k}}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:i||{}}}async versionMultiBuild({extraPreBuildData:e,txVersion:t,extInfo:i}){return t===0?await this.buildV0MultiTx({extraPreBuildData:e,buildProps:i||{}}):this.buildMultiTx({extraPreBuildData:e,extInfo:i})}async buildV0(e){var f;let b=e||{},{lookupTableCache:t={},lookupTableAddress:i=[],forerunCreate:r,recentBlockhash:o}=b,s=he(b,["lookupTableCache","lookupTableAddress","forerunCreate","recentBlockhash"]),a=U(U({},this.cluster==="devnet"?{}:Dt),t),c=Array.from(new Set([...i,...this.lookupTableAddress])),u=[];for(let g of c)a[g]===void 0&&u.push(new _e(g));let l=await An({connection:this.connection,address:u});for(let[g,A]of Object.entries(l))a[g]=A;let m=r?_e.default.toBase58():o!=null?o:await je(this.connection,this.blockhashCommitment),d=new Me({payerKey:this.feePayer,recentBlockhash:m,instructions:[...this.allInstructions]}).compileToV0Message(Object.values(a));((f=this.owner)==null?void 0:f.signer)&&!this.signers.some(g=>g.publicKey.equals(this.owner.publicKey))&&this.signers.push(this.owner.signer);let p=new Oe(d);return p.sign(this.signers),{builder:this,transaction:p,signers:this.signers,instructionTypes:[...this.instructionTypes,...this.endInstructionTypes],execute:async g=>{var P;let{skipPreflight:A=!0,sendAndConfirm:w,notSendToRpc:k}=g||{};if(We([p]),console.log("SEND 3"),(P=this.owner)!=null&&P.isKeyPair){let T=await this.connection.sendTransaction(p,{skipPreflight:A});return w&&await Pn(this.connection,T),{txId:T,signedTx:p}}if(this.signAllTransactions){let T=await this.signAllTransactions([p]);if(this.signers.length)for(let h of T)try{h.sign(this.signers)}catch{}return{txId:k?"":await this.connection.sendTransaction(T[0],{skipPreflight:A}),signedTx:T[0]}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:s||{}}}async buildV0MultiTx(e){var u;let{extraPreBuildData:t=[],buildProps:i}=e,{transaction:r}=await this.buildV0(i),o=t.filter(l=>l.builder.instructions.length>0),s=[r,...o.map(l=>l.transaction)],a=[this.signers,...o.map(l=>l.signers)],c=[...this.instructionTypes,...o.map(l=>l.instructionTypes).flat()];return(u=this.owner)!=null&&u.signer&&a.forEach(l=>{l.some(m=>m.publicKey.equals(this.owner.publicKey))||this.signers.push(this.owner.signer)}),s.forEach(async(l,m)=>{l.sign(a[m])}),{builder:this,transactions:s,signers:a,instructionTypes:c,buildProps:i,execute:async l=>{var f;let{sequentially:m,onTxUpdate:d,recentBlockHash:p,skipPreflight:b=!0}=l||{};if(p&&s.forEach(g=>g.message.recentBlockhash=p),We(s),console.log("SEND 4"),(f=this.owner)!=null&&f.isKeyPair){if(m){let g=[];for(let A of s){let w=await this.connection.sendTransaction(A,{skipPreflight:b});await Pn(this.connection,w),g.push(w)}return{txIds:g,signedTxs:s}}return{txIds:await Promise.all(s.map(async g=>await this.connection.sendTransaction(g,{skipPreflight:b}))),signedTxs:s}}if(this.signAllTransactions){let g=await this.signAllTransactions(s);if(m){let A=0,w=[],k=async()=>{if(!g[A])return;let P=await this.connection.sendTransaction(g[A],{skipPreflight:b});w.push({txId:P,status:"sent",signedTx:g[A]}),d==null||d([...w]),A++;let T=!1,h=null,x=null,B=M=>{h!==null&&clearInterval(h),x!==null&&this.connection.removeSignatureListener(x);let C=w.findIndex(D=>D.txId===P);if(C>-1){if(w[C].status==="error"||w[C].status==="success")return;w[C].status=M.err?"error":"success"}d==null||d([...w]),M.err||k()};this.loopMultiTxStatus&&(h=setInterval(async()=>{var M;if(T){clearInterval(h);return}try{let C=await this.connection.getTransaction(P,{commitment:"confirmed",maxSupportedTransactionVersion:0});C&&(T=!0,clearInterval(h),B({err:((M=C.meta)==null?void 0:M.err)||null}),console.log("tx status from getTransaction:",P))}catch(C){T=!0,clearInterval(h),console.error("getTransaction timeout:",C,P)}},Wt)),x=this.connection.onSignature(P,M=>{if(T){this.connection.removeSignatureListener(x);return}T=!0,B(M)},"confirmed"),this.connection.getSignatureStatus(P)};return k(),{txIds:[],signedTxs:g}}else{let A=[];for(let w=0;w<g.length;w+=1){let k=await this.connection.sendTransaction(g[w],{skipPreflight:b});A.push(k)}return{txIds:A,signedTxs:g}}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:i||{}}}async sizeCheckBuild(e){var d;let m=e||{},{splitIns:t=[],computeBudgetConfig:i}=m,r=he(m,["splitIns","computeBudgetConfig"]),o=i?Ot(i):{instructions:[],instructionTypes:[]},s=this.signers.reduce((p,b)=>Z(U({},p),{[b.publicKey.toBase58()]:b}),{}),a=[],c=[],u=[],l=0;if(this.allInstructions.forEach(p=>{let b=[...u,p],f=i?[...o.instructions,...b]:b,A=[...new Set(b.map(w=>w.keys.filter(k=>k.isSigner).map(k=>k.pubkey.toString())).flat()).values()].map(w=>new _e(w));if(p!==t[l]&&u.length<12&&(lt({instructions:f,payer:this.feePayer,signers:A})||lt({instructions:b,payer:this.feePayer,signers:A})))u.push(p);else{if(u.length===0)throw Error("item ins too big");l+=p===t[l]?1:0,lt({instructions:i?[...o.instructions,...u]:[...u],payer:this.feePayer,signers:A})?a.push(new pt().add(...o.instructions,...u)):a.push(new pt().add(...u)),c.push(Array.from(new Set(u.map(w=>w.keys.filter(k=>k.isSigner).map(k=>k.pubkey.toString())).flat())).map(w=>s[w]).filter(w=>w!==void 0)),u=[p]}}),u.length>0){let b=[...new Set(u.map(f=>f.keys.filter(g=>g.isSigner).map(g=>g.pubkey.toString())).flat()).values()].map(f=>s[f]).filter(f=>f!==void 0);lt({instructions:i?[...o.instructions,...u]:[...u],payer:this.feePayer,signers:b.map(f=>f.publicKey)})?a.push(new pt().add(...o.instructions,...u)):a.push(new pt().add(...u)),c.push(b)}return a.forEach(p=>p.feePayer=this.feePayer),(d=this.owner)!=null&&d.signer&&c.forEach(p=>{p.some(b=>b.publicKey.equals(this.owner.publicKey))||p.push(this.owner.signer)}),{builder:this,transactions:a,signers:c,instructionTypes:this.instructionTypes,execute:async p=>{var P;let{sequentially:b,onTxUpdate:f,skipTxCount:g=0,recentBlockHash:A,skipPreflight:w=!0}=p||{},k=A!=null?A:await je(this.connection,this.blockhashCommitment);if(a.forEach(async(T,h)=>{T.recentBlockhash=k,c[h].length&&T.sign(...c[h])}),We(a),console.log("SEND 5"),console.log("sizeCheckBuild"),(P=this.owner)!=null&&P.isKeyPair){if(b){let T=0,h=[];for(let x of a){if(++T,T<=g){h.push("tx skipped");continue}let B=await kn(this.connection,x,this.signers.find(M=>M.publicKey.equals(this.owner.publicKey))?this.signers:[...this.signers,this.owner.signer],{skipPreflight:w});h.push(B)}return{txIds:h,signedTxs:a}}return{txIds:await Promise.all(a.map(async T=>await this.connection.sendRawTransaction(T.serialize(),{skipPreflight:w}))),signedTxs:a}}if(this.signAllTransactions){let T=await this.signAllTransactions(a.slice(g,a.length)),h=[...a.slice(0,g),...T];if(b){let x=0,B=[],M=async()=>{if(!h[x])return;x<g&&(B.push({txId:"",status:"success",signedTx:h[x]}),f==null||f([...B]),x++,M());let C=await this.connection.sendRawTransaction(h[x].serialize(),{skipPreflight:w});B.push({txId:C,status:"sent",signedTx:h[x]}),f==null||f([...B]),x++;let D=!1,E=null,v=null,q=O=>{E!==null&&clearInterval(E),v!==null&&this.connection.removeSignatureListener(v);let R=B.findIndex($=>$.txId===C);if(R>-1){if(B[R].status==="error"||B[R].status==="success")return;B[R].status=O.err?"error":"success"}f==null||f([...B]),O.err||M()};this.loopMultiTxStatus&&(E=setInterval(async()=>{var O;if(D){clearInterval(E);return}try{let R=await this.connection.getTransaction(C,{commitment:"confirmed",maxSupportedTransactionVersion:0});R&&(D=!0,clearInterval(E),q({err:((O=R.meta)==null?void 0:O.err)||null}),console.log("tx status from getTransaction:",C))}catch(R){D=!0,clearInterval(E),console.error("getTransaction timeout:",R,C)}},Wt)),v=this.connection.onSignature(C,O=>{if(D){this.connection.removeSignatureListener(v);return}D=!0,q(O)},"confirmed"),this.connection.getSignatureStatus(C)};return await M(),{txIds:B.map(C=>C.txId),signedTxs:h}}else{let x=[];for(let B=0;B<h.length;B+=1){let M=await this.connection.sendRawTransaction(h[B].serialize(),{skipPreflight:w});x.push(M)}return{txIds:x,signedTxs:h}}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:r||{}}}async sizeCheckBuildV0(e){var k;let w=e||{},{computeBudgetConfig:t,splitIns:i=[],lookupTableCache:r={},lookupTableAddress:o=[]}=w,s=he(w,["computeBudgetConfig","splitIns","lookupTableCache","lookupTableAddress"]),a=U(U({},this.cluster==="devnet"?{}:Dt),r),c=Array.from(new Set([...this.lookupTableAddress,...o])),u=[];for(let P of c)a[P]===void 0&&u.push(new _e(P));let l=await An({connection:this.connection,address:u});for(let[P,T]of Object.entries(l))a[P]=T;let m=t?Ot(t):{instructions:[],instructionTypes:[]},d=await je(this.connection,this.blockhashCommitment),p=this.signers.reduce((P,T)=>Z(U({},P),{[T.publicKey.toBase58()]:T}),{}),b=[],f=[],g=[],A=0;if(this.allInstructions.forEach(P=>{let T=[...g,P],h=t?[...m.instructions,...T]:T;if(P!==i[A]&&g.length<12&&(mt({instructions:h,payer:this.feePayer,lookupTableAddressAccount:a})||mt({instructions:T,payer:this.feePayer,lookupTableAddressAccount:a})))g.push(P);else{if(g.length===0)throw Error("item ins too big");A+=P===i[A]?1:0;let x={};for(let B of[...new Set(c)])a[B]!==void 0&&(x[B]=a[B]);if(t&&mt({instructions:[...m.instructions,...g],payer:this.feePayer,lookupTableAddressAccount:a,recentBlockhash:d})){let B=new Me({payerKey:this.feePayer,recentBlockhash:d,instructions:[...m.instructions,...g]}).compileToV0Message(Object.values(a));b.push(new Oe(B))}else{let B=new Me({payerKey:this.feePayer,recentBlockhash:d,instructions:[...g]}).compileToV0Message(Object.values(a));b.push(new Oe(B))}f.push(Array.from(new Set(g.map(B=>B.keys.filter(M=>M.isSigner).map(M=>M.pubkey.toString())).flat())).map(B=>p[B]).filter(B=>B!==void 0)),g=[P]}}),g.length>0){let T=[...new Set(g.map(q=>q.keys.filter(O=>O.isSigner).map(O=>O.pubkey.toString())).flat()).values()].map(q=>p[q]).filter(q=>q!==void 0),h=ki[Math.floor(Math.random()*ki.length)],x=Ai.transfer({fromPubkey:this.feePayer,toPubkey:h,lamports:Math.floor(.001*Ti)});if(t&&mt({instructions:[x,...m.instructions,...g],payer:this.feePayer,lookupTableAddressAccount:a,recentBlockhash:d})){console.log("MESSAGE 1");let q=new Me({payerKey:this.feePayer,recentBlockhash:d,instructions:[x,...g]}).compileToV0Message(Object.values(a));b.push(new Oe(q))}else{console.log("MESSAGE 2");let q=new Me({payerKey:this.feePayer,recentBlockhash:d,instructions:[x,...g]}).compileToV0Message(Object.values(a));b.push(new Oe(q))}let B=new Me({payerKey:this.feePayer,recentBlockhash:d,instructions:[x]}).compileToV0Message([]),M=new Oe(B);console.log("\u{1F4E6} Tip-only tx size:",M.serialize().length);let C=new Me({payerKey:this.feePayer,recentBlockhash:d,instructions:[...m.instructions]}).compileToV0Message(Object.values(a)),D=new Oe(C);console.log("\u{1F4E6} computeTx-only tx size:",D.serialize().length),f.push(T);let E=new Me({payerKey:this.feePayer,recentBlockhash:d,instructions:[...g]}).compileToV0Message([]),v=new Oe(E);console.log("\u{1F4E6} instructionTx-only tx size:",v.serialize().length),f.push(T)}return(k=this.owner)!=null&&k.signer&&f.forEach(P=>{P.some(T=>T.publicKey.equals(this.owner.publicKey))||P.push(this.owner.signer)}),b.forEach((P,T)=>{P.sign(f[T]),console.log(`Tx #${T+1} size (bytes):`,P.serialize().length)}),{builder:this,transactions:b,buildProps:e,signers:f,instructionTypes:this.instructionTypes,execute:async P=>{var C;let{sequentially:T,onTxUpdate:h,skipTxCount:x=0,recentBlockHash:B,skipPreflight:M=!0}=P||{};if(b.map(async(D,E)=>{f[E].length&&D.sign(f[E]),B&&(D.message.recentBlockhash=B)}),We(b),console.log("SEND 6"),console.log("sizeCheckBuildV0"),(C=this.owner)!=null&&C.isKeyPair){console.log("send transactions using Helius Sender");for(let D of b);return{txIds:[],signedTxs:[]}}if(this.signAllTransactions){let D=await this.signAllTransactions(b.slice(x,b.length)),E=[...b.slice(0,x),...D];if(T){let v=0,q=[],O=async()=>{if(!E[v])return;if(v<x){q.push({txId:"",status:"success",signedTx:E[v]}),h==null||h([...q]),v++,O();return}let R=await this.connection.sendTransaction(E[v],{skipPreflight:M});q.push({txId:R,status:"sent",signedTx:E[v]}),h==null||h([...q]),v++;let $=!1,me=null,Ee=null,Dn=ve=>{me!==null&&clearInterval(me),Ee!==null&&this.connection.removeSignatureListener(Ee);let Te=q.findIndex(tr=>tr.txId===R);if(Te>-1){if(q[Te].status==="error"||q[Te].status==="success")return;q[Te].status=ve.err?"error":"success"}h==null||h([...q]),ve.err||O()};this.loopMultiTxStatus&&(me=setInterval(async()=>{var ve;if($){clearInterval(me);return}try{let Te=await this.connection.getTransaction(R,{commitment:"confirmed",maxSupportedTransactionVersion:0});Te&&($=!0,clearInterval(me),Dn({err:((ve=Te.meta)==null?void 0:ve.err)||null}),console.log("tx status from getTransaction:",R))}catch(Te){$=!0,clearInterval(me),console.error("getTransaction timeout:",Te,R)}},Wt)),Ee=this.connection.onSignature(R,ve=>{if($){this.connection.removeSignatureListener(Ee);return}$=!0,Dn(ve)},"confirmed"),this.connection.getSignatureStatus(R)};return O(),{txIds:[],signedTxs:E}}else{let v=[];for(let q=0;q<E.length;q+=1){let O=await this.connection.sendTransaction(E[q],{skipPreflight:M});v.push(O)}return{txIds:v,signedTxs:E}}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:s||{}}}};import{PublicKey as nc}from"@solana/web3.js";import rc from"bn.js";import vo from"bn.js";var Vt=new vo(1e6);var _c=ne("Raydium_amount"),Vc=ut(Do);var wn=new ke(0),il=new ke(1),rl=new ke(2),ol=new ke(3),sl=new ke(5),Wo=new ke(10),al=new ke(100),ul=new ke(1e3),cl=new ke(1e4);function hi(n,e,t){return n.mul(e).add(t).sub(new ke(1)).div(t)}function Tn(n,e,t){return n.mul(e).div(t)}import hn from"bn.js";import Xt from"decimal.js-light";import ft from"bn.js";function qt(n,e){if(e.isZero())throw Error("divisor is zero");return n.mod(e)}function _o(n,e){if(e.isZero())throw Error("rhs is zero");let t=n.div(e);if(t.isZero())throw Error("quotient is zero");let i=qt(n,e);return i.gt(Ye)&&(t=t.add(new ft(1)),e=n.div(t),i=qt(n,t),i.gt(Ye)&&(e=e.add(new ft(1)))),[t,e]}var Ye=new ft(0),Ut=class{static swapWithoutFees(e,t,i){let r=t.mul(i),o=t.add(e),[s]=_o(r,o),a=i.sub(s);if(a.isZero())throw Error("destinationAmountSwapped is zero");return{destinationAmountSwapped:a}}static lpTokensToTradingTokens(e,t,i,r,o){let s=e.mul(i).div(t),a=e.mul(r).div(t);if(o===0)return{tokenAmount0:s,tokenAmount1:a};if(o===1)return qt(e.mul(i),t).gt(Ye)&&s.gt(Ye)&&(s=s.add(new ft(1))),qt(e.mul(r),t).gt(Ye)&&a.gt(Ye)&&(a=a.add(new ft(1))),{tokenAmount0:s,tokenAmount1:a};throw Error("roundDirection value error")}};var Gt=class{static tradingFee(e,t){return hi(e,t,Vt)}static protocolFee(e,t){return Tn(e,t,Vt)}static fundFee(e,t){return Tn(e,t,Vt)}};var zt=class{static validate_supply(e,t){if(e.isZero())throw Error("tokenAmount0 is zero");if(t.isZero())throw Error("tokenAmount1 is zero")}static swap(e,t,i,r){let o=Gt.tradingFee(e,r),s=e.sub(o),{destinationAmountSwapped:a}=Ut.swapWithoutFees(s,t,i);return{newSwapDestinationAmount:i.sub(a),sourceAmountSwapped:e,destinationAmountSwapped:a,tradeFee:o}}static swapBaseOut({poolMintA:e,poolMintB:t,tradeFeeRate:i,baseReserve:r,quoteReserve:o,outputMint:s,outputAmount:a}){let[c,u,l,m,d]=t.address===s.toString()?[r,o,e.decimals,t.decimals,e.address]:[o,r,t.decimals,e.decimals,t.address],p=new Xt(u.toString()).div(10**m).div(new Xt(c.toString()).div(10**l)),b=a.gte(u)?u.sub(new hn(1)):a,f=u.sub(b),g=Qe(c.mul(b),f),A=Qe(g.mul(new hn(1e6)),new hn(1e6).sub(i)),w=A.sub(g),k=new Xt(b.toString()).div(10**m).div(new Xt(A.toString()).div(10**l)),P=p.isZero()?0:k.sub(p).div(p).abs().toNumber();return{amountRealOut:b,amountIn:A,amountInWithoutFee:g,tradeFee:w,priceImpact:P}}};import J from"bn.js";var Bn=(...n)=>n.map(e=>{try{return typeof e=="object"?JSON.stringify(e):e}catch{return e}}).join(", "),Je=class{constructor({scope:e,moduleName:t}){this.disabled=!1;this.scope=e,this.logger=ne(t)}createTxBuilder(e){return this.scope.checkOwner(),new _t({connection:this.scope.connection,feePayer:e||this.scope.ownerPubKey,cluster:this.scope.cluster,owner:this.scope.owner,blockhashCommitment:this.scope.blockhashCommitment,loopMultiTxStatus:this.scope.loopMultiTxStatus,api:this.scope.api,signAllTransactions:this.scope.signAllTransactions})}logDebug(...e){this.logger.debug(Bn(e))}logInfo(...e){this.logger.info(Bn(e))}logAndCreateError(...e){let t=Bn(e);throw new Error(t)}checkDisabled(){(this.disabled||!this.scope)&&this.logAndCreateError("module not working")}};import{PublicKey as jo}from"@solana/web3.js";import Si,{isBN as Ci}from"bn.js";import{bits as Ll,BitStructure as Rl,blob as Vo,Blob as Ml,cstr as Ol,f32 as Fl,f32be as El,f64 as vl,f64be as Dl,greedy as Wl,Layout as qo,ns64 as _l,ns64be as Vl,nu64 as ql,nu64be as Ul,offset as Gl,s16 as Xl,s16be as zl,s24 as Hl,s24be as Zl,s32 as Uo,s32be as jl,s40 as Ql,s40be as Yl,s48 as Jl,s48be as $l,s8 as em,seq as Go,struct as tm,Structure as Xo,u16 as zo,u16be as nm,u24 as im,u24be as rm,u32 as om,u32be as sm,u40 as am,u40be as um,u48 as cm,u48be as lm,u8 as Ho,UInt as Zo,union as mm,Union as dm,unionLayoutDiscriminator as pm,utf8 as fm}from"@solana/buffer-layout";var xn=qo,Bi=Xo;var In=Zo;var xi=Ho,Ve=zo;var xe=Uo;var Ii=Go;var se=Vo;var $e=class extends xn{constructor(t,i,r){super(t,r);this.blob=se(t),this.signed=i}decode(t,i=0){let r=new Si(this.blob.decode(t,i),10,"le");return this.signed?r.fromTwos(this.span*8).clone():r}encode(t,i,r=0){return typeof t=="number"&&(t=new Si(t)),this.signed&&(t=t.toTwos(this.span*8)),this.blob.encode(t.toArrayLike(Buffer,"le",this.span),i,r)}};function j(n){return new In(1,n)}function Ie(n){return new In(4,n)}function S(n){return new $e(8,!1,n)}function Y(n){return new $e(16,!1,n)}function Ki(n){return new $e(8,!0,n)}function Ni(n){return new $e(16,!0,n)}var Ht=class extends xn{constructor(t,i,r,o){super(t.span,o);this.layout=t,this.decoder=i,this.encoder=r}decode(t,i){return this.decoder(this.layout.decode(t,i))}encode(t,i,r){return this.layout.encode(this.encoder(t),i,r)}getSpan(t,i){return this.layout.getSpan(t,i)}};function V(n){return new Ht(se(32),e=>new jo(e),e=>e.toBuffer(),n)}function qe(n){return new Ht(xi(),Qo,Yo,n)}function Qo(n){if(n===0)return!1;if(n===1)return!0;throw new Error("Invalid bool: "+n)}function Yo(n){return n?1:0}var Sn=class extends Bi{decode(e,t){return super.decode(e,t)}};function G(n,e,t){return new Sn(n,e,t)}function z(n,e,t){let i,r=typeof e=="number"?e:Ci(e)?e.toNumber():new Proxy(e,{get(o,s){if(!i){let a=Reflect.get(o,"count");i=Ci(a)?a.toNumber():a,Reflect.set(o,"count",i)}return Reflect.get(o,s)},set(o,s,a){return s==="count"&&(i=a),Reflect.set(o,s,a)}});return Ii(n,r,t)}var Cm=G([Ie("mintAuthorityOption"),V("mintAuthority"),S("supply"),j("decimals"),j("isInitialized"),Ie("freezeAuthorityOption"),V("freezeAuthority")]);import{PublicKey as Rm}from"@solana/web3.js";import{MintLayout as Om,TOKEN_PROGRAM_ID as Em}from"@solana/spl-token";var Ue=r=>{var o=r,{address:n,programId:e,decimals:t}=o,i=he(o,["address","programId","decimals"]);return U({chainId:101,address:ot(n).toBase58(),programId:e,logoURI:"",symbol:"",name:"",decimals:t,tags:[],extensions:i.extensions||{}},i)},et=n=>n?Z(U({},n),{transferFeeConfigAuthority:n.transferFeeConfigAuthority.toBase58(),withdrawWithheldAuthority:n.withdrawWithheldAuthority.toBase58(),withheldAmount:n.withheldAmount.toString(),olderTransferFee:Z(U({},n.olderTransferFee),{epoch:n.olderTransferFee.epoch.toString(),maximumFee:n.olderTransferFee.maximumFee.toString()}),newerTransferFee:Z(U({},n.newerTransferFee),{epoch:n.newerTransferFee.epoch.toString(),maximumFee:n.newerTransferFee.maximumFee.toString()})}):void 0;import{PublicKey as Pt,TransactionInstruction as Ge,Keypair as As,SystemProgram as ks}from"@solana/web3.js";import{ASSOCIATED_TOKEN_PROGRAM_ID as Xi,TOKEN_2022_PROGRAM_ID as En,TOKEN_PROGRAM_ID as Fe}from"@solana/spl-token";var Jo=Buffer.from("vault_and_lp_mint_auth_seed","utf8"),Zm=Buffer.from("amm_config","utf8"),$o=Buffer.from("pool","utf8"),es=Buffer.from("pool_lp_mint","utf8"),ts=Buffer.from("pool_vault","utf8"),ns=Buffer.from("observation","utf8");function Zt(n){return fe([Jo],n)}function Cn(n,e,t,i){return fe([$o,e.toBuffer(),t.toBuffer(),i.toBuffer()],n)}function is(n,e){return fe([es,e.toBuffer()],n)}function Li(n,e,t){return fe([ts,e.toBuffer(),t.toBuffer()],n)}function bt(n,e){return fe([ns,e.toBuffer()],n)}function Ri({poolId:n,programId:e,configId:t,mintA:i,mintB:r}){let o=Zt(e).publicKey,s=n||Cn(e,t,i,r).publicKey,a=is(e,s).publicKey,c=Li(e,s,i).publicKey,u=Li(e,s,r).publicKey,l=bt(e,s).publicKey;return{poolId:s,configId:t,authority:o,lpMint:a,vaultA:c,vaultB:u,observationId:l}}var rs=Buffer.from("locked_liquidity","utf8");function jt(n,e){return fe([rs,e.toBuffer()],n)}import{PublicKey as Nf}from"@solana/web3.js";import Rf from"bn.js";import{AccountLayout as Ef,TOKEN_2022_PROGRAM_ID as vf,TOKEN_PROGRAM_ID as Df}from"@solana/spl-token";import{Keypair as nf,PublicKey as rf,SystemProgram as sf,TransactionInstruction as af}from"@solana/web3.js";import cf from"bn.js";import{ASSOCIATED_TOKEN_PROGRAM_ID as df,TOKEN_2022_PROGRAM_ID as pf,TOKEN_PROGRAM_ID as ff}from"@solana/spl-token";import Fp from"bn.js";import le from"bn.js";var Kn=new le(0),Mi=new le(1),Oi=new le(-1),Qt=new le(1).shln(64),Fi=new le(1).shln(128),os=Qt.sub(Mi);var ss=Fi.subn(1),tt=-443636,gt=-tt,Nn=new le("4295048016"),Ln=new le("79226673521066979257578248091"),Ym=new le("4295048017"),Jm=new le("79226673521066979257578248090");var as=new le(10).pow(new le(6));var $m=new le("18446744073700000000");import kp from"bn.js";var sd=Buffer.from("amm_config","utf8"),ad=Buffer.from("pool","utf8"),ud=Buffer.from("pool_vault","utf8"),cd=Buffer.from("pool_reward_vault","utf8"),ld=Buffer.from("position","utf8"),md=Buffer.from("tick_array","utf8"),dd=Buffer.from("operation","utf8"),pd=Buffer.from("pool_tick_array_bitmap_extension","utf8"),fd=Buffer.from("observation","utf8");function Rn(n){return fe([Buffer.from("metadata","utf8"),Ze.toBuffer(),n.toBuffer()],Ze)}var bd=Buffer.from("locked_position","utf8");var gd=Buffer.from("support_mint","utf8");import{PublicKey as jd}from"@solana/web3.js";import{TOKEN_2022_PROGRAM_ID as Yd}from"@solana/spl-token";import $d from"bn.js";import Pd from"bn.js";var Fn=14;var Yt=60;var ms=G([se(8),j("bump"),Ve("index"),V(""),Ie("protocolFeeRate"),Ie("tradeFeeRate"),Ve("tickSpacing"),z(S(),8,"")]),ds=G([Ie("blockTimestamp"),Ki("tickCumulative"),z(S(),4)]),Gi=G([se(8),qe("initialized"),S("recentEpoch"),Ve("observationIndex"),V("poolId"),z(ds,100,"observations"),z(S(),4)]),ps=G([j("rewardState"),S("openTime"),S("endTime"),S("lastUpdateTime"),Y("emissionsPerSecondX64"),S("rewardTotalEmissioned"),S("rewardClaimed"),V("tokenMint"),V("tokenVault"),V("creator"),Y("rewardGrowthGlobalX64")]),Vi=G([se(8),j("bump"),V("ammConfig"),V("creator"),V("mintA"),V("mintB"),V("vaultA"),V("vaultB"),V("observationId"),j("mintDecimalsA"),j("mintDecimalsB"),Ve("tickSpacing"),Y("liquidity"),Y("sqrtPriceX64"),xe("tickCurrent"),Ie(),Y("feeGrowthGlobalX64A"),Y("feeGrowthGlobalX64B"),S("protocolFeesTokenA"),S("protocolFeesTokenB"),Y("swapInAmountTokenA"),Y("swapOutAmountTokenB"),Y("swapInAmountTokenB"),Y("swapOutAmountTokenA"),j("status"),z(j(),7,""),z(ps,3,"rewardInfos"),z(S(),16,"tickArrayBitmap"),S("totalFeesTokenA"),S("totalFeesClaimedTokenA"),S("totalFeesTokenB"),S("totalFeesClaimedTokenB"),S("fundFeesTokenA"),S("fundFeesTokenB"),S("startTime"),z(S(),15*4-3,"padding")]),fs=G([Y("growthInsideLastX64"),S("rewardAmountOwed")]),qi=G([se(8),j("bump"),V("nftMint"),V("poolId"),xe("tickLower"),xe("tickUpper"),Y("liquidity"),Y("feeGrowthInsideLastX64A"),Y("feeGrowthInsideLastX64B"),S("tokenFeesOwedA"),S("tokenFeesOwedB"),z(fs,3,"rewardInfos"),z(S(),8,"")]),Xp=G([se(8),j("bump"),V("poolId"),xe("tickLowerIndex"),xe("tickUpperIndex"),Y("liquidity"),Y("feeGrowthInsideLastX64A"),Y("feeGrowthInsideLastX64B"),S("tokenFeesOwedA"),S("tokenFeesOwedB"),z(Y(),3,"rewardGrowthInside"),z(S(),8,"")]),bs=G([xe("tick"),Ni("liquidityNet"),Y("liquidityGross"),Y("feeGrowthOutsideX64A"),Y("feeGrowthOutsideX64B"),z(Y(),3,"rewardGrowthsOutsideX64"),z(Ie(),13,"")]),Di=G([se(8),V("poolId"),xe("startTickIndex"),z(bs,Yt,"ticks"),j("initializedTickCount"),z(j(),115,"")]),gs=G([se(329),z(V(),100,"whitelistMints")]),ls=G([se(8),V("poolId"),z(z(S(),8),Fn,"positiveTickArrayBitmap"),z(z(S(),8),Fn,"negativeTickArrayBitmap")]),zp=G([S(),j("bump"),V("owner"),V("poolId"),V("positionId"),V("nftAccount"),z(S(),8)]),Hp=G([se(8),j("bump"),V("lockOwner"),V("poolId"),V("positionId"),V("nftAccount"),V("lockNftMint"),S("recentEpoch"),z(S(),8)]);Gi.span;var hf=ne("Raydium_Clmm");var Ts=ne("Raydium_cpmm"),Xe={initialize:[175,175,109,31,13,152,155,237],deposit:[242,35,198,137,82,225,242,182],withdraw:[183,18,70,156,148,109,161,34],swapBaseInput:[143,190,90,218,196,30,51,222],swapBaseOutput:[55,217,98,86,163,74,180,173],lockCpLiquidity:[216,157,29,78,38,51,31,26],collectCpFee:[8,30,51,199,209,184,247,133]};function zi(n,e,t,i,r,o,s,a,c,u,l,m,d,p,b,f,g,A,w,k){let P=G([S("amountMaxA"),S("amountMaxB"),S("openTime")]),T=Cn(n,t,o,s).publicKey,h=[{pubkey:e,isSigner:!0,isWritable:!1},{pubkey:t,isSigner:!1,isWritable:!1},{pubkey:i,isSigner:!1,isWritable:!1},{pubkey:r,isSigner:!r.equals(T),isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!1},{pubkey:s,isSigner:!1,isWritable:!1},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:m,isSigner:!1,isWritable:!0},{pubkey:d,isSigner:!1,isWritable:!0},{pubkey:p,isSigner:!1,isWritable:!0},{pubkey:g,isSigner:!1,isWritable:!0},{pubkey:Fe,isSigner:!1,isWritable:!1},{pubkey:b,isSigner:!1,isWritable:!1},{pubkey:f,isSigner:!1,isWritable:!1},{pubkey:Xi,isSigner:!1,isWritable:!1},{pubkey:ci,isSigner:!1,isWritable:!1},{pubkey:Kt,isSigner:!1,isWritable:!1}],x=Buffer.alloc(P.span);return P.encode({amountMaxA:A,amountMaxB:w,openTime:k},x),new Ge({keys:h,programId:n,data:Buffer.from([...Xe.initialize,...x])})}function Hi(n,e,t,i,r,o,s,a,c,u,l,m,d,p,b){let f=G([S("lpAmount"),S("amountMaxA"),S("amountMaxB")]),g=[{pubkey:e,isSigner:!0,isWritable:!1},{pubkey:t,isSigner:!1,isWritable:!1},{pubkey:i,isSigner:!1,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:Fe,isSigner:!1,isWritable:!1},{pubkey:En,isSigner:!1,isWritable:!1},{pubkey:u,isSigner:!1,isWritable:!1},{pubkey:l,isSigner:!1,isWritable:!1},{pubkey:m,isSigner:!1,isWritable:!0}],A=Buffer.alloc(f.span);return Ts.debug("cpmm deposit data",{lpAmount:d.toString(),amountMaxA:p.toString(),amountMaxB:b.toString()}),f.encode({lpAmount:d,amountMaxA:p,amountMaxB:b},A),new Ge({keys:g,programId:n,data:Buffer.from([...Xe.deposit,...A])})}function Zi(n,e,t,i,r,o,s,a,c,u,l,m,d,p,b){let f=G([S("lpAmount"),S("amountMinA"),S("amountMinB")]),g=[{pubkey:e,isSigner:!0,isWritable:!1},{pubkey:t,isSigner:!1,isWritable:!1},{pubkey:i,isSigner:!1,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:Fe,isSigner:!1,isWritable:!1},{pubkey:En,isSigner:!1,isWritable:!1},{pubkey:u,isSigner:!1,isWritable:!1},{pubkey:l,isSigner:!1,isWritable:!1},{pubkey:m,isSigner:!1,isWritable:!0},{pubkey:Ct,isSigner:!1,isWritable:!1}],A=Buffer.alloc(f.span);return f.encode({lpAmount:d,amountMinA:p,amountMinB:b},A),new Ge({keys:g,programId:n,data:Buffer.from([...Xe.withdraw,...A])})}function ji(n,e,t,i,r,o,s,a,c,u,l,m,d,p,b,f){let g=G([S("amountIn"),S("amounOutMin")]),A=[{pubkey:e,isSigner:!0,isWritable:!1},{pubkey:t,isSigner:!1,isWritable:!1},{pubkey:i,isSigner:!1,isWritable:!1},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!1},{pubkey:l,isSigner:!1,isWritable:!1},{pubkey:m,isSigner:!1,isWritable:!1},{pubkey:d,isSigner:!1,isWritable:!1},{pubkey:p,isSigner:!1,isWritable:!0}],w=Buffer.alloc(g.span);return g.encode({amountIn:b,amounOutMin:f},w),new Ge({keys:A,programId:n,data:Buffer.from([...Xe.swapBaseInput,...w])})}function Qi(n,e,t,i,r,o,s,a,c,u,l,m,d,p,b,f){let g=G([S("amountInMax"),S("amountOut")]),A=[{pubkey:e,isSigner:!0,isWritable:!1},{pubkey:t,isSigner:!1,isWritable:!1},{pubkey:i,isSigner:!1,isWritable:!1},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!1},{pubkey:l,isSigner:!1,isWritable:!1},{pubkey:m,isSigner:!1,isWritable:!1},{pubkey:d,isSigner:!1,isWritable:!1},{pubkey:p,isSigner:!1,isWritable:!0}],w=Buffer.alloc(g.span);return g.encode({amountInMax:b,amountOut:f},w),new Ge({keys:A,programId:n,data:Buffer.from([...Xe.swapBaseOutput,...w])})}async function Yi(n){var g;let{ownerInfo:e,poolInfo:t,poolKeys:i,feeNftOwner:r,getEphemeralSigners:o}=n,s=[],[a,c]=[new Pt(t.id),new Pt(t.lpMint.address)],u;if(o)u=new Pt((await o(1))[0]);else{let A=As.generate();s.push(A),u=A.publicKey}let{publicKey:l}=Pe(r,u,Fe),{publicKey:m}=Rn(u),{publicKey:d}=jt(n.lockProgram,u),{publicKey:p}=Pe(e.wallet,c,Fe),{publicKey:b}=Pe(n.lockAuthProgram,c,Fe),f=hs({programId:n.lockProgram,auth:n.lockAuthProgram,payer:e.feePayer,liquidityOwner:e.wallet,nftOwner:r,nftMint:u,nftAccount:l,poolId:a,lockPda:d,mintLp:c,userLpVault:p,lockLpVault:b,poolVaultA:new Pt(i.vault.A),poolVaultB:new Pt(i.vault.B),metadataAccount:m,lpAmount:n.lpAmount,withMetadata:(g=n.withMetadata)!=null?g:!0});return{address:{nftMint:u,nftAccount:l,metadataAccount:m,lockPda:d,userLpVault:p,lockLpVault:b},instructions:[f],signers:s,instructionTypes:[oe.CpmmLockLp],lookupTableAddress:[]}}function hs({programId:n,auth:e,payer:t,liquidityOwner:i,nftOwner:r,nftMint:o,nftAccount:s,poolId:a,lockPda:c,mintLp:u,userLpVault:l,lockLpVault:m,poolVaultA:d,poolVaultB:p,metadataAccount:b,lpAmount:f,withMetadata:g}){let A=[{pubkey:e,isSigner:!1,isWritable:!1},{pubkey:t,isSigner:!0,isWritable:!0},{pubkey:i,isSigner:!0,isWritable:!1},{pubkey:r,isSigner:!1,isWritable:!1},{pubkey:o,isSigner:!0,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!1},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!1},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:m,isSigner:!1,isWritable:!0},{pubkey:d,isSigner:!1,isWritable:!0},{pubkey:p,isSigner:!1,isWritable:!0},{pubkey:b,isSigner:!1,isWritable:!0},{pubkey:Kt,isSigner:!1,isWritable:!1},{pubkey:ks.programId,isSigner:!1,isWritable:!1},{pubkey:Fe,isSigner:!1,isWritable:!1},{pubkey:Xi,isSigner:!1,isWritable:!1},{pubkey:Ze,isSigner:!1,isWritable:!1}],w=G([S("lpAmount"),qe("withMetadata")]),k=Buffer.alloc(w.span);w.encode({lpAmount:f,withMetadata:g},k);let P=Buffer.from([...Xe.lockCpLiquidity,...k]);return new Ge({keys:A,programId:n,data:P})}function Ji({programId:n,nftOwner:e,auth:t,nftAccount:i,lockPda:r,poolId:o,mintLp:s,userVaultA:a,userVaultB:c,poolVaultA:u,poolVaultB:l,mintA:m,mintB:d,lockLpVault:p,lpFeeAmount:b,cpmmProgram:f,cpmmAuthProgram:g}){let A=[{pubkey:t,isSigner:!1,isWritable:!1},{pubkey:e,isSigner:!0,isWritable:!1},{pubkey:i,isSigner:!1,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:f!=null?f:yi,isSigner:!1,isWritable:!1},{pubkey:g!=null?g:wi,isSigner:!1,isWritable:!1},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:m,isSigner:!1,isWritable:!1},{pubkey:d,isSigner:!1,isWritable:!1},{pubkey:p,isSigner:!1,isWritable:!0},{pubkey:Fe,isSigner:!1,isWritable:!1},{pubkey:En,isSigner:!1,isWritable:!1},{pubkey:Ct,isSigner:!1,isWritable:!1}],w=G([S("lpFeeAmount")]),k=Buffer.alloc(w.span);w.encode({lpFeeAmount:b},k);let P=Buffer.from([...Xe.collectCpFee,...k]);return new Ge({keys:A,programId:n,data:P})}var $i=G([se(8),j("bump"),qe("disableCreatePool"),Ve("index"),S("tradeFeeRate"),S("protocolFeeRate"),S("fundFeeRate"),S("createPoolFee"),V("protocolOwner"),V("fundOwner"),z(S(),16)]),er=G([se(8),V("configId"),V("poolCreator"),V("vaultA"),V("vaultB"),V("mintLp"),V("mintA"),V("mintB"),V("mintProgramA"),V("mintProgramB"),V("observationId"),j("bump"),j("status"),j("lpDecimals"),j("mintDecimalA"),j("mintDecimalB"),S("lpAmount"),S("protocolFeesMintA"),S("protocolFeesMintB"),S("fundFeesMintA"),S("fundFeesMintB"),S("openTime"),z(S(),32)]);var vn=class extends Je{constructor(e){super(e)}async load(){this.checkDisabled()}async getCpmmPoolKeys(e){return(await this.scope.api.fetchPoolKeysById({idList:[e]}))[0]}async getRpcPoolInfo(e,t){return(await this.getRpcPoolInfos([e],t))[e]}async getRpcPoolInfos(e,t){let i=await De(this.scope.connection,e.map(m=>({pubkey:new I(m)}))),r={},o=new Set,s=[];for(let m=0;m<e.length;m++){let d=i[m];if(d.accountInfo===null)throw Error("fetch pool info error: "+String(e[m]));let p=er.decode(d.accountInfo.data);r[String(e[m])]=Z(U({},p),{programId:d.accountInfo.owner}),o.add(String(p.configId)),s.push(p.vaultA,p.vaultB)}let a={};if(t){let m=[...o],d=await De(this.scope.connection,m.map(p=>({pubkey:new I(p)})));for(let p=0;p<m.length;p++){let b=d[p].accountInfo;if(b===null)throw Error("fetch pool config error: "+m[p]);a[m[p]]=$i.decode(b.data)}}let c={},u=await De(this.scope.connection,s.map(m=>({pubkey:new I(m)})));for(let m=0;m<s.length;m++){let d=u[m].accountInfo;if(d===null)throw Error("fetch vault info error: "+s[m]);c[String(s[m])]=new J(Bs.decode(d.data).amount.toString())}let l={};for(let[m,d]of Object.entries(r)){let p=c[d.vaultA.toString()].sub(d.protocolFeesMintA).sub(d.fundFeesMintA),b=c[d.vaultB.toString()].sub(d.protocolFeesMintB).sub(d.fundFeesMintB);l[m]=Z(U({},d),{baseReserve:p,quoteReserve:b,vaultAAmount:c[d.vaultA.toString()],vaultBAmount:c[d.vaultB.toString()],configInfo:a[d.configId.toString()],poolPrice:new te(b.toString()).div(new te(10).pow(d.mintDecimalB)).div(new te(p.toString()).div(new te(10).pow(d.mintDecimalA)))})}return l}toComputePoolInfos({pools:e,mintInfos:t}){return Object.keys(e).reduce((i,r)=>{var c,u,l,m;let o=e[r],[s,a]=[o.mintA.toBase58(),o.mintB.toBase58()];return Z(U({},i),{[r]:Z(U({},o),{id:new I(r),configInfo:o.configInfo,version:7,authority:Zt(o.programId).publicKey,mintA:Ue({address:s,decimals:o.mintDecimalA,programId:o.mintProgramA.toBase58(),extensions:{feeConfig:(c=t[s])!=null&&c.feeConfig?et((u=t[s])==null?void 0:u.feeConfig):void 0}}),mintB:Ue({address:a,decimals:o.mintDecimalB,programId:o.mintProgramB.toBase58(),extensions:{feeConfig:(l=t[a])!=null&&l.feeConfig?et((m=t[a])==null?void 0:m.feeConfig):void 0}})})})},{})}async getPoolInfoFromRpc(e){let t=await this.getRpcPoolInfo(e,!0),i=await cn({connection:this.scope.connection,mints:[t.mintA,t.mintB]}),r=Ue({address:t.mintA.toBase58(),decimals:t.mintDecimalA,programId:t.mintProgramA.toBase58(),extensions:{feeConfig:i[t.mintA.toBase58()].feeConfig?et(i[t.mintA.toBase58()].feeConfig):void 0}}),o=Ue({address:t.mintB.toBase58(),decimals:t.mintDecimalB,programId:t.mintProgramB.toBase58(),extensions:{feeConfig:i[t.mintB.toBase58()].feeConfig?et(i[t.mintB.toBase58()].feeConfig):void 0}}),s=Ue({address:t.mintLp.toBase58(),decimals:t.lpDecimals,programId:ge.toBase58()}),a={id:t.configId.toBase58(),index:t.configInfo.index,protocolFeeRate:t.configInfo.protocolFeeRate.toNumber(),tradeFeeRate:t.configInfo.tradeFeeRate.toNumber(),fundFeeRate:t.configInfo.fundFeeRate.toNumber(),createPoolFee:t.configInfo.createPoolFee.toString()},c={volume:0,volumeQuote:0,volumeFee:0,apr:0,feeApr:0,priceMin:0,priceMax:0,rewardApr:[]};return{poolInfo:{programId:t.programId.toBase58(),id:e,type:"Standard",lpMint:s,lpPrice:0,lpAmount:t.lpAmount.toNumber(),config:a,mintA:r,mintB:o,rewardDefaultInfos:[],rewardDefaultPoolInfos:"Ecosystem",price:t.poolPrice.toNumber(),mintAmountA:new te(t.vaultAAmount.toString()).div(10**r.decimals).toNumber(),mintAmountB:new te(t.vaultBAmount.toString()).div(10**o.decimals).toNumber(),feeRate:t.configInfo.tradeFeeRate.toNumber(),openTime:t.openTime.toString(),tvl:0,burnPercent:0,day:c,week:c,month:c,pooltype:[],farmUpcomingCount:0,farmOngoingCount:0,farmFinishedCount:0},poolKeys:{programId:t.programId.toBase58(),id:e,mintA:r,mintB:o,openTime:t.openTime.toString(),vault:{A:t.vaultA.toBase58(),B:t.vaultB.toBase58()},authority:Zt(t.programId).publicKey.toBase58(),mintLp:s,config:a,observationId:bt(t.programId,new I(e)).publicKey.toBase58()},rpcData:t}}async createPool(b){var f=b,{poolId:e,programId:t,poolFeeAccount:i,startTime:r,ownerInfo:o,associatedOnly:s=!1,checkCreateATAOwner:a=!1,txVersion:c,feeConfig:u,computeBudgetConfig:l,txTipConfig:m,feePayer:d}=f,p=he(f,["poolId","programId","poolFeeAccount","startTime","ownerInfo","associatedOnly","checkCreateATAOwner","txVersion","feeConfig","computeBudgetConfig","txTipConfig","feePayer"]);var R,$,me;let g=o.feePayer||((R=this.scope.owner)==null?void 0:R.publicKey),A=new J(new I(p.mintA.address).toBuffer()).lte(new J(new I(p.mintB.address).toBuffer())),[w,k]=A?[p.mintA,p.mintB]:[p.mintB,p.mintA],[P,T]=A?[p.mintAAmount,p.mintBAmount]:[p.mintBAmount,p.mintAAmount],h=o.useSOLBalance&&w.address===Jt.toBase58(),x=o.useSOLBalance&&k.address===Jt.toBase58(),[B,M]=[new I(w.address),new I(k.address)],C=this.createTxBuilder(d),{account:D,instructionParams:E}=await this.scope.account.getOrCreateTokenAccount({mint:B,tokenProgram:w.programId,owner:this.scope.ownerPubKey,createInfo:h?{payer:g,amount:P}:void 0,notUseTokenAccount:h,skipCloseAccount:!h,associatedOnly:h?!1:s,checkCreateATAOwner:a});C.addInstruction(E||{});let{account:v,instructionParams:q}=await this.scope.account.getOrCreateTokenAccount({mint:new I(k.address),tokenProgram:k.programId,owner:this.scope.ownerPubKey,createInfo:x?{payer:g,amount:T}:void 0,notUseTokenAccount:x,skipCloseAccount:!x,associatedOnly:x?!1:s,checkCreateATAOwner:a});if(C.addInstruction(q||{}),D===void 0||v===void 0)throw Error("you don't has some token account");let O=Ri({poolId:e,programId:t,configId:new I(u.id),mintA:B,mintB:M});return C.addInstruction({instructions:[zi(t,this.scope.ownerPubKey,new I(u.id),O.authority,O.poolId,B,M,O.lpMint,D,v,Pe(this.scope.ownerPubKey,O.lpMint).publicKey,O.vaultA,O.vaultB,i,new I(($=w.programId)!=null?$:ge),new I((me=k.programId)!=null?me:ge),O.observationId,P,T,r)],instructionTypes:[oe.CpmmCreatePool]}),C.addCustomComputeBudget(l),C.addTipInstruction(m),C.versionBuild({txVersion:c,extInfo:{address:Z(U({},O),{mintA:w,mintB:k,programId:t,poolFeeAccount:i,feeConfig:u})}})}async addLiquidity(e){let{poolInfo:t,poolKeys:i,inputAmount:r,baseIn:o,slippage:s,computeResult:a,computeBudgetConfig:c,txTipConfig:u,config:l,txVersion:m,feePayer:d}=e;this.scope.availability.addStandardPosition===!1&&this.logAndCreateError("add liquidity feature disabled in your region"),r.isZero()&&this.logAndCreateError("amounts must greater than zero","amountInA",{amountInA:r.toString()});let{account:p}=this.scope,{bypassAssociatedCheck:b,checkCreateATAOwner:f}=U({bypassAssociatedCheck:!1,checkCreateATAOwner:!1},l),g=a?void 0:await this.getRpcPoolInfo(t.id),{liquidity:A,inputAmountFee:w,anotherAmount:k}=a||this.computePairAmount({poolInfo:Z(U({},t),{lpAmount:new te(g.lpAmount.toString()).div(10**t.lpMint.decimals).toNumber()}),baseReserve:g.baseReserve,quoteReserve:g.quoteReserve,slippage:new ce(0),baseIn:o,epochInfo:await this.scope.fetchEpochInfo(),amount:new te(r.toString()).div(10**(o?t.mintA.decimals:t.mintB.decimals))}),P=k.amount,T=t.mintA.address===Jt.toString(),h=t.mintB.address===Jt.toString(),x=this.createTxBuilder(d),[B,M]=[new I(t.mintA.address),new I(t.mintB.address)],{account:C,instructionParams:D}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:t.mintA.programId,mint:new I(t.mintA.address),owner:this.scope.ownerPubKey,createInfo:T||(o?r:P).isZero()?{payer:this.scope.ownerPubKey,amount:o?r:P}:void 0,skipCloseAccount:!T,notUseTokenAccount:T,associatedOnly:!1,checkCreateATAOwner:f});x.addInstruction(D||{});let{account:E,instructionParams:v}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:t.mintB.programId,mint:new I(t.mintB.address),owner:this.scope.ownerPubKey,createInfo:h||(o?P:r).isZero()?{payer:this.scope.ownerPubKey,amount:o?P:r}:void 0,skipCloseAccount:!h,notUseTokenAccount:h,associatedOnly:!1,checkCreateATAOwner:f});x.addInstruction(v||{}),!C&&!E&&this.logAndCreateError("cannot found target token accounts","tokenAccounts",p.tokenAccounts);let q=await p.getCreatedTokenAccount({mint:new I(t.lpMint.address)}),Ee=await p.handleTokenAccount({side:"out",amount:0,mint:new I(t.lpMint.address),tokenAccount:q,bypassAssociatedCheck:b,checkCreateATAOwner:f}),{tokenAccount:O}=Ee,R=he(Ee,["tokenAccount"]);x.addInstruction(R);let $=i!=null?i:await this.getCpmmPoolKeys(t.id),me=new ce(new J(1)).sub(s);return x.addInstruction({instructions:[Hi(new I(t.programId),this.scope.ownerPubKey,new I($.authority),new I(t.id),O,C,E,new I($.vault.A),new I($.vault.B),B,M,new I(t.lpMint.address),a?a==null?void 0:a.liquidity:me.mul(A).quotient,o?w.amount:P,o?P:w.amount)],instructionTypes:[oe.CpmmAddLiquidity],lookupTableAddress:$.lookupTableAccount?[$.lookupTableAccount]:[]}),x.addCustomComputeBudget(c),x.addTipInstruction(u),x.versionBuild({txVersion:m})}async withdrawLiquidity(e){var R,$;let{poolInfo:t,poolKeys:i,lpAmount:r,slippage:o,computeBudgetConfig:s,txTipConfig:a,txVersion:c,feePayer:u,closeWsol:l=!0}=e;this.scope.availability.addStandardPosition===!1&&this.logAndCreateError("add liquidity feature disabled in your region");let m=new ce(new J(1)).sub(o),d=await this.getRpcPoolInfo(t.id),[p,b]=[m.mul(r.mul(d.baseReserve).div(d.lpAmount)).quotient,m.mul(r.mul(d.quoteReserve).div(d.lpAmount)).quotient],f=await this.scope.fetchEpochInfo(),[g,A]=[Ae(p,t.mintA.extensions.feeConfig,f,!1),Ae(b,t.mintB.extensions.feeConfig,f,!1)],{account:w}=this.scope,k=this.createTxBuilder(u),[P,T]=[new I(t.mintA.address),new I(t.mintB.address)],h=P.equals(ue),x=T.equals(ue),B,M,{account:C,instructionParams:D}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:t.mintA.programId,mint:new I(t.mintA.address),notUseTokenAccount:h,owner:this.scope.ownerPubKey,createInfo:{payer:this.scope.ownerPubKey,amount:0},skipCloseAccount:!(h&&l),associatedOnly:!h,checkCreateATAOwner:!1});B=C,D&&k.addInstruction(D);let{account:E,instructionParams:v}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:t.mintB.programId,mint:new I(t.mintB.address),notUseTokenAccount:x,owner:this.scope.ownerPubKey,createInfo:{payer:this.scope.ownerPubKey,amount:0},skipCloseAccount:!(x&&l),associatedOnly:!x,checkCreateATAOwner:!1});M=E,v&&k.addInstruction(v),(!B||!M)&&this.logAndCreateError("cannot found target token accounts","tokenAccounts",w.tokenAccounts);let q=await w.getCreatedTokenAccount({mint:new I(t.lpMint.address)});q||this.logAndCreateError("cannot found lp token account","tokenAccounts",w.tokenAccounts);let O=i!=null?i:await this.getCpmmPoolKeys(t.id);return k.addInstruction({instructions:[Zi(new I(t.programId),this.scope.ownerPubKey,new I(O.authority),new I(t.id),q,B,M,new I(O.vault.A),new I(O.vault.B),P,T,new I(t.lpMint.address),r,p.sub((R=g.fee)!=null?R:new J(0)),b.sub(($=A.fee)!=null?$:new J(0)))],instructionTypes:[oe.CpmmWithdrawLiquidity],lookupTableAddress:O.lookupTableAccount?[O.lookupTableAccount]:[]}),k.addCustomComputeBudget(s),k.addTipInstruction(a),k.versionBuild({txVersion:c})}async swap(e){var D,E,v,q,O,R;let{poolInfo:t,poolKeys:i,baseIn:r,fixedOut:o,inputAmount:s,swapResult:a,slippage:c=0,config:u,computeBudgetConfig:l,txTipConfig:m,txVersion:d,feePayer:p}=e,{bypassAssociatedCheck:b,checkCreateATAOwner:f,associatedOnly:g}=U({bypassAssociatedCheck:!1,checkCreateATAOwner:!1,associatedOnly:!0},u),A=this.createTxBuilder(p),[w,k]=[new I(t.mintA.address),new I(t.mintB.address)];o?a.sourceAmountSwapped=a.sourceAmountSwapped.mul(new J((1+c)*1e4)).div(new J(1e4)):a.destinationAmountSwapped=a.destinationAmountSwapped.mul(new J((1-c)*1e4)).div(new J(1e4));let P=t.mintA.address===ue.toBase58(),T=t.mintB.address===ue.toBase58(),{account:h,instructionParams:x}=await this.scope.account.getOrCreateTokenAccount({mint:w,tokenProgram:new I((D=t.mintA.programId)!=null?D:ge),owner:this.scope.ownerPubKey,createInfo:P||!r?{payer:this.scope.ownerPubKey,amount:r?a.sourceAmountSwapped:0}:void 0,notUseTokenAccount:P,skipCloseAccount:!P,associatedOnly:P?!1:g,checkCreateATAOwner:f});x&&A.addInstruction(x);let{account:B,instructionParams:M}=await this.scope.account.getOrCreateTokenAccount({mint:k,tokenProgram:new I((E=t.mintB.programId)!=null?E:ge),owner:this.scope.ownerPubKey,createInfo:T||r?{payer:this.scope.ownerPubKey,amount:r?0:a.sourceAmountSwapped}:void 0,notUseTokenAccount:T,skipCloseAccount:!T,associatedOnly:T?!1:g,checkCreateATAOwner:f});M&&A.addInstruction(M),(!h||!B)&&this.logAndCreateError("user do not have token account",{mintA:t.mintA.symbol||t.mintA.address,mintB:t.mintB.symbol||t.mintB.address,mintATokenAcc:h,mintBTokenAcc:B,mintAUseSOLBalance:P,mintBUseSOLBalance:T,associatedOnly:g});let C=i!=null?i:await this.getCpmmPoolKeys(t.id);return A.addInstruction({instructions:[o?Qi(new I(t.programId),this.scope.ownerPubKey,new I(C.authority),new I(C.config.id),new I(t.id),r?h:B,r?B:h,new I(C.vault[r?"A":"B"]),new I(C.vault[r?"B":"A"]),new I((O=t[r?"mintA":"mintB"].programId)!=null?O:ge),new I((R=t[r?"mintB":"mintA"].programId)!=null?R:ge),r?w:k,r?k:w,bt(new I(t.programId),new I(t.id)).publicKey,a.sourceAmountSwapped,a.destinationAmountSwapped):ji(new I(t.programId),this.scope.ownerPubKey,new I(C.authority),new I(C.config.id),new I(t.id),r?h:B,r?B:h,new I(C.vault[r?"A":"B"]),new I(C.vault[r?"B":"A"]),new I((v=t[r?"mintA":"mintB"].programId)!=null?v:ge),new I((q=t[r?"mintB":"mintA"].programId)!=null?q:ge),r?w:k,r?k:w,bt(new I(t.programId),new I(t.id)).publicKey,s,a.destinationAmountSwapped)],instructionTypes:[o?oe.CpmmSwapBaseOut:oe.ClmmSwapBaseIn]}),A.addCustomComputeBudget(l),A.addTipInstruction(m),A.versionBuild({txVersion:d})}async lockLp(e){var d,p,b,f,g;let{poolInfo:t,lpAmount:i,computeBudgetConfig:r,txTipConfig:o,txVersion:s,feePayer:a,feeNftOwner:c}=e;i.isZero()&&this.logAndCreateError("lpAmount must greater than zero",{lpAmount:i.toString()});let u=this.createTxBuilder(a),l=(d=e.poolKeys)!=null?d:await this.getCpmmPoolKeys(t.id),m=await Yi({poolInfo:t,poolKeys:l,ownerInfo:{wallet:this.scope.ownerPubKey,feePayer:(p=e.feePayer)!=null?p:this.scope.ownerPubKey},feeNftOwner:c!=null?c:this.scope.ownerPubKey,lockProgram:(b=e.programId)!=null?b:Ft,lockAuthProgram:(f=e.authProgram)!=null?f:Et,lpAmount:i,withMetadata:(g=e.withMetadata)!=null?g:!0,getEphemeralSigners:e.getEphemeralSigners});return u.addInstruction(m),u.addCustomComputeBudget(r),u.addTipInstruction(o),u.versionBuild({txVersion:s,extInfo:m.address})}async harvestLockLp(e){var E;let{poolInfo:t,lpFeeAmount:i,nftMint:r,programId:o=Ft,authProgram:s=Et,cpmmProgram:a,computeBudgetConfig:c,txTipConfig:u,txVersion:l,closeWsol:m=!0}=e;i.isZero()&&this.logAndCreateError("lpFeeAmount must greater than zero",{lpAmount:i.toString()});let d=e.feePayer||this.scope.ownerPubKey,p=this.createTxBuilder(d),[b,f]=[new I(t.mintA.address),new I(t.mintB.address)],g=b.equals(ue),A=f.equals(ue),w,k,{account:P,instructionParams:T}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:t.mintA.programId,mint:new I(t.mintA.address),notUseTokenAccount:g,owner:this.scope.ownerPubKey,createInfo:{payer:this.scope.ownerPubKey,amount:0},skipCloseAccount:!(g&&m),associatedOnly:!g,checkCreateATAOwner:!1});w=P,T&&p.addInstruction(T);let{account:h,instructionParams:x}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:t.mintB.programId,mint:new I(t.mintB.address),notUseTokenAccount:A,owner:this.scope.ownerPubKey,createInfo:{payer:this.scope.ownerPubKey,amount:0},skipCloseAccount:!(A&&m),associatedOnly:!A,checkCreateATAOwner:!1});k=h,x&&p.addInstruction(x),(!w||!k)&&this.logAndCreateError("cannot found target token accounts",{tokenAccountA:w,tokenAccountB:k});let B=(E=e.poolKeys)!=null?E:await this.getCpmmPoolKeys(t.id),{publicKey:M}=Pe(d,r,ge),{publicKey:C}=jt(o,r),{publicKey:D}=Pe(s,new I(t.lpMint.address),ge);return p.addInstruction({instructions:[Ji({programId:o!=null?o:Ft,nftOwner:this.scope.ownerPubKey,auth:s!=null?s:Et,nftMint:r,nftAccount:M,lockPda:C,poolId:new I(t.id),mintLp:new I(B.mintLp.address),userVaultA:w,userVaultB:k,poolVaultA:new I(B.vault.A),poolVaultB:new I(B.vault.B),mintA:b,mintB:f,lockLpVault:D,lpFeeAmount:i,cpmmProgram:a==null?void 0:a.programId,cpmmAuthProgram:a==null?void 0:a.authProgram})],instructionTypes:[oe.CpmmCollectLockFee]}),p.addCustomComputeBudget(c),p.addTipInstruction(u),p.versionBuild({txVersion:l})}computeSwapAmount({pool:e,amountIn:t,outputMint:i,slippage:r}){let o=i.toString()===e.mintB.address,s=zt.swap(t,o?e.baseReserve:e.quoteReserve,o?e.quoteReserve:e.baseReserve,e.configInfo.tradeFeeRate),a=new te(s.destinationAmountSwapped.toString()).div(s.sourceAmountSwapped.toString()),c=s.destinationAmountSwapped.mul(new J((1-r)*1e4)).div(new J(1e4));return{allTrade:s.sourceAmountSwapped.eq(t),amountIn:t,amountOut:s.destinationAmountSwapped,minAmountOut:c,executionPrice:a,fee:s.tradeFee,priceImpact:e.poolPrice.sub(a).div(e.poolPrice)}}computePairAmount({poolInfo:e,baseReserve:t,quoteReserve:i,amount:r,slippage:o,epochInfo:s,baseIn:a}){var P,T,h,x,B,M,C,D,E;let c=1-Number(o.toSignificant())/100,u=new J(new te(r).mul(10**e[a?"mintA":"mintB"].decimals).mul(c).toFixed(0)),l=Ae(u,e[a?"mintA":"mintB"].extensions.feeConfig,s,!1),m=u.sub((P=l.fee)!=null?P:new J(0)),d=new J(new te(e.lpAmount).mul(10**e.lpMint.decimals).toFixed(0,te.ROUND_DOWN));this.logDebug("baseReserve:",t.toString(),"quoteReserve:",i.toString()),this.logDebug("tokenIn:",a?e.mintA.symbol:e.mintB.symbol,"amountIn:",u.toString(),"amountInFee:",(h=(T=l.fee)==null?void 0:T.toString())!=null?h:0,"anotherToken:",a?e.mintB.symbol:e.mintA.symbol,"slippage:",`${o.toSignificant()}%`);let p=a?"base":"quote";this.logDebug("input side:",p);let b=m.mul(d).div(p==="base"?t:i),f={amount:wn,fee:void 0,expirationTime:void 0};if(!m.isZero()){let v=xs(b,t,i,d);this.logDebug("lpAmountData:",{amountA:v.amountA.toString(),amountB:v.amountB.toString()}),f=Ae(v[a?"amountB":"amountA"],e[a?"mintB":"mintA"].extensions.feeConfig,s,!0)}let g=new ce(new J(1)).add(o),A=new ce(new J(1)).sub(o),w=Ae(g.mul(f.amount.sub((x=f.fee)!=null?x:new J(0))).quotient,e[a?"mintB":"mintA"].extensions.feeConfig,s,!0),k=Ae(A.mul(f.amount.sub((B=f.fee)!=null?B:new J(0))).quotient,e[a?"mintB":"mintA"].extensions.feeConfig,s,!0);return this.logDebug("anotherAmount:",f.amount.toString(),"anotherAmountFee:",(C=(M=f.fee)==null?void 0:M.toString())!=null?C:0,"maxAnotherAmount:",w.amount.toString(),"maxAnotherAmountFee:",(E=(D=w.fee)==null?void 0:D.toString())!=null?E:0),{inputAmountFee:l,anotherAmount:f,maxAnotherAmount:w,minAnotherAmount:k,liquidity:b}}};function xs(n,e,t,i){let r=n.mul(e).div(i);!r.isZero()&&!n.mul(e).mod(i).isZero()&&(r=r.add(new J(1)));let o=n.mul(t).div(i);return!o.isZero()&&!n.mul(t).mod(i).isZero()&&(o=o.add(new J(1))),{amountA:r,amountB:o}}export{vn as default};
//# sourceMappingURL=cpmm.mjs.map