var So=Object.defineProperty,Ko=Object.defineProperties;var Co=Object.getOwnPropertyDescriptors;var fn=Object.getOwnPropertySymbols;var Xi=Object.prototype.hasOwnProperty,zi=Object.prototype.propertyIsEnumerable;var Ui=(i,e,t)=>e in i?So(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t,q=(i,e)=>{for(var t in e||(e={}))Xi.call(e,t)&&Ui(i,t,e[t]);if(fn)for(var t of fn(e))zi.call(e,t)&&Ui(i,t,e[t]);return i},J=(i,e)=>Ko(i,Co(e));var It=(i,e)=>{var t={};for(var n in i)Xi.call(i,n)&&e.indexOf(n)<0&&(t[n]=i[n]);if(i!=null&&fn)for(var n of fn(i))e.indexOf(n)<0&&zi.call(i,n)&&(t[n]=i[n]);return t};import{PublicKey as _t}from"@solana/web3.js";import{createTransferInstruction as Io,TOKEN_PROGRAM_ID as Ae,TOKEN_2022_PROGRAM_ID as zn}from"@solana/spl-token";import Hn from"bn.js";var Ft=9e15,Pt=1e9,Qn="0123456789abcdef",yn="2.3025850929940456840179914546843642076011014886287729760333279009675726096773524802359972050895982983419677840422862486334095254650828067566662873690987816894829072083255546808437998948262331985283935053089653777326288461633662222876982198867465436674744042432743651550489343149393914796194044002221051017141748003688084012647080685567743216228355220114804663715659121373450747856947683463616792101806445070648000277502684916746550586856935673420670581136429224554405758925724208241314695689016758940256776311356919292033376587141660230105703089634572075440370847469940168269282808481184289314848524948644871927809676271275775397027668605952496716674183485704422507197965004714951050492214776567636938662976979522110718264549734772662425709429322582798502585509785265383207606726317164309505995087807523710333101197857547331541421808427543863591778117054309827482385045648019095610299291824318237525357709750539565187697510374970888692180205189339507238539205144634197265287286965110862571492198849978748873771345686209167058",gn="3.1415926535897932384626433832795028841971693993751058209749445923078164062862089986280348253421170679821480865132823066470938446095505822317253594081284811174502841027019385211055596446229489549303819644288109756659334461284756482337867831652712019091456485669234603486104543266482133936072602491412737245870066063155881748815209209628292540917153643678925903600113305305488204665213841469519415116094330572703657595919530921861173819326117931051185480744623799627495673518857527248912279381830119491298336733624406566430860213949463952247371907021798609437027705392171762931767523846748184676694051320005681271452635608277857713427577896091736371787214684409012249534301465495853710507922796892589235420199561121290219608640344181598136297747713099605187072113499999983729780499510597317328160963185950244594553469083026425223082533446850352619311881710100031378387528865875332083814206171776691473035982534904287554687311595628638823537875937519577818577805321712268066130019278766111959092164201989380952572010654858632789",jn={precision:20,rounding:4,modulo:1,toExpNeg:-7,toExpPos:21,minE:-Ft,maxE:Ft,crypto:!1},Zi,ot,Q=!0,kn="[DecimalError] ",gt=kn+"Invalid argument: ",Yi=kn+"Precision limit exceeded",Ji=kn+"crypto unavailable",$i="[object Decimal]",Ne=Math.floor,Be=Math.pow,No=/^0b([01]+(\.[01]*)?|\.[01]+)(p[+-]?\d+)?$/i,Lo=/^0x([0-9a-f]+(\.[0-9a-f]*)?|\.[0-9a-f]+)(p[+-]?\d+)?$/i,Ro=/^0o([0-7]+(\.[0-7]*)?|\.[0-7]+)(p[+-]?\d+)?$/i,er=/^(\d+(\.\d*)?|\.\d+)(e[+-]?\d+)?$/i,ze=1e7,U=7,Mo=9007199254740991,Oo=yn.length-1,Zn=gn.length-1,S={toStringTag:$i};S.absoluteValue=S.abs=function(){var i=new this.constructor(this);return i.s<0&&(i.s=1),V(i)};S.ceil=function(){return V(new this.constructor(this),this.e+1,2)};S.clampedTo=S.clamp=function(i,e){var t,n=this,r=n.constructor;if(i=new r(i),e=new r(e),!i.s||!e.s)return new r(NaN);if(i.gt(e))throw Error(gt+e);return t=n.cmp(i),t<0?i:n.cmp(e)>0?e:new r(n)};S.comparedTo=S.cmp=function(i){var e,t,n,r,o=this,s=o.d,a=(i=new o.constructor(i)).d,c=o.s,u=i.s;if(!s||!a)return!c||!u?NaN:c!==u?c:s===a?0:!s^c<0?1:-1;if(!s[0]||!a[0])return s[0]?c:a[0]?-u:0;if(c!==u)return c;if(o.e!==i.e)return o.e>i.e^c<0?1:-1;for(n=s.length,r=a.length,e=0,t=n<r?n:r;e<t;++e)if(s[e]!==a[e])return s[e]>a[e]^c<0?1:-1;return n===r?0:n>r^c<0?1:-1};S.cosine=S.cos=function(){var i,e,t=this,n=t.constructor;return t.d?t.d[0]?(i=n.precision,e=n.rounding,n.precision=i+Math.max(t.e,t.sd())+U,n.rounding=1,t=Eo(n,or(n,t)),n.precision=i,n.rounding=e,V(ot==2||ot==3?t.neg():t,i,e,!0)):new n(1):new n(NaN)};S.cubeRoot=S.cbrt=function(){var i,e,t,n,r,o,s,a,c,u,l=this,p=l.constructor;if(!l.isFinite()||l.isZero())return new p(l);for(Q=!1,o=l.s*Be(l.s*l,1/3),!o||Math.abs(o)==1/0?(t=Ke(l.d),i=l.e,(o=(i-t.length+1)%3)&&(t+=o==1||o==-2?"0":"00"),o=Be(t,1/3),i=Ne((i+1)/3)-(i%3==(i<0?-1:2)),o==1/0?t="5e"+i:(t=o.toExponential(),t=t.slice(0,t.indexOf("e")+1)+i),n=new p(t),n.s=l.s):n=new p(o.toString()),s=(i=p.precision)+3;;)if(a=n,c=a.times(a).times(a),u=c.plus(l),n=ue(u.plus(l).times(a),u.plus(c),s+2,1),Ke(a.d).slice(0,s)===(t=Ke(n.d)).slice(0,s))if(t=t.slice(s-3,s+1),t=="9999"||!r&&t=="4999"){if(!r&&(V(a,i+1,0),a.times(a).times(a).eq(l))){n=a;break}s+=4,r=1}else{(!+t||!+t.slice(1)&&t.charAt(0)=="5")&&(V(n,i+1,1),e=!n.times(n).times(n).eq(l));break}return Q=!0,V(n,i,p.rounding,e)};S.decimalPlaces=S.dp=function(){var i,e=this.d,t=NaN;if(e){if(i=e.length-1,t=(i-Ne(this.e/U))*U,i=e[i],i)for(;i%10==0;i/=10)t--;t<0&&(t=0)}return t};S.dividedBy=S.div=function(i){return ue(this,new this.constructor(i))};S.dividedToIntegerBy=S.divToInt=function(i){var e=this,t=e.constructor;return V(ue(e,new t(i),0,1,1),t.precision,t.rounding)};S.equals=S.eq=function(i){return this.cmp(i)===0};S.floor=function(){return V(new this.constructor(this),this.e+1,3)};S.greaterThan=S.gt=function(i){return this.cmp(i)>0};S.greaterThanOrEqualTo=S.gte=function(i){var e=this.cmp(i);return e==1||e===0};S.hyperbolicCosine=S.cosh=function(){var i,e,t,n,r,o=this,s=o.constructor,a=new s(1);if(!o.isFinite())return new s(o.s?1/0:NaN);if(o.isZero())return a;t=s.precision,n=s.rounding,s.precision=t+Math.max(o.e,o.sd())+4,s.rounding=1,r=o.d.length,r<32?(i=Math.ceil(r/3),e=(1/wn(4,i)).toString()):(i=16,e="2.3283064365386962890625e-10"),o=Wt(s,1,o.times(e),new s(1),!0);for(var c,u=i,l=new s(8);u--;)c=o.times(o),o=a.minus(c.times(l.minus(c.times(l))));return V(o,s.precision=t,s.rounding=n,!0)};S.hyperbolicSine=S.sinh=function(){var i,e,t,n,r=this,o=r.constructor;if(!r.isFinite()||r.isZero())return new o(r);if(e=o.precision,t=o.rounding,o.precision=e+Math.max(r.e,r.sd())+4,o.rounding=1,n=r.d.length,n<3)r=Wt(o,2,r,r,!0);else{i=1.4*Math.sqrt(n),i=i>16?16:i|0,r=r.times(1/wn(5,i)),r=Wt(o,2,r,r,!0);for(var s,a=new o(5),c=new o(16),u=new o(20);i--;)s=r.times(r),r=r.times(a.plus(s.times(c.times(s).plus(u))))}return o.precision=e,o.rounding=t,V(r,e,t,!0)};S.hyperbolicTangent=S.tanh=function(){var i,e,t=this,n=t.constructor;return t.isFinite()?t.isZero()?new n(t):(i=n.precision,e=n.rounding,n.precision=i+7,n.rounding=1,ue(t.sinh(),t.cosh(),n.precision=i,n.rounding=e)):new n(t.s)};S.inverseCosine=S.acos=function(){var i,e=this,t=e.constructor,n=e.abs().cmp(1),r=t.precision,o=t.rounding;return n!==-1?n===0?e.isNeg()?Xe(t,r,o):new t(0):new t(NaN):e.isZero()?Xe(t,r+4,o).times(.5):(t.precision=r+6,t.rounding=1,e=e.asin(),i=Xe(t,r+4,o).times(.5),t.precision=r,t.rounding=o,i.minus(e))};S.inverseHyperbolicCosine=S.acosh=function(){var i,e,t=this,n=t.constructor;return t.lte(1)?new n(t.eq(1)?0:NaN):t.isFinite()?(i=n.precision,e=n.rounding,n.precision=i+Math.max(Math.abs(t.e),t.sd())+4,n.rounding=1,Q=!1,t=t.times(t).minus(1).sqrt().plus(t),Q=!0,n.precision=i,n.rounding=e,t.ln()):new n(t)};S.inverseHyperbolicSine=S.asinh=function(){var i,e,t=this,n=t.constructor;return!t.isFinite()||t.isZero()?new n(t):(i=n.precision,e=n.rounding,n.precision=i+2*Math.max(Math.abs(t.e),t.sd())+6,n.rounding=1,Q=!1,t=t.times(t).plus(1).sqrt().plus(t),Q=!0,n.precision=i,n.rounding=e,t.ln())};S.inverseHyperbolicTangent=S.atanh=function(){var i,e,t,n,r=this,o=r.constructor;return r.isFinite()?r.e>=0?new o(r.abs().eq(1)?r.s/0:r.isZero()?r:NaN):(i=o.precision,e=o.rounding,n=r.sd(),Math.max(n,i)<2*-r.e-1?V(new o(r),i,e,!0):(o.precision=t=n-r.e,r=ue(r.plus(1),new o(1).minus(r),t+i,1),o.precision=i+4,o.rounding=1,r=r.ln(),o.precision=i,o.rounding=e,r.times(.5))):new o(NaN)};S.inverseSine=S.asin=function(){var i,e,t,n,r=this,o=r.constructor;return r.isZero()?new o(r):(e=r.abs().cmp(1),t=o.precision,n=o.rounding,e!==-1?e===0?(i=Xe(o,t+4,n).times(.5),i.s=r.s,i):new o(NaN):(o.precision=t+6,o.rounding=1,r=r.div(new o(1).minus(r.times(r)).sqrt().plus(1)).atan(),o.precision=t,o.rounding=n,r.times(2)))};S.inverseTangent=S.atan=function(){var i,e,t,n,r,o,s,a,c,u=this,l=u.constructor,p=l.precision,m=l.rounding;if(u.isFinite()){if(u.isZero())return new l(u);if(u.abs().eq(1)&&p+4<=Zn)return s=Xe(l,p+4,m).times(.25),s.s=u.s,s}else{if(!u.s)return new l(NaN);if(p+4<=Zn)return s=Xe(l,p+4,m).times(.5),s.s=u.s,s}for(l.precision=a=p+10,l.rounding=1,t=Math.min(28,a/U+2|0),i=t;i;--i)u=u.div(u.times(u).plus(1).sqrt().plus(1));for(Q=!1,e=Math.ceil(a/U),n=1,c=u.times(u),s=new l(u),r=u;i!==-1;)if(r=r.times(c),o=s.minus(r.div(n+=2)),r=r.times(c),s=o.plus(r.div(n+=2)),s.d[e]!==void 0)for(i=e;s.d[i]===o.d[i]&&i--;);return t&&(s=s.times(2<<t-1)),Q=!0,V(s,l.precision=p,l.rounding=m,!0)};S.isFinite=function(){return!!this.d};S.isInteger=S.isInt=function(){return!!this.d&&Ne(this.e/U)>this.d.length-2};S.isNaN=function(){return!this.s};S.isNegative=S.isNeg=function(){return this.s<0};S.isPositive=S.isPos=function(){return this.s>0};S.isZero=function(){return!!this.d&&this.d[0]===0};S.lessThan=S.lt=function(i){return this.cmp(i)<0};S.lessThanOrEqualTo=S.lte=function(i){return this.cmp(i)<1};S.logarithm=S.log=function(i){var e,t,n,r,o,s,a,c,u=this,l=u.constructor,p=l.precision,m=l.rounding,d=5;if(i==null)i=new l(10),e=!0;else{if(i=new l(i),t=i.d,i.s<0||!t||!t[0]||i.eq(1))return new l(NaN);e=i.eq(10)}if(t=u.d,u.s<0||!t||!t[0]||u.eq(1))return new l(t&&!t[0]?-1/0:u.s!=1?NaN:t?0:1/0);if(e)if(t.length>1)o=!0;else{for(r=t[0];r%10===0;)r/=10;o=r!==1}if(Q=!1,a=p+d,s=yt(u,a),n=e?Pn(l,a+10):yt(i,a),c=ue(s,n,a,1),Ht(c.d,r=p,m))do if(a+=10,s=yt(u,a),n=e?Pn(l,a+10):yt(i,a),c=ue(s,n,a,1),!o){+Ke(c.d).slice(r+1,r+15)+1==1e14&&(c=V(c,p+1,0));break}while(Ht(c.d,r+=10,m));return Q=!0,V(c,p,m)};S.minus=S.sub=function(i){var e,t,n,r,o,s,a,c,u,l,p,m,d=this,y=d.constructor;if(i=new y(i),!d.d||!i.d)return!d.s||!i.s?i=new y(NaN):d.d?i.s=-i.s:i=new y(i.d||d.s!==i.s?d:NaN),i;if(d.s!=i.s)return i.s=-i.s,d.plus(i);if(u=d.d,m=i.d,a=y.precision,c=y.rounding,!u[0]||!m[0]){if(m[0])i.s=-i.s;else if(u[0])i=new y(d);else return new y(c===3?-0:0);return Q?V(i,a,c):i}if(t=Ne(i.e/U),l=Ne(d.e/U),u=u.slice(),o=l-t,o){for(p=o<0,p?(e=u,o=-o,s=m.length):(e=m,t=l,s=u.length),n=Math.max(Math.ceil(a/U),s)+2,o>n&&(o=n,e.length=1),e.reverse(),n=o;n--;)e.push(0);e.reverse()}else{for(n=u.length,s=m.length,p=n<s,p&&(s=n),n=0;n<s;n++)if(u[n]!=m[n]){p=u[n]<m[n];break}o=0}for(p&&(e=u,u=m,m=e,i.s=-i.s),s=u.length,n=m.length-s;n>0;--n)u[s++]=0;for(n=m.length;n>o;){if(u[--n]<m[n]){for(r=n;r&&u[--r]===0;)u[r]=ze-1;--u[r],u[n]+=ze}u[n]-=m[n]}for(;u[--s]===0;)u.pop();for(;u[0]===0;u.shift())--t;return u[0]?(i.d=u,i.e=An(u,t),Q?V(i,a,c):i):new y(c===3?-0:0)};S.modulo=S.mod=function(i){var e,t=this,n=t.constructor;return i=new n(i),!t.d||!i.s||i.d&&!i.d[0]?new n(NaN):!i.d||t.d&&!t.d[0]?V(new n(t),n.precision,n.rounding):(Q=!1,n.modulo==9?(e=ue(t,i.abs(),0,3,1),e.s*=i.s):e=ue(t,i,0,n.modulo,1),e=e.times(i),Q=!0,t.minus(e))};S.naturalExponential=S.exp=function(){return Yn(this)};S.naturalLogarithm=S.ln=function(){return yt(this)};S.negated=S.neg=function(){var i=new this.constructor(this);return i.s=-i.s,V(i)};S.plus=S.add=function(i){var e,t,n,r,o,s,a,c,u,l,p=this,m=p.constructor;if(i=new m(i),!p.d||!i.d)return!p.s||!i.s?i=new m(NaN):p.d||(i=new m(i.d||p.s===i.s?p:NaN)),i;if(p.s!=i.s)return i.s=-i.s,p.minus(i);if(u=p.d,l=i.d,a=m.precision,c=m.rounding,!u[0]||!l[0])return l[0]||(i=new m(p)),Q?V(i,a,c):i;if(o=Ne(p.e/U),n=Ne(i.e/U),u=u.slice(),r=o-n,r){for(r<0?(t=u,r=-r,s=l.length):(t=l,n=o,s=u.length),o=Math.ceil(a/U),s=o>s?o+1:s+1,r>s&&(r=s,t.length=1),t.reverse();r--;)t.push(0);t.reverse()}for(s=u.length,r=l.length,s-r<0&&(r=s,t=l,l=u,u=t),e=0;r;)e=(u[--r]=u[r]+l[r]+e)/ze|0,u[r]%=ze;for(e&&(u.unshift(e),++n),s=u.length;u[--s]==0;)u.pop();return i.d=u,i.e=An(u,n),Q?V(i,a,c):i};S.precision=S.sd=function(i){var e,t=this;if(i!==void 0&&i!==!!i&&i!==1&&i!==0)throw Error(gt+i);return t.d?(e=tr(t.d),i&&t.e+1>e&&(e=t.e+1)):e=NaN,e};S.round=function(){var i=this,e=i.constructor;return V(new e(i),i.e+1,e.rounding)};S.sine=S.sin=function(){var i,e,t=this,n=t.constructor;return t.isFinite()?t.isZero()?new n(t):(i=n.precision,e=n.rounding,n.precision=i+Math.max(t.e,t.sd())+U,n.rounding=1,t=_o(n,or(n,t)),n.precision=i,n.rounding=e,V(ot>2?t.neg():t,i,e,!0)):new n(NaN)};S.squareRoot=S.sqrt=function(){var i,e,t,n,r,o,s=this,a=s.d,c=s.e,u=s.s,l=s.constructor;if(u!==1||!a||!a[0])return new l(!u||u<0&&(!a||a[0])?NaN:a?s:1/0);for(Q=!1,u=Math.sqrt(+s),u==0||u==1/0?(e=Ke(a),(e.length+c)%2==0&&(e+="0"),u=Math.sqrt(e),c=Ne((c+1)/2)-(c<0||c%2),u==1/0?e="5e"+c:(e=u.toExponential(),e=e.slice(0,e.indexOf("e")+1)+c),n=new l(e)):n=new l(u.toString()),t=(c=l.precision)+3;;)if(o=n,n=o.plus(ue(s,o,t+2,1)).times(.5),Ke(o.d).slice(0,t)===(e=Ke(n.d)).slice(0,t))if(e=e.slice(t-3,t+1),e=="9999"||!r&&e=="4999"){if(!r&&(V(o,c+1,0),o.times(o).eq(s))){n=o;break}t+=4,r=1}else{(!+e||!+e.slice(1)&&e.charAt(0)=="5")&&(V(n,c+1,1),i=!n.times(n).eq(s));break}return Q=!0,V(n,c,l.rounding,i)};S.tangent=S.tan=function(){var i,e,t=this,n=t.constructor;return t.isFinite()?t.isZero()?new n(t):(i=n.precision,e=n.rounding,n.precision=i+10,n.rounding=1,t=t.sin(),t.s=1,t=ue(t,new n(1).minus(t.times(t)).sqrt(),i+10,0),n.precision=i,n.rounding=e,V(ot==2||ot==4?t.neg():t,i,e,!0)):new n(NaN)};S.times=S.mul=function(i){var e,t,n,r,o,s,a,c,u,l=this,p=l.constructor,m=l.d,d=(i=new p(i)).d;if(i.s*=l.s,!m||!m[0]||!d||!d[0])return new p(!i.s||m&&!m[0]&&!d||d&&!d[0]&&!m?NaN:!m||!d?i.s/0:i.s*0);for(t=Ne(l.e/U)+Ne(i.e/U),c=m.length,u=d.length,c<u&&(o=m,m=d,d=o,s=c,c=u,u=s),o=[],s=c+u,n=s;n--;)o.push(0);for(n=u;--n>=0;){for(e=0,r=c+n;r>n;)a=o[r]+d[n]*m[r-n-1]+e,o[r--]=a%ze|0,e=a/ze|0;o[r]=(o[r]+e)%ze|0}for(;!o[--s];)o.pop();return e?++t:o.shift(),i.d=o,i.e=An(o,t),Q?V(i,p.precision,p.rounding):i};S.toBinary=function(i,e){return $n(this,2,i,e)};S.toDecimalPlaces=S.toDP=function(i,e){var t=this,n=t.constructor;return t=new n(t),i===void 0?t:(Me(i,0,Pt),e===void 0?e=n.rounding:Me(e,0,8),V(t,i+t.e+1,e))};S.toExponential=function(i,e){var t,n=this,r=n.constructor;return i===void 0?t=Je(n,!0):(Me(i,0,Pt),e===void 0?e=r.rounding:Me(e,0,8),n=V(new r(n),i+1,e),t=Je(n,!0,i+1)),n.isNeg()&&!n.isZero()?"-"+t:t};S.toFixed=function(i,e){var t,n,r=this,o=r.constructor;return i===void 0?t=Je(r):(Me(i,0,Pt),e===void 0?e=o.rounding:Me(e,0,8),n=V(new o(r),i+r.e+1,e),t=Je(n,!1,i+n.e+1)),r.isNeg()&&!r.isZero()?"-"+t:t};S.toFraction=function(i){var e,t,n,r,o,s,a,c,u,l,p,m,d=this,y=d.d,f=d.constructor;if(!y)return new f(d);if(u=t=new f(1),n=c=new f(0),e=new f(n),o=e.e=tr(y)-d.e-1,s=o%U,e.d[0]=Be(10,s<0?U+s:s),i==null)i=o>0?e:u;else{if(a=new f(i),!a.isInt()||a.lt(u))throw Error(gt+a);i=a.gt(e)?o>0?e:u:a}for(Q=!1,a=new f(Ke(y)),l=f.precision,f.precision=o=y.length*U*2;p=ue(a,e,0,1,1),r=t.plus(p.times(n)),r.cmp(i)!=1;)t=n,n=r,r=u,u=c.plus(p.times(r)),c=r,r=e,e=a.minus(p.times(r)),a=r;return r=ue(i.minus(t),n,0,1,1),c=c.plus(r.times(u)),t=t.plus(r.times(n)),c.s=u.s=d.s,m=ue(u,n,o,1).minus(d).abs().cmp(ue(c,t,o,1).minus(d).abs())<1?[u,n]:[c,t],f.precision=l,Q=!0,m};S.toHexadecimal=S.toHex=function(i,e){return $n(this,16,i,e)};S.toNearest=function(i,e){var t=this,n=t.constructor;if(t=new n(t),i==null){if(!t.d)return t;i=new n(1),e=n.rounding}else{if(i=new n(i),e===void 0?e=n.rounding:Me(e,0,8),!t.d)return i.s?t:i;if(!i.d)return i.s&&(i.s=t.s),i}return i.d[0]?(Q=!1,t=ue(t,i,0,e,1).times(i),Q=!0,V(t)):(i.s=t.s,t=i),t};S.toNumber=function(){return+this};S.toOctal=function(i,e){return $n(this,8,i,e)};S.toPower=S.pow=function(i){var e,t,n,r,o,s,a=this,c=a.constructor,u=+(i=new c(i));if(!a.d||!i.d||!a.d[0]||!i.d[0])return new c(Be(+a,u));if(a=new c(a),a.eq(1))return a;if(n=c.precision,o=c.rounding,i.eq(1))return V(a,n,o);if(e=Ne(i.e/U),e>=i.d.length-1&&(t=u<0?-u:u)<=Mo)return r=nr(c,a,t,n),i.s<0?new c(1).div(r):V(r,n,o);if(s=a.s,s<0){if(e<i.d.length-1)return new c(NaN);if((i.d[e]&1)==0&&(s=1),a.e==0&&a.d[0]==1&&a.d.length==1)return a.s=s,a}return t=Be(+a,u),e=t==0||!isFinite(t)?Ne(u*(Math.log("0."+Ke(a.d))/Math.LN10+a.e+1)):new c(t+"").e,e>c.maxE+1||e<c.minE-1?new c(e>0?s/0:0):(Q=!1,c.rounding=a.s=1,t=Math.min(12,(e+"").length),r=Yn(i.times(yt(a,n+t)),n),r.d&&(r=V(r,n+5,1),Ht(r.d,n,o)&&(e=n+10,r=V(Yn(i.times(yt(a,e+t)),e),e+5,1),+Ke(r.d).slice(n+1,n+15)+1==1e14&&(r=V(r,n+1,0)))),r.s=s,Q=!0,c.rounding=o,V(r,n,o))};S.toPrecision=function(i,e){var t,n=this,r=n.constructor;return i===void 0?t=Je(n,n.e<=r.toExpNeg||n.e>=r.toExpPos):(Me(i,1,Pt),e===void 0?e=r.rounding:Me(e,0,8),n=V(new r(n),i,e),t=Je(n,i<=n.e||n.e<=r.toExpNeg,i)),n.isNeg()&&!n.isZero()?"-"+t:t};S.toSignificantDigits=S.toSD=function(i,e){var t=this,n=t.constructor;return i===void 0?(i=n.precision,e=n.rounding):(Me(i,1,Pt),e===void 0?e=n.rounding:Me(e,0,8)),V(new n(t),i,e)};S.toString=function(){var i=this,e=i.constructor,t=Je(i,i.e<=e.toExpNeg||i.e>=e.toExpPos);return i.isNeg()&&!i.isZero()?"-"+t:t};S.truncated=S.trunc=function(){return V(new this.constructor(this),this.e+1,1)};S.valueOf=S.toJSON=function(){var i=this,e=i.constructor,t=Je(i,i.e<=e.toExpNeg||i.e>=e.toExpPos);return i.isNeg()?"-"+t:t};function Ke(i){var e,t,n,r=i.length-1,o="",s=i[0];if(r>0){for(o+=s,e=1;e<r;e++)n=i[e]+"",t=U-n.length,t&&(o+=bt(t)),o+=n;s=i[e],n=s+"",t=U-n.length,t&&(o+=bt(t))}else if(s===0)return"0";for(;s%10===0;)s/=10;return o+s}function Me(i,e,t){if(i!==~~i||i<e||i>t)throw Error(gt+i)}function Ht(i,e,t,n){var r,o,s,a;for(o=i[0];o>=10;o/=10)--e;return--e<0?(e+=U,r=0):(r=Math.ceil((e+1)/U),e%=U),o=Be(10,U-e),a=i[r]%o|0,n==null?e<3?(e==0?a=a/100|0:e==1&&(a=a/10|0),s=t<4&&a==99999||t>3&&a==49999||a==5e4||a==0):s=(t<4&&a+1==o||t>3&&a+1==o/2)&&(i[r+1]/o/100|0)==Be(10,e-2)-1||(a==o/2||a==0)&&(i[r+1]/o/100|0)==0:e<4?(e==0?a=a/1e3|0:e==1?a=a/100|0:e==2&&(a=a/10|0),s=(n||t<4)&&a==9999||!n&&t>3&&a==4999):s=((n||t<4)&&a+1==o||!n&&t>3&&a+1==o/2)&&(i[r+1]/o/1e3|0)==Be(10,e-3)-1,s}function bn(i,e,t){for(var n,r=[0],o,s=0,a=i.length;s<a;){for(o=r.length;o--;)r[o]*=e;for(r[0]+=Qn.indexOf(i.charAt(s++)),n=0;n<r.length;n++)r[n]>t-1&&(r[n+1]===void 0&&(r[n+1]=0),r[n+1]+=r[n]/t|0,r[n]%=t)}return r.reverse()}function Eo(i,e){var t,n,r;if(e.isZero())return e;n=e.d.length,n<32?(t=Math.ceil(n/3),r=(1/wn(4,t)).toString()):(t=16,r="2.3283064365386962890625e-10"),i.precision+=t,e=Wt(i,1,e.times(r),new i(1));for(var o=t;o--;){var s=e.times(e);e=s.times(s).minus(s).times(8).plus(1)}return i.precision-=t,e}var ue=function(){function i(n,r,o){var s,a=0,c=n.length;for(n=n.slice();c--;)s=n[c]*r+a,n[c]=s%o|0,a=s/o|0;return a&&n.unshift(a),n}function e(n,r,o,s){var a,c;if(o!=s)c=o>s?1:-1;else for(a=c=0;a<o;a++)if(n[a]!=r[a]){c=n[a]>r[a]?1:-1;break}return c}function t(n,r,o,s){for(var a=0;o--;)n[o]-=a,a=n[o]<r[o]?1:0,n[o]=a*s+n[o]-r[o];for(;!n[0]&&n.length>1;)n.shift()}return function(n,r,o,s,a,c){var u,l,p,m,d,y,f,b,g,A,w,T,B,k,x,I,R,h,L,G,E=n.constructor,z=n.s==r.s?1:-1,D=n.d,v=r.d;if(!D||!D[0]||!v||!v[0])return new E(!n.s||!r.s||(D?v&&D[0]==v[0]:!v)?NaN:D&&D[0]==0||!v?z*0:z/0);for(c?(d=1,l=n.e-r.e):(c=ze,d=U,l=Ne(n.e/d)-Ne(r.e/d)),L=v.length,R=D.length,g=new E(z),A=g.d=[],p=0;v[p]==(D[p]||0);p++);if(v[p]>(D[p]||0)&&l--,o==null?(k=o=E.precision,s=E.rounding):a?k=o+(n.e-r.e)+1:k=o,k<0)A.push(1),y=!0;else{if(k=k/d+2|0,p=0,L==1){for(m=0,v=v[0],k++;(p<R||m)&&k--;p++)x=m*c+(D[p]||0),A[p]=x/v|0,m=x%v|0;y=m||p<R}else{for(m=c/(v[0]+1)|0,m>1&&(v=i(v,m,c),D=i(D,m,c),L=v.length,R=D.length),I=L,w=D.slice(0,L),T=w.length;T<L;)w[T++]=0;G=v.slice(),G.unshift(0),h=v[0],v[1]>=c/2&&++h;do m=0,u=e(v,w,L,T),u<0?(B=w[0],L!=T&&(B=B*c+(w[1]||0)),m=B/h|0,m>1?(m>=c&&(m=c-1),f=i(v,m,c),b=f.length,T=w.length,u=e(f,w,b,T),u==1&&(m--,t(f,L<b?G:v,b,c))):(m==0&&(u=m=1),f=v.slice()),b=f.length,b<T&&f.unshift(0),t(w,f,T,c),u==-1&&(T=w.length,u=e(v,w,L,T),u<1&&(m++,t(w,L<T?G:v,T,c))),T=w.length):u===0&&(m++,w=[0]),A[p++]=m,u&&w[0]?w[T++]=D[I]||0:(w=[D[I]],T=1);while((I++<R||w[0]!==void 0)&&k--);y=w[0]!==void 0}A[0]||A.shift()}if(d==1)g.e=l,Zi=y;else{for(p=1,m=A[0];m>=10;m/=10)p++;g.e=p+l*d-1,V(g,a?o+g.e+1:o,s,y)}return g}}();function V(i,e,t,n){var r,o,s,a,c,u,l,p,m,d=i.constructor;e:if(e!=null){if(p=i.d,!p)return i;for(r=1,a=p[0];a>=10;a/=10)r++;if(o=e-r,o<0)o+=U,s=e,l=p[m=0],c=l/Be(10,r-s-1)%10|0;else if(m=Math.ceil((o+1)/U),a=p.length,m>=a)if(n){for(;a++<=m;)p.push(0);l=c=0,r=1,o%=U,s=o-U+1}else break e;else{for(l=a=p[m],r=1;a>=10;a/=10)r++;o%=U,s=o-U+r,c=s<0?0:l/Be(10,r-s-1)%10|0}if(n=n||e<0||p[m+1]!==void 0||(s<0?l:l%Be(10,r-s-1)),u=t<4?(c||n)&&(t==0||t==(i.s<0?3:2)):c>5||c==5&&(t==4||n||t==6&&(o>0?s>0?l/Be(10,r-s):0:p[m-1])%10&1||t==(i.s<0?8:7)),e<1||!p[0])return p.length=0,u?(e-=i.e+1,p[0]=Be(10,(U-e%U)%U),i.e=-e||0):p[0]=i.e=0,i;if(o==0?(p.length=m,a=1,m--):(p.length=m+1,a=Be(10,U-o),p[m]=s>0?(l/Be(10,r-s)%Be(10,s)|0)*a:0),u)for(;;)if(m==0){for(o=1,s=p[0];s>=10;s/=10)o++;for(s=p[0]+=a,a=1;s>=10;s/=10)a++;o!=a&&(i.e++,p[0]==ze&&(p[0]=1));break}else{if(p[m]+=a,p[m]!=ze)break;p[m--]=0,a=1}for(o=p.length;p[--o]===0;)p.pop()}return Q&&(i.e>d.maxE?(i.d=null,i.e=NaN):i.e<d.minE&&(i.e=0,i.d=[0])),i}function Je(i,e,t){if(!i.isFinite())return rr(i);var n,r=i.e,o=Ke(i.d),s=o.length;return e?(t&&(n=t-s)>0?o=o.charAt(0)+"."+o.slice(1)+bt(n):s>1&&(o=o.charAt(0)+"."+o.slice(1)),o=o+(i.e<0?"e":"e+")+i.e):r<0?(o="0."+bt(-r-1)+o,t&&(n=t-s)>0&&(o+=bt(n))):r>=s?(o+=bt(r+1-s),t&&(n=t-r-1)>0&&(o=o+"."+bt(n))):((n=r+1)<s&&(o=o.slice(0,n)+"."+o.slice(n)),t&&(n=t-s)>0&&(r+1===s&&(o+="."),o+=bt(n))),o}function An(i,e){var t=i[0];for(e*=U;t>=10;t/=10)e++;return e}function Pn(i,e,t){if(e>Oo)throw Q=!0,t&&(i.precision=t),Error(Yi);return V(new i(yn),e,1,!0)}function Xe(i,e,t){if(e>Zn)throw Error(Yi);return V(new i(gn),e,t,!0)}function tr(i){var e=i.length-1,t=e*U+1;if(e=i[e],e){for(;e%10==0;e/=10)t--;for(e=i[0];e>=10;e/=10)t++}return t}function bt(i){for(var e="";i--;)e+="0";return e}function nr(i,e,t,n){var r,o=new i(1),s=Math.ceil(n/U+4);for(Q=!1;;){if(t%2&&(o=o.times(e),Qi(o.d,s)&&(r=!0)),t=Ne(t/2),t===0){t=o.d.length-1,r&&o.d[t]===0&&++o.d[t];break}e=e.times(e),Qi(e.d,s)}return Q=!0,o}function Hi(i){return i.d[i.d.length-1]&1}function ir(i,e,t){for(var n,r=new i(e[0]),o=0;++o<e.length;)if(n=new i(e[o]),n.s)r[t](n)&&(r=n);else{r=n;break}return r}function Yn(i,e){var t,n,r,o,s,a,c,u=0,l=0,p=0,m=i.constructor,d=m.rounding,y=m.precision;if(!i.d||!i.d[0]||i.e>17)return new m(i.d?i.d[0]?i.s<0?0:1/0:1:i.s?i.s<0?0:i:0/0);for(e==null?(Q=!1,c=y):c=e,a=new m(.03125);i.e>-2;)i=i.times(a),p+=5;for(n=Math.log(Be(2,p))/Math.LN10*2+5|0,c+=n,t=o=s=new m(1),m.precision=c;;){if(o=V(o.times(i),c,1),t=t.times(++l),a=s.plus(ue(o,t,c,1)),Ke(a.d).slice(0,c)===Ke(s.d).slice(0,c)){for(r=p;r--;)s=V(s.times(s),c,1);if(e==null)if(u<3&&Ht(s.d,c-n,d,u))m.precision=c+=10,t=o=a=new m(1),l=0,u++;else return V(s,m.precision=y,d,Q=!0);else return m.precision=y,s}s=a}}function yt(i,e){var t,n,r,o,s,a,c,u,l,p,m,d=1,y=10,f=i,b=f.d,g=f.constructor,A=g.rounding,w=g.precision;if(f.s<0||!b||!b[0]||!f.e&&b[0]==1&&b.length==1)return new g(b&&!b[0]?-1/0:f.s!=1?NaN:b?0:f);if(e==null?(Q=!1,l=w):l=e,g.precision=l+=y,t=Ke(b),n=t.charAt(0),Math.abs(o=f.e)<15e14){for(;n<7&&n!=1||n==1&&t.charAt(1)>3;)f=f.times(i),t=Ke(f.d),n=t.charAt(0),d++;o=f.e,n>1?(f=new g("0."+t),o++):f=new g(n+"."+t.slice(1))}else return u=Pn(g,l+2,w).times(o+""),f=yt(new g(n+"."+t.slice(1)),l-y).plus(u),g.precision=w,e==null?V(f,w,A,Q=!0):f;for(p=f,c=s=f=ue(f.minus(1),f.plus(1),l,1),m=V(f.times(f),l,1),r=3;;){if(s=V(s.times(m),l,1),u=c.plus(ue(s,new g(r),l,1)),Ke(u.d).slice(0,l)===Ke(c.d).slice(0,l))if(c=c.times(2),o!==0&&(c=c.plus(Pn(g,l+2,w).times(o+""))),c=ue(c,new g(d),l,1),e==null)if(Ht(c.d,l-y,A,a))g.precision=l+=y,u=s=f=ue(p.minus(1),p.plus(1),l,1),m=V(f.times(f),l,1),r=a=1;else return V(c,g.precision=w,A,Q=!0);else return g.precision=w,c;c=u,r+=2}}function rr(i){return String(i.s*i.s/0)}function Jn(i,e){var t,n,r;for((t=e.indexOf("."))>-1&&(e=e.replace(".","")),(n=e.search(/e/i))>0?(t<0&&(t=n),t+=+e.slice(n+1),e=e.substring(0,n)):t<0&&(t=e.length),n=0;e.charCodeAt(n)===48;n++);for(r=e.length;e.charCodeAt(r-1)===48;--r);if(e=e.slice(n,r),e){if(r-=n,i.e=t=t-n-1,i.d=[],n=(t+1)%U,t<0&&(n+=U),n<r){for(n&&i.d.push(+e.slice(0,n)),r-=U;n<r;)i.d.push(+e.slice(n,n+=U));e=e.slice(n),n=U-e.length}else n-=r;for(;n--;)e+="0";i.d.push(+e),Q&&(i.e>i.constructor.maxE?(i.d=null,i.e=NaN):i.e<i.constructor.minE&&(i.e=0,i.d=[0]))}else i.e=0,i.d=[0];return i}function vo(i,e){var t,n,r,o,s,a,c,u,l;if(e.indexOf("_")>-1){if(e=e.replace(/(\d)_(?=\d)/g,"$1"),er.test(e))return Jn(i,e)}else if(e==="Infinity"||e==="NaN")return+e||(i.s=NaN),i.e=NaN,i.d=null,i;if(Lo.test(e))t=16,e=e.toLowerCase();else if(No.test(e))t=2;else if(Ro.test(e))t=8;else throw Error(gt+e);for(o=e.search(/p/i),o>0?(c=+e.slice(o+1),e=e.substring(2,o)):e=e.slice(2),o=e.indexOf("."),s=o>=0,n=i.constructor,s&&(e=e.replace(".",""),a=e.length,o=a-o,r=nr(n,new n(t),o,o*2)),u=bn(e,t,ze),l=u.length-1,o=l;u[o]===0;--o)u.pop();return o<0?new n(i.s*0):(i.e=An(u,l),i.d=u,Q=!1,s&&(i=ue(i,r,a*4)),c&&(i=i.times(Math.abs(c)<54?Be(2,c):Qt.pow(2,c))),Q=!0,i)}function _o(i,e){var t,n=e.d.length;if(n<3)return e.isZero()?e:Wt(i,2,e,e);t=1.4*Math.sqrt(n),t=t>16?16:t|0,e=e.times(1/wn(5,t)),e=Wt(i,2,e,e);for(var r,o=new i(5),s=new i(16),a=new i(20);t--;)r=e.times(e),e=e.times(o.plus(r.times(s.times(r).minus(a))));return e}function Wt(i,e,t,n,r){var o,s,a,c,u=1,l=i.precision,p=Math.ceil(l/U);for(Q=!1,c=t.times(t),a=new i(n);;){if(s=ue(a.times(c),new i(e++*e++),l,1),a=r?n.plus(s):n.minus(s),n=ue(s.times(c),new i(e++*e++),l,1),s=a.plus(n),s.d[p]!==void 0){for(o=p;s.d[o]===a.d[o]&&o--;);if(o==-1)break}o=a,a=n,n=s,s=o,u++}return Q=!0,s.d.length=p+1,s}function wn(i,e){for(var t=i;--e;)t*=i;return t}function or(i,e){var t,n=e.s<0,r=Xe(i,i.precision,1),o=r.times(.5);if(e=e.abs(),e.lte(o))return ot=n?4:1,e;if(t=e.divToInt(r),t.isZero())ot=n?3:2;else{if(e=e.minus(t.times(r)),e.lte(o))return ot=Hi(t)?n?2:3:n?4:1,e;ot=Hi(t)?n?1:4:n?3:2}return e.minus(r).abs()}function $n(i,e,t,n){var r,o,s,a,c,u,l,p,m,d=i.constructor,y=t!==void 0;if(y?(Me(t,1,Pt),n===void 0?n=d.rounding:Me(n,0,8)):(t=d.precision,n=d.rounding),!i.isFinite())l=rr(i);else{for(l=Je(i),s=l.indexOf("."),y?(r=2,e==16?t=t*4-3:e==8&&(t=t*3-2)):r=e,s>=0&&(l=l.replace(".",""),m=new d(1),m.e=l.length-s,m.d=bn(Je(m),10,r),m.e=m.d.length),p=bn(l,10,r),o=c=p.length;p[--c]==0;)p.pop();if(!p[0])l=y?"0p+0":"0";else{if(s<0?o--:(i=new d(i),i.d=p,i.e=o,i=ue(i,m,t,n,0,r),p=i.d,o=i.e,u=Zi),s=p[t],a=r/2,u=u||p[t+1]!==void 0,u=n<4?(s!==void 0||u)&&(n===0||n===(i.s<0?3:2)):s>a||s===a&&(n===4||u||n===6&&p[t-1]&1||n===(i.s<0?8:7)),p.length=t,u)for(;++p[--t]>r-1;)p[t]=0,t||(++o,p.unshift(1));for(c=p.length;!p[c-1];--c);for(s=0,l="";s<c;s++)l+=Qn.charAt(p[s]);if(y){if(c>1)if(e==16||e==8){for(s=e==16?4:3,--c;c%s;c++)l+="0";for(p=bn(l,r,e),c=p.length;!p[c-1];--c);for(s=1,l="1.";s<c;s++)l+=Qn.charAt(p[s])}else l=l.charAt(0)+"."+l.slice(1);l=l+(o<0?"p":"p+")+o}else if(o<0){for(;++o;)l="0"+l;l="0."+l}else if(++o>c)for(o-=c;o--;)l+="0";else o<c&&(l=l.slice(0,o)+"."+l.slice(o))}l=(e==16?"0x":e==2?"0b":e==8?"0o":"")+l}return i.s<0?"-"+l:l}function Qi(i,e){if(i.length>e)return i.length=e,!0}function Fo(i){return new this(i).abs()}function Wo(i){return new this(i).acos()}function Vo(i){return new this(i).acosh()}function Do(i,e){return new this(i).plus(e)}function qo(i){return new this(i).asin()}function Go(i){return new this(i).asinh()}function Uo(i){return new this(i).atan()}function Xo(i){return new this(i).atanh()}function zo(i,e){i=new this(i),e=new this(e);var t,n=this.precision,r=this.rounding,o=n+4;return!i.s||!e.s?t=new this(NaN):!i.d&&!e.d?(t=Xe(this,o,1).times(e.s>0?.25:.75),t.s=i.s):!e.d||i.isZero()?(t=e.s<0?Xe(this,n,r):new this(0),t.s=i.s):!i.d||e.isZero()?(t=Xe(this,o,1).times(.5),t.s=i.s):e.s<0?(this.precision=o,this.rounding=1,t=this.atan(ue(i,e,o,1)),e=Xe(this,o,1),this.precision=n,this.rounding=r,t=i.s<0?t.minus(e):t.plus(e)):t=this.atan(ue(i,e,o,1)),t}function Ho(i){return new this(i).cbrt()}function Qo(i){return V(i=new this(i),i.e+1,2)}function jo(i,e,t){return new this(i).clamp(e,t)}function Zo(i){if(!i||typeof i!="object")throw Error(kn+"Object expected");var e,t,n,r=i.defaults===!0,o=["precision",1,Pt,"rounding",0,8,"toExpNeg",-Ft,0,"toExpPos",0,Ft,"maxE",0,Ft,"minE",-Ft,0,"modulo",0,9];for(e=0;e<o.length;e+=3)if(t=o[e],r&&(this[t]=jn[t]),(n=i[t])!==void 0)if(Ne(n)===n&&n>=o[e+1]&&n<=o[e+2])this[t]=n;else throw Error(gt+t+": "+n);if(t="crypto",r&&(this[t]=jn[t]),(n=i[t])!==void 0)if(n===!0||n===!1||n===0||n===1)if(n)if(typeof crypto<"u"&&crypto&&(crypto.getRandomValues||crypto.randomBytes))this[t]=!0;else throw Error(Ji);else this[t]=!1;else throw Error(gt+t+": "+n);return this}function Yo(i){return new this(i).cos()}function Jo(i){return new this(i).cosh()}function sr(i){var e,t,n;function r(o){var s,a,c,u=this;if(!(u instanceof r))return new r(o);if(u.constructor=r,ji(o)){u.s=o.s,Q?!o.d||o.e>r.maxE?(u.e=NaN,u.d=null):o.e<r.minE?(u.e=0,u.d=[0]):(u.e=o.e,u.d=o.d.slice()):(u.e=o.e,u.d=o.d?o.d.slice():o.d);return}if(c=typeof o,c==="number"){if(o===0){u.s=1/o<0?-1:1,u.e=0,u.d=[0];return}if(o<0?(o=-o,u.s=-1):u.s=1,o===~~o&&o<1e7){for(s=0,a=o;a>=10;a/=10)s++;Q?s>r.maxE?(u.e=NaN,u.d=null):s<r.minE?(u.e=0,u.d=[0]):(u.e=s,u.d=[o]):(u.e=s,u.d=[o]);return}else if(o*0!==0){o||(u.s=NaN),u.e=NaN,u.d=null;return}return Jn(u,o.toString())}else if(c!=="string")throw Error(gt+o);return(a=o.charCodeAt(0))===45?(o=o.slice(1),u.s=-1):(a===43&&(o=o.slice(1)),u.s=1),er.test(o)?Jn(u,o):vo(u,o)}if(r.prototype=S,r.ROUND_UP=0,r.ROUND_DOWN=1,r.ROUND_CEIL=2,r.ROUND_FLOOR=3,r.ROUND_HALF_UP=4,r.ROUND_HALF_DOWN=5,r.ROUND_HALF_EVEN=6,r.ROUND_HALF_CEIL=7,r.ROUND_HALF_FLOOR=8,r.EUCLID=9,r.config=r.set=Zo,r.clone=sr,r.isDecimal=ji,r.abs=Fo,r.acos=Wo,r.acosh=Vo,r.add=Do,r.asin=qo,r.asinh=Go,r.atan=Uo,r.atanh=Xo,r.atan2=zo,r.cbrt=Ho,r.ceil=Qo,r.clamp=jo,r.cos=Yo,r.cosh=Jo,r.div=$o,r.exp=es,r.floor=ts,r.hypot=ns,r.ln=is,r.log=rs,r.log10=ss,r.log2=os,r.max=as,r.min=us,r.mod=cs,r.mul=ls,r.pow=ms,r.random=ps,r.round=ds,r.sign=fs,r.sin=bs,r.sinh=ys,r.sqrt=gs,r.sub=Ps,r.sum=ks,r.tan=As,r.tanh=ws,r.trunc=hs,i===void 0&&(i={}),i&&i.defaults!==!0)for(n=["precision","rounding","toExpNeg","toExpPos","maxE","minE","modulo","crypto"],e=0;e<n.length;)i.hasOwnProperty(t=n[e++])||(i[t]=this[t]);return r.config(i),r}function $o(i,e){return new this(i).div(e)}function es(i){return new this(i).exp()}function ts(i){return V(i=new this(i),i.e+1,3)}function ns(){var i,e,t=new this(0);for(Q=!1,i=0;i<arguments.length;)if(e=new this(arguments[i++]),e.d)t.d&&(t=t.plus(e.times(e)));else{if(e.s)return Q=!0,new this(1/0);t=e}return Q=!0,t.sqrt()}function ji(i){return i instanceof Qt||i&&i.toStringTag===$i||!1}function is(i){return new this(i).ln()}function rs(i,e){return new this(i).log(e)}function os(i){return new this(i).log(2)}function ss(i){return new this(i).log(10)}function as(){return ir(this,arguments,"lt")}function us(){return ir(this,arguments,"gt")}function cs(i,e){return new this(i).mod(e)}function ls(i,e){return new this(i).mul(e)}function ms(i,e){return new this(i).pow(e)}function ps(i){var e,t,n,r,o=0,s=new this(1),a=[];if(i===void 0?i=this.precision:Me(i,1,Pt),n=Math.ceil(i/U),this.crypto)if(crypto.getRandomValues)for(e=crypto.getRandomValues(new Uint32Array(n));o<n;)r=e[o],r>=429e7?e[o]=crypto.getRandomValues(new Uint32Array(1))[0]:a[o++]=r%1e7;else if(crypto.randomBytes){for(e=crypto.randomBytes(n*=4);o<n;)r=e[o]+(e[o+1]<<8)+(e[o+2]<<16)+((e[o+3]&127)<<24),r>=214e7?crypto.randomBytes(4).copy(e,o):(a.push(r%1e7),o+=4);o=n/4}else throw Error(Ji);else for(;o<n;)a[o++]=Math.random()*1e7|0;for(n=a[--o],i%=U,n&&i&&(r=Be(10,U-i),a[o]=(n/r|0)*r);a[o]===0;o--)a.pop();if(o<0)t=0,a=[0];else{for(t=-1;a[0]===0;t-=U)a.shift();for(n=1,r=a[0];r>=10;r/=10)n++;n<U&&(t-=U-n)}return s.e=t,s.d=a,s}function ds(i){return V(i=new this(i),i.e+1,this.rounding)}function fs(i){return i=new this(i),i.d?i.d[0]?i.s:0*i.s:i.s||NaN}function bs(i){return new this(i).sin()}function ys(i){return new this(i).sinh()}function gs(i){return new this(i).sqrt()}function Ps(i,e){return new this(i).sub(e)}function ks(){var i=0,e=arguments,t=new this(e[i]);for(Q=!1;t.s&&++i<e.length;)t=t.plus(e[i]);return Q=!0,V(t,this.precision,this.rounding)}function As(i){return new this(i).tan()}function ws(i){return new this(i).tanh()}function hs(i){return V(i=new this(i),i.e+1,1)}S[Symbol.for("nodejs.util.inspect.custom")]=S.toString;S[Symbol.toStringTag]="Decimal";var Qt=S.constructor=sr(jn);yn=new Qt(yn);gn=new Qt(gn);var _=Qt;import{PublicKey as cr}from"@solana/web3.js";import{get as ar,set as Ts}from"lodash";var ei=class{constructor(e){this.logLevel=e.logLevel!==void 0?e.logLevel:0,this.name=e.name}set level(e){this.logLevel=e}get time(){return Date.now().toString()}get moduleName(){return this.name}isLogLevel(e){return e<=this.logLevel}error(...e){return this.isLogLevel(0)?(console.error(this.time,this.name,"sdk logger error",...e),this):this}logWithError(...e){let t=e.map(n=>typeof n=="object"?JSON.stringify(n):n).join(", ");throw new Error(t)}warning(...e){return this.isLogLevel(1)?(console.warn(this.time,this.name,"sdk logger warning",...e),this):this}info(...e){return this.isLogLevel(2)?(console.info(this.time,this.name,"sdk logger info",...e),this):this}debug(...e){return this.isLogLevel(3)?(console.debug(this.time,this.name,"sdk logger debug",...e),this):this}},ur={},Bs={};function ce(i){let e=ar(ur,i);if(!e){let t=ar(Bs,i);e=new ei({name:i,logLevel:t}),Ts(ur,i,e)}return e}import{MINT_SIZE as Is,TOKEN_PROGRAM_ID as xs,getTransferFeeConfig as Ss,unpackMint as Ks}from"@solana/spl-token";var ti=ce("Raydium_accountInfo_util");async function st(i,e,t){let{batchRequest:n,commitment:r="confirmed",chunkCount:o=100}=q({batchRequest:!1},t),s=ni(e,o),a=new Array(s.length).fill([]);if(n){let c=s.map(p=>{let m=i._buildArgs([p.map(d=>d.toBase58())],r,"base64");return{methodName:"getMultipleAccounts",args:m}}),u=ni(c,10);a=(await(await Promise.all(u.map(async p=>await i._rpcBatchRequest(p)))).flat()).map(p=>(p.error&&ti.logWithError(`failed to get info for multiple accounts, RPC_ERROR, ${p.error.message}`),p.result.value.map(m=>{if(m){let{data:d,executable:y,lamports:f,owner:b,rentEpoch:g}=m;return d.length!==2&&d[1]!=="base64"&&ti.logWithError("info must be base64 encoded, RPC_ERROR"),{data:Buffer.from(d[0],"base64"),executable:y,lamports:f,owner:new cr(b),rentEpoch:g}}return null})))}else try{a=await Promise.all(s.map(c=>i.getMultipleAccountsInfo(c,r)))}catch(c){c instanceof Error&&ti.logWithError(`failed to get info for multiple accounts, RPC_ERROR, ${c.message}`)}return a.flat()}async function xt(i,e,t){let n=await st(i,e.map(r=>r.pubkey),t);return e.map((r,o)=>J(q({},r),{accountInfo:n[o]}))}async function ii({connection:i,mints:e,config:t}){var o,s,a;if(e.length===0)return{};let n=await xt(i,e.map(c=>({pubkey:$e(c)})),t),r={};for(let c of n){if(!c.accountInfo||c.accountInfo.data.length<Is){console.log("invalid mint account",c.pubkey.toBase58());continue}let u=Ks(c.pubkey,c.accountInfo,(o=c.accountInfo)==null?void 0:o.owner);r[c.pubkey.toString()]=J(q({},u),{programId:((s=c.accountInfo)==null?void 0:s.owner)||xs,feeConfig:(a=Ss(u))!=null?a:void 0})}return r[cr.default.toBase58()]=r[He.toBase58()],r}import ut from"bn.js";import vs from"big.js";import Bn from"bn.js";import Cs from"toformat";var Ns=Cs,jt=Ns;import Tn from"big.js";import Rs from"bn.js";import Ms from"decimal.js-light";import Zt from"bn.js";var lr=9007199254740991;function le(i){let e=ce("Raydium_parseBigNumberish");if(i instanceof Zt)return i;if(typeof i=="string"){if(i.match(/^-?[0-9]+$/))return new Zt(i);e.logWithError(`invalid BigNumberish string: ${i}`)}return typeof i=="number"?(i%1&&e.logWithError(`BigNumberish number underflow: ${i}`),(i>=lr||i<=-lr)&&e.logWithError(`BigNumberish number overflow: ${i}`),new Zt(String(i))):typeof i=="bigint"?new Zt(i.toString()):(e.error(`invalid BigNumberish value: ${i}`),new Zt(0))}var hn=ce("module/fraction"),ri=jt(Tn),Yt=jt(Ms),Os={[0]:Yt.ROUND_DOWN,[1]:Yt.ROUND_HALF_UP,[2]:Yt.ROUND_UP},Es={[0]:Tn.roundDown,[1]:Tn.roundHalfUp,[2]:Tn.roundUp},oe=class{constructor(e,t=new Rs(1)){this.numerator=le(e),this.denominator=le(t)}get quotient(){return this.numerator.div(this.denominator)}invert(){return new oe(this.denominator,this.numerator)}add(e){let t=e instanceof oe?e:new oe(le(e));return this.denominator.eq(t.denominator)?new oe(this.numerator.add(t.numerator),this.denominator):new oe(this.numerator.mul(t.denominator).add(t.numerator.mul(this.denominator)),this.denominator.mul(t.denominator))}sub(e){let t=e instanceof oe?e:new oe(le(e));return this.denominator.eq(t.denominator)?new oe(this.numerator.sub(t.numerator),this.denominator):new oe(this.numerator.mul(t.denominator).sub(t.numerator.mul(this.denominator)),this.denominator.mul(t.denominator))}mul(e){let t=e instanceof oe?e:new oe(le(e));return new oe(this.numerator.mul(t.numerator),this.denominator.mul(t.denominator))}div(e){let t=e instanceof oe?e:new oe(le(e));return new oe(this.numerator.mul(t.denominator),this.denominator.mul(t.numerator))}toSignificant(e,t={groupSeparator:""},n=1){Number.isInteger(e)||hn.logWithError(`${e} is not an integer.`),e<=0&&hn.logWithError(`${e} is not positive.`),Yt.set({precision:e+1,rounding:Os[n]});let r=new Yt(this.numerator.toString()).div(this.denominator.toString()).toSignificantDigits(e);return r.toFormat(r.decimalPlaces(),t)}toFixed(e,t={groupSeparator:""},n=1){return Number.isInteger(e)||hn.logWithError(`${e} is not an integer.`),e<0&&hn.logWithError(`${e} is negative.`),ri.DP=e,ri.RM=Es[n]||1,new ri(this.numerator.toString()).div(this.denominator.toString()).toFormat(e,t)}isZero(){return this.numerator.isZero()}};var _s=ce("Raydium_amount"),mr=jt(vs);function Fs(i,e){let t="0",n="0";if(i.includes(".")){let r=i.split(".");r.length===2?([t,n]=r,n=n.padEnd(e,"0")):_s.logWithError(`invalid number string, num: ${i}`)}else t=i;return[t,n.slice(0,e)||n]}var me=class extends oe{constructor(t,n,r=!0,o){let s=new Bn(0),a=oi.pow(new Bn(t.decimals));if(r)s=le(n);else{let c=new Bn(0),u=new Bn(0);if(typeof n=="string"||typeof n=="number"||typeof n=="bigint"){let[l,p]=Fs(n.toString(),t.decimals);c=le(l),u=le(p)}c=c.mul(a),s=c.add(u)}super(s,a);this.logger=ce(o||"TokenAmount"),this.token=t}get raw(){return this.numerator}isZero(){return this.raw.isZero()}gt(t){return this.token.equals(t.token)||this.logger.logWithError("gt token not equals"),this.raw.gt(t.raw)}lt(t){return this.token.equals(t.token)||this.logger.logWithError("lt token not equals"),this.raw.lt(t.raw)}add(t){return this.token.equals(t.token)||this.logger.logWithError("add token not equals"),new me(this.token,this.raw.add(t.raw))}subtract(t){return this.token.equals(t.token)||this.logger.logWithError("sub token not equals"),new me(this.token,this.raw.sub(t.raw))}toSignificant(t=this.token.decimals,n,r=0){return super.toSignificant(t,n,r)}toFixed(t=this.token.decimals,n,r=0){return t>this.token.decimals&&this.logger.logWithError("decimals overflow"),super.toFixed(t,n,r)}toExact(t={groupSeparator:""}){return mr.DP=this.token.decimals,new mr(this.numerator.toString()).div(this.denominator.toString()).toFormat(t)}};import{PublicKey as Ws}from"@solana/web3.js";import{TOKEN_PROGRAM_ID as pr}from"@solana/spl-token";var si={chainId:101,address:Ws.default.toBase58(),programId:pr.toBase58(),decimals:9,symbol:"SOL",name:"solana",logoURI:"https://img-v1.raydium.io/icon/So11111111111111111111111111111111111111112.png",tags:[],priority:2,type:"raydium",extensions:{coingeckoId:"solana"}},et={chainId:101,address:"So11111111111111111111111111111111111111112",programId:pr.toBase58(),decimals:9,symbol:"WSOL",name:"Wrapped SOL",logoURI:"https://img-v1.raydium.io/icon/So11111111111111111111111111111111111111112.png",tags:[],priority:2,type:"raydium",extensions:{coingeckoId:"solana"}};import{PublicKey as ci}from"@solana/web3.js";import{PublicKey as be,SystemProgram as dr,SYSVAR_RENT_PUBKEY as Vs}from"@solana/web3.js";import{TOKEN_PROGRAM_ID as Ds}from"@solana/spl-token";function K({pubkey:i,isSigner:e=!1,isWritable:t=!0}){return{pubkey:i,isWritable:t,isSigner:e}}var pc=[K({pubkey:Ds,isWritable:!1}),K({pubkey:dr.programId,isWritable:!1}),K({pubkey:Vs,isWritable:!1})];function ai({publicKey:i,transformSol:e}){let t=ui(i.toString());if(t instanceof be)return e&&t.equals(Jt)?He:t;if(e&&t.toString()===Jt.toBase58())return He;if(typeof t=="string"){if(t===be.default.toBase58())return be.default;try{return new be(t)}catch{throw new Error("invalid public key")}}throw new Error("invalid public key")}function ui(i){try{return new be(i)}catch{return i}}var In=new be("MemoSq4gqABAXKb96qnH8TysNcWxMyWCqXgDLGmfcHr"),Vt=new be("MemoSq4gqABAXKb96qnH8TysNcWxMyWCqXgDLGmfcHr"),tt=new be("SysvarRent111111111111111111111111111111111"),dc=new be("SysvarC1ock11111111111111111111111111111111"),kt=new be("metaqbxxUerdq28cj1RbAWkYQm3ybzjb6a8bt518x1s"),fc=new be("Sysvar1nstructions1111111111111111111111111"),qs=dr.programId,bc=new be("4k3Dyjzvzp8eMZWUXbBCjEvwSkkk59S5iCNLY3QrkX6R"),yc=new be("Ea5SjE2Y6yvCeW5dYTn7PYMuW5ikXkvbGdcmSnXeaLjS"),gc=new be("SRMuApVNdxXokk5GT7XD5cUUgXMBCoAz2LHeuAoKWRt"),Pc=new be("EPjFWdd5AufqSSqeM2qN1xzybapC8G4wEGGkZwyTDt1v"),kc=new be("Es9vMFrzaCERmJfrF4H2FYD4KCoNkY11McCe8BenwNYB"),Ac=new be("mSoLzYCxHdYgdzU16g5QSh3i5K3z3KZK7ytfqcJm7So"),wc=new be("7dHbWXmci3dT8UFYWYZweBLXgycu7Y3iL6trKn1Y7ARj"),hc=new be("USDH1SM1ojwWUga67PGrgFWUHibbjqMvuMaDkRJTgkX"),Tc=new be("NRVwhjBQiUPYtfDT5zRBVJajzFQHaBUNtC7SNVvqRFa"),Bc=new be("ANAxByE6G2WjFp7A4NqtWYXb3mgruyzZYg3spfxe6Lbo"),Ic=new be("7vfCXTUXx5WJV5JADk17DUJ4ksgau7utNKj4b963voxs"),He=new be("So11111111111111111111111111111111111111112"),Jt=be.default;function $e(i){return ai({publicKey:i,transformSol:!0})}var li=class{constructor({mint:e,decimals:t,symbol:n,name:r,skipMint:o=!1,isToken2022:s=!1}){if(e===Jt.toBase58()||e instanceof ci&&Jt.equals(e)){this.decimals=et.decimals,this.symbol=et.symbol,this.name=et.name,this.mint=new ci(et.address),this.isToken2022=!1;return}this.decimals=t,this.symbol=n||e.toString().substring(0,6),this.name=r||e.toString().substring(0,6),this.mint=o?ci.default:ai({publicKey:e}),this.isToken2022=s}equals(e){return this===e?!0:this.mint.equals(e.mint)}},ve=li;ve.WSOL=new li(J(q({},et),{mint:et.address}));var mi=class{constructor({decimals:e,symbol:t="UNKNOWN",name:n="UNKNOWN"}){this.decimals=e,this.symbol=t,this.name=n}equals(e){return this===e}},xn=mi;xn.SOL=new mi(si);import Gs from"bn.js";var fr=new oe(new Gs(100)),at=class extends oe{toSignificant(e=5,t,n){return this.mul(fr).toSignificant(e,t,n)}toFixed(e=2,t,n){return this.mul(fr).toFixed(e,t,n)}};var Us=ce("Raydium_price"),Oe=class extends oe{constructor(t){let{baseToken:n,quoteToken:r,numerator:o,denominator:s}=t;super(o,s);this.baseToken=n,this.quoteToken=r,this.scalar=new oe(pi(n.decimals),pi(r.decimals))}get raw(){return new oe(this.numerator,this.denominator)}get adjusted(){return super.mul(this.scalar)}invert(){return new Oe({baseToken:this.quoteToken,quoteToken:this.baseToken,denominator:this.numerator,numerator:this.denominator})}mul(t){this.quoteToken!==t.baseToken&&Us.logWithError("mul token not equals");let n=super.mul(t);return new Oe({baseToken:this.baseToken,quoteToken:t.quoteToken,denominator:n.denominator,numerator:n.numerator})}toSignificant(t=this.quoteToken.decimals,n,r){return this.adjusted.toSignificant(t,n,r)}toFixed(t=this.quoteToken.decimals,n,r){return this.adjusted.toFixed(t,n,r)}};import{PublicKey as Xs}from"@solana/web3.js";import zs from"bn.js";function yr(i){return typeof i=="object"&&i!==null&&![ve,me,Xs,oe,zs,Oe,at].some(e=>typeof e=="object"&&i instanceof e)}function St(i){return typeof i=="string"?ui(i):Array.isArray(i)?i.map(e=>St(e)):yr(i)?Object.fromEntries(Object.entries(i).map(([e,t])=>[e,St(t)])):i}var br=new ut(0),Hs=new ut(1),Al=new ut(2),wl=new ut(3),hl=new ut(5),oi=new ut(10),Tl=new ut(100),Bl=new ut(1e3),Il=new ut(1e4);function pi(i){return oi.pow(le(i))}function ni(i,e=1,t=[]){let n=[...i];if(e<=0)return t;for(;n.length;)t.push(n.splice(0,e));return t}import{PublicKey as ea}from"@solana/web3.js";import{TOKEN_PROGRAM_ID as ta}from"@solana/spl-token";import{ComputeBudgetProgram as gr,Keypair as kr,PublicKey as Qs,Transaction as Ar,TransactionMessage as js,VersionedTransaction as wr}from"@solana/web3.js";var te={CreateAccount:"CreateAccount",InitAccount:"InitAccount",CreateATA:"CreateATA",CloseAccount:"CloseAccount",TransferAmount:"TransferAmount",InitMint:"InitMint",MintTo:"MintTo",InitMarket:"InitMarket",Util1216OwnerClaim:"Util1216OwnerClaim",SetComputeUnitPrice:"SetComputeUnitPrice",SetComputeUnitLimit:"SetComputeUnitLimit",ClmmCreatePool:"ClmmCreatePool",ClmmOpenPosition:"ClmmOpenPosition",ClmmIncreasePosition:"ClmmIncreasePosition",ClmmDecreasePosition:"ClmmDecreasePosition",ClmmClosePosition:"ClmmClosePosition",ClmmSwapBaseIn:"ClmmSwapBaseIn",ClmmSwapBaseOut:"ClmmSwapBaseOut",ClmmInitReward:"ClmmInitReward",ClmmSetReward:"ClmmSetReward",ClmmCollectReward:"ClmmCollectReward",ClmmLockPosition:"ClmmLockPosition",ClmmHarvestLockPosition:"ClmmHarvestLockPosition",AmmV4Swap:"AmmV4Swap",AmmV4AddLiquidity:"AmmV4AddLiquidity",AmmV4RemoveLiquidity:"AmmV4RemoveLiquidity",AmmV4SimulatePoolInfo:"AmmV4SimulatePoolInfo",AmmV4SwapBaseIn:"AmmV4SwapBaseIn",AmmV4SwapBaseOut:"AmmV4SwapBaseOut",AmmV4CreatePool:"AmmV4CreatePool",AmmV4InitPool:"AmmV4InitPool",AmmV5AddLiquidity:"AmmV5AddLiquidity",AmmV5RemoveLiquidity:"AmmV5RemoveLiquidity",AmmV5SimulatePoolInfo:"AmmV5SimulatePoolInfo",AmmV5SwapBaseIn:"AmmV5SwapBaseIn",AmmV5SwapBaseOut:"AmmV5SwapBaseOut",RouteSwap:"RouteSwap",RouteSwap1:"RouteSwap1",RouteSwap2:"RouteSwap2",FarmV3Deposit:"FarmV3Deposit",FarmV3Withdraw:"FarmV3Withdraw",FarmV3CreateLedger:"FarmV3CreateLedger",FarmV4Withdraw:"FarmV4Withdraw",FarmV5Deposit:"FarmV5Deposit",FarmV5Withdraw:"FarmV5Withdraw",FarmV5CreateLedger:"FarmV5CreateLedger",FarmV6Deposit:"FarmV6Deposit",FarmV6Withdraw:"FarmV6Withdraw",FarmV6Create:"FarmV6Create",FarmV6Restart:"FarmV6Restart",FarmV6CreatorAddReward:"FarmV6CreatorAddReward",FarmV6CreatorWithdraw:"FarmV6CreatorWithdraw",CpmmCreatePool:"CpmmCreatePool",CpmmAddLiquidity:"CpmmAddLiquidity",CpmmWithdrawLiquidity:"CpmmWithdrawLiquidity",CpmmSwapBaseIn:"CpmmSwapBaseIn",CpmmSwapBaseOut:"CpmmSwapBaseOut",CpmmLockLp:"CpmmLockLp",CpmmCollectLockFee:"CpmmCollectLockFee",TransferTip:"TransferTip"};import{TOKEN_PROGRAM_ID as Zs}from"@solana/spl-token";var Pr=ce("Raydium_txUtil"),hr=1644;function Sn(i){let e=[],t=[];return i.microLamports&&(e.push(gr.setComputeUnitPrice({microLamports:i.microLamports})),t.push(te.SetComputeUnitPrice)),i.units&&(e.push(gr.setComputeUnitLimit({units:i.units})),t.push(te.SetComputeUnitLimit)),{instructions:e,instructionTypes:t}}async function Dt(i,e){var n,r;let t=e!=null?e:"confirmed";return(r=await((n=i.getLatestBlockhash)==null?void 0:n.call(i,{commitment:t})))==null?void 0:r.blockhash}async function di(i,e){return i.getSignatureStatuses([e]),new Promise((t,n)=>{let r=setTimeout(n,6e4);i.onSignature(e,o=>{if(clearTimeout(r),!o.err){t("");return}n(Object.assign(o.err,{txId:e}))},"confirmed")})}function Ys(i,e){i.length<1&&Pr.logWithError(`no instructions provided: ${i.toString()}`),e.length<1&&Pr.logWithError(`no signers provided:, ${e.toString()}`);let t=new Ar;t.recentBlockhash="11111111111111111111111111111111",t.feePayer=e[0],t.add(...i);try{return Buffer.from(t.serialize({verifySignatures:!1})).toString("base64").length<hr}catch{return!1}}function we(i,e){let[t,n]=Qs.findProgramAddressSync(i,e);return{publicKey:t,nonce:n}}function $t({instructions:i,payer:e,signers:t}){return Ys(i,[e,...t])}function en({instructions:i,payer:e,lookupTableAddressAccount:t,recentBlockhash:n=kr.generate().publicKey.toString()}){let o=new js({payerKey:e,recentBlockhash:n,instructions:i}).compileToV0Message(Object.values(t!=null?t:{}));try{return Buffer.from(new wr(o).serialize()).toString("base64").length<hr}catch{return!1}}var Js=i=>Buffer.isBuffer(i)?i:i instanceof Uint8Array?Buffer.from(i.buffer,i.byteOffset,i.byteLength):Buffer.from(i),$s=i=>{let e=i.serialize({requireAllSignatures:!1,verifySignatures:!1});i instanceof wr&&(e=Js(e));try{return e instanceof Buffer?e.toString("base64"):Buffer.from(e).toString("base64")}catch{return e.toString("base64")}};function Kt(i){let e=[];return i.forEach(t=>{t instanceof Ar&&(t.recentBlockhash||(t.recentBlockhash=Zs.toBase58()),t.feePayer||(t.feePayer=kr.generate().publicKey)),e.push($s(t))}),console.log("simulate tx string:",e),e}function pe(i,e,t){return we([i.toBuffer(),(t!=null?t:ta).toBuffer(),e.toBuffer()],new ea("ATokenGPvbdGVxr1b2hvZbsiqW5xWH25efTNsLJA8knL"))}import{PublicKey as j}from"@solana/web3.js";var zl=new j("EhhTKczWMGQt46ynNeRX1WfeagwwJd7ufHvCDjRxjo5Q"),Hl=new j("CBuCnLe26faBpcBP2fktp4rp8abpcAnTWft6ZrP5Q4T"),Ql=new j("9KEPoZmtHUrBbhWN1v1KWLMkkvwY6WLtAVUCPRtRjP4z"),jl=new j("FarmqiPv5eAj3j1GMdMCMUGXqPUvmquZtMy86QH6rzhG"),Zl=new j("CLaimxFqjHzgTJtAGHU47NPhg6qrc5sCnpC4tBLyABQS"),Yl=new j("srmqPvymJeFKQ4zGQed1GFppgkRHL9kaELCbyksJtPX"),fi=new j("9xQeWvG816bUx9EPjHmaT23yvVM2ZWbrrpZb9PusVFin"),Tr=new j("675kPX9MHTjS2zt1qfr1NYHuzeLXfQM9H24wFSUt1Mp8"),Jl=new j("5quBtoiQqxF9Jv6KYKctB59NT3gtJD2Y65kdnB1Uev3h"),Br=new j("CDSr3ssLcRB6XYPJwAfFt18MZvEZp4LjHcvzBVZ45duo"),bi=new j("CAMMCzo5YL8w4VFF8KVHrK22GGUsp5VTaW7grrKgrWqK"),na=new j("LockrWmn6K5twhz3y9w1dQERbmgSaRkfnTeTKbpofwE"),ia=new j("kN1kEznaF5Xbd8LYuqtEFcxzWSBk5Fv6ygX6SqEGJVy"),$l=new j("routeUGWgWzqBWFcrCfv8tritsqukccJPu3q5GPP3xS"),em=new j("7YttLkHDoNj9wyDur5pM1ejNaAvT9X4eqaYcHQqtj2G5"),tm=new j("6FJon3QE27qgPVggARueB22hLvoh22VzJpXv4rBEoSLF"),nm=new j("CC12se5To1CdEuw7fDS27B7Geo5jJyL7t5UK2B44NgiH"),im=new j("9HzJyW1qZsEiSfMUf6L2jo3CcTKAyBmSyKdwQeYisHrC"),rm=new j("DropEU8AvevN3UrXWXTMuz3rqnMczQVNjq3kcSdW2SQi"),yi=new j("CPMMoo8L3F4NbTegBCKVNunggL7H1ZpdTHKxQB5qKP1C"),ra=new j("GpMZbSM2GgvTKHJirzeGfMFoaZ8UR2X7F4v8vHTvxFbL"),om=new j("DNXgeM9EiiaAbaWvwjHj9fQQLAX5ZsfHyvmYUNRAdNC8"),oa=new j("CPMDWBwJDtYax9qW7AyRuVC19Cc4L4Vcy4n2BHAbHkCW"),sa=new j("7rQ1QFNosMkUCuh7Z7fPbTHvh73b68sQYdirycEzJVuw"),aa=new j("G11FKBRaAkHAKuLCgLM6K6NUc9rTjPAznRCjZifrTQe2"),sm=new j("LockrWmn6K5twhz3y9w1dQERbmgSaRkfnTeTKbpofwE"),ua=new j("DLockwT7X7sxtLmGH9g5kmfcjaBtncdbUmi738m5bvQC"),am=new j("3f7GcQFG397GAaEnv51zR6tsTVihYRydnydDD1cXekxH"),ca=new j("7AFUeLVRjBfzqK3tTGw8hN48KLQWSk6DTE8xprWdPqix"),um=new j("LanMV9sAd7wArD4vJFi2qDdfnVhFxYSUg6eADduJ3uj"),cm=new j("WLHv2UAZm6z4KyaaELi5pjdbJh6RESMva1Rnn8pJVVh"),la=new j("LanD8FpTBBvzZFXjTxsAoipkFsxPUCDB4qAqKxYDiNP"),ma=new j("HYNHiyKJ3gGVFvyxJAurK7qr7P2o5J9THmvCGMdULtpW");var lm={AMM_V4:new j("HWy1jotHpo6UqeQxx49dpYYdQB8wj9Qk9MdxwjLvDHB8"),AMM_STABLE:new j("DDg4VmQaJV9ogWce7LpcjBA9bv22wRp5uaTPa5pGjijF"),CLMM_PROGRAM_ID:new j("devi51mZmdwUJGU9hjN27vEz64Gps7uUefqxg27EAtH"),CLMM_LOCK_PROGRAM_ID:new j("DLockwT7X7sxtLmGH9g5kmfcjaBtncdbUmi738m5bvQC"),CLMM_LOCK_AUTH_ID:new j("8qmHNvu2Kr2C7U8mJL4Vz1vTDxMhVuXKREwU7TNoaVEo"),FARM_PROGRAM_ID_V3:new j("85BFyr98MbCUU9MVTEgzx1nbhWACbJqLzho6zd6DZcWL"),FARM_PROGRAM_ID_V5:new j("EcLzTrNg9V7qhcdyXDe2qjtPkiGzDM2UbdRaeaadU5r2"),FARM_PROGRAM_ID_V6:new j("Farm2hJLcqPtPg8M4rR6DMrsRNc5TPm5Cs4bVQrMe2T7"),OPEN_BOOK_PROGRAM:new j("EoTcMgcDRTJVZDMZWBoU6rhYHZfkNTVEAfz3uUJRcYGj"),SERUM_PROGRAM_ID_V3:j.default,UTIL1216:j.default,Router:new j("BVChZ3XFEwTMUk1o9i3HAf91H6mFxSwa5X2wFAWhYPhU"),CREATE_CPMM_POOL_PROGRAM:oa,CREATE_CPMM_POOL_AUTH:sa,CREATE_CPMM_POOL_FEE_ACC:aa,LOCK_CPMM_PROGRAM:ua,LOCK_CPMM_AUTH:ca,LAUNCHPAD_PROGRAM:la,LAUNCHPAD_AUTH:ma,FEE_DESTINATION_ID:new j("3XMrhbv989VxAMi3DErLV9eJht1pHppW5LbKxe9fkEFR")};import Qe from"bn.js";var tn=1e4;function ke(i,e,t,n){if(e===void 0)return{amount:i,fee:void 0,expirationTime:void 0};let r=J(q({},e),{olderTransferFee:{epoch:BigInt(e.olderTransferFee.epoch),maximumFee:BigInt(e.olderTransferFee.maximumFee),transferFeeBasisPoints:e.olderTransferFee.transferFeeBasisPoints},newerTransferFee:{epoch:BigInt(e.newerTransferFee.epoch),maximumFee:BigInt(e.newerTransferFee.maximumFee),transferFeeBasisPoints:e.newerTransferFee.transferFeeBasisPoints}}),o=t.epoch<r.newerTransferFee.epoch?r.olderTransferFee:r.newerTransferFee,s=new Qe(o.maximumFee.toString()),a=t.epoch<r.newerTransferFee.epoch?(Number(r.newerTransferFee.epoch)*t.slotsInEpoch-t.absoluteSlot)*400/1e3:void 0;if(n)if(o.transferFeeBasisPoints===tn){let c=new Qe(o.maximumFee.toString());return{amount:i.add(c),fee:c,expirationTime:a}}else{let c=Kn(i.mul(new Qe(tn)),new Qe(tn-o.transferFeeBasisPoints)),u=new Qe(o.maximumFee.toString()),l=c.sub(i).gt(u)?i.add(u):c,p=Kn(l.mul(new Qe(o.transferFeeBasisPoints)),new Qe(tn)),m=p.gt(s)?s:p;return{amount:l,fee:m,expirationTime:a}}else{let c=Kn(i.mul(new Qe(o.transferFeeBasisPoints)),new Qe(tn)),u=c.gt(s)?s:c;return{amount:i,fee:u,expirationTime:a}}}function je(i,e){return i===void 0?e:e===void 0?i:Math.min(i,e)}function Kn(i,e){let{div:t,mod:n}=i.divmod(e);return n.gt(new Qe(0))?t.add(new Qe(1)):t}import{PublicKey as Ir,AddressLookupTableAccount as Cn}from"@solana/web3.js";async function gi({connection:i,address:e}){let t=await st(i,[...new Set(e.map(r=>r.toString()))].map(r=>new Ir(r))),n={};for(let r=0;r<e.length;r++){let o=t[r],s=e[r];if(!o)continue;let a=new Cn({key:s,state:Cn.deserialize(o.data)});n[s.toString()]=a,Nn[s.toString()]=a}return n}var Nn={AcL1Vo8oy1ULiavEcjSUcwfBSForXMudcZvDZy5nzJkU:new Cn({key:new Ir("AcL1Vo8oy1ULiavEcjSUcwfBSForXMudcZvDZy5nzJkU"),state:Cn.deserialize(Buffer.from("AQAAAP//////////I1rcEwAAAAAvAQYwun9CU6c5Ikm2pAj+D9IEnCOR45nK+SFTGSdpd6J6AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAbd9uHXZaGT2cvhRs7reawctIXtX1s3kTqM9YV+/wCpBt324e51j94YQl285GzN2rYa/E2DuQ0n/r35KNihi/wFSlNQ+F3IgtYUpVZyeIopbd8eq6vQpgZ4iEky9O72oAVKU1qZKSEGTSTocWDaOHx8NbXdvJK7geQfqEBBBUSNBqfVFxksXFEhjMlMPUrxf1ja7gibof1E49vZigAAAAAGp9UXGMd0yShWY5hpHV62i164o5tLbVxzVVshAAAAAIyXJY9OJInxuz0QKRSODYMLWhOZ2v8QhASOe9jb6fhZC3BlsePRfEU4nVJ/awTDzVi4bHMaoP21SbbRvAP4KUbIScv+6Yw2LHF/6K0ZjUPibbSWXCirYPGuuVl7zT789IUPLW4CpHr4JNCatp3ELXDLKMv6JJ+37le50lbBJ2LvBkX2T9y7AHdNGviJAqQNtlDUDCnauQRWybsLji6nPM8Qkw5asQRvCdB3MbX6IEBwytOrpM32l4jQygKG9TKgR0vZScQ2AsM/IHeQ7RajUkyhuZdc8SGiqQz/7H34torNR/Wir3sl0ruUrVxJWEZfUg+QLNAxxODdBi53/OP7Ioil1cqeBM9dtZC3FLov4yyxWRM/wcGStyJX/QfTnLBAHqkqWotPKVlShCVQqpP9W5W1rOao65IMk5QuQ2kMIOxzDMKAy2vjGSxQODgBz0QwGA+eP4ZjIjrIAQaXENv31QfLlOdXSRCkaybRniDHF4C8YcwhcvsqrOVuTP4B2Na+9wLdtrB31uz2rtlFI5kahdsnp/d1SrASDInYCtTYtdoke4kX+hoKWcEWM4Tle8pTUkUVv4BxS6fje/EzKBE4Qu/YsA/yfEEFGcr8Z57VKDw8uQzpiru7g4lvjnfapW62W030syevD8k07SGoxUHiuT/ai7gAHWWhDsVmg/C63ajgpkH7Sn3GdutArDTfyqOkdqv4/IPC/EFFy7mGkfDd2C57N5a/4jC+BbmJy7wQaSEZr0CQU88lPtUxIVvzGjC95b8Ooss2TqmkrayGKofkPMGQn7Ux+9lfwBSNfxwH8NgbpqC/7LNlV4I7nCvsXf3p+ohQk9NrAJb2KAFpUqEIJ9ZBV7BYDzHF/ORKYlgtvPnXjudZQ6CEo5OzUDaNIomTCCsvhD16TxJjsbgne1kGnQPCFSoaxUbq2V1bPMFQ3VYP6wDZ9bKStCFKx9A3tNbwZFC5ZGAN83MFK7XoTy+OmmcFEr6rLOjfSuTfPvHJkSVxW6Qllwkl67XcBi5v00u2gQsbu+38sp+rd5pA/LvyWj4P94ZGZwc1tE2P88xekCLcAwZGb+UhFzL/7K26csOb57yM5bvF9xJrLEObOkAAAAAn+HWRkdcPKyFFMnVwEoD7vnD0jCKFIU1sImubYCxNTSVzsKpaQX+fzNxrLAI3L14JQnJx/D6Uk2LADIHGqnGELzjEbkBDAlaM77NkXMPfqXNLSveCkWI7UEgNs31WEWB6XHSYI/v5DklHOb4QTtDOR804PVbi3fjloZeLR2F8d4FuZmMMO7ck3Fnkn2zEMG5gOmqsygb6PjTitArVl52NhcSznTxVnguaIJxiZkAnurDmn3MWR0PC2GLghp2KJqHCc6QQ85odeIjFHKOlRlJyeSXVJmL8vb1UgOzsbJPVP8p6zM4M3C1Sd7uWIHP33G42AP2Zg8ucn/n6meQjjD266JgCWdxZD6PXs9CsnIeL7SSG0/6lGb9xfP0ZcWkCXB/3hjxHYVXjra/GPOeXGk0fLLKjCbk+mgs2w6d2oCwimBipTzuoZ30GiI8ij8VRzD5CzMWtu2m21eDBIfjGAEo4pQeNNonKcqzV/cleX8ySZLOHsz8PtBCrLqF+VkLm9hOzIT+6i/nIf6keR4GWKMOD4AvqfpjHoD4DuhBpz8P28+DxkGrDXXr/nr20x291VPvcTU/b+b+o2kC9G0kcXeTlLjU6a2TQXWlZ4gBUdBl1jgT7mObSTpLblNiXZsLkbmVXZwvFKXua5cUKlWed/w30skmEUraTuQqtqr5fHZPW9n57EmeTif6LjHL2YJFZkQU+TrJmFzqzmF4/b8OwrPQAprl8mX3q4LUIdAS/a+11B6DWD1Xk2++Sn94dLC4xjkO4Wtlw8c4XuzciVbepHOmnoWzVu/0y3KCrLCSfQxQ3br8DJCoVzhgtPsS2nZZjsBGIZgnU0QpMv+2MnRsnKwdp1VsrCX84j/qvaZn4WhKunippgTbN2EUs0tPTP55Qfgj+nKmjtWW5IYs72FrEwJKYoNfsmqaF4o5pf4v9zgPwVwY/5I4XJKUL2L25m9kAQcW/K+H1RTFEUoj8Z4ajpOmAB/dG0COmCphVMW2CCMvnxhcGiSgPnpDuWu6qiJ7NG7ye5kvHgefgqPLeicspNJ5EpL3XiRNLM2tmJLI1awAwOyd6iHv0dCkMYRKaa6rcaZeYwmKCkckm0kM2JNmnmmAaBQQ7mwmIM0IMxX4f5W6j9PqZWcJxF7r17T/lQBAmcjoupRiJifbnXCNUv9GhpRF19WcBdeKbivRJVlGop6I2RS6lGImJ9udcI1S/0aGlEXX1ZwF14puK9ElWUainojZFYVHLHD6dIP2ESjqBzg3ol1/wB7+/ylGwd9LS7wSZ2A630CJSVKwH47K9P4bB8PEQP8BwjMFa7xQHOqZFP1XqaQ==","base64"))})};import{PublicKey as Ct,sendAndConfirmTransaction as Pi,SystemProgram as xr,Transaction as nn,TransactionMessage as At,VersionedTransaction as wt}from"@solana/web3.js";import pa from"axios";import{LAMPORTS_PER_SOL as Cr}from"@solana/web3.js";var Nm=.001*Cr,Sr=["4ACfpUFoaSD9bfPdeu6DBt89gB6ENTeHBXCAi87NhDEE","D2L6yPZ2FmmmTKPgzaMKdhu6EWZcTpLy1Vhx8uvZe7NZ","9bnz4RShgq1hAnLnZbP8kbgBg1kEmcJBYQq3gQbmnSta","5VY91ws6B2hMmBFRsXkoAAdsPHBJwRfBht4DXox3xkwn","2nyhqdwKcJZR2vcqCyrYsaPVdAnFoJjiksCXJ7hfEYgD","2q5pghRs6arqVjRvT5gfgWfWcHWmw1ZuCzphgd5KfWGJ","wyvPkWjVZz1M8fHQnMMCDTQDbkManefNNhweYk5WkcF","3KCKozbAaF75qEU33jtzozcJ29yJuaLJTy2jFdzUY8bT","4vieeGHPYPG2MmyPRcYjdiDmmhN3ww7hsFNap8pVN3Ey","4TQLFNWK8AovT1gFvda5jfw2oJeRMKEmw7aH6MGBJ3or"].map(i=>new Ct(i)),Ln=2e3;var Rn=class{constructor(e){this.instructions=[];this.endInstructions=[];this.lookupTableAddress=[];this.signers=[];this.instructionTypes=[];this.endInstructionTypes=[];this.connection=e.connection,this.feePayer=e.feePayer,this.signAllTransactions=e.signAllTransactions,this.owner=e.owner,this.cluster=e.cluster,this.blockhashCommitment=e.blockhashCommitment,this.loopMultiTxStatus=!!e.loopMultiTxStatus}get AllTxData(){return{instructions:this.instructions,endInstructions:this.endInstructions,signers:this.signers,instructionTypes:this.instructionTypes,endInstructionTypes:this.endInstructionTypes,lookupTableAddress:this.lookupTableAddress}}get allInstructions(){return[...this.instructions,...this.endInstructions]}async getComputeBudgetConfig(){var n;let e=(await pa.get(`https://solanacompass.com/api/fees?cacheFreshTime=${3e5}`)).data,{avg:t}=(n=e==null?void 0:e[15])!=null?n:{};if(!!t)return{units:6e5,microLamports:Math.min(Math.ceil(t*1e6/6e5),25e3)}}addCustomComputeBudget(e){if(e){let{instructions:t,instructionTypes:n}=Sn(e);return this.instructions.unshift(...t),this.instructionTypes.unshift(...n),!0}return!1}addTipInstruction(e){var t;return e?(this.endInstructions.push(xr.transfer({fromPubkey:(t=e.feePayer)!=null?t:this.feePayer,toPubkey:new Ct(e.address),lamports:BigInt(e.amount.toString())})),this.endInstructionTypes.push(te.TransferTip),!0):!1}async calComputeBudget({config:e,defaultIns:t}){try{let n=e||await this.getComputeBudgetConfig();if(this.addCustomComputeBudget(n))return;t&&this.instructions.unshift(...t)}catch{t&&this.instructions.unshift(...t)}}addInstruction({instructions:e=[],endInstructions:t=[],signers:n=[],instructionTypes:r=[],endInstructionTypes:o=[],lookupTableAddress:s=[]}){return this.instructions.push(...e),this.endInstructions.push(...t),this.signers.push(...n),this.instructionTypes.push(...r),this.endInstructionTypes.push(...o),this.lookupTableAddress.push(...s.filter(a=>a!==Ct.default.toString())),this}async versionBuild({txVersion:e,extInfo:t}){return e===0?await this.buildV0(q({},t||{})):this.build(t)}build(e){var n;let t=new nn;return this.allInstructions.length&&t.add(...this.allInstructions),t.feePayer=this.feePayer,((n=this.owner)==null?void 0:n.signer)&&!this.signers.some(r=>r.publicKey.equals(this.owner.publicKey))&&this.signers.push(this.owner.signer),{builder:this,transaction:t,signers:this.signers,instructionTypes:[...this.instructionTypes,...this.endInstructionTypes],execute:async r=>{var l;let{recentBlockHash:o,skipPreflight:s=!0,sendAndConfirm:a,notSendToRpc:c}=r||{},u=o!=null?o:await Dt(this.connection,this.blockhashCommitment);if(t.recentBlockhash=u,this.signers.length&&t.sign(...this.signers),Kt([t]),console.log("SEND 1"),(l=this.owner)!=null&&l.isKeyPair)return{txId:a?await Pi(this.connection,t,this.signers.find(m=>m.publicKey.equals(this.owner.publicKey))?this.signers:[...this.signers,this.owner.signer],{skipPreflight:s}):await this.connection.sendRawTransaction(t.serialize(),{skipPreflight:s}),signedTx:t};if(this.signAllTransactions){let p=await this.signAllTransactions([t]);if(this.signers.length)for(let m of p)try{m.sign(...this.signers)}catch{}return{txId:c?"":await this.connection.sendRawTransaction(p[0].serialize(),{skipPreflight:s}),signedTx:p[0]}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:e||{}}}buildMultiTx(e){var u;let{extraPreBuildData:t=[],extInfo:n}=e,{transaction:r}=this.build(n),o=t.filter(l=>l.transaction.instructions.length>0),s=[r,...o.map(l=>l.transaction)],a=[this.signers,...o.map(l=>l.signers)],c=[...this.instructionTypes,...o.map(l=>l.instructionTypes).flat()];return(u=this.owner)!=null&&u.signer&&a.forEach(l=>{l.some(p=>p.publicKey.equals(this.owner.publicKey))||this.signers.push(this.owner.signer)}),{builder:this,transactions:s,signers:a,instructionTypes:c,execute:async l=>{var g;let{sequentially:p,onTxUpdate:m,skipTxCount:d=0,recentBlockHash:y,skipPreflight:f=!0}=l||{},b=y!=null?y:await Dt(this.connection,this.blockhashCommitment);if((g=this.owner)!=null&&g.isKeyPair){if(p){let A=[],w=0;for(let T of s){if(++w,w<=d)continue;let B=await Pi(this.connection,T,this.signers.find(k=>k.publicKey.equals(this.owner.publicKey))?this.signers:[...this.signers,this.owner.signer],{skipPreflight:f});A.push(B)}return{txIds:A,signedTxs:s}}return{txIds:await await Promise.all(s.map(async A=>(A.recentBlockhash=b,await this.connection.sendRawTransaction(A.serialize(),{skipPreflight:f})))),signedTxs:s}}if(this.signAllTransactions){let A=s.map((T,B)=>(T.recentBlockhash=b,a[B].length&&T.sign(...a[B]),T));Kt(A),console.log("SEND 2");let w=await this.signAllTransactions(A);if(p){let T=0,B=[],k=async()=>{if(!w[T])return;let x=await this.connection.sendRawTransaction(w[T].serialize(),{skipPreflight:f});B.push({txId:x,status:"sent",signedTx:w[T]}),m==null||m([...B]),T++;let I=!1,R=null,h=null,L=G=>{R!==null&&clearInterval(R),h!==null&&this.connection.removeSignatureListener(h);let E=B.findIndex(z=>z.txId===x);if(E>-1){if(B[E].status==="error"||B[E].status==="success")return;B[E].status=G.err?"error":"success"}m==null||m([...B]),G.err||k()};this.loopMultiTxStatus&&(R=setInterval(async()=>{var G;if(I){clearInterval(R);return}try{let E=await this.connection.getTransaction(x,{commitment:"confirmed",maxSupportedTransactionVersion:0});E&&(I=!0,clearInterval(R),L({err:((G=E.meta)==null?void 0:G.err)||null}),console.log("tx status from getTransaction:",x))}catch(E){I=!0,clearInterval(R),console.error("getTransaction timeout:",E,x)}},Ln)),h=this.connection.onSignature(x,G=>{if(I){this.connection.removeSignatureListener(h);return}I=!0,L(G)},"confirmed"),this.connection.getSignatureStatus(x)};return await k(),{txIds:B.map(x=>x.txId),signedTxs:w}}else{let T=[];for(let B=0;B<w.length;B+=1){let k=await this.connection.sendRawTransaction(w[B].serialize(),{skipPreflight:f});T.push(k)}return{txIds:T,signedTxs:w}}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:n||{}}}async versionMultiBuild({extraPreBuildData:e,txVersion:t,extInfo:n}){return t===0?await this.buildV0MultiTx({extraPreBuildData:e,buildProps:n||{}}):this.buildMultiTx({extraPreBuildData:e,extInfo:n})}async buildV0(e){var f;let y=e||{},{lookupTableCache:t={},lookupTableAddress:n=[],forerunCreate:r,recentBlockhash:o}=y,s=It(y,["lookupTableCache","lookupTableAddress","forerunCreate","recentBlockhash"]),a=q(q({},this.cluster==="devnet"?{}:Nn),t),c=Array.from(new Set([...n,...this.lookupTableAddress])),u=[];for(let b of c)a[b]===void 0&&u.push(new Ct(b));let l=await gi({connection:this.connection,address:u});for(let[b,g]of Object.entries(l))a[b]=g;let p=r?Ct.default.toBase58():o!=null?o:await Dt(this.connection,this.blockhashCommitment),m=new At({payerKey:this.feePayer,recentBlockhash:p,instructions:[...this.allInstructions]}).compileToV0Message(Object.values(a));((f=this.owner)==null?void 0:f.signer)&&!this.signers.some(b=>b.publicKey.equals(this.owner.publicKey))&&this.signers.push(this.owner.signer);let d=new wt(m);return d.sign(this.signers),{builder:this,transaction:d,signers:this.signers,instructionTypes:[...this.instructionTypes,...this.endInstructionTypes],execute:async b=>{var T;let{skipPreflight:g=!0,sendAndConfirm:A,notSendToRpc:w}=b||{};if(Kt([d]),console.log("SEND 3"),(T=this.owner)!=null&&T.isKeyPair){let B=await this.connection.sendTransaction(d,{skipPreflight:g});return A&&await di(this.connection,B),{txId:B,signedTx:d}}if(this.signAllTransactions){let B=await this.signAllTransactions([d]);if(this.signers.length)for(let k of B)try{k.sign(this.signers)}catch{}return{txId:w?"":await this.connection.sendTransaction(B[0],{skipPreflight:g}),signedTx:B[0]}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:s||{}}}async buildV0MultiTx(e){var u;let{extraPreBuildData:t=[],buildProps:n}=e,{transaction:r}=await this.buildV0(n),o=t.filter(l=>l.builder.instructions.length>0),s=[r,...o.map(l=>l.transaction)],a=[this.signers,...o.map(l=>l.signers)],c=[...this.instructionTypes,...o.map(l=>l.instructionTypes).flat()];return(u=this.owner)!=null&&u.signer&&a.forEach(l=>{l.some(p=>p.publicKey.equals(this.owner.publicKey))||this.signers.push(this.owner.signer)}),s.forEach(async(l,p)=>{l.sign(a[p])}),{builder:this,transactions:s,signers:a,instructionTypes:c,buildProps:n,execute:async l=>{var f;let{sequentially:p,onTxUpdate:m,recentBlockHash:d,skipPreflight:y=!0}=l||{};if(d&&s.forEach(b=>b.message.recentBlockhash=d),Kt(s),console.log("SEND 4"),(f=this.owner)!=null&&f.isKeyPair){if(p){let b=[];for(let g of s){let A=await this.connection.sendTransaction(g,{skipPreflight:y});await di(this.connection,A),b.push(A)}return{txIds:b,signedTxs:s}}return{txIds:await Promise.all(s.map(async b=>await this.connection.sendTransaction(b,{skipPreflight:y}))),signedTxs:s}}if(this.signAllTransactions){let b=await this.signAllTransactions(s);if(p){let g=0,A=[],w=async()=>{if(!b[g])return;let T=await this.connection.sendTransaction(b[g],{skipPreflight:y});A.push({txId:T,status:"sent",signedTx:b[g]}),m==null||m([...A]),g++;let B=!1,k=null,x=null,I=R=>{k!==null&&clearInterval(k),x!==null&&this.connection.removeSignatureListener(x);let h=A.findIndex(L=>L.txId===T);if(h>-1){if(A[h].status==="error"||A[h].status==="success")return;A[h].status=R.err?"error":"success"}m==null||m([...A]),R.err||w()};this.loopMultiTxStatus&&(k=setInterval(async()=>{var R;if(B){clearInterval(k);return}try{let h=await this.connection.getTransaction(T,{commitment:"confirmed",maxSupportedTransactionVersion:0});h&&(B=!0,clearInterval(k),I({err:((R=h.meta)==null?void 0:R.err)||null}),console.log("tx status from getTransaction:",T))}catch(h){B=!0,clearInterval(k),console.error("getTransaction timeout:",h,T)}},Ln)),x=this.connection.onSignature(T,R=>{if(B){this.connection.removeSignatureListener(x);return}B=!0,I(R)},"confirmed"),this.connection.getSignatureStatus(T)};return w(),{txIds:[],signedTxs:b}}else{let g=[];for(let A=0;A<b.length;A+=1){let w=await this.connection.sendTransaction(b[A],{skipPreflight:y});g.push(w)}return{txIds:g,signedTxs:b}}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:n||{}}}async sizeCheckBuild(e){var m;let p=e||{},{splitIns:t=[],computeBudgetConfig:n}=p,r=It(p,["splitIns","computeBudgetConfig"]),o=n?Sn(n):{instructions:[],instructionTypes:[]},s=this.signers.reduce((d,y)=>J(q({},d),{[y.publicKey.toBase58()]:y}),{}),a=[],c=[],u=[],l=0;if(this.allInstructions.forEach(d=>{let y=[...u,d],f=n?[...o.instructions,...y]:y,g=[...new Set(y.map(A=>A.keys.filter(w=>w.isSigner).map(w=>w.pubkey.toString())).flat()).values()].map(A=>new Ct(A));if(d!==t[l]&&u.length<12&&($t({instructions:f,payer:this.feePayer,signers:g})||$t({instructions:y,payer:this.feePayer,signers:g})))u.push(d);else{if(u.length===0)throw Error("item ins too big");l+=d===t[l]?1:0,$t({instructions:n?[...o.instructions,...u]:[...u],payer:this.feePayer,signers:g})?a.push(new nn().add(...o.instructions,...u)):a.push(new nn().add(...u)),c.push(Array.from(new Set(u.map(A=>A.keys.filter(w=>w.isSigner).map(w=>w.pubkey.toString())).flat())).map(A=>s[A]).filter(A=>A!==void 0)),u=[d]}}),u.length>0){let y=[...new Set(u.map(f=>f.keys.filter(b=>b.isSigner).map(b=>b.pubkey.toString())).flat()).values()].map(f=>s[f]).filter(f=>f!==void 0);$t({instructions:n?[...o.instructions,...u]:[...u],payer:this.feePayer,signers:y.map(f=>f.publicKey)})?a.push(new nn().add(...o.instructions,...u)):a.push(new nn().add(...u)),c.push(y)}return a.forEach(d=>d.feePayer=this.feePayer),(m=this.owner)!=null&&m.signer&&c.forEach(d=>{d.some(y=>y.publicKey.equals(this.owner.publicKey))||d.push(this.owner.signer)}),{builder:this,transactions:a,signers:c,instructionTypes:this.instructionTypes,execute:async d=>{var T;let{sequentially:y,onTxUpdate:f,skipTxCount:b=0,recentBlockHash:g,skipPreflight:A=!0}=d||{},w=g!=null?g:await Dt(this.connection,this.blockhashCommitment);if(a.forEach(async(B,k)=>{B.recentBlockhash=w,c[k].length&&B.sign(...c[k])}),Kt(a),console.log("SEND 5"),console.log("sizeCheckBuild"),(T=this.owner)!=null&&T.isKeyPair){if(y){let B=0,k=[];for(let x of a){if(++B,B<=b){k.push("tx skipped");continue}let I=await Pi(this.connection,x,this.signers.find(R=>R.publicKey.equals(this.owner.publicKey))?this.signers:[...this.signers,this.owner.signer],{skipPreflight:A});k.push(I)}return{txIds:k,signedTxs:a}}return{txIds:await Promise.all(a.map(async B=>await this.connection.sendRawTransaction(B.serialize(),{skipPreflight:A}))),signedTxs:a}}if(this.signAllTransactions){let B=await this.signAllTransactions(a.slice(b,a.length)),k=[...a.slice(0,b),...B];if(y){let x=0,I=[],R=async()=>{if(!k[x])return;x<b&&(I.push({txId:"",status:"success",signedTx:k[x]}),f==null||f([...I]),x++,R());let h=await this.connection.sendRawTransaction(k[x].serialize(),{skipPreflight:A});I.push({txId:h,status:"sent",signedTx:k[x]}),f==null||f([...I]),x++;let L=!1,G=null,E=null,z=D=>{G!==null&&clearInterval(G),E!==null&&this.connection.removeSignatureListener(E);let v=I.findIndex(qe=>qe.txId===h);if(v>-1){if(I[v].status==="error"||I[v].status==="success")return;I[v].status=D.err?"error":"success"}f==null||f([...I]),D.err||R()};this.loopMultiTxStatus&&(G=setInterval(async()=>{var D;if(L){clearInterval(G);return}try{let v=await this.connection.getTransaction(h,{commitment:"confirmed",maxSupportedTransactionVersion:0});v&&(L=!0,clearInterval(G),z({err:((D=v.meta)==null?void 0:D.err)||null}),console.log("tx status from getTransaction:",h))}catch(v){L=!0,clearInterval(G),console.error("getTransaction timeout:",v,h)}},Ln)),E=this.connection.onSignature(h,D=>{if(L){this.connection.removeSignatureListener(E);return}L=!0,z(D)},"confirmed"),this.connection.getSignatureStatus(h)};return await R(),{txIds:I.map(h=>h.txId),signedTxs:k}}else{let x=[];for(let I=0;I<k.length;I+=1){let R=await this.connection.sendRawTransaction(k[I].serialize(),{skipPreflight:A});x.push(R)}return{txIds:x,signedTxs:k}}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:r||{}}}async sizeCheckBuildV0(e){var w;let A=e||{},{computeBudgetConfig:t,splitIns:n=[],lookupTableCache:r={},lookupTableAddress:o=[]}=A,s=It(A,["computeBudgetConfig","splitIns","lookupTableCache","lookupTableAddress"]),a=q(q({},this.cluster==="devnet"?{}:Nn),r),c=Array.from(new Set([...this.lookupTableAddress,...o])),u=[];for(let T of c)a[T]===void 0&&u.push(new Ct(T));let l=await gi({connection:this.connection,address:u});for(let[T,B]of Object.entries(l))a[T]=B;let p=t?Sn(t):{instructions:[],instructionTypes:[]},m=await Dt(this.connection,this.blockhashCommitment),d=this.signers.reduce((T,B)=>J(q({},T),{[B.publicKey.toBase58()]:B}),{}),y=[],f=[],b=[],g=0;if(this.allInstructions.forEach(T=>{let B=[...b,T],k=t?[...p.instructions,...B]:B;if(T!==n[g]&&b.length<12&&(en({instructions:k,payer:this.feePayer,lookupTableAddressAccount:a})||en({instructions:B,payer:this.feePayer,lookupTableAddressAccount:a})))b.push(T);else{if(b.length===0)throw Error("item ins too big");g+=T===n[g]?1:0;let x={};for(let I of[...new Set(c)])a[I]!==void 0&&(x[I]=a[I]);if(t&&en({instructions:[...p.instructions,...b],payer:this.feePayer,lookupTableAddressAccount:a,recentBlockhash:m})){let I=new At({payerKey:this.feePayer,recentBlockhash:m,instructions:[...p.instructions,...b]}).compileToV0Message(Object.values(a));y.push(new wt(I))}else{let I=new At({payerKey:this.feePayer,recentBlockhash:m,instructions:[...b]}).compileToV0Message(Object.values(a));y.push(new wt(I))}f.push(Array.from(new Set(b.map(I=>I.keys.filter(R=>R.isSigner).map(R=>R.pubkey.toString())).flat())).map(I=>d[I]).filter(I=>I!==void 0)),b=[T]}}),b.length>0){let B=[...new Set(b.map(z=>z.keys.filter(D=>D.isSigner).map(D=>D.pubkey.toString())).flat()).values()].map(z=>d[z]).filter(z=>z!==void 0),k=Sr[Math.floor(Math.random()*Sr.length)],x=xr.transfer({fromPubkey:this.feePayer,toPubkey:k,lamports:Math.floor(.001*Cr)});if(t&&en({instructions:[x,...p.instructions,...b],payer:this.feePayer,lookupTableAddressAccount:a,recentBlockhash:m})){console.log("MESSAGE 1");let z=new At({payerKey:this.feePayer,recentBlockhash:m,instructions:[x,...b]}).compileToV0Message(Object.values(a));y.push(new wt(z))}else{console.log("MESSAGE 2");let z=new At({payerKey:this.feePayer,recentBlockhash:m,instructions:[x,...b]}).compileToV0Message(Object.values(a));y.push(new wt(z))}let I=new At({payerKey:this.feePayer,recentBlockhash:m,instructions:[x]}).compileToV0Message([]),R=new wt(I);console.log("\u{1F4E6} Tip-only tx size:",R.serialize().length);let h=new At({payerKey:this.feePayer,recentBlockhash:m,instructions:[...p.instructions]}).compileToV0Message(Object.values(a)),L=new wt(h);console.log("\u{1F4E6} computeTx-only tx size:",L.serialize().length),f.push(B);let G=new At({payerKey:this.feePayer,recentBlockhash:m,instructions:[...b]}).compileToV0Message([]),E=new wt(G);console.log("\u{1F4E6} instructionTx-only tx size:",E.serialize().length),f.push(B)}return(w=this.owner)!=null&&w.signer&&f.forEach(T=>{T.some(B=>B.publicKey.equals(this.owner.publicKey))||T.push(this.owner.signer)}),y.forEach((T,B)=>{T.sign(f[B]),console.log(`Tx #${B+1} size (bytes):`,T.serialize().length)}),{builder:this,transactions:y,buildProps:e,signers:f,instructionTypes:this.instructionTypes,execute:async T=>{var h;let{sequentially:B,onTxUpdate:k,skipTxCount:x=0,recentBlockHash:I,skipPreflight:R=!0}=T||{};if(y.map(async(L,G)=>{f[G].length&&L.sign(f[G]),I&&(L.message.recentBlockhash=I)}),Kt(y),console.log("SEND 6"),console.log("sizeCheckBuildV0"),(h=this.owner)!=null&&h.isKeyPair){console.log("send transactions using Helius Sender");for(let L of y);return{txIds:[],signedTxs:[]}}if(this.signAllTransactions){let L=await this.signAllTransactions(y.slice(x,y.length)),G=[...y.slice(0,x),...L];if(B){let E=0,z=[],D=async()=>{if(!G[E])return;if(E<x){z.push({txId:"",status:"success",signedTx:G[E]}),k==null||k([...z]),E++,D();return}let v=await this.connection.sendTransaction(G[E],{skipPreflight:R});z.push({txId:v,status:"sent",signedTx:G[E]}),k==null||k([...z]),E++;let qe=!1,ft=null,Bt=null,zt=Ye=>{ft!==null&&clearInterval(ft),Bt!==null&&this.connection.removeSignatureListener(Bt);let Ge=z.findIndex(xo=>xo.txId===v);if(Ge>-1){if(z[Ge].status==="error"||z[Ge].status==="success")return;z[Ge].status=Ye.err?"error":"success"}k==null||k([...z]),Ye.err||D()};this.loopMultiTxStatus&&(ft=setInterval(async()=>{var Ye;if(qe){clearInterval(ft);return}try{let Ge=await this.connection.getTransaction(v,{commitment:"confirmed",maxSupportedTransactionVersion:0});Ge&&(qe=!0,clearInterval(ft),zt({err:((Ye=Ge.meta)==null?void 0:Ye.err)||null}),console.log("tx status from getTransaction:",v))}catch(Ge){qe=!0,clearInterval(ft),console.error("getTransaction timeout:",Ge,v)}},Ln)),Bt=this.connection.onSignature(v,Ye=>{if(qe){this.connection.removeSignatureListener(Bt);return}qe=!0,zt(Ye)},"confirmed"),this.connection.getSignatureStatus(v)};return D(),{txIds:[],signedTxs:G}}else{let E=[];for(let z=0;z<G.length;z+=1){let D=await this.connection.sendTransaction(G[z],{skipPreflight:R});E.push(D)}return{txIds:E,signedTxs:G}}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:s||{}}}};import da from"bn.js";var fa=new da(1e6);import{PublicKey as Ta}from"@solana/web3.js";import Mr,{isBN as Or}from"bn.js";import{bits as ep,BitStructure as tp,blob as ba,Blob as np,cstr as ip,f32 as rp,f32be as op,f64 as sp,f64be as ap,greedy as up,Layout as ya,ns64 as cp,ns64be as lp,nu64 as mp,nu64be as pp,offset as dp,s16 as fp,s16be as bp,s24 as yp,s24be as gp,s32 as ga,s32be as Pp,s40 as kp,s40be as Ap,s48 as wp,s48be as hp,s8 as Tp,seq as Pa,struct as Bp,Structure as ka,u16 as Aa,u16be as Ip,u24 as xp,u24be as Sp,u32 as Kp,u32be as Cp,u40 as Np,u40be as Lp,u48 as Rp,u48be as Mp,u8 as wa,UInt as ha,union as Op,Union as Ep,unionLayoutDiscriminator as vp,utf8 as _p}from"@solana/buffer-layout";var ki=ya,Nr=ka;var Ai=ha;var Lr=wa,Nt=Aa;var de=ga;var Rr=Pa;var he=ba;var qt=class extends ki{constructor(t,n,r){super(t,r);this.blob=he(t),this.signed=n}decode(t,n=0){let r=new Mr(this.blob.decode(t,n),10,"le");return this.signed?r.fromTwos(this.span*8).clone():r}encode(t,n,r=0){return typeof t=="number"&&(t=new Mr(t)),this.signed&&(t=t.toTwos(this.span*8)),this.blob.encode(t.toArrayLike(Buffer,"le",this.span),n,r)}};function H(i){return new Ai(1,i)}function _e(i){return new Ai(4,i)}function P(i){return new qt(8,!1,i)}function Z(i){return new qt(16,!1,i)}function Er(i){return new qt(8,!0,i)}function vr(i){return new qt(16,!0,i)}var Mn=class extends ki{constructor(t,n,r,o){super(t.span,o);this.layout=t,this.decoder=n,this.encoder=r}decode(t,n){return this.decoder(this.layout.decode(t,n))}encode(t,n,r){return this.layout.encode(this.encoder(t),n,r)}getSpan(t,n){return this.layout.getSpan(t,n)}};function N(i){return new Mn(he(32),e=>new Ta(e),e=>e.toBuffer(),i)}function xe(i){return new Mn(Lr(),Ba,Ia,i)}function Ba(i){if(i===0)return!1;if(i===1)return!0;throw new Error("Invalid bool: "+i)}function Ia(i){return i?1:0}var wi=class extends Nr{decode(e,t){return super.decode(e,t)}};function F(i,e,t){return new wi(i,e,t)}function ne(i,e,t){let n,r=typeof e=="number"?e:Or(e)?e.toNumber():new Proxy(e,{get(o,s){if(!n){let a=Reflect.get(o,"count");n=Or(a)?a.toNumber():a,Reflect.set(o,"count",n)}return Reflect.get(o,s)},set(o,s,a){return s==="count"&&(n=a),Reflect.set(o,s,a)}});return Rr(i,r,t)}import{PublicKey as $f}from"@solana/web3.js";import tb from"bn.js";import{AccountLayout as ob,TOKEN_2022_PROGRAM_ID as sb,TOKEN_PROGRAM_ID as ab}from"@solana/spl-token";import{PublicKey as Jp}from"@solana/web3.js";import{MintLayout as ed,TOKEN_PROGRAM_ID as nd}from"@solana/spl-token";var _r=i=>new ve({mint:i.address,decimals:i.decimals,symbol:i.symbol,name:i.name}),rn=r=>{var o=r,{amount:i,isRaw:e,name:t}=o,n=It(o,["amount","isRaw","name"]);return new me(new ve({mint:$e(n.address).toBase58(),decimals:n.decimals,symbol:n.symbol,name:t}),i,e,t)};var Lt=r=>{var o=r,{address:i,programId:e,decimals:t}=o,n=It(o,["address","programId","decimals"]);return q({chainId:101,address:$e(i).toBase58(),programId:e,logoURI:"",symbol:"",name:"",decimals:t,tags:[],extensions:n.extensions||{}},n)};var hi=(...i)=>i.map(e=>{try{return typeof e=="object"?JSON.stringify(e):e}catch{return e}}).join(", "),Gt=class{constructor({scope:e,moduleName:t}){this.disabled=!1;this.scope=e,this.logger=ce(t)}createTxBuilder(e){return this.scope.checkOwner(),new Rn({connection:this.scope.connection,feePayer:e||this.scope.ownerPubKey,cluster:this.scope.cluster,owner:this.scope.owner,blockhashCommitment:this.scope.blockhashCommitment,loopMultiTxStatus:this.scope.loopMultiTxStatus,api:this.scope.api,signAllTransactions:this.scope.signAllTransactions})}logDebug(...e){this.logger.debug(hi(e))}logInfo(...e){this.logger.info(hi(e))}logAndCreateError(...e){let t=hi(e);throw new Error(t)}checkDisabled(){(this.disabled||!this.scope)&&this.logAndCreateError("module not working")}};import{Keypair as Vn,PublicKey as C,SystemProgram as pt,TransactionInstruction as Ce}from"@solana/web3.js";import Ri from"bn.js";import{ASSOCIATED_TOKEN_PROGRAM_ID as ln,TOKEN_2022_PROGRAM_ID as Pe,TOKEN_PROGRAM_ID as ae}from"@solana/spl-token";import Ea from"bn.js";import Ue from"bn.js";var ye=new Ue(0),Fe=new Ue(1),ct=new Ue(-1),We=new Ue(1).shln(64),On=new Ue(1).shln(128),Ti=We.sub(Fe),on=64,Fr=On.subn(1),Le=-443636,Re=-Le,nt=new Ue("4295048016"),it=new Ue("79226673521066979257578248091"),En=new Ue("4295048017"),vn=new Ue("79226673521066979257578248090"),Wr=16,Vr="59543866431248",Dr="184467440737095516",qr="15793534762490258745",_n=new Ue(10).pow(new Ue(6));var dd=new Ue("18446744073700000000");import ee from"bn.js";function Fn(i){let e=new ArrayBuffer(4);return new DataView(e).setInt32(0,i,!1),new Uint8Array(e)}function Bi(i,e){let t=0;for(let n=i-1;n>=0&&!e.testn(n);n--)t++;return t}function Ii(i,e){let t=0;for(let n=0;n<i&&!e.testn(n);n++)t++;return t}function sn(i,e){for(let t=0;t<i;t++)if(e.testn(t))return!1;return!0}function Gr(i,e){return sn(i,e)?null:Bi(i,e)}function Ur(i,e){return sn(i,e)?null:Ii(i,e)}var kd=Buffer.from("amm_config","utf8"),xa=Buffer.from("pool","utf8"),Sa=Buffer.from("pool_vault","utf8"),Ka=Buffer.from("pool_reward_vault","utf8"),Xr=Buffer.from("position","utf8"),Ca=Buffer.from("tick_array","utf8"),Na=Buffer.from("operation","utf8"),La=Buffer.from("pool_tick_array_bitmap_extension","utf8"),Ra=Buffer.from("observation","utf8");function zr(i,e,t,n){return we([xa,e.toBuffer(),t.toBuffer(),n.toBuffer()],i)}function xi(i,e,t){return we([Sa,e.toBuffer(),t.toBuffer()],i)}function Hr(i,e,t){return we([Ka,e.toBuffer(),t.toBuffer()],i)}function se(i,e,t){return we([Ca,e.toBuffer(),Fn(t)],i)}function lt(i,e,t,n){return we([Xr,e.toBuffer(),Fn(t),Fn(n)],i)}function Ee(i,e){return we([Xr,e.toBuffer()],i)}function Ut(i){return we([Buffer.from("metadata","utf8"),kt.toBuffer(),i.toBuffer()],kt)}function Wn(i){return we([Na],i)}function Te(i,e){return we([La,e.toBuffer()],i)}function Qr(i,e){return we([Ra,e.toBuffer()],i)}var jr=Buffer.from("locked_position","utf8");function Si(i,e){return we([jr,e.toBuffer()],i)}function Ki(i,e){return we([jr,e.toBuffer()],i)}var Ad=Buffer.from("support_mint","utf8");import{PublicKey as Ve}from"@solana/web3.js";import{TOKEN_2022_PROGRAM_ID as Zr}from"@solana/spl-token";import fe from"bn.js";import rt from"bn.js";var an=class{static getfeeGrowthInside(e,t,n){let r=new rt(0),o=new rt(0);e.tickCurrent>=t.tick?(r=t.feeGrowthOutsideX64A,o=t.feeGrowthOutsideX64B):(r=e.feeGrowthGlobalX64A.sub(t.feeGrowthOutsideX64A),o=e.feeGrowthGlobalX64B.sub(t.feeGrowthOutsideX64B));let s=new rt(0),a=new rt(0);e.tickCurrent<n.tick?(s=n.feeGrowthOutsideX64A,a=n.feeGrowthOutsideX64B):(s=e.feeGrowthGlobalX64A.sub(n.feeGrowthOutsideX64A),a=e.feeGrowthGlobalX64B.sub(n.feeGrowthOutsideX64B));let c=$.wrappingSubU128($.wrappingSubU128(e.feeGrowthGlobalX64A,r),s),u=$.wrappingSubU128($.wrappingSubU128(e.feeGrowthGlobalX64B,o),a);return{feeGrowthInsideX64A:c,feeGrowthInsideBX64:u}}static GetPositionFees(e,t,n,r){let{feeGrowthInsideX64A:o,feeGrowthInsideBX64:s}=this.getfeeGrowthInside(e,n,r),a=$.mulDivFloor($.wrappingSubU128(o,t.feeGrowthInsideLastX64A),t.liquidity,We),c=t.tokenFeesOwedA.add(a),u=$.mulDivFloor($.wrappingSubU128(s,t.feeGrowthInsideLastX64B),t.liquidity,We),l=t.tokenFeesOwedB.add(u);return{tokenFeeAmountA:c,tokenFeeAmountB:l}}static GetPositionFeesV2(e,t,n,r){let{feeGrowthInsideX64A:o,feeGrowthInsideBX64:s}=this.getfeeGrowthInside(e,n,r),a=$.mulDivFloor($.wrappingSubU128(o,t.feeGrowthInsideLastX64A),t.liquidity,We),c=t.tokenFeesOwedA.add(a),u=$.mulDivFloor($.wrappingSubU128(s,t.feeGrowthInsideLastX64B),t.liquidity,We),l=t.tokenFeesOwedB.add(u);return{tokenFeeAmountA:c,tokenFeeAmountB:l}}static GetPositionRewardsV2(e,t,n,r){let o=[],s=this.getRewardGrowthInsideV2(e.tickCurrent,n,r,e.rewardInfos);for(let a=0;a<s.length;a++){let c=s[a],u=t.rewardInfos[a],l=$.wrappingSubU128(c,u.growthInsideLastX64),p=$.mulDivFloor(l,t.liquidity,We),m=u.rewardAmountOwed.add(p);o.push(m)}return o}static GetPositionRewards(e,t,n,r){let o=[],s=this.getRewardGrowthInside(e.tickCurrent,n,r,e.rewardInfos);for(let a=0;a<s.length;a++){let c=s[a],u=t.rewardInfos[a],l=$.wrappingSubU128(c,u.growthInsideLastX64),p=$.mulDivFloor(l,t.liquidity,We),m=u.rewardAmountOwed.add(p);o.push(m)}return o}static getRewardGrowthInside(e,t,n,r){let o=[];for(let s=0;s<r.length;s++){let a=new rt(0);t.liquidityGross.eqn(0)?a=r[s].rewardGrowthGlobalX64:e<t.tick?a=r[s].rewardGrowthGlobalX64.sub(t.rewardGrowthsOutsideX64[s]):a=t.rewardGrowthsOutsideX64[s];let c=new rt(0);n.liquidityGross.eqn(0)||(e<n.tick?c=n.rewardGrowthsOutsideX64[s]:c=r[s].rewardGrowthGlobalX64.sub(n.rewardGrowthsOutsideX64[s])),o.push($.wrappingSubU128($.wrappingSubU128(r[s].rewardGrowthGlobalX64,a),c))}return o}static getRewardGrowthInsideV2(e,t,n,r){let o=[];for(let s=0;s<r.length;s++){let a=new rt(0);t.liquidityGross.eqn(0)?a=r[s].rewardGrowthGlobalX64:e<t.tick?a=r[s].rewardGrowthGlobalX64.sub(t.rewardGrowthsOutsideX64[s]):a=t.rewardGrowthsOutsideX64[s];let c=new rt(0);n.liquidityGross.eqn(0)||(e<n.tick?c=n.rewardGrowthsOutsideX64[s]:c=r[s].rewardGrowthGlobalX64.sub(n.rewardGrowthsOutsideX64[s])),o.push($.wrappingSubU128($.wrappingSubU128(r[s].rewardGrowthGlobalX64,a),c))}return o}static getAmountsFromLiquidity({poolInfo:e,ownerPosition:t,liquidity:n,slippage:r,add:o,epochInfo:s}){var b,g,A,w;let a=Y.priceToSqrtPriceX64(new _(e.price),e.mintA.decimals,e.mintB.decimals),c=Y.getSqrtPriceX64FromTick(t.tickLower),u=Y.getSqrtPriceX64FromTick(t.tickUpper),l=o?1+r:1-r,p=re.getAmountsFromLiquidity(a,c,u,n,o),[m,d]=[ke(p.amountA,(b=e.mintA.extensions)==null?void 0:b.feeConfig,s,!0),ke(p.amountB,(g=e.mintB.extensions)==null?void 0:g.feeConfig,s,!0)],[y,f]=[ke(new rt(new _(p.amountA.toString()).mul(l).toFixed(0)),(A=e.mintA.extensions)==null?void 0:A.feeConfig,s,!0),ke(new rt(new _(p.amountB.toString()).mul(l).toFixed(0)),(w=e.mintB.extensions)==null?void 0:w.feeConfig,s,!0)];return{liquidity:n,amountA:m,amountB:d,amountSlippageA:y,amountSlippageB:f,expirationTime:je(m.expirationTime,d.expirationTime)}}};var Ma=15,ie=class{static async getTickArrays(e,t,n,r,o,s,a){let c=[],u=W.getTickArrayStartIndexByTick(r,o),l=W.getInitializedTickArrayInRange(s,a,o,u,Math.floor(Ma/2));for(let d=0;d<l.length;d++){let{publicKey:y}=se(t,n,l[d]);c.push(y)}let p=(await st(e,c)).map(d=>d!==null?un.decode(d.data):null),m={};for(let d=0;d<c.length;d++){let y=p[d];y!==null&&(m[y.startTickIndex]=J(q({},y),{address:c[d]}))}return m}static nextInitializedTick(e,t,n,r,o,s){let{initializedTick:a,tickArrayAddress:c,tickArrayStartTickIndex:u}=this.nextInitializedTickInOneArray(e,t,n,r,o,s);for(;a==null||a.liquidityGross.lten(0);){if(u=W.getNextTickArrayStartIndex(u,o,s),this.checkIsValidStartIndex(u,o))throw new Error("No enough initialized tickArray");let l=n[u];if(l===void 0)continue;let{nextTick:p,tickArrayAddress:m,tickArrayStartTickIndex:d}=this.firstInitializedTickInOneArray(e,t,l,s);[a,c,u]=[p,m,d]}if(a==null)throw new Error("No invaild tickArray cache");return{nextTick:a,tickArrayAddress:c,tickArrayStartTickIndex:u}}static nextInitializedTickArray(e,t,n,r,o){let s=Math.floor(e/ie.tickCount(t)),a=n?W.searchLowBitFromStart(r,o,s-1,1,t):W.searchHightBitFromStart(r,o,s+1,1,t);return a.length>0?{isExist:!0,nextStartIndex:a[0]}:{isExist:!1,nextStartIndex:0}}static firstInitializedTickInOneArray(e,t,n,r){let o;if(r){let a=Ie-1;for(;a>=0;){let c=n.ticks[a];if(c.liquidityGross.gtn(0)){o=c;break}a=a-1}}else{let a=0;for(;a<Ie;){let c=n.ticks[a];if(c.liquidityGross.gtn(0)){o=c;break}a=a+1}}let{publicKey:s}=se(e,t,n.startTickIndex);return{nextTick:o,tickArrayAddress:s,tickArrayStartTickIndex:n.startTickIndex}}static nextInitializedTickInOneArray(e,t,n,r,o,s){let a=W.getTickArrayStartIndexByTick(r,o),c=Math.floor((r-a)/o),u=n[a];if(u==null)return{initializedTick:void 0,tickArrayAddress:void 0,tickArrayStartTickIndex:a};let l;if(s)for(;c>=0;){let m=u.ticks[c];if(m.liquidityGross.gtn(0)){l=m;break}c=c-1}else for(c=c+1;c<Ie;){let m=u.ticks[c];if(m.liquidityGross.gtn(0)){l=m;break}c=c+1}let{publicKey:p}=se(e,t,a);return{initializedTick:l,tickArrayAddress:p,tickArrayStartTickIndex:u.startTickIndex}}static getArrayStartIndex(e,t){let n=this.tickCount(t);return Math.floor(e/n)*n}static checkIsValidStartIndex(e,t){if(W.checkIsOutOfBoundary(e)){if(e>Re)return!1;let n=W.getTickArrayStartIndexByTick(Le,t);return e==n}return e%this.tickCount(t)==0}static tickCount(e){return Ie*e}};var Ci=14,mt=class{static maxTickInTickarrayBitmap(e){return e*Ie*Rt}static getBitmapTickBoundary(e,t){let n=this.maxTickInTickarrayBitmap(t),r=Math.floor(Math.abs(e)/n);e<0&&Math.abs(e)%n!=0&&(r+=1);let o=n*r;return e<0?{minValue:-o,maxValue:-o+n}:{minValue:o,maxValue:o+n}}static nextInitializedTickArrayStartIndex(e,t,n,r){if(!ie.checkIsValidStartIndex(t,n))throw Error("nextInitializedTickArrayStartIndex check error");let o=this.maxTickInTickarrayBitmap(n),s=r?t-ie.tickCount(n):t+ie.tickCount(n);if(s<-o||s>=o)return{isInit:!1,tickIndex:t};let a=n*Ie,c=s/a+512;s<0&&s%a!=0&&c--;let u=Math.abs(c);if(r){let l=e.shln(1024-u-1),p=Gr(1024,l);if(p!==null){let m=(u-p-512)*a;return{isInit:!0,tickIndex:m}}else return{isInit:!1,tickIndex:-o}}else{let l=e.shrn(u),p=Ur(1024,l);if(p!==null){let m=(u+p-512)*a;return{isInit:!0,tickIndex:m}}else return{isInit:!1,tickIndex:o-ie.tickCount(n)}}}},cn=class{static getBitmapOffset(e,t){if(!ie.checkIsValidStartIndex(e,t))throw new Error("No enough initialized tickArray");this.checkExtensionBoundary(e,t);let n=mt.maxTickInTickarrayBitmap(t),r=Math.floor(Math.abs(e)/n)-1;return e<0&&Math.abs(e)%n===0&&r--,r}static getBitmap(e,t,n){let r=this.getBitmapOffset(e,t);return e<0?{offset:r,tickarrayBitmap:n.negativeTickArrayBitmap[r]}:{offset:r,tickarrayBitmap:n.positiveTickArrayBitmap[r]}}static checkExtensionBoundary(e,t){let{positiveTickBoundary:n,negativeTickBoundary:r}=this.extensionTickBoundary(t);if(e>=r&&e<n)throw Error("checkExtensionBoundary -> InvalidTickArrayBoundary")}static extensionTickBoundary(e){let t=mt.maxTickInTickarrayBitmap(e),n=-t;if(Re<=t)throw Error(`extensionTickBoundary check error: ${Re}, ${t}`);if(n<=Le)throw Error(`extensionTickBoundary check error: ${n}, ${Le}`);return{positiveTickBoundary:t,negativeTickBoundary:n}}static checkTickArrayIsInit(e,t,n){let{tickarrayBitmap:r}=this.getBitmap(e,t,n),o=this.tickArrayOffsetInBitmap(e,t);return{isInitialized:W.mergeTickArrayBitmap(r).testn(o),startIndex:e}}static nextInitializedTickArrayFromOneBitmap(e,t,n,r){let o=ie.tickCount(t),s=n?e-o:e+o,{tickarrayBitmap:a}=this.getBitmap(s,t,r);return this.nextInitializedTickArrayInBitmap(a,s,t,n)}static nextInitializedTickArrayInBitmap(e,t,n,r){let{minValue:o,maxValue:s}=mt.getBitmapTickBoundary(t,n),a=this.tickArrayOffsetInBitmap(t,n);if(r){let c=W.mergeTickArrayBitmap(e).shln(Rt-1-a),u=sn(512,c)?null:Bi(512,c);if(u!==null){let l=t-u*ie.tickCount(n);return{isInit:!0,tickIndex:l}}else return{isInit:!1,tickIndex:o}}else{let c=W.mergeTickArrayBitmap(e).shrn(a),u=sn(512,c)?null:Ii(512,c);if(u!==null){let l=t+u*ie.tickCount(n);return{isInit:!0,tickIndex:l}}else return{isInit:!1,tickIndex:s-ie.tickCount(n)}}}static tickArrayOffsetInBitmap(e,t){let n=Math.abs(e)%mt.maxTickInTickarrayBitmap(t),r=Math.floor(n/ie.tickCount(t));return e<0&&n!=0&&(r=Rt-r),r}};var ge=class{static getOutputAmountAndRemainAccounts(e,t,n,r,o,s=!1){let a=n.toBase58()===e.mintA.address,c=[],{isExist:u,startIndex:l,nextAccountMeta:p}=this.getFirstInitializedTickArray(e,a);if(!u||l===void 0||!p)throw new Error("Invalid tick array");c.push(p);let{allTrade:m,amountCalculated:d,accounts:y,sqrtPriceX64:f,feeAmount:b}=Mt.swapCompute(e.programId,e.id,t,e.tickArrayBitmap,e.exBitmapInfo,a,e.ammConfig.tradeFeeRate,e.liquidity,e.tickCurrent,e.tickSpacing,e.sqrtPriceX64,r,l,o,s);return c.push(...y),{allTrade:m,expectedAmountOut:d.mul(ct),remainingAccounts:c,executionPrice:f,feeAmount:b}}static getInputAmountAndRemainAccounts(e,t,n,r,o){let s=n.toBase58()===e.mintB.address,a=[],{isExist:c,startIndex:u,nextAccountMeta:l}=this.getFirstInitializedTickArray(e,s);if(!c||u===void 0||!l)throw new Error("Invalid tick array");try{let f=this.preInitializedTickArrayStartIndex(e,s);if(f.isExist){let{publicKey:b}=se(e.programId,e.id,f.nextStartIndex);a.push(b)}}catch{}a.push(l);let{amountCalculated:p,accounts:m,sqrtPriceX64:d,feeAmount:y}=Mt.swapCompute(e.programId,e.id,t,e.tickArrayBitmap,e.exBitmapInfo,s,e.ammConfig.tradeFeeRate,e.liquidity,e.tickCurrent,e.tickSpacing,e.sqrtPriceX64,r.mul(ct),u,o);return a.push(...m),{expectedAmountIn:p,remainingAccounts:a,executionPrice:d,feeAmount:y}}static getFirstInitializedTickArray(e,t){let{isInitialized:n,startIndex:r}=ge.isOverflowDefaultTickarrayBitmap(e.tickSpacing,[e.tickCurrent])?cn.checkTickArrayIsInit(ie.getArrayStartIndex(e.tickCurrent,e.tickSpacing),e.tickSpacing,e.exBitmapInfo):W.checkTickArrayIsInitialized(W.mergeTickArrayBitmap(e.tickArrayBitmap),e.tickCurrent,e.tickSpacing);if(n){let{publicKey:a}=se(e.programId,e.id,r);return{isExist:!0,startIndex:r,nextAccountMeta:a}}let{isExist:o,nextStartIndex:s}=this.nextInitializedTickArrayStartIndex(e,ie.getArrayStartIndex(e.tickCurrent,e.tickSpacing),t);if(o){let{publicKey:a}=se(e.programId,e.id,s);return{isExist:!0,startIndex:s,nextAccountMeta:a}}return{isExist:!1,nextAccountMeta:void 0,startIndex:void 0}}static preInitializedTickArrayStartIndex(e,t){let n=Math.floor(e.tickCurrent/ie.tickCount(e.tickSpacing)),r=t?W.searchHightBitFromStart(e.tickArrayBitmap,e.exBitmapInfo,n+1,1,e.tickSpacing):W.searchLowBitFromStart(e.tickArrayBitmap,e.exBitmapInfo,n-1,1,e.tickSpacing);return r.length>0?{isExist:!0,nextStartIndex:r[0]}:{isExist:!1,nextStartIndex:0}}static nextInitializedTickArrayStartIndex(e,t,n){for(t=ie.getArrayStartIndex(e.tickCurrent,e.tickSpacing);;){let{isInit:r,tickIndex:o}=mt.nextInitializedTickArrayStartIndex(W.mergeTickArrayBitmap(e.tickArrayBitmap),t,e.tickSpacing,n);if(r)return{isExist:!0,nextStartIndex:o};t=o;let{isInit:s,tickIndex:a}=cn.nextInitializedTickArrayFromOneBitmap(t,e.tickSpacing,n,e.exBitmapInfo);if(s)return{isExist:!0,nextStartIndex:a};if(t=a,t<Le||t>Re)return{isExist:!1,nextStartIndex:0}}}static async updatePoolRewardInfos({connection:e,apiPoolInfo:t,chainTime:n,poolLiquidity:r,rewardInfos:o}){var a,c,u;let s=[];for(let l=0;l<o.length;l++){let p=o[l],m=(u=(a=t.rewardDefaultInfos[l])==null?void 0:a.mint.programId)!=null?u:(c=await e.getAccountInfo(p.tokenMint))==null?void 0:c.owner;if(m===void 0)throw Error("get new reward mint info error");let d=J(q({},p),{perSecond:$.x64ToDecimal(p.emissionsPerSecondX64),remainingRewards:void 0,tokenProgramId:new Ve(m)});if(d.tokenMint.equals(Ve.default))continue;if(n<=d.openTime.toNumber()||r.eq(ye)){s.push(d);continue}let y=new fe(Math.min(d.endTime.toNumber(),n)),f=y.sub(d.lastUpdateTime),b=$.mulDivFloor(f,d.emissionsPerSecondX64,r),g=d.rewardGrowthGlobalX64.add(b),A=$.mulDivFloor(f,d.emissionsPerSecondX64,We),w=d.rewardTotalEmissioned.add(A);s.push(J(q({},d),{rewardGrowthGlobalX64:g,rewardTotalEmissioned:w,lastUpdateTime:y}))}return s}static isOverflowDefaultTickarrayBitmap(e,t){let{maxTickBoundary:n,minTickBoundary:r}=this.tickRange(e);for(let o of t){let s=W.getTickArrayStartIndexByTick(o,e);if(s>=n||s<r)return!0}return!1}static tickRange(e){let t=mt.maxTickInTickarrayBitmap(e),n=-t;return t>Re&&(t=ie.getArrayStartIndex(Re,e)+ie.tickCount(e)),n<Le&&(n=ie.getArrayStartIndex(Le,e)),{maxTickBoundary:t,minTickBoundary:n}}static get_tick_array_offset(e,t){if(!ie.checkIsValidStartIndex(e,t))throw new Error("No enough initialized tickArray");return e/ie.tickCount(t)*Rt}static async fetchExBitmaps({connection:e,exBitmapAddress:t,batchRequest:n}){let r=await xt(e,t.map(s=>({pubkey:s})),{batchRequest:n}),o={};for(let s of r)s.accountInfo!==null&&(o[s.pubkey.toString()]=Yr.decode(s.accountInfo.data));return o}static async fetchMultiplePoolTickArrays({connection:e,poolKeys:t,batchRequest:n}){let r={},o=[];for(let c of t){let u=W.getTickArrayStartIndexByTick(c.tickCurrent,c.tickSpacing),l=W.getInitializedTickArrayInRange(c.tickArrayBitmap,c.exBitmapInfo,c.tickSpacing,u,7);for(let p of l){let{publicKey:m}=se(c.programId,c.id,p);o.push({pubkey:m}),r[m.toString()]=c.id}}let s=await xt(e,o,{batchRequest:n}),a={};for(let c of s){if(!c.accountInfo)continue;let u=r[c.pubkey.toString()];if(!u)continue;a[u.toString()]===void 0&&(a[u.toString()]={});let l=un.decode(c.accountInfo.data);a[u.toString()][l.startTickIndex]=J(q({},l),{address:c.pubkey})}return a}static async fetchPoolsAccountPosition({pools:e,connection:t,ownerInfo:n,batchRequest:r=!1,updateOwnerRewardAndFee:o=!0}){var a;let s=[];for(let c=0;c<e.length;c++){let u=e[c];u!==null&&(s.find(l=>l.equals(u.state.programId))||s.push(u.state.programId))}if(n){let c=n.tokenAccounts.map(m=>m.accountInfo.mint),u=[];for(let m of c)for(let d of s)u.push(Ee(d,m).publicKey);let l=await st(t,u,{batchRequest:r}),p={};for(let m of l){if(m===null)continue;let d=Ni.decode(m.data),y=d.poolId.toString(),f=e.find(I=>I.state.id.toBase58()===y);if(f===void 0)continue;let b=f.state,g=W._getTickPriceLegacy({poolInfo:b,tick:d.tickLower,baseIn:!0}),A=W._getTickPriceLegacy({poolInfo:b,tick:d.tickUpper,baseIn:!0}),{amountA:w,amountB:T}=re.getAmountsFromLiquidity(b.sqrtPriceX64,g.tickSqrtPriceX64,A.tickSqrtPriceX64,d.liquidity,!1),B=1/(1-Math.sqrt(Math.sqrt(g.price.div(A.price).toNumber())));f.positionAccount=[...(a=f.positionAccount)!=null?a:[],{poolId:d.poolId,nftMint:d.nftMint,priceLower:g.price,priceUpper:A.price,amountA:w,amountB:T,tickLower:d.tickLower,tickUpper:d.tickUpper,liquidity:d.liquidity,feeGrowthInsideLastX64A:d.feeGrowthInsideLastX64A,feeGrowthInsideLastX64B:d.feeGrowthInsideLastX64B,tokenFeesOwedA:d.tokenFeesOwedA,tokenFeesOwedB:d.tokenFeesOwedB,rewardInfos:d.rewardInfos.map(I=>J(q({},I),{pendingReward:new fe(0)})),leverage:B,tokenFeeAmountA:new fe(0),tokenFeeAmountB:new fe(0)}];let k=await W.getTickArrayAddressByTick(f.state.programId,d.poolId,d.tickLower,f.state.tickSpacing),x=await W.getTickArrayAddressByTick(f.state.programId,d.poolId,d.tickUpper,f.state.tickSpacing);p[`${f.state.programId.toString()}-${d.poolId.toString()}-${d.tickLower}`]=k,p[`${f.state.programId.toString()}-${d.poolId.toString()}-${d.tickUpper}`]=x}if(o){let m=Object.values(p),d=await st(t,m,{batchRequest:r}),y={};for(let f=0;f<m.length;f++){let b=d[f];if(b===null)continue;let g=m[f].toString();y[g]=un.decode(b.data)}for(let{state:f,positionAccount:b}of e)if(!!b)for(let g of b){let A=`${f.programId.toString()}-${f.id.toString()}-${g.tickLower}`,w=`${f.programId.toString()}-${f.id.toString()}-${g.tickUpper}`,T=y[p[A].toString()],B=y[p[w].toString()],k=T.ticks[W.getTickOffsetInArray(g.tickLower,f.tickSpacing)],x=B.ticks[W.getTickOffsetInArray(g.tickUpper,f.tickSpacing)],{tokenFeeAmountA:I,tokenFeeAmountB:R}=await an.GetPositionFees(f,g,k,x),h=await an.GetPositionRewards(f,g,k,x);g.tokenFeeAmountA=I.gte(new fe(0))?I:new fe(0),g.tokenFeeAmountB=R.gte(new fe(0))?R:new fe(0);for(let L=0;L<h.length;L++)g.rewardInfos[L].pendingReward=h[L].gte(new fe(0))?h[L]:new fe(0)}}}return e}static computeAmountOut({poolInfo:e,tickArrayCache:t,baseMint:n,epochInfo:r,amountIn:o,slippage:s,priceLimit:a=new _(0),catchLiquidityInsufficient:c=!1}){var G;let u,l=n.toBase58()===e.mintA.address,[p,m]=l?[e.mintA.extensions.feeConfig,e.mintB.extensions.feeConfig]:[e.mintB.extensions.feeConfig,e.mintA.extensions.feeConfig];a.equals(new _(0))?u=l?nt.add(new fe(1)):it.sub(new fe(1)):u=Y.priceToSqrtPriceX64(a,e.mintA.decimals,e.mintB.decimals);let d=ke(o,p,r,!1),{allTrade:y,expectedAmountOut:f,remainingAccounts:b,executionPrice:g,feeAmount:A}=ge.getOutputAmountAndRemainAccounts(e,t,n,d.amount.sub((G=d.fee)!=null?G:ye),u,c),w=ke(f,m,r,!1),T=Y.sqrtPriceX64ToPrice(g,e.mintA.decimals,e.mintB.decimals),B=l?T:new _(1).div(T),k=f.mul(new fe(Math.floor((1-s)*1e10))).div(new fe(1e10)),x=ke(k,m,r,!1),I=l?e.currentPrice:new _(1).div(e.currentPrice),R=new _(B).sub(I).abs(),h=I,L=new at(new _(R).mul(10**15).toFixed(0),new _(h).mul(10**15).toFixed(0));return{allTrade:y,realAmountIn:d,amountOut:w,minAmountOut:x,expirationTime:je(d.expirationTime,w.expirationTime),currentPrice:e.currentPrice,executionPrice:B,priceImpact:L,fee:A,remainingAccounts:b,executionPriceX64:g}}static computeAmountOutFormat({poolInfo:e,tickArrayCache:t,amountIn:n,tokenOut:r,slippage:o,epochInfo:s,catchLiquidityInsufficient:a=!1}){let c=r.address===e.mintB.address,[u,l]=c?[e.mintA,e.mintB]:[e.mintB,e.mintA],[p,m]=[new ve(J(q({},u),{mint:u.address,isToken2022:u.programId===Zr.toBase58()})),new ve(J(q({},l),{mint:l.address,isToken2022:l.programId===Zr.toBase58()}))],{allTrade:d,realAmountIn:y,amountOut:f,minAmountOut:b,expirationTime:g,currentPrice:A,executionPrice:w,priceImpact:T,fee:B,remainingAccounts:k,executionPriceX64:x}=ge.computeAmountOut({poolInfo:e,tickArrayCache:t,baseMint:new Ve(u.address),amountIn:n,slippage:o,epochInfo:s,catchLiquidityInsufficient:a}),I=J(q({},y),{amount:new me(p,y.amount),fee:y.fee===void 0?void 0:new me(p,y.fee)}),R=J(q({},f),{amount:new me(m,f.amount),fee:f.fee===void 0?void 0:new me(m,f.fee)}),h=J(q({},b),{amount:new me(m,b.amount),fee:b.fee===void 0?void 0:new me(m,b.fee)}),L=new Oe({baseToken:p,denominator:new fe(10).pow(new fe(20+p.decimals)),quoteToken:m,numerator:A.mul(new _(10**(20+m.decimals))).toFixed(0)}),G=new Oe({baseToken:p,denominator:new fe(10).pow(new fe(20+p.decimals)),quoteToken:m,numerator:w.mul(new _(10**(20+m.decimals))).toFixed(0)}),E=new me(p,B);return{allTrade:d,realAmountIn:I,amountOut:R,minAmountOut:h,expirationTime:g,currentPrice:L,executionPrice:G,priceImpact:T,fee:E,remainingAccounts:k,executionPriceX64:x}}static computeAmountIn({poolInfo:e,tickArrayCache:t,baseMint:n,epochInfo:r,amountOut:o,slippage:s,priceLimit:a=new _(0)}){var h;let c=n.toBase58()===e.mintA.address,u={[e.mintA.address]:e.mintA.extensions.feeConfig,[e.mintB.address]:e.mintB.extensions.feeConfig},l;a.equals(new _(0))?l=c?it.sub(new fe(1)):nt.add(new fe(1)):l=Y.priceToSqrtPriceX64(a,e.mintA.decimals,e.mintB.decimals);let p=ke(o,u[n.toString()],r,!0),{expectedAmountIn:m,remainingAccounts:d,executionPrice:y,feeAmount:f}=ge.getInputAmountAndRemainAccounts(e,t,n,p.amount.sub((h=p.fee)!=null?h:ye),l),b=c?e.mintB.address:e.mintA.address,g=ke(m,u[b],r,!1),A=Y.sqrtPriceX64ToPrice(y,e.mintA.decimals,e.mintB.decimals),w=c?A:new _(1).div(A),T=m.mul(new fe(Math.floor((1+s)*1e10))).div(new fe(1e10)),B=ke(T,u[b],r,!0),k=c?e.currentPrice:new _(1).div(e.currentPrice),x=new _(w).sub(k).abs(),I=k,R=new at(new _(x).mul(10**15).toFixed(0),new _(I).mul(10**15).toFixed(0));return{amountIn:g,maxAmountIn:B,realAmountOut:p,expirationTime:je(g.expirationTime,p.expirationTime),currentPrice:e.currentPrice,executionPrice:w,priceImpact:R,fee:f,remainingAccounts:d}}static estimateAprsForPriceRangeMultiplier({poolInfo:e,aprType:t,positionTickLowerIndex:n,positionTickUpperIndex:r}){var y,f,b;let o=e[t],s=W.getTickPrice({poolInfo:e,tick:n,baseIn:!0}).price.toNumber(),a=W.getTickPrice({poolInfo:e,tick:r,baseIn:!0}).price.toNumber(),c=Math.max(s,o.priceMin),l=Math.min(a,o.priceMax)-c,p=a-s,m=o.priceMax-o.priceMin,d;return l<=0?d=0:p===l?d=m/l:m===l?d=l/p:d=l/m*(l/p),{feeApr:o.feeApr*d,rewardsApr:[((y=o.rewardApr[0])!=null?y:0)*d,((f=o.rewardApr[1])!=null?f:0)*d,((b=o.rewardApr[2])!=null?b:0)*d],apr:o.apr*d}}static estimateAprsForPriceRangeDelta({poolInfo:e,poolLiquidity:t,aprType:n,mintPrice:r,liquidity:o,positionTickLowerIndex:s,positionTickUpperIndex:a,chainTime:c}){let u=n==="day"?1:n==="week"?7:n==="month"?30:0,l=e[n],p=r[$e(e.mintA.address).toString()],m=r[$e(e.mintB.address).toString()],d=e.mintA.decimals,y=e.mintB.decimals;if(!l||!p||!m)return{feeApr:0,rewardsApr:[0,0,0],apr:0};let f=Y.priceToSqrtPriceX64(new _(e.price),e.mintA.decimals,e.mintB.decimals),b=Y.getSqrtPriceX64FromTick(s),g=Y.getSqrtPriceX64FromTick(a),{amountSlippageA:A,amountSlippageB:w}=re.getAmountsFromLiquidityWithSlippage(f,b,g,t,!1,!1,0),{amountSlippageA:T,amountSlippageB:B}=re.getAmountsFromLiquidityWithSlippage(f,b,g,o,!1,!1,0),k=new _(A.toString()).div(new _(10).pow(d)).mul(p.value).add(new _(w.toString()).div(new _(10).pow(y)).mul(m.value)),x=new _(T.toString()).div(new _(10).pow(d)).mul(p.value).add(new _(B.toString()).div(new _(10).pow(y)).mul(m.value)),I=new _(1).div(k.add(x)),h=new _(l.volumeFee).mul(365).div(u).mul(I).mul(100).toNumber(),L=3600*24*365,G=e.rewardDefaultInfos.map(E=>{var v,qe;let z=E.mint.decimals,D=r[E.mint.address];return c<((v=E.startTime)!=null?v:0)||c>((qe=E.endTime)!=null?qe:0)||!E.perSecond||!D||z===void 0?0:new _(D.value).mul(new _(E.perSecond).mul(L)).div(new _(10).pow(z)).mul(I).mul(100).toNumber()});return{feeApr:h,rewardsApr:G,apr:h+G.reduce((E,z)=>E+z,0)}}static async getLiquidityAmountOutFromAmountIn({poolInfo:e,inputA:t,tickLower:n,tickUpper:r,amount:o,slippage:s,add:a,epochInfo:c,amountHasFee:u}){var g,A;let l=Y.priceToSqrtPriceX64(new _(e.price),e.mintA.decimals,e.mintB.decimals),p=Y.getSqrtPriceX64FromTick(n),m=Y.getSqrtPriceX64FromTick(r),d=ke(o,(g=e[t?"mintA":"mintB"].extensions)==null?void 0:g.feeConfig,c,!u),y=new fe(new _(d.amount.sub((A=d.fee)!=null?A:ye).toString()).toFixed(0)),f;if(l.lte(p))f=t?re.getLiquidityFromTokenAmountA(p,m,y,!a):new fe(0);else if(l.lte(m)){let w=re.getLiquidityFromTokenAmountA(l,m,y,!a),T=re.getLiquidityFromTokenAmountB(p,l,y);f=t?w:T}else f=t?new fe(0):re.getLiquidityFromTokenAmountB(p,m,y);let b=await ge.getAmountsFromLiquidity({epochInfo:c,poolInfo:e,tickLower:n,tickUpper:r,liquidity:f,slippage:s,add:a});return{liquidity:f,amountA:t?d:b.amountA,amountB:t?b.amountB:d,amountSlippageA:t?d:b.amountSlippageA,amountSlippageB:t?b.amountSlippageB:d,expirationTime:b.expirationTime}}static async getAmountsFromLiquidity({epochInfo:e,poolInfo:t,tickLower:n,tickUpper:r,liquidity:o,slippage:s,add:a}){var b,g,A,w;let c=Y.getSqrtPriceX64FromTick(n),u=Y.getSqrtPriceX64FromTick(r),l=a?1+s:1-s,p=re.getAmountsFromLiquidity(Y.priceToSqrtPriceX64(new _(t.price),t.mintA.decimals,t.mintB.decimals),c,u,o,a),[m,d]=[ke(p.amountA,(b=t.mintA.extensions)==null?void 0:b.feeConfig,e,!0),ke(p.amountB,(g=t.mintB.extensions)==null?void 0:g.feeConfig,e,!0)],[y,f]=[ke(p.amountA.muln(l),(A=t.mintA.extensions)==null?void 0:A.feeConfig,e,!0),ke(p.amountB.muln(l),(w=t.mintB.extensions)==null?void 0:w.feeConfig,e,!0)];return{liquidity:o,amountA:m,amountB:d,amountSlippageA:y,amountSlippageB:f,expirationTime:je(m.expirationTime,d.expirationTime)}}static async fetchComputeMultipleClmmInfo({connection:e,poolList:t,rpcDataMap:n={}}){let r=t.filter(c=>!n[c.id]).map(c=>new Ve(c.id));(await st(e,r)).forEach((c,u)=>{!c||(n[r[u].toBase58()]=Xt.decode(c.data))});let s=t.map(c=>Te(new Ve(c.programId),new Ve(c.id)).publicKey),a=await ge.fetchExBitmaps({connection:e,exBitmapAddress:s,batchRequest:!1});return t.reduce((c,u)=>J(q({},c),{[u.id]:J(q({},n[u.id]),{id:new Ve(u.id),version:6,programId:new Ve(u.programId),mintA:u.mintA,mintB:u.mintB,ammConfig:J(q({},u.config),{id:new Ve(u.config.id),fundOwner:""}),currentPrice:new _(u.price),exBitmapAccount:Te(new Ve(u.programId),new Ve(u.id)).publicKey,exBitmapInfo:a[Te(new Ve(u.programId),new Ve(u.id)).publicKey.toBase58()],startTime:n[u.id].startTime.toNumber(),rewardInfos:n[u.id].rewardInfos})}),{})}static async fetchComputeClmmInfo({connection:e,poolInfo:t,rpcData:n}){return(await this.fetchComputeMultipleClmmInfo({connection:e,rpcDataMap:n?{[t.id]:n}:void 0,poolList:[t]}))[t.id]}};var $=class{static mulDivRoundingUp(e,t,n){let r=e.mul(t),o=r.div(n);return r.mod(n).eq(ye)||(o=o.add(Fe)),o}static mulDivFloor(e,t,n){if(n.eq(ye))throw new Error("division by 0");return e.mul(t).div(n)}static mulDivCeil(e,t,n){if(n.eq(ye))throw new Error("division by 0");return e.mul(t).add(n.sub(Fe)).div(n)}static x64ToDecimal(e,t){return new _(e.toString()).div(_.pow(2,64)).toDecimalPlaces(t)}static decimalToX64(e){return new ee(e.mul(_.pow(2,64)).floor().toFixed())}static wrappingSubU128(e,t){return e.add(On).sub(t).mod(On)}};function Se(i,e){return Li(i.mul(e),64,256)}function Oa(i,e,t){let n=i.toTwos(t).shln(e);return n.imaskn(t+1),n.fromTwos(t)}function Li(i,e,t){let n=i.toTwos(t).shrn(e);return n.imaskn(t-e+1),n.fromTwos(t-e)}var Y=class{static sqrtPriceX64ToPrice(e,t,n){return $.x64ToDecimal(e).pow(2).mul(_.pow(10,t-n))}static priceToSqrtPriceX64(e,t,n){return $.decimalToX64(e.mul(_.pow(10,n-t)).sqrt())}static getNextSqrtPriceX64FromInput(e,t,n,r){if(!e.gt(ye))throw new Error("sqrtPriceX64 must greater than 0");if(!t.gt(ye))throw new Error("liquidity must greater than 0");return r?this.getNextSqrtPriceFromTokenAmountARoundingUp(e,t,n,!0):this.getNextSqrtPriceFromTokenAmountBRoundingDown(e,t,n,!0)}static getNextSqrtPriceX64FromOutput(e,t,n,r){if(!e.gt(ye))throw new Error("sqrtPriceX64 must greater than 0");if(!t.gt(ye))throw new Error("liquidity must greater than 0");return r?this.getNextSqrtPriceFromTokenAmountBRoundingDown(e,t,n,!1):this.getNextSqrtPriceFromTokenAmountARoundingUp(e,t,n,!1)}static getNextSqrtPriceFromTokenAmountARoundingUp(e,t,n,r){if(n.eq(ye))return e;let o=t.shln(on);if(r){let s=o,a=o.add(n.mul(e));return a.gte(s)?$.mulDivCeil(s,e,a):$.mulDivRoundingUp(s,Fe,s.div(e).add(n))}else{let s=n.mul(e);if(!o.gt(s))throw new Error("getNextSqrtPriceFromTokenAmountARoundingUp,liquidityLeftShift must gt amountMulSqrtPrice");let a=o.sub(s);return $.mulDivCeil(o,e,a)}}static getNextSqrtPriceFromTokenAmountBRoundingDown(e,t,n,r){let o=n.shln(on);if(r)return e.add(o.div(t));{let s=$.mulDivRoundingUp(o,Fe,t);if(!e.gt(s))throw new Error("getNextSqrtPriceFromTokenAmountBRoundingDown sqrtPriceX64 must gt amountDivLiquidity");return e.sub(s)}}static getSqrtPriceX64FromTick(e){if(!Number.isInteger(e))throw new Error("tick must be integer");if(e<Le||e>Re)throw new Error("tick must be in MIN_TICK and MAX_TICK");let t=e<0?e*-1:e,n=(t&1)!=0?new ee("18445821805675395072"):new ee("18446744073709551616");return(t&2)!=0&&(n=Se(n,new ee("18444899583751176192"))),(t&4)!=0&&(n=Se(n,new ee("18443055278223355904"))),(t&8)!=0&&(n=Se(n,new ee("18439367220385607680"))),(t&16)!=0&&(n=Se(n,new ee("18431993317065453568"))),(t&32)!=0&&(n=Se(n,new ee("18417254355718170624"))),(t&64)!=0&&(n=Se(n,new ee("18387811781193609216"))),(t&128)!=0&&(n=Se(n,new ee("18329067761203558400"))),(t&256)!=0&&(n=Se(n,new ee("18212142134806163456"))),(t&512)!=0&&(n=Se(n,new ee("17980523815641700352"))),(t&1024)!=0&&(n=Se(n,new ee("17526086738831433728"))),(t&2048)!=0&&(n=Se(n,new ee("16651378430235570176"))),(t&4096)!=0&&(n=Se(n,new ee("15030750278694412288"))),(t&8192)!=0&&(n=Se(n,new ee("12247334978884435968"))),(t&16384)!=0&&(n=Se(n,new ee("8131365268886854656"))),(t&32768)!=0&&(n=Se(n,new ee("3584323654725218816"))),(t&65536)!=0&&(n=Se(n,new ee("696457651848324352"))),(t&131072)!=0&&(n=Se(n,new ee("26294789957507116"))),(t&262144)!=0&&(n=Se(n,new ee("37481735321082"))),e>0&&(n=Fr.div(n)),n}static getTickFromPrice(e,t,n){return Y.getTickFromSqrtPriceX64(Y.priceToSqrtPriceX64(e,t,n))}static getTickFromSqrtPriceX64(e){if(e.gt(it)||e.lt(nt))throw new Error("Provided sqrtPrice is not within the supported sqrtPrice range.");let t=e.bitLength()-1,n=new ee(t-64),r=Oa(n,32,128),o=new ee("8000000000000000","hex"),s=0,a=new ee(0),c=t>=64?e.shrn(t-63):e.shln(63-t);for(;o.gt(new ee(0))&&s<Wr;){c=c.mul(c);let y=c.shrn(127);c=c.shrn(63+y.toNumber()),a=a.add(o.mul(y)),o=o.shrn(1),s+=1}let u=a.shrn(32),p=r.add(u).mul(new ee(Vr)),m=Li(p.sub(new ee(Dr)),64,128).toNumber(),d=Li(p.add(new ee(qr)),64,128).toNumber();return m==d?m:Y.getSqrtPriceX64FromTick(d).lte(e)?d:m}},Ot=class{static getTickWithPriceAndTickspacing(e,t,n,r){let s=Y.getTickFromSqrtPriceX64(Y.priceToSqrtPriceX64(e,n,r))/t;return s<0?s=Math.floor(s):s=Math.ceil(s),s*t}static roundPriceWithTickspacing(e,t,n,r){let o=Ot.getTickWithPriceAndTickspacing(e,t,n,r),s=Y.getSqrtPriceX64FromTick(o);return Y.sqrtPriceX64ToPrice(s,n,r)}},re=class{static addDelta(e,t){return e.add(t)}static getTokenAmountAFromLiquidity(e,t,n,r){if(e.gt(t)&&([e,t]=[t,e]),!e.gt(ye))throw new Error("sqrtPriceX64A must greater than 0");let o=n.ushln(on),s=t.sub(e);return r?$.mulDivRoundingUp($.mulDivCeil(o,s,t),Fe,e):$.mulDivFloor(o,s,t).div(e)}static getTokenAmountBFromLiquidity(e,t,n,r){if(e.gt(t)&&([e,t]=[t,e]),!e.gt(ye))throw new Error("sqrtPriceX64A must greater than 0");return r?$.mulDivCeil(n,t.sub(e),We):$.mulDivFloor(n,t.sub(e),We)}static getLiquidityFromTokenAmountA(e,t,n,r){e.gt(t)&&([e,t]=[t,e]);let o=n.mul(e).mul(t),s=t.sub(e),a=o.div(s);return r?$.mulDivRoundingUp(a,Fe,Ti):a.shrn(on)}static getLiquidityFromTokenAmountB(e,t,n){return e.gt(t)&&([e,t]=[t,e]),$.mulDivFloor(n,Ti,t.sub(e))}static getLiquidityFromTokenAmounts(e,t,n,r,o){if(t.gt(n)&&([t,n]=[n,t]),e.lte(t))return re.getLiquidityFromTokenAmountA(t,n,r,!1);if(e.lt(n)){let s=re.getLiquidityFromTokenAmountA(e,n,r,!1),a=re.getLiquidityFromTokenAmountB(t,e,o);return s.lt(a)?s:a}else return re.getLiquidityFromTokenAmountB(t,n,o)}static getAmountsFromLiquidity(e,t,n,r,o){if(t.gt(n)&&([t,n]=[n,t]),e.lte(t))return{amountA:re.getTokenAmountAFromLiquidity(t,n,r,o),amountB:new ee(0)};if(e.lt(n)){let s=re.getTokenAmountAFromLiquidity(e,n,r,o),a=re.getTokenAmountBFromLiquidity(t,e,r,o);return{amountA:s,amountB:a}}else return{amountA:new ee(0),amountB:re.getTokenAmountBFromLiquidity(t,n,r,o)}}static getAmountsFromLiquidityWithSlippage(e,t,n,r,o,s,a){let{amountA:c,amountB:u}=re.getAmountsFromLiquidity(e,t,n,r,s),l=o?1+a:1-a,p=new ee(new _(c.toString()).mul(l).toFixed(0)),m=new ee(new _(u.toString()).mul(l).toFixed(0));return{amountSlippageA:p,amountSlippageB:m}}static getAmountsOutFromLiquidity({poolInfo:e,tickLower:t,tickUpper:n,liquidity:r,slippage:o,add:s,epochInfo:a,amountAddFee:c}){var A,w,T,B;let u=Y.priceToSqrtPriceX64(new _(e.price),e.mintA.decimals,e.mintB.decimals),l=Y.getSqrtPriceX64FromTick(t),p=Y.getSqrtPriceX64FromTick(n),m=s?1+o:1-o,d=re.getAmountsFromLiquidity(u,l,p,r,s),[y,f]=[ke(d.amountA,(A=e.mintA.extensions)==null?void 0:A.feeConfig,a,c),ke(d.amountB,(w=e.mintB.extensions)==null?void 0:w.feeConfig,a,c)],[b,g]=[ke(new ee(new _(d.amountA.toString()).mul(m).toFixed(0)),(T=e.mintA.extensions)==null?void 0:T.feeConfig,a,c),ke(new ee(new _(d.amountB.toString()).mul(m).toFixed(0)),(B=e.mintB.extensions)==null?void 0:B.feeConfig,a,c)];return{liquidity:r,amountA:y,amountB:f,amountSlippageA:b,amountSlippageB:g,expirationTime:je(y.expirationTime,f.expirationTime)}}},Mt=class{static swapCompute(e,t,n,r,o,s,a,c,u,l,p,m,d,y,f=!1){if(m.eq(ye))throw new Error("amountSpecified must not be 0");if(y||(y=s?nt.add(Fe):it.sub(Fe)),s){if(y.lt(nt))throw new Error("sqrtPriceX64 must greater than MIN_SQRT_PRICE_X64");if(y.gte(p))throw new Error("sqrtPriceX64 must smaller than current")}else{if(y.gt(it))throw new Error("sqrtPriceX64 must smaller than MAX_SQRT_PRICE_X64");if(y.lte(p))throw new Error("sqrtPriceX64 must greater than current")}let b=m.gt(ye),g={amountSpecifiedRemaining:m,amountCalculated:ye,sqrtPriceX64:p,tick:u>d?Math.min(d+ie.tickCount(l)-1,u):d,accounts:[],liquidity:c,feeAmount:new ee(0)},A=d,w=n[d],T=0,B=!s&&w.startTickIndex===g.tick;for(;!g.amountSpecifiedRemaining.eq(ye)&&!g.sqrtPriceX64.eq(y);){T>10;let k={};k.sqrtPriceStartX64=g.sqrtPriceX64;let x=W.nextInitTick(w,g.tick,l,s,B),I=x||null,R=null;if(!(I!=null&&I.liquidityGross.gtn(0))){let L=ge.nextInitializedTickArrayStartIndex({tickCurrent:g.tick,tickSpacing:l,tickArrayBitmap:r,exBitmapInfo:o},A,s);if(!L.isExist){if(f)return{allTrade:!1,amountSpecifiedRemaining:g.amountSpecifiedRemaining,amountCalculated:g.amountCalculated,feeAmount:g.feeAmount,sqrtPriceX64:g.sqrtPriceX64,liquidity:g.liquidity,tickCurrent:g.tick,accounts:g.accounts};throw Error("swapCompute LiquidityInsufficient")}A=L.nextStartIndex;let{publicKey:G}=se(e,t,A);R=G,w=n[A];try{I=W.firstInitializedTick(w,s)}catch{throw Error("not found next tick info")}}k.tickNext=I.tick,k.initialized=I.liquidityGross.gtn(0),d!==A&&R&&(g.accounts.push(R),d=A),k.tickNext<Le?k.tickNext=Le:k.tickNext>Re&&(k.tickNext=Re),k.sqrtPriceNextX64=Y.getSqrtPriceX64FromTick(k.tickNext);let h;if(s&&k.sqrtPriceNextX64.lt(y)||!s&&k.sqrtPriceNextX64.gt(y)?h=y:h=k.sqrtPriceNextX64,[g.sqrtPriceX64,k.amountIn,k.amountOut,k.feeAmount]=Mt.swapStepCompute(g.sqrtPriceX64,h,g.liquidity,g.amountSpecifiedRemaining,a,s),g.feeAmount=g.feeAmount.add(k.feeAmount),b?(g.amountSpecifiedRemaining=g.amountSpecifiedRemaining.sub(k.amountIn.add(k.feeAmount)),g.amountCalculated=g.amountCalculated.sub(k.amountOut)):(g.amountSpecifiedRemaining=g.amountSpecifiedRemaining.add(k.amountOut),g.amountCalculated=g.amountCalculated.add(k.amountIn.add(k.feeAmount))),g.sqrtPriceX64.eq(k.sqrtPriceNextX64)){if(k.initialized){let L=I.liquidityNet;s&&(L=L.mul(ct)),g.liquidity=re.addDelta(g.liquidity,L)}B=k.tickNext!=g.tick&&!s&&w.startTickIndex===k.tickNext,g.tick=s?k.tickNext-1:k.tickNext}else if(g.sqrtPriceX64!=k.sqrtPriceStartX64){let L=Y.getTickFromSqrtPriceX64(g.sqrtPriceX64);B=L!=g.tick&&!s&&w.startTickIndex===L,g.tick=L}++T}try{let{nextStartIndex:k,isExist:x}=ie.nextInitializedTickArray(g.tick,l,s,r,o);x&&d!==k&&(g.accounts.push(se(e,t,k).publicKey),d=k)}catch{}return{allTrade:!0,amountSpecifiedRemaining:ye,amountCalculated:g.amountCalculated,feeAmount:g.feeAmount,sqrtPriceX64:g.sqrtPriceX64,liquidity:g.liquidity,tickCurrent:g.tick,accounts:g.accounts}}static swapStepCompute(e,t,n,r,o,s){let a={sqrtPriceX64Next:new ee(0),amountIn:new ee(0),amountOut:new ee(0),feeAmount:new ee(0)},c=r.gte(ye);if(c){let l=$.mulDivFloor(r,_n.sub(new ee(o.toString())),_n);a.amountIn=s?re.getTokenAmountAFromLiquidity(t,e,n,!0):re.getTokenAmountBFromLiquidity(e,t,n,!0),l.gte(a.amountIn)?a.sqrtPriceX64Next=t:a.sqrtPriceX64Next=Y.getNextSqrtPriceX64FromInput(e,n,l,s)}else a.amountOut=s?re.getTokenAmountBFromLiquidity(t,e,n,!1):re.getTokenAmountAFromLiquidity(e,t,n,!1),r.mul(ct).gte(a.amountOut)?a.sqrtPriceX64Next=t:a.sqrtPriceX64Next=Y.getNextSqrtPriceX64FromOutput(e,n,r.mul(ct),s);let u=t.eq(a.sqrtPriceX64Next);return s?(u&&c||(a.amountIn=re.getTokenAmountAFromLiquidity(a.sqrtPriceX64Next,e,n,!0)),u&&!c||(a.amountOut=re.getTokenAmountBFromLiquidity(a.sqrtPriceX64Next,e,n,!1))):(a.amountIn=u&&c?a.amountIn:re.getTokenAmountBFromLiquidity(e,a.sqrtPriceX64Next,n,!0),a.amountOut=u&&!c?a.amountOut:re.getTokenAmountAFromLiquidity(e,a.sqrtPriceX64Next,n,!1)),!c&&a.amountOut.gt(r.mul(ct))&&(a.amountOut=r.mul(ct)),c&&!a.sqrtPriceX64Next.eq(t)?a.feeAmount=r.sub(a.amountIn):a.feeAmount=$.mulDivCeil(a.amountIn,new ee(o),_n.sub(new ee(o))),[a.sqrtPriceX64Next,a.amountIn,a.amountOut,a.feeAmount]}};var Ie=60,Rt=512,W=class{static getTickArrayAddressByTick(e,t,n,r){let o=W.getTickArrayStartIndexByTick(n,r),{publicKey:s}=se(e,t,o);return s}static getTickOffsetInArray(e,t){if(e%t!=0)throw new Error("tickIndex % tickSpacing not equal 0");let n=W.getTickArrayStartIndexByTick(e,t),r=Math.floor((e-n)/t);if(r<0||r>=Ie)throw new Error("tick offset in array overflow");return r}static getTickArrayBitIndex(e,t){let n=ie.tickCount(t),r=e/n;return e<0&&e%n!=0?r=Math.ceil(r)-1:r=Math.floor(r),r}static getTickArrayStartIndexByTick(e,t){return this.getTickArrayBitIndex(e,t)*ie.tickCount(t)}static getTickArrayOffsetInBitmapByTick(e,t){let n=t*Ie,r=Math.floor(e/n)+512;return Math.abs(r)}static checkTickArrayIsInitialized(e,t,n){let r=n*Ie,o=Math.floor(t/r)+512,s=Math.abs(o);return{isInitialized:e.testn(s),startIndex:(s-512)*r}}static getNextTickArrayStartIndex(e,t,n){return n?e-t*Ie:e+t*Ie}static mergeTickArrayBitmap(e){let t=new Ea(0);for(let n=0;n<e.length;n++)t=t.add(e[n].shln(64*n));return t}static getInitializedTickArrayInRange(e,t,n,r,o){let s=Math.floor(r/(n*Ie));return[...W.searchLowBitFromStart(e,t,s-1,o,n),...W.searchHightBitFromStart(e,t,s,o,n)]}static getAllInitializedTickArrayStartIndex(e,t,n){return W.searchHightBitFromStart(e,t,-7680,Rt,n)}static getAllInitializedTickArrayInfo(e,t,n,r,o){let s=[],a=W.getAllInitializedTickArrayStartIndex(n,r,o);for(let c of a){let{publicKey:u}=se(e,t,c);s.push({tickArrayStartIndex:c,tickArrayAddress:u})}return s}static getAllInitializedTickInTickArray(e){return e.ticks.filter(t=>t.liquidityGross.gtn(0))}static searchLowBitFromStart(e,t,n,r,o){let s=[...[...t.negativeTickArrayBitmap].reverse(),e.slice(0,8),e.slice(8,16),...t.positiveTickArrayBitmap].map(u=>W.mergeTickArrayBitmap(u)),a=[];for(;n>=-7680;){let u=Math.floor((n+7680)/512),l=(n+7680)%512;if(s[u].testn(l)&&a.push(n),n--,a.length===r)break}let c=ie.tickCount(o);return a.map(u=>u*c)}static searchHightBitFromStart(e,t,n,r,o){let s=[...[...t.negativeTickArrayBitmap].reverse(),e.slice(0,8),e.slice(8,16),...t.positiveTickArrayBitmap].map(u=>W.mergeTickArrayBitmap(u)),a=[];for(;n<7680;){let u=Math.floor((n+7680)/512),l=(n+7680)%512;if(s[u].testn(l)&&a.push(n),n++,a.length===r)break}let c=ie.tickCount(o);return a.map(u=>u*c)}static checkIsOutOfBoundary(e){return e<Le||e>Re}static nextInitTick(e,t,n,r,o){if(ie.getArrayStartIndex(t,n)!=e.startTickIndex)return null;let a=Math.floor((t-e.startTickIndex)/n);if(r)for(;a>=0;){if(e.ticks[a].liquidityGross.gtn(0))return e.ticks[a];a=a-1}else for(o||(a=a+1);a<Ie;){if(e.ticks[a].liquidityGross.gtn(0))return e.ticks[a];a=a+1}return null}static firstInitializedTick(e,t){if(t){let n=Ie-1;for(;n>=0;){if(e.ticks[n].liquidityGross.gtn(0))return e.ticks[n];n=n-1}}else{let n=0;for(;n<Ie;){if(e.ticks[n].liquidityGross.gtn(0))return e.ticks[n];n=n+1}}throw Error(`firstInitializedTick check error: ${e} - ${t}`)}static _getTickPriceLegacy({poolInfo:e,tick:t,baseIn:n}){let r=Y.getSqrtPriceX64FromTick(t),o=Y.sqrtPriceX64ToPrice(r,e.mintA.decimals,e.mintB.decimals);return n?{tick:t,price:o,tickSqrtPriceX64:r}:{tick:t,price:new _(1).div(o),tickSqrtPriceX64:r}}static _getPriceAndTickLegacy({poolInfo:e,price:t,baseIn:n}){let r=n?t:new _(1).div(t),o=Ot.getTickWithPriceAndTickspacing(r,e.ammConfig.tickSpacing,e.mintA.decimals,e.mintB.decimals),s=Y.getSqrtPriceX64FromTick(o),a=Y.sqrtPriceX64ToPrice(s,e.mintA.decimals,e.mintB.decimals);return n?{tick:o,price:a}:{tick:o,price:new _(1).div(a)}}static getTickPrice({poolInfo:e,tick:t,baseIn:n}){let r=Y.getSqrtPriceX64FromTick(t),o=Y.sqrtPriceX64ToPrice(r,e.mintA.decimals,e.mintB.decimals);return n?{tick:t,price:o,tickSqrtPriceX64:r}:{tick:t,price:new _(1).div(o),tickSqrtPriceX64:r}}static getPriceAndTick({poolInfo:e,price:t,baseIn:n}){let r=n?t:new _(1).div(t),o=Ot.getTickWithPriceAndTickspacing(r,e.config.tickSpacing,e.mintA.decimals,e.mintB.decimals),s=Y.getSqrtPriceX64FromTick(o),a=Y.sqrtPriceX64ToPrice(s,e.mintA.decimals,e.mintB.decimals);return n?{tick:o,price:a}:{tick:o,price:new _(1).div(a)}}};var va=F([he(8),H("bump"),Nt("index"),N(""),_e("protocolFeeRate"),_e("tradeFeeRate"),Nt("tickSpacing"),ne(P(),8,"")]),_a=F([_e("blockTimestamp"),Er("tickCumulative"),ne(P(),4)]),Jr=F([he(8),xe("initialized"),P("recentEpoch"),Nt("observationIndex"),N("poolId"),ne(_a,100,"observations"),ne(P(),4)]),Fa=F([H("rewardState"),P("openTime"),P("endTime"),P("lastUpdateTime"),Z("emissionsPerSecondX64"),P("rewardTotalEmissioned"),P("rewardClaimed"),N("tokenMint"),N("tokenVault"),N("creator"),Z("rewardGrowthGlobalX64")]),Xt=F([he(8),H("bump"),N("ammConfig"),N("creator"),N("mintA"),N("mintB"),N("vaultA"),N("vaultB"),N("observationId"),H("mintDecimalsA"),H("mintDecimalsB"),Nt("tickSpacing"),Z("liquidity"),Z("sqrtPriceX64"),de("tickCurrent"),_e(),Z("feeGrowthGlobalX64A"),Z("feeGrowthGlobalX64B"),P("protocolFeesTokenA"),P("protocolFeesTokenB"),Z("swapInAmountTokenA"),Z("swapOutAmountTokenB"),Z("swapInAmountTokenB"),Z("swapOutAmountTokenA"),H("status"),ne(H(),7,""),ne(Fa,3,"rewardInfos"),ne(P(),16,"tickArrayBitmap"),P("totalFeesTokenA"),P("totalFeesClaimedTokenA"),P("totalFeesTokenB"),P("totalFeesClaimedTokenB"),P("fundFeesTokenA"),P("fundFeesTokenB"),P("startTime"),ne(P(),15*4-3,"padding")]),Wa=F([Z("growthInsideLastX64"),P("rewardAmountOwed")]),Ni=F([he(8),H("bump"),N("nftMint"),N("poolId"),de("tickLower"),de("tickUpper"),Z("liquidity"),Z("feeGrowthInsideLastX64A"),Z("feeGrowthInsideLastX64B"),P("tokenFeesOwedA"),P("tokenFeesOwedB"),ne(Wa,3,"rewardInfos"),ne(P(),8,"")]),Cf=F([he(8),H("bump"),N("poolId"),de("tickLowerIndex"),de("tickUpperIndex"),Z("liquidity"),Z("feeGrowthInsideLastX64A"),Z("feeGrowthInsideLastX64B"),P("tokenFeesOwedA"),P("tokenFeesOwedB"),ne(Z(),3,"rewardGrowthInside"),ne(P(),8,"")]),Va=F([de("tick"),vr("liquidityNet"),Z("liquidityGross"),Z("feeGrowthOutsideX64A"),Z("feeGrowthOutsideX64B"),ne(Z(),3,"rewardGrowthsOutsideX64"),ne(_e(),13,"")]),un=F([he(8),N("poolId"),de("startTickIndex"),ne(Va,Ie,"ticks"),H("initializedTickCount"),ne(H(),115,"")]),Da=F([he(329),ne(N(),100,"whitelistMints")]),Yr=F([he(8),N("poolId"),ne(ne(P(),8),Ci,"positiveTickArrayBitmap"),ne(ne(P(),8),Ci,"negativeTickArrayBitmap")]),Nf=F([P(),H("bump"),N("owner"),N("poolId"),N("positionId"),N("nftAccount"),ne(P(),8)]),Lf=F([he(8),H("bump"),N("lockOwner"),N("poolId"),N("positionId"),N("nftAccount"),N("lockNftMint"),P("recentEpoch"),ne(P(),8)]);Jr.span;var $r=ce("Raydium_Clmm"),De={createPool:[233,146,209,142,207,104,64,188],initReward:[95,135,192,196,242,129,230,68],setRewardEmissions:[112,52,167,75,32,201,211,137],openPosition:[77,184,74,214,112,86,241,199],openPositionWithTokenEx:[77,255,174,82,125,29,201,46],closePosition:[123,134,81,0,49,68,98,98],increaseLiquidity:[133,29,89,223,69,238,176,10],decreaseLiquidity:[58,127,188,62,79,82,196,96],swap:[43,4,237,11,26,201,30,98],collectReward:[18,237,166,197,34,16,213,144]},eo=[188,37,179,131,82,150,84,73],to=[16,72,250,198,14,162,212,19],Et=class{static createPoolInstruction(e,t,n,r,o,s,a,c,u,l,p,m,d,y){let f=F([Z("sqrtPriceX64"),P("zero")]),b=[{pubkey:n,isSigner:!0,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!1},{pubkey:t,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!1},{pubkey:u,isSigner:!1,isWritable:!1},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:m,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!1},{pubkey:p,isSigner:!1,isWritable:!1},{pubkey:pt.programId,isSigner:!1,isWritable:!1},{pubkey:tt,isSigner:!1,isWritable:!1},...(y==null?void 0:y.map(w=>({pubkey:w,isSigner:!1,isWritable:!1})))||[]],g=Buffer.alloc(f.span);f.encode({sqrtPriceX64:d,zero:ye},g);let A=Buffer.from([...De.createPool,...g]);return new Ce({keys:b,programId:e,data:A})}static async createPoolInstructions(e){let{programId:t,owner:n,mintA:r,mintB:o,ammConfigId:s,initialPriceX64:a,extendMintAccount:c}=e,[u,l]=[new C(r.address),new C(o.address)],{publicKey:p}=zr(t,s,u,l),{publicKey:m}=Qr(t,p),{publicKey:d}=xi(t,p,u),{publicKey:y}=xi(t,p,l),f=Te(t,p).publicKey,b=[this.createPoolInstruction(t,p,n,s,m,u,d,new C(r.programId||ae),l,y,new C(o.programId||ae),f,a,c)];return{signers:[],instructions:b,instructionTypes:[te.CreateAccount,te.ClmmCreatePool],address:{poolId:p,observationId:m,exBitmapAccount:f,mintAVault:d,mintBVault:y},lookupTableAddress:[]}}static openPositionFromLiquidityInstruction(e,t,n,r,o,s,a,c,u,l,p,m,d,y,f,b,g,A,w,T,B,k,x,I,R,h){let L=F([de("tickLowerIndex"),de("tickUpperIndex"),de("tickArrayLowerStartIndex"),de("tickArrayUpperStartIndex"),Z("liquidity"),P("amountMaxA"),P("amountMaxB"),xe("withMetadata"),H("optionBaseFlag"),xe("baseFlag")]),G=[...h?[{pubkey:h,isSigner:!1,isWritable:!0}]:[]],E=[{pubkey:t,isSigner:!0,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!1},{pubkey:o,isSigner:!0,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:p,isSigner:!1,isWritable:!0},{pubkey:m,isSigner:!1,isWritable:!0},{pubkey:d,isSigner:!1,isWritable:!0},{pubkey:y,isSigner:!1,isWritable:!0},{pubkey:f,isSigner:!1,isWritable:!0},{pubkey:tt,isSigner:!1,isWritable:!1},{pubkey:pt.programId,isSigner:!1,isWritable:!1},{pubkey:ae,isSigner:!1,isWritable:!1},{pubkey:ln,isSigner:!1,isWritable:!1},{pubkey:kt,isSigner:!1,isWritable:!1},{pubkey:Pe,isSigner:!1,isWritable:!1},{pubkey:b,isSigner:!1,isWritable:!1},{pubkey:g,isSigner:!1,isWritable:!1},...G],z=Buffer.alloc(L.span);L.encode({tickLowerIndex:A,tickUpperIndex:w,tickArrayLowerStartIndex:T,tickArrayUpperStartIndex:B,liquidity:k,amountMaxA:x,amountMaxB:I,withMetadata:R==="create",baseFlag:!1,optionBaseFlag:0},z);let D=Buffer.from([...De.openPosition,...z]);return new Ce({keys:E,programId:e,data:D})}static openPositionFromLiquidityInstruction22(e,t,n,r,o,s,a,c,u,l,p,m,d,y,f,b,g,A,w,T,B,k,x,I,R){let h=F([de("tickLowerIndex"),de("tickUpperIndex"),de("tickArrayLowerStartIndex"),de("tickArrayUpperStartIndex"),Z("liquidity"),P("amountMaxA"),P("amountMaxB"),xe("withMetadata"),H("optionBaseFlag"),xe("baseFlag")]),L=[...R?[{pubkey:R,isSigner:!1,isWritable:!0}]:[]],G=[{pubkey:t,isSigner:!0,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!1},{pubkey:o,isSigner:!0,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:p,isSigner:!1,isWritable:!0},{pubkey:m,isSigner:!1,isWritable:!0},{pubkey:d,isSigner:!1,isWritable:!0},{pubkey:y,isSigner:!1,isWritable:!0},{pubkey:tt,isSigner:!1,isWritable:!1},{pubkey:pt.programId,isSigner:!1,isWritable:!1},{pubkey:ae,isSigner:!1,isWritable:!1},{pubkey:ln,isSigner:!1,isWritable:!1},{pubkey:Pe,isSigner:!1,isWritable:!1},{pubkey:f,isSigner:!1,isWritable:!1},{pubkey:b,isSigner:!1,isWritable:!1},...L],E=Buffer.alloc(h.span);h.encode({tickLowerIndex:g,tickUpperIndex:A,tickArrayLowerStartIndex:w,tickArrayUpperStartIndex:T,liquidity:B,amountMaxA:k,amountMaxB:x,withMetadata:I==="create",baseFlag:!1,optionBaseFlag:0},E);let z=Buffer.from([...De.openPositionWithTokenEx,...E]);return new Ce({keys:G,programId:e,data:z})}static async openPositionInstructions({poolInfo:e,poolKeys:t,ownerInfo:n,tickLower:r,tickUpper:o,liquidity:s,amountMaxA:a,amountMaxB:c,withMetadata:u,getEphemeralSigners:l,nft2022:p}){let m=[],[d,y]=[new C(e.programId),new C(e.id)],f;if(l)f=new C((await l(1))[0]);else{let R=Vn.generate();m.push(R),f=R.publicKey}let b=W.getTickArrayStartIndexByTick(r,e.config.tickSpacing),g=W.getTickArrayStartIndexByTick(o,e.config.tickSpacing),{publicKey:A}=se(d,y,b),{publicKey:w}=se(d,y,g),{publicKey:T}=p?pe(n.wallet,f,Pe):pe(n.wallet,f,ae),{publicKey:B}=Ut(f),{publicKey:k}=Ee(d,f),{publicKey:x}=lt(d,y,r,o),I=p?this.openPositionFromLiquidityInstruction22(d,n.feePayer,y,n.wallet,f,T,x,A,w,k,n.tokenAccountA,n.tokenAccountB,new C(t.vault.A),new C(t.vault.B),new C(e.mintA.address),new C(e.mintB.address),r,o,b,g,s,a,c,u,ge.isOverflowDefaultTickarrayBitmap(e.config.tickSpacing,[b,g])?Te(d,y).publicKey:void 0):this.openPositionFromLiquidityInstruction(d,n.feePayer,y,n.wallet,f,T,B,x,A,w,k,n.tokenAccountA,n.tokenAccountB,new C(t.vault.A),new C(t.vault.B),new C(e.mintA.address),new C(e.mintB.address),r,o,b,g,s,a,c,u,ge.isOverflowDefaultTickarrayBitmap(e.config.tickSpacing,[b,g])?Te(d,y).publicKey:void 0);return{signers:m,instructions:[I],instructionTypes:[te.ClmmOpenPosition],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[],address:{nftMint:f,tickArrayLower:A,tickArrayUpper:w,positionNftAccount:T,metadataAccount:B,personalPosition:k,protocolPosition:x}}}static async openPositionFromBaseInstructions({poolInfo:e,poolKeys:t,ownerInfo:n,tickLower:r,tickUpper:o,base:s,baseAmount:a,otherAmountMax:c,withMetadata:u,getEphemeralSigners:l,nft2022:p}){let m=[],[d,y]=[new C(e.programId),new C(e.id)],f;if(l)f=new C((await l(1))[0]);else{let R=Vn.generate();m.push(R),f=R.publicKey}let b=W.getTickArrayStartIndexByTick(r,e.config.tickSpacing),g=W.getTickArrayStartIndexByTick(o,e.config.tickSpacing),{publicKey:A}=se(d,y,b),{publicKey:w}=se(d,y,g),{publicKey:T}=p?pe(n.wallet,f,Pe):pe(n.wallet,f,ae),{publicKey:B}=Ut(f),{publicKey:k}=Ee(d,f),{publicKey:x}=lt(d,y,r,o),I=p?this.openPositionFromBaseInstruction22(d,n.feePayer,y,n.wallet,f,T,x,A,w,k,n.tokenAccountA,n.tokenAccountB,new C(t.vault.A),new C(t.vault.B),new C(e.mintA.address),new C(e.mintB.address),r,o,b,g,u,s,a,c,ge.isOverflowDefaultTickarrayBitmap(e.config.tickSpacing,[b,g])?Te(d,y).publicKey:void 0):this.openPositionFromBaseInstruction(d,n.feePayer,y,n.wallet,f,T,B,x,A,w,k,n.tokenAccountA,n.tokenAccountB,new C(t.vault.A),new C(t.vault.B),new C(e.mintA.address),new C(e.mintB.address),r,o,b,g,u,s,a,c,ge.isOverflowDefaultTickarrayBitmap(e.config.tickSpacing,[b,g])?Te(d,y).publicKey:void 0);return{address:{nftMint:f,tickArrayLower:A,tickArrayUpper:w,positionNftAccount:T,metadataAccount:B,personalPosition:k,protocolPosition:x},instructions:[I],signers:m,instructionTypes:[te.ClmmOpenPosition],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[]}}static openPositionFromBaseInstruction(e,t,n,r,o,s,a,c,u,l,p,m,d,y,f,b,g,A,w,T,B,k,x,I,R,h){let L=F([de("tickLowerIndex"),de("tickUpperIndex"),de("tickArrayLowerStartIndex"),de("tickArrayUpperStartIndex"),Z("liquidity"),P("amountMaxA"),P("amountMaxB"),xe("withMetadata"),H("optionBaseFlag"),xe("baseFlag")]),G=[...h?[{pubkey:h,isSigner:!1,isWritable:!0}]:[]],E=[{pubkey:t,isSigner:!0,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!1},{pubkey:o,isSigner:!0,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:p,isSigner:!1,isWritable:!0},{pubkey:m,isSigner:!1,isWritable:!0},{pubkey:d,isSigner:!1,isWritable:!0},{pubkey:y,isSigner:!1,isWritable:!0},{pubkey:f,isSigner:!1,isWritable:!0},{pubkey:tt,isSigner:!1,isWritable:!1},{pubkey:pt.programId,isSigner:!1,isWritable:!1},{pubkey:ae,isSigner:!1,isWritable:!1},{pubkey:ln,isSigner:!1,isWritable:!1},{pubkey:kt,isSigner:!1,isWritable:!1},{pubkey:Pe,isSigner:!1,isWritable:!1},{pubkey:b,isSigner:!1,isWritable:!1},{pubkey:g,isSigner:!1,isWritable:!1},...G],z=Buffer.alloc(L.span);L.encode({tickLowerIndex:A,tickUpperIndex:w,tickArrayLowerStartIndex:T,tickArrayUpperStartIndex:B,liquidity:new Ri(0),amountMaxA:x==="MintA"?I:R,amountMaxB:x==="MintA"?R:I,withMetadata:k==="create",baseFlag:x==="MintA",optionBaseFlag:1},z);let D=Buffer.from([...De.openPosition,...z]);return new Ce({keys:E,programId:e,data:D})}static openPositionFromBaseInstruction22(e,t,n,r,o,s,a,c,u,l,p,m,d,y,f,b,g,A,w,T,B,k,x,I,R){let h=F([de("tickLowerIndex"),de("tickUpperIndex"),de("tickArrayLowerStartIndex"),de("tickArrayUpperStartIndex"),Z("liquidity"),P("amountMaxA"),P("amountMaxB"),xe("withMetadata"),H("optionBaseFlag"),xe("baseFlag")]),L=[...R?[{pubkey:R,isSigner:!1,isWritable:!0}]:[]],G=[{pubkey:t,isSigner:!0,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!1},{pubkey:o,isSigner:!0,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:p,isSigner:!1,isWritable:!0},{pubkey:m,isSigner:!1,isWritable:!0},{pubkey:d,isSigner:!1,isWritable:!0},{pubkey:y,isSigner:!1,isWritable:!0},{pubkey:tt,isSigner:!1,isWritable:!1},{pubkey:pt.programId,isSigner:!1,isWritable:!1},{pubkey:ae,isSigner:!1,isWritable:!1},{pubkey:ln,isSigner:!1,isWritable:!1},{pubkey:Pe,isSigner:!1,isWritable:!1},{pubkey:f,isSigner:!1,isWritable:!1},{pubkey:b,isSigner:!1,isWritable:!1},...L],E=Buffer.alloc(h.span);h.encode({tickLowerIndex:g,tickUpperIndex:A,tickArrayLowerStartIndex:w,tickArrayUpperStartIndex:T,liquidity:new Ri(0),amountMaxA:k==="MintA"?x:I,amountMaxB:k==="MintA"?I:x,withMetadata:B==="create",baseFlag:k==="MintA",optionBaseFlag:1},E);let z=Buffer.from([...De.openPositionWithTokenEx,...E]);return new Ce({keys:G,programId:e,data:z})}static async openPositionFromLiquidityInstructions({poolInfo:e,poolKeys:t,ownerInfo:n,tickLower:r,tickUpper:o,liquidity:s,amountMaxA:a,amountMaxB:c,withMetadata:u,getEphemeralSigners:l,nft2022:p}){let m,d=[];if(l)m=new C((await l(1))[0]);else{let R=Vn.generate();d.push(R),m=R.publicKey}let[y,f]=[new C(e.programId),new C(e.id)],b=W.getTickArrayStartIndexByTick(r,e.config.tickSpacing),g=W.getTickArrayStartIndexByTick(o,e.config.tickSpacing),{publicKey:A}=se(y,f,b),{publicKey:w}=se(y,f,g),{publicKey:T}=p?pe(n.wallet,m,Pe):pe(n.wallet,m,ae),{publicKey:B}=Ut(m),{publicKey:k}=Ee(y,m),{publicKey:x}=lt(y,f,r,o),I=p?this.openPositionFromLiquidityInstruction22(y,n.wallet,f,n.wallet,m,T,x,A,w,k,n.tokenAccountA,n.tokenAccountB,new C(t.vault.A),new C(t.vault.B),new C(t.mintA.address),new C(t.mintB.address),r,o,b,g,s,a,c,u,ge.isOverflowDefaultTickarrayBitmap(e.config.tickSpacing,[b,g])?Te(y,f).publicKey:void 0):this.openPositionFromLiquidityInstruction(y,n.wallet,f,n.wallet,m,T,B,x,A,w,k,n.tokenAccountA,n.tokenAccountB,new C(t.vault.A),new C(t.vault.B),new C(t.mintA.address),new C(t.mintB.address),r,o,b,g,s,a,c,u,ge.isOverflowDefaultTickarrayBitmap(e.config.tickSpacing,[b,g])?Te(y,f).publicKey:void 0);return{address:{nftMint:m,tickArrayLower:A,tickArrayUpper:w,positionNftAccount:T,metadataAccount:B,personalPosition:k,protocolPosition:x},instructions:[I],signers:d,instructionTypes:[te.ClmmOpenPosition],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[]}}static closePositionInstruction(e,t,n,r,o,s){let a=F([]),c=[{pubkey:t,isSigner:!0,isWritable:!0},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:pt.programId,isSigner:!1,isWritable:!1},{pubkey:s?Pe:ae,isSigner:!1,isWritable:!1}],u=Buffer.alloc(a.span);a.encode({},u);let l=Buffer.from([...De.closePosition,...u]);return new Ce({keys:c,programId:e,data:l})}static closePositionInstructions({poolInfo:e,poolKeys:t,ownerInfo:n,ownerPosition:r,nft2022:o}){let s=new C(e.programId),a=o?pe(n.wallet,r.nftMint,Pe).publicKey:pe(n.wallet,r.nftMint,ae).publicKey,{publicKey:c}=Ee(s,r.nftMint),u=[];return u.push(this.closePositionInstruction(s,n.wallet,r.nftMint,a,c,o)),{address:{positionNftAccount:a,personalPosition:c},signers:[],instructions:u,instructionTypes:[te.ClmmClosePosition],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[]}}static increasePositionFromLiquidityInstruction(e,t,n,r,o,s,a,c,u,l,p,m,d,y,f,b,g,A){let w=F([Z("liquidity"),P("amountMaxA"),P("amountMaxB"),H("optionBaseFlag"),xe("baseFlag")]),T=[...A?[{pubkey:A,isSigner:!1,isWritable:!0}]:[]],B=[{pubkey:t,isSigner:!0,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!1},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:p,isSigner:!1,isWritable:!0},{pubkey:m,isSigner:!1,isWritable:!0},{pubkey:ae,isSigner:!1,isWritable:!1},{pubkey:Pe,isSigner:!1,isWritable:!1},{pubkey:d,isSigner:!1,isWritable:!1},{pubkey:y,isSigner:!1,isWritable:!1},...T],k=Buffer.alloc(w.span);w.encode({liquidity:f,amountMaxA:b,amountMaxB:g,optionBaseFlag:0,baseFlag:!1},k);let x=Buffer.from([...De.increaseLiquidity,...k]);return new Ce({keys:B,programId:e,data:x})}static increasePositionFromLiquidityInstructions({poolInfo:e,poolKeys:t,ownerPosition:n,ownerInfo:r,liquidity:o,amountMaxA:s,amountMaxB:a,nft2022:c}){let[u,l]=[new C(e.programId),new C(e.id)],p=W.getTickArrayStartIndexByTick(n.tickLower,e.config.tickSpacing),m=W.getTickArrayStartIndexByTick(n.tickUpper,e.config.tickSpacing),{publicKey:d}=se(u,l,p),{publicKey:y}=se(u,l,m),{publicKey:f}=c?pe(r.wallet,n.nftMint,Pe):pe(r.wallet,n.nftMint,ae),{publicKey:b}=Ee(u,n.nftMint),{publicKey:g}=lt(u,l,n.tickLower,n.tickUpper),A=this.increasePositionFromLiquidityInstruction(u,r.wallet,f,b,l,g,d,y,r.tokenAccountA,r.tokenAccountB,new C(t.vault.A),new C(t.vault.B),new C(e.mintA.address),new C(e.mintB.address),o,s,a,ge.isOverflowDefaultTickarrayBitmap(e.config.tickSpacing,[p,m])?Te(u,l).publicKey:void 0);return{address:{tickArrayLower:d,tickArrayUpper:y,positionNftAccount:f,personalPosition:b,protocolPosition:g},signers:[],instructions:[A],instructionTypes:[te.ClmmIncreasePosition],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[]}}static increasePositionFromBaseInstructions({poolInfo:e,poolKeys:t,ownerPosition:n,ownerInfo:r,base:o,baseAmount:s,otherAmountMax:a,nft2022:c}){let[u,l]=[new C(e.programId),new C(e.id)],p=W.getTickArrayStartIndexByTick(n.tickLower,e.config.tickSpacing),m=W.getTickArrayStartIndexByTick(n.tickUpper,e.config.tickSpacing),{publicKey:d}=se(u,l,p),{publicKey:y}=se(u,l,m),{publicKey:f}=c?pe(r.wallet,n.nftMint,Pe):pe(r.wallet,n.nftMint,ae),{publicKey:b}=Ee(u,n.nftMint),{publicKey:g}=lt(u,l,n.tickLower,n.tickUpper);return{address:{tickArrayLower:d,tickArrayUpper:y,positionNftAccount:f,personalPosition:b,protocolPosition:g},instructions:[this.increasePositionFromBaseInstruction(u,r.wallet,f,b,l,g,d,y,r.tokenAccountA,r.tokenAccountB,new C(t.vault.A),new C(t.vault.B),new C(e.mintA.address),new C(e.mintB.address),o,s,a,ge.isOverflowDefaultTickarrayBitmap(e.config.tickSpacing,[p,m])?Te(u,l).publicKey:void 0)],signers:[],instructionTypes:[te.ClmmIncreasePosition],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[]}}static increasePositionFromBaseInstruction(e,t,n,r,o,s,a,c,u,l,p,m,d,y,f,b,g,A){let w=F([Z("liquidity"),P("amountMaxA"),P("amountMaxB"),H("optionBaseFlag"),xe("baseFlag")]),T=[...A?[{pubkey:A,isSigner:!1,isWritable:!0}]:[]],B=[{pubkey:t,isSigner:!0,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!1},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:p,isSigner:!1,isWritable:!0},{pubkey:m,isSigner:!1,isWritable:!0},{pubkey:ae,isSigner:!1,isWritable:!1},{pubkey:Pe,isSigner:!1,isWritable:!1},{pubkey:d,isSigner:!1,isWritable:!1},{pubkey:y,isSigner:!1,isWritable:!1},...T],k=Buffer.alloc(w.span);w.encode({liquidity:new Ri(0),amountMaxA:f==="MintA"?b:g,amountMaxB:f==="MintA"?g:b,baseFlag:f==="MintA",optionBaseFlag:1},k);let x=Buffer.from([...De.increaseLiquidity,...k]);return new Ce({keys:B,programId:e,data:x})}static decreaseLiquidityInstruction(e,t,n,r,o,s,a,c,u,l,p,m,d,y,f,b,g,A,w){let T=F([Z("liquidity"),P("amountMinA"),P("amountMinB")]),B=[...w?[{pubkey:w,isSigner:!1,isWritable:!0}]:[],...f.map(R=>[{pubkey:R.poolRewardVault,isSigner:!1,isWritable:!0},{pubkey:R.ownerRewardVault,isSigner:!1,isWritable:!0},{pubkey:R.rewardMint,isSigner:!1,isWritable:!1}]).flat()],k=[{pubkey:t,isSigner:!0,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!1},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:p,isSigner:!1,isWritable:!0},{pubkey:m,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:ae,isSigner:!1,isWritable:!1},{pubkey:Pe,isSigner:!1,isWritable:!1},{pubkey:In,isSigner:!1,isWritable:!1},{pubkey:d,isSigner:!1,isWritable:!1},{pubkey:y,isSigner:!1,isWritable:!1},...B],x=Buffer.alloc(T.span);T.encode({liquidity:b,amountMinA:g,amountMinB:A},x);let I=Buffer.from([...De.decreaseLiquidity,...x]);return new Ce({keys:k,programId:e,data:I})}static decreaseLiquidityInstructions({poolInfo:e,poolKeys:t,ownerPosition:n,ownerInfo:r,liquidity:o,amountMinA:s,amountMinB:a,programId:c,nft2022:u}){let[l,p]=[new C(e.programId),new C(e.id)],m=W.getTickArrayStartIndexByTick(n.tickLower,e.config.tickSpacing),d=W.getTickArrayStartIndexByTick(n.tickUpper,e.config.tickSpacing),{publicKey:y}=se(l,p,m),{publicKey:f}=se(l,p,d),{publicKey:b}=u?pe(r.wallet,n.nftMint,Pe):pe(r.wallet,n.nftMint,c),{publicKey:g}=Ee(l,n.nftMint),{publicKey:A}=lt(l,p,n.tickLower,n.tickUpper),w=[];for(let k=0;k<e.rewardDefaultInfos.length;k++)w.push({poolRewardVault:new C(t.rewardInfos[k].vault),ownerRewardVault:r.rewardAccounts[k],rewardMint:new C(e.rewardDefaultInfos[k].mint.address)});let T=[],B=this.decreaseLiquidityInstruction(l,r.wallet,b,g,p,A,y,f,r.tokenAccountA,r.tokenAccountB,new C(t.vault.A),new C(t.vault.B),new C(e.mintA.address),new C(e.mintB.address),w,o,s,a,ge.isOverflowDefaultTickarrayBitmap(e.config.tickSpacing,[m,d])?Te(l,p).publicKey:void 0);return T.push(B),{address:{tickArrayLower:y,tickArrayUpper:f,positionNftAccount:b,personalPosition:g,protocolPosition:A},signers:[],instructions:T,instructionTypes:[te.ClmmDecreasePosition],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[]}}static swapInstruction(e,t,n,r,o,s,a,c,u,l,p,m,d,y,f,b,g){let A=F([P("amount"),P("otherAmountThreshold"),Z("sqrtPriceLimitX64"),xe("isBaseInput")]),w=[...g?[{pubkey:g,isSigner:!1,isWritable:!0}]:[],...p.map(x=>({pubkey:x,isSigner:!1,isWritable:!0}))],T=[{pubkey:t,isSigner:!0,isWritable:!1},{pubkey:r,isSigner:!1,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:m,isSigner:!1,isWritable:!0},{pubkey:ae,isSigner:!1,isWritable:!1},{pubkey:Pe,isSigner:!1,isWritable:!1},{pubkey:In,isSigner:!1,isWritable:!1},{pubkey:u,isSigner:!1,isWritable:!1},{pubkey:l,isSigner:!1,isWritable:!1},...w],B=Buffer.alloc(A.span);A.encode({amount:d,otherAmountThreshold:y,sqrtPriceLimitX64:f,isBaseInput:b},B);let k=Buffer.from([...De.swap,...B]);return new Ce({keys:T,programId:e,data:k})}static makeSwapBaseInInstructions({poolInfo:e,poolKeys:t,observationId:n,ownerInfo:r,inputMint:o,amountIn:s,amountOutMin:a,sqrtPriceLimitX64:c,remainingAccounts:u}){let[l,p]=[new C(e.programId),new C(e.id)],[m,d]=[new C(t.vault.A),new C(t.vault.B)],[y,f]=[new C(e.mintA.address),new C(e.mintB.address)],b=e.mintA.address===o.toString(),g=[this.swapInstruction(l,r.wallet,p,new C(e.config.id),b?r.tokenAccountA:r.tokenAccountB,b?r.tokenAccountB:r.tokenAccountA,b?m:d,b?d:m,b?y:f,b?f:y,u,n,s,a,c,!0,Te(l,p).publicKey)];return{signers:[],instructions:g,instructionTypes:[te.ClmmSwapBaseIn],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[],address:{}}}static makeSwapBaseOutInstructions({poolInfo:e,poolKeys:t,observationId:n,ownerInfo:r,outputMint:o,amountOut:s,amountInMax:a,sqrtPriceLimitX64:c,remainingAccounts:u}){let[l,p]=[new C(e.programId),new C(e.id)],[m,d]=[new C(t.vault.A),new C(t.vault.B)],[y,f]=[new C(e.mintA.address),new C(e.mintB.address)],b=e.mintA.address===o.toBase58(),g=[this.swapInstruction(l,r.wallet,p,new C(e.config.id),b?r.tokenAccountB:r.tokenAccountA,b?r.tokenAccountA:r.tokenAccountB,b?d:m,b?m:d,b?f:y,b?y:f,u,n,s,a,c,!1,Te(l,p).publicKey)];return{signers:[],instructions:g,instructionTypes:[te.ClmmSwapBaseOut],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[],address:{}}}static initRewardInstruction(e,t,n,r,o,s,a,c,u,l,p,m){let d=F([P("openTime"),P("endTime"),Z("emissionsPerSecondX64")]),y=[{pubkey:t,isSigner:!0,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!1},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!1},{pubkey:pt.programId,isSigner:!1,isWritable:!1},{pubkey:tt,isSigner:!1,isWritable:!1}],f=Buffer.alloc(d.span);d.encode({openTime:le(l),endTime:le(p),emissionsPerSecondX64:m},f);let b=Buffer.from([...De.initReward,...f]);return new Ce({keys:y,programId:e,data:b})}static initRewardInstructions({poolInfo:e,poolKeys:t,ownerInfo:n,rewardInfo:r}){let[o,s]=[new C(e.programId),new C(e.id)],a=Hr(o,s,r.mint).publicKey,c=Wn(o).publicKey,u=[this.initRewardInstruction(o,n.wallet,s,c,new C(e.config.id),n.tokenAccount,r.programId,r.mint,a,r.openTime,r.endTime,r.emissionsPerSecondX64)];return{address:{poolRewardVault:a,operationId:c},signers:[],instructions:u,instructionTypes:[te.ClmmInitReward],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[]}}static setRewardInstruction(e,t,n,r,o,s,a,c,u,l,p,m){let d=F([H("rewardIndex"),Z("emissionsPerSecondX64"),P("openTime"),P("endTime")]),y=[{pubkey:t,isSigner:!0,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:ae,isSigner:!1,isWritable:!1},{pubkey:Pe,isSigner:!1,isWritable:!1},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!0}],f=Buffer.alloc(d.span);d.encode({rewardIndex:u,emissionsPerSecondX64:m,openTime:le(l),endTime:le(p)},f);let b=Buffer.from([...De.setRewardEmissions,...f]);return new Ce({keys:y,programId:e,data:b})}static setRewardInstructions({poolInfo:e,poolKeys:t,ownerInfo:n,rewardInfo:r}){let[o,s]=[new C(e.programId),new C(e.id)],a,c,u;for(let m=0;m<e.rewardDefaultInfos.length;m++)e.rewardDefaultInfos[m].mint.address===r.mint.toString()&&(a=m,c=new C(t.rewardInfos[m].vault),u=new C(t.rewardInfos[m].mint.address));(a===void 0||c===void 0)&&$r.logWithError("reward mint check error","no reward mint",e.rewardDefaultInfos);let l=Wn(o).publicKey,p=[this.setRewardInstruction(o,n.wallet,s,l,new C(e.config.id),n.tokenAccount,c,u,a,r.openTime,r.endTime,r.emissionsPerSecondX64)];return{address:{rewardVault:c,operationId:l},signers:[],instructions:p,instructionTypes:[te.ClmmSetReward],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[]}}static collectRewardInstruction(e,t,n,r,o,s,a){let c=F([H("rewardIndex")]),u=[{pubkey:t,isSigner:!0,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!1},{pubkey:ae,isSigner:!1,isWritable:!1},{pubkey:Pe,isSigner:!1,isWritable:!1},{pubkey:In,isSigner:!1,isWritable:!1}],l=Buffer.alloc(c.span);c.encode({rewardIndex:a},l);let p=Buffer.from([...De.collectReward,...l]);return new Ce({keys:u,programId:e,data:p})}static collectRewardInstructions({poolInfo:e,poolKeys:t,ownerInfo:n,rewardMint:r}){let[o,s]=[new C(e.programId),new C(e.id)],a,c;for(let l=0;l<e.rewardDefaultInfos.length;l++)e.rewardDefaultInfos[l].mint.address===r.toString()&&(a=l,c=new C(t.rewardInfos[l].vault));(a===void 0||c===void 0)&&$r.logWithError("reward mint check error","no reward mint",e.rewardDefaultInfos);let u=[this.collectRewardInstruction(o,n.wallet,s,n.tokenAccount,c,r,a)];return{address:{rewardVault:c},signers:[],instructions:u,instructionTypes:[te.ClmmCollectReward],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[]}}static async makeLockPositions({programId:e,authProgramId:t,poolProgramId:n,payer:r,wallet:o,nftMint:s,nft2022:a,getEphemeralSigners:c}){let u=[],l;if(c)l=new C((await c(1))[0]);else{let g=Vn.generate();u.push(g),l=g.publicKey}let p=a?pe(o,s,Pe).publicKey:pe(o,s,ae).publicKey,{publicKey:m}=Ee(n,s),d=Ki(e,l).publicKey,y=pe(o,l,ae).publicKey,f=Ut(l).publicKey,b=Et.lockPositionInstructionV2({programId:e,auth:t,payer:r,positionOwner:o,lockOwner:o,positionNftAccount:p,positionId:m,lockPositionId:d,lockNftMint:l,lockNftAccount:y,metadataAccount:f,withMetadata:!0,nft2022:a,positionNftMint:s,authPositionNftAccount:pe(t,s,a?Pe:ae).publicKey,positionNftProgram:a?Pe:ae});return{address:{positionId:m,lockPositionId:d,lockNftAccount:y,lockNftMint:l,positionNftAccount:p,metadataAccount:f},instructions:[b],signers:u,instructionTypes:[te.ClmmLockPosition],lookupTableAddress:[]}}static lockPositionInstructionV2({programId:e,auth:t,payer:n,positionOwner:r,lockOwner:o,positionNftAccount:s,positionId:a,positionNftMint:c,authPositionNftAccount:u,positionNftProgram:l,lockPositionId:p,lockNftMint:m,lockNftAccount:d,metadataAccount:y,withMetadata:f}){let b=[{pubkey:t,isSigner:!1,isWritable:!1},{pubkey:n,isSigner:!0,isWritable:!0},{pubkey:r,isSigner:!0,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!1},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!1},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:p,isSigner:!1,isWritable:!0},{pubkey:m,isSigner:!0,isWritable:!0},{pubkey:d,isSigner:!1,isWritable:!0},{pubkey:y,isSigner:!1,isWritable:!0},{pubkey:kt,isSigner:!1,isWritable:!1},{pubkey:ln,isSigner:!1,isWritable:!1},{pubkey:tt,isSigner:!1,isWritable:!1},{pubkey:ae,isSigner:!1,isWritable:!1},{pubkey:l,isSigner:!1,isWritable:!1},{pubkey:pt.programId,isSigner:!1,isWritable:!1}],g=F([xe("withMetadata")]),A=Buffer.alloc(g.span);g.encode({withMetadata:f},A);let w=Buffer.from([...eo,...A]);return new Ce({keys:b,programId:e,data:w})}static lockPositionInstruction({programId:e,authProgramId:t,poolProgramId:n,owner:r,positionNft:o}){let{publicKey:s}=pe(r,o,ae),{publicKey:a}=Ee(n,o),c=[{pubkey:t,isSigner:!1,isWritable:!1},{pubkey:r,isSigner:!0,isWritable:!1},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!1},{pubkey:Si(e,a).publicKey,isSigner:!1,isWritable:!0},{pubkey:ae,isSigner:!1,isWritable:!1},{pubkey:pt.programId,isSigner:!1,isWritable:!1}];return new Ce({keys:c,programId:e,data:Buffer.from(eo)})}static harvestLockPositionInstruction(e){let[t,n]=[new C(e.poolKeys.programId),new C(e.poolKeys.id)],r=W.getTickArrayStartIndexByTick(e.ownerPosition.tickLower,e.poolKeys.config.tickSpacing),o=W.getTickArrayStartIndexByTick(e.ownerPosition.tickUpper,e.poolKeys.config.tickSpacing),{publicKey:s}=se(t,n,r),{publicKey:a}=se(t,n,o),{publicKey:c}=pe(e.owner,e.ownerPosition.nftMint,ae),{publicKey:u}=Ee(t,e.ownerPosition.nftMint),{publicKey:l}=lt(t,n,e.ownerPosition.tickLower,e.ownerPosition.tickUpper),p=[];for(let y=0;y<e.poolKeys.rewardInfos.length;y++)p.push({poolRewardVault:new C(e.poolKeys.rewardInfos[y].vault),ownerRewardVault:e.ownerRewardAccounts[y],rewardMint:new C(e.poolKeys.rewardInfos[y].mint.address)});let m=[...p.map(y=>[{pubkey:y.poolRewardVault,isSigner:!1,isWritable:!0},{pubkey:y.ownerRewardVault,isSigner:!1,isWritable:!0},{pubkey:y.rewardMint,isSigner:!1,isWritable:!1}]).flat()],d=[{pubkey:e.authProgramId,isSigner:!1,isWritable:!1},{pubkey:Si(e.programId,u).publicKey,isSigner:!1,isWritable:!1},{pubkey:t,isSigner:!1,isWritable:!1},{pubkey:e.owner,isSigner:!0,isWritable:!1},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:new C(e.poolKeys.vault.A),isSigner:!1,isWritable:!0},{pubkey:new C(e.poolKeys.vault.B),isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:e.userVaultA,isSigner:!1,isWritable:!0},{pubkey:e.userVaultB,isSigner:!1,isWritable:!0},{pubkey:ae,isSigner:!1,isWritable:!1},{pubkey:Pe,isSigner:!1,isWritable:!1},{pubkey:Vt,isSigner:!1,isWritable:!1},{pubkey:new C(e.poolKeys.mintA.address),isSigner:!1,isWritable:!1},{pubkey:new C(e.poolKeys.mintB.address),isSigner:!1,isWritable:!1},...m];return new Ce({keys:d,programId:e.programId,data:Buffer.from(to)})}static harvestLockPositionInstructionV2({programId:e,auth:t,lockPositionId:n,clmmProgram:r,lockOwner:o,lockNftMint:s,lockNftAccount:a,positionNftAccount:c,positionId:u,poolId:l,protocolPosition:p,vaultA:m,vaultB:d,tickArrayLower:y,tickArrayUpper:f,userVaultA:b,userVaultB:g,mintA:A,mintB:w,rewardAccounts:T,exTickArrayBitmap:B}){let k=[...B?[{pubkey:B,isSigner:!1,isWritable:!0}]:[],...T.map(I=>[{pubkey:I.poolRewardVault,isSigner:!1,isWritable:!0},{pubkey:I.ownerRewardVault,isSigner:!1,isWritable:!0},{pubkey:I.rewardMint,isSigner:!1,isWritable:!1}]).flat()],x=[{pubkey:t,isSigner:!1,isWritable:!1},{pubkey:o,isSigner:!0,isWritable:!1},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:n,isSigner:!1,isWritable:!1},{pubkey:r,isSigner:!1,isWritable:!1},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:p,isSigner:!1,isWritable:!0},{pubkey:m,isSigner:!1,isWritable:!0},{pubkey:d,isSigner:!1,isWritable:!0},{pubkey:y,isSigner:!1,isWritable:!0},{pubkey:f,isSigner:!1,isWritable:!0},{pubkey:b,isSigner:!1,isWritable:!0},{pubkey:g,isSigner:!1,isWritable:!0},{pubkey:ae,isSigner:!1,isWritable:!1},{pubkey:Pe,isSigner:!1,isWritable:!1},{pubkey:Vt,isSigner:!1,isWritable:!1},{pubkey:A,isSigner:!1,isWritable:!1},{pubkey:w,isSigner:!1,isWritable:!1},...k];return new Ce({keys:x,programId:e,data:Buffer.from(to)})}};var Xb=F([he(8),H("bump"),xe("disableCreatePool"),Nt("index"),P("tradeFeeRate"),P("protocolFeeRate"),P("fundFeeRate"),P("createPoolFee"),N("protocolOwner"),N("fundOwner"),ne(P(),16)]),no=F([he(8),N("configId"),N("poolCreator"),N("vaultA"),N("vaultB"),N("mintLp"),N("mintA"),N("mintB"),N("mintProgramA"),N("mintProgramB"),N("observationId"),H("bump"),H("status"),H("lpDecimals"),H("mintDecimalA"),H("mintDecimalB"),P("lpAmount"),P("protocolFeesMintA"),P("protocolFeesMintB"),P("fundFeesMintA"),P("fundFeesMintB"),P("openTime"),ne(P(),32)]);import{PublicKey as oy,TransactionInstruction as Ga,Keypair as ay,SystemProgram as uy}from"@solana/web3.js";import{ASSOCIATED_TOKEN_PROGRAM_ID as ly,TOKEN_2022_PROGRAM_ID as my,TOKEN_PROGRAM_ID as py}from"@solana/spl-token";var qa=Buffer.from("vault_and_lp_mint_auth_seed","utf8"),Qb=Buffer.from("amm_config","utf8"),jb=Buffer.from("pool","utf8"),Zb=Buffer.from("pool_lp_mint","utf8"),Yb=Buffer.from("pool_vault","utf8"),Jb=Buffer.from("observation","utf8");function io(i){return we([qa],i)}var $b=Buffer.from("locked_liquidity","utf8");var Py=ce("Raydium_cpmm"),Ua={initialize:[175,175,109,31,13,152,155,237],deposit:[242,35,198,137,82,225,242,182],withdraw:[183,18,70,156,148,109,161,34],swapBaseInput:[143,190,90,218,196,30,51,222],swapBaseOutput:[55,217,98,86,163,74,180,173],lockCpLiquidity:[216,157,29,78,38,51,31,26],collectCpFee:[8,30,51,199,209,184,247,133]};function ro(i,e,t,n,r,o,s,a,c,u,l,p,m,d,y,f){let b=F([P("amountIn"),P("amounOutMin")]),g=[{pubkey:e,isSigner:!0,isWritable:!1},{pubkey:t,isSigner:!1,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!1},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!1},{pubkey:l,isSigner:!1,isWritable:!1},{pubkey:p,isSigner:!1,isWritable:!1},{pubkey:m,isSigner:!1,isWritable:!1},{pubkey:d,isSigner:!1,isWritable:!0}],A=Buffer.alloc(b.span);return b.encode({amountIn:y,amounOutMin:f},A),new Ga({keys:g,programId:i,data:Buffer.from([...Ua.swapBaseInput,...A])})}import Ey from"bn.js";import _y from"decimal.js-light";import Xa from"bn.js";var By=new Xa(0);import oo from"bn.js";var Jy=new oo(25),$y=new oo(1e4);var Mi=F([H("instruction"),P("amountIn"),P("minAmountOut")]),Oi=F([H("instruction"),P("maxAmountIn"),P("amountOut")]),ig=F([H("instruction"),H("nonce")]),za=F([H("instruction"),H("nonce"),P("startTime")]),Ei=F([P("status"),P("nonce"),P("maxOrder"),P("depth"),P("baseDecimal"),P("quoteDecimal"),P("state"),P("resetFlag"),P("minSize"),P("volMaxCutRatio"),P("amountWaveRatio"),P("baseLotSize"),P("quoteLotSize"),P("minPriceMultiplier"),P("maxPriceMultiplier"),P("systemDecimalValue"),P("minSeparateNumerator"),P("minSeparateDenominator"),P("tradeFeeNumerator"),P("tradeFeeDenominator"),P("pnlNumerator"),P("pnlDenominator"),P("swapFeeNumerator"),P("swapFeeDenominator"),P("baseNeedTakePnl"),P("quoteNeedTakePnl"),P("quoteTotalPnl"),P("baseTotalPnl"),P("poolOpenTime"),P("punishPcAmount"),P("punishCoinAmount"),P("orderbookToInitTime"),Z("swapBaseInAmount"),Z("swapQuoteOutAmount"),P("swapBase2QuoteFee"),Z("swapQuoteInAmount"),Z("swapBaseOutAmount"),P("swapQuote2BaseFee"),N("baseVault"),N("quoteVault"),N("baseMint"),N("quoteMint"),N("lpMint"),N("openOrders"),N("marketId"),N("marketProgramId"),N("targetOrders"),N("withdrawQueue"),N("lpVault"),N("owner"),P("lpReserve"),ne(P(),3,"padding")]),rg=F([P("accountType"),P("status"),P("nonce"),P("maxOrder"),P("depth"),P("baseDecimal"),P("quoteDecimal"),P("state"),P("resetFlag"),P("minSize"),P("volMaxCutRatio"),P("amountWaveRatio"),P("baseLotSize"),P("quoteLotSize"),P("minPriceMultiplier"),P("maxPriceMultiplier"),P("systemDecimalsValue"),P("abortTradeFactor"),P("priceTickMultiplier"),P("priceTick"),P("minSeparateNumerator"),P("minSeparateDenominator"),P("tradeFeeNumerator"),P("tradeFeeDenominator"),P("pnlNumerator"),P("pnlDenominator"),P("swapFeeNumerator"),P("swapFeeDenominator"),P("baseNeedTakePnl"),P("quoteNeedTakePnl"),P("quoteTotalPnl"),P("baseTotalPnl"),P("poolOpenTime"),P("punishPcAmount"),P("punishCoinAmount"),P("orderbookToInitTime"),Z("swapBaseInAmount"),Z("swapQuoteOutAmount"),Z("swapQuoteInAmount"),Z("swapBaseOutAmount"),P("swapQuote2BaseFee"),P("swapBase2QuoteFee"),N("baseVault"),N("quoteVault"),N("baseMint"),N("quoteMint"),N("lpMint"),N("modelDataAccount"),N("openOrders"),N("marketId"),N("marketProgramId"),N("targetOrders"),N("owner"),ne(P(),64,"padding")]),Ha=F([H("instruction"),P("baseAmountIn"),P("quoteAmountIn"),P("fixedSide"),P("otherAmountMin")]),Qa=F([H("instruction"),P("lpAmount"),P("baseAmountMin"),P("quoteAmountMin")]);var og=F([P("fee")]);import{PublicKey as VP}from"@solana/web3.js";import qP from"bn.js";import{TOKEN_PROGRAM_ID as bu}from"@solana/spl-token";import{PublicKey as dg,SystemProgram as fg,SYSVAR_RENT_PUBKEY as bg,TransactionInstruction as ao}from"@solana/web3.js";import{ASSOCIATED_TOKEN_PROGRAM_ID as gg,TOKEN_PROGRAM_ID as uo}from"@solana/spl-token";import{PublicKey as ja}from"@solana/web3.js";var vi=new ja("CDSr3ssLcRB6XYPJwAfFt18MZvEZp4LjHcvzBVZ45duo"),Za=5e4,Ya=F([P("x"),P("y"),P("price")]),lg=F([P("accountType"),P("status"),P("multiplier"),P("validDataCount"),ne(Ya,Za,"DataElement")]);var so=ce("Raydium_liquidity_instruction");function Ja({poolKeys:i,userKeys:e,amountIn:t,minAmountOut:n},r){let o=St(i),s=Buffer.alloc(Mi.span);Mi.encode({instruction:9,amountIn:le(t),minAmountOut:le(n)},s);let a=[K({pubkey:uo,isWritable:!1}),K({pubkey:o.id}),K({pubkey:o.authority,isWritable:!1}),K({pubkey:o.openOrders})];return r===4&&a.push(K({pubkey:o.targetOrders})),a.push(K({pubkey:o.vault.A}),K({pubkey:o.vault.B})),r===5&&a.push(K({pubkey:vi})),a.push(K({pubkey:o.marketProgramId,isWritable:!1}),K({pubkey:o.marketId}),K({pubkey:o.marketBids}),K({pubkey:o.marketAsks}),K({pubkey:o.marketEventQueue}),K({pubkey:o.marketBaseVault}),K({pubkey:o.marketQuoteVault}),K({pubkey:o.marketAuthority,isWritable:!1}),K({pubkey:e.tokenAccountIn}),K({pubkey:e.tokenAccountOut}),K({pubkey:e.owner,isWritable:!1,isSigner:!0})),new ao({programId:o.programId,keys:a,data:s})}function $a({poolKeys:i,userKeys:e,maxAmountIn:t,amountOut:n},r){let o=St(i),s=Buffer.alloc(Oi.span);Oi.encode({instruction:11,maxAmountIn:le(t),amountOut:le(n)},s);let a=[K({pubkey:uo,isWritable:!1}),K({pubkey:o.id}),K({pubkey:o.authority,isWritable:!1}),K({pubkey:o.openOrders}),K({pubkey:o.targetOrders}),K({pubkey:o.vault.A}),K({pubkey:o.vault.B})];return r===5&&a.push(K({pubkey:vi})),a.push(K({pubkey:o.marketProgramId,isWritable:!1}),K({pubkey:o.marketId}),K({pubkey:o.marketBids}),K({pubkey:o.marketAsks}),K({pubkey:o.marketEventQueue}),K({pubkey:o.marketBaseVault}),K({pubkey:o.marketQuoteVault}),K({pubkey:o.marketAuthority,isWritable:!1}),K({pubkey:e.tokenAccountIn}),K({pubkey:e.tokenAccountOut}),K({pubkey:e.owner,isWritable:!1,isSigner:!0})),new ao({programId:o.programId,keys:a,data:s})}function co(i){let{poolKeys:e,version:t,userKeys:n,amountIn:r,amountOut:o,fixedSide:s}=i;if(t===4||t===5){let a={poolKeys:e,userKeys:n};if(s==="in")return Ja(J(q({},a),{amountIn:r,minAmountOut:o}),t);if(s==="out")return $a(J(q({},a),{maxAmountIn:r,amountOut:o}),t);so.logWithError("invalid params","params",i)}throw so.logWithError("invalid version","poolKeys.version",t),new Error("invalid version")}import{PublicKey as Cg}from"@solana/web3.js";var Rg=ce("Raydium_liquidity_serum");var mn=F([N("mint"),N("owner"),P("amount"),_e("delegateOption"),N("delegate"),H("state"),_e("isNativeOption"),P("isNative"),P("delegatedAmount"),_e("closeAuthorityOption"),N("closeAuthority")]);import{Keypair as ru,PublicKey as ou}from"@solana/web3.js";import Jg from"bn.js";import{TOKEN_PROGRAM_ID as su}from"@solana/spl-token";function eu(i){return i instanceof Uint8Array||i!=null&&typeof i=="object"&&i.constructor.name==="Uint8Array"}function _i(i,...e){if(!eu(i))throw new Error("Uint8Array expected");if(e.length>0&&!e.includes(i.length))throw new Error(`Uint8Array expected of length ${e}, not of length=${i.length}`)}function Fi(i,e=!0){if(i.destroyed)throw new Error("Hash instance has been destroyed");if(e&&i.finished)throw new Error("Hash#digest() has already been called")}function lo(i,e){_i(i);let t=e.outputLen;if(i.length<t)throw new Error(`digestInto() expects output buffer of length at least ${t}`)}var qn=i=>new DataView(i.buffer,i.byteOffset,i.byteLength),Ze=(i,e)=>i<<32-e|i>>>e;var Fg=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;function tu(i){if(typeof i!="string")throw new Error(`utf8ToBytes expected string, got ${typeof i}`);return new Uint8Array(new TextEncoder().encode(i))}function Wi(i){return typeof i=="string"&&(i=tu(i)),_i(i),i}var Dn=class{clone(){return this._cloneInto()}},Wg={}.toString;function mo(i){let e=n=>i().update(Wi(n)).digest(),t=i();return e.outputLen=t.outputLen,e.blockLen=t.blockLen,e.create=()=>i(),e}function nu(i,e,t,n){if(typeof i.setBigUint64=="function")return i.setBigUint64(e,t,n);let r=BigInt(32),o=BigInt(4294967295),s=Number(t>>r&o),a=Number(t&o),c=n?4:0,u=n?0:4;i.setUint32(e+c,s,n),i.setUint32(e+u,a,n)}var po=(i,e,t)=>i&e^~i&t,fo=(i,e,t)=>i&e^i&t^e&t,Gn=class extends Dn{constructor(e,t,n,r){super(),this.blockLen=e,this.outputLen=t,this.padOffset=n,this.isLE=r,this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.buffer=new Uint8Array(e),this.view=qn(this.buffer)}update(e){Fi(this);let{view:t,buffer:n,blockLen:r}=this;e=Wi(e);let o=e.length;for(let s=0;s<o;){let a=Math.min(r-this.pos,o-s);if(a===r){let c=qn(e);for(;r<=o-s;s+=r)this.process(c,s);continue}n.set(e.subarray(s,s+a),this.pos),this.pos+=a,s+=a,this.pos===r&&(this.process(t,0),this.pos=0)}return this.length+=e.length,this.roundClean(),this}digestInto(e){Fi(this),lo(e,this),this.finished=!0;let{buffer:t,view:n,blockLen:r,isLE:o}=this,{pos:s}=this;t[s++]=128,this.buffer.subarray(s).fill(0),this.padOffset>r-s&&(this.process(n,0),s=0);for(let p=s;p<r;p++)t[p]=0;nu(n,r-8,BigInt(this.length*8),o),this.process(n,0);let a=qn(e),c=this.outputLen;if(c%4)throw new Error("_sha2: outputLen should be aligned to 32bit");let u=c/4,l=this.get();if(u>l.length)throw new Error("_sha2: outputLen bigger than state");for(let p=0;p<u;p++)a.setUint32(4*p,l[p],o)}digest(){let{buffer:e,outputLen:t}=this;this.digestInto(e);let n=e.slice(0,t);return this.destroy(),n}_cloneInto(e){e||(e=new this.constructor),e.set(...this.get());let{blockLen:t,buffer:n,length:r,finished:o,destroyed:s,pos:a}=this;return e.length=r,e.pos=a,e.finished=o,e.destroyed=s,r%t&&e.buffer.set(n),e}};var iu=new Uint32Array([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),ht=new Uint32Array([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),Tt=new Uint32Array(64),Vi=class extends Gn{constructor(){super(64,32,8,!1),this.A=ht[0]|0,this.B=ht[1]|0,this.C=ht[2]|0,this.D=ht[3]|0,this.E=ht[4]|0,this.F=ht[5]|0,this.G=ht[6]|0,this.H=ht[7]|0}get(){let{A:e,B:t,C:n,D:r,E:o,F:s,G:a,H:c}=this;return[e,t,n,r,o,s,a,c]}set(e,t,n,r,o,s,a,c){this.A=e|0,this.B=t|0,this.C=n|0,this.D=r|0,this.E=o|0,this.F=s|0,this.G=a|0,this.H=c|0}process(e,t){for(let p=0;p<16;p++,t+=4)Tt[p]=e.getUint32(t,!1);for(let p=16;p<64;p++){let m=Tt[p-15],d=Tt[p-2],y=Ze(m,7)^Ze(m,18)^m>>>3,f=Ze(d,17)^Ze(d,19)^d>>>10;Tt[p]=f+Tt[p-7]+y+Tt[p-16]|0}let{A:n,B:r,C:o,D:s,E:a,F:c,G:u,H:l}=this;for(let p=0;p<64;p++){let m=Ze(a,6)^Ze(a,11)^Ze(a,25),d=l+m+po(a,c,u)+iu[p]+Tt[p]|0,f=(Ze(n,2)^Ze(n,13)^Ze(n,22))+fo(n,r,o)|0;l=u,u=c,c=a,a=s+d|0,s=o,o=r,r=n,n=d+f|0}n=n+this.A|0,r=r+this.B|0,o=o+this.C|0,s=s+this.D|0,a=a+this.E|0,c=c+this.F|0,u=u+this.G|0,l=l+this.H|0,this.set(n,r,o,s,a,c,u,l)}roundClean(){Tt.fill(0)}destroy(){this.set(0,0,0,0,0,0,0,0),this.buffer.fill(0)}};var bo=mo(()=>new Vi);var iP=ce("Raydium_Util");function yo({fromPublicKey:i,programId:e=su,assignSeed:t}){let n=t?btoa(t).slice(0,32):ru.generate().publicKey.toBase58().slice(0,32);return{publicKey:au(i,n,e),seed:n}}function au(i,e,t){let n=Buffer.concat([i.toBuffer(),Buffer.from(e),t.toBuffer()]),r=bo(n);return new ou(r)}import{PublicKey as uu,SystemProgram as cu}from"@solana/web3.js";import lu from"bn.js";import{createCloseAccountInstruction as mu,createInitializeAccountInstruction as pu,createTransferInstruction as fP,TOKEN_PROGRAM_ID as pn}from"@solana/spl-token";function du(i){let{mint:e,tokenAccount:t,owner:n,programId:r=pn}=i;return pu(t,e,n,r)}function dn(i){let{tokenAccount:e,payer:t,multiSigners:n=[],owner:r,programId:o=pn}=i;return mu(e,t,r,n,o)}async function go(i){let{connection:e,amount:t,commitment:n,payer:r,owner:o,skipCloseAccount:s}=i,a=await e.getMinimumBalanceForRentExemption(mn.span,n),c=le(t).add(new lu(a)),u=yo({fromPublicKey:r,programId:pn});return{addresses:{newAccount:u.publicKey},signers:[],instructions:[cu.createAccountWithSeed({fromPubkey:r,basePubkey:r,seed:u.seed,newAccountPubkey:u.publicKey,lamports:c.toNumber(),space:mn.span,programId:pn}),du({mint:new uu(et.address),tokenAccount:u.publicKey,owner:o,programId:pn})],instructionTypes:[te.CreateAccount,te.InitAccount],endInstructionTypes:s?[]:[te.CloseAccount],endInstructions:s?[]:[dn({tokenAccount:u.publicKey,payer:r,owner:o})]}}var fu=F([_e("mintAuthorityOption"),N("mintAuthority"),P("supply"),H("decimals"),H("isInitialized"),_e("freezeAuthorityOption"),N("freezeAuthority")]);function yu({programId:i}){let{publicKey:e}=we([Buffer.from("amm_config_account_seed","utf-8")],i);return e}function Po({programId:i}){return we([Buffer.from([97,109,109,32,97,117,116,104,111,114,105,116,121])],i)}var Di={volume:0,volumeQuote:0,volumeFee:0,apr:0,feeApr:0,priceMin:0,priceMax:0,rewardApr:[]},ko=i=>{let e={},t=bu.toBase58();return Object.keys(i).map(n=>{let r=i[n],[o,s]=[r.baseMint.toBase58(),r.quoteMint.toBase58()];e[n]={id:n,version:4,status:r.status.toNumber(),programId:r.programId.toBase58(),mintA:Lt({address:o,programId:t,decimals:r.baseDecimal.toNumber()}),mintB:Lt({address:s,programId:t,decimals:r.quoteDecimal.toNumber()}),rewardDefaultInfos:[],rewardDefaultPoolInfos:"Ecosystem",price:r.poolPrice.toNumber(),mintAmountA:new _(r.mintAAmount.toString()).div(10**r.baseDecimal.toNumber()).toNumber(),mintAmountB:new _(r.mintBAmount.toString()).div(10**r.quoteDecimal.toNumber()).toNumber(),baseReserve:r.baseReserve,quoteReserve:r.quoteReserve,feeRate:new _(r.tradeFeeNumerator.toString()).div(r.tradeFeeDenominator.toString()).toNumber(),openTime:r.poolOpenTime.toString(),tvl:0,day:Di,week:Di,month:Di,pooltype:[],farmUpcomingCount:0,farmOngoingCount:0,farmFinishedCount:0,type:"Standard",marketId:r.marketId.toBase58(),configId:yu({programId:r.programId}).toBase58(),lpPrice:0,lpAmount:new _(r.lpReserve.toString()).div(10**Math.min(r.baseDecimal.toNumber(),r.quoteDecimal.toNumber())).toNumber(),lpMint:Lt({address:r.lpMint.toBase58(),programId:t,decimals:Math.min(r.baseDecimal.toNumber(),r.quoteDecimal.toNumber())}),burnPercent:0}}),e};var Ao={[fi.toBase58()]:3},wo={3:fi};var qi=F([he(5),he(8),N("ownAddress"),P("vaultSignerNonce"),N("baseMint"),N("quoteMint"),N("baseVault"),P("baseDepositsTotal"),P("baseFeesAccrued"),N("quoteVault"),P("quoteDepositsTotal"),P("quoteFeesAccrued"),P("quoteDustThreshold"),N("requestQueue"),N("eventQueue"),N("bids"),N("asks"),P("baseLotSize"),P("quoteLotSize"),P("feeRateBps"),P("referrerRebatesAccrued"),he(7)]),ho={3:qi};import{PublicKey as To}from"@solana/web3.js";var Un=ce("Serum"),Xn=class{static getProgramId(e){let t=wo[e];return t||Un.logWithError("invalid version","version",e),t}static getVersion(e){let t=e.toBase58(),n=Ao[t];return n||Un.logWithError("invalid program id","programId",t),n}static getStateLayout(e){let t=ho[e];return t||Un.logWithError(!!t,"invalid version","version",e),t}static getLayouts(e){return{state:this.getStateLayout(e)}}static getAssociatedAuthority({programId:e,marketId:t}){let n=[t.toBuffer()],r=0,o;for(;r<100;){try{let s=n.concat(Buffer.from([r]),Buffer.alloc(7));o=To.createProgramAddressSync(s,e)}catch(s){if(s instanceof TypeError)throw s;r++;continue}return{publicKey:o,nonce:r}}return Un.logWithError("unable to find a viable program address nonce","params",{programId:e,marketId:t}),{publicKey:To.default,nonce:r}}};import{PublicKey as X,SystemProgram as gu,TransactionInstruction as Pu}from"@solana/web3.js";import vt from"bn.js";import{ASSOCIATED_TOKEN_PROGRAM_ID as ku,TOKEN_2022_PROGRAM_ID as Au,TOKEN_PROGRAM_ID as wu}from"@solana/spl-token";function hu(i,e,t,n,r,o,s,a,c,u,l,p,m,d,y){var k;let f=[],b=[K({pubkey:wu,isWritable:!1}),K({pubkey:Au,isWritable:!1}),K({pubkey:ku,isWritable:!1}),K({pubkey:gu.programId,isWritable:!1}),K({pubkey:e,isSigner:!0})];b.push(K({pubkey:t})),b.push(K({pubkey:r}));let g=[c,u],A=[l,p],w=[o,s,a];for(let x=0;x<g.length;x++){let I=g[x],R=w[x]===I.mintA.address;if(b.push(K({pubkey:new X(I.programId),isWritable:!1})),x===g.length-1?b.push(K({pubkey:r})):b.push(K({pubkey:n})),b.push(K({pubkey:new X(w[x])})),b.push(K({pubkey:new X(w[x+1])})),I.version===6){let h=A[x];b.push(K({pubkey:new X(h.config.id)})),b.push(K({pubkey:new X(h.id)})),b.push(K({pubkey:new X(R?h.vault.A:h.vault.B)})),b.push(K({pubkey:new X(R?h.vault.B:h.vault.A)})),b.push(K({pubkey:new X(I.observationId)})),b.push(K({pubkey:Vt})),b.push(K({pubkey:Te(new X(I.programId),new X(I.id)).publicKey})),f.push(Tu(I.sqrtPriceX64.toString(),R));for(let L of(k=y[x])!=null?k:[])b.push(K({pubkey:new X(L)}))}else if(I.version===5){let h=A[x];b.push(K({pubkey:new X(h.id)})),b.push(K({pubkey:new X(h.authority),isWritable:!1})),b.push(K({pubkey:new X(h.marketProgramId)})),b.push(K({pubkey:new X(h.marketAuthority)})),b.push(K({pubkey:Br,isWritable:!1})),b.push(K({pubkey:new X(h.openOrders)})),b.push(K({pubkey:new X(h.vault.A)})),b.push(K({pubkey:new X(h.vault.B)})),b.push(K({pubkey:new X(h.id)})),b.push(K({pubkey:new X(h.id)})),b.push(K({pubkey:new X(h.id)})),b.push(K({pubkey:new X(h.id)})),b.push(K({pubkey:new X(h.id)})),b.push(K({pubkey:new X(h.id)})),b.push(K({pubkey:new X(h.marketId)})),b.push(K({pubkey:new X(h.marketBids)})),b.push(K({pubkey:new X(h.marketAsks)})),b.push(K({pubkey:new X(h.marketEventQueue)})),b.push(K({pubkey:new X(h.marketBaseVault)})),b.push(K({pubkey:new X(h.marketQuoteVault)}))}else if(I.version===4){let h=A[x],L=I.status!==1;b.push(K({pubkey:new X(h.id)})),b.push(K({pubkey:new X(h.authority),isWritable:!1})),b.push(K({pubkey:new X(L?h.id:h.marketProgramId)})),b.push(K({pubkey:new X(L?h.id:h.marketAuthority)})),b.push(K({pubkey:new X(L?h.id:h.openOrders)})),b.push(K({pubkey:new X(h.vault.A)})),b.push(K({pubkey:new X(h.vault.B)})),b.push(K({pubkey:new X(L?h.id:h.marketId)})),b.push(K({pubkey:new X(L?h.id:h.marketBids)})),b.push(K({pubkey:new X(L?h.id:h.marketAsks)})),b.push(K({pubkey:new X(L?h.id:h.marketEventQueue)})),b.push(K({pubkey:new X(L?h.id:h.marketBaseVault)})),b.push(K({pubkey:new X(L?h.id:h.marketQuoteVault)}))}else if(I.version===7){let h=A[x];b.push(K({pubkey:new X(h.authority)})),b.push(K({pubkey:new X(h.config.id)})),b.push(K({pubkey:new X(h.id)})),b.push(K({pubkey:new X(R?h.vault.A:h.vault.B)})),b.push(K({pubkey:new X(R?h.vault.B:h.vault.A)})),b.push(K({pubkey:new X(I.observationId)}))}else throw Error("pool type error")}let T=F([H("insId"),P("amountIn"),P("amountOut"),ne(Z(),f.length,"clmmPriceLimit")]),B=Buffer.alloc(T.span);return T.encode({insId:0,amountIn:m,amountOut:d,clmmPriceLimit:f},B),new Pu({keys:b,programId:i,data:B})}function Tu(i,e){if(i)if(e){let t=new vt(i).div(new vt(25));return t.gt(En)?t:En}else{let t=new vt(i).mul(new vt(25));return t.lt(vn)?t:vn}else return e?En:vn}function Bo({routeProgram:i,ownerInfo:e,inputMint:t,swapInfo:n}){var r,o,s,a,c,u,l;if(n.routeType==="amm")if(n.poolInfo[0].version===6){let p=n.poolKey[0],m=St(p),d=t.equals(m.mintA.address)?nt.add(Fe):it.sub(Fe);return Et.makeSwapBaseInInstructions({poolInfo:p,poolKeys:p,observationId:n.poolInfo[0].observationId,ownerInfo:{wallet:e.wallet,tokenAccountA:m.mintA.address.equals(t)?e.sourceToken:e.destinationToken,tokenAccountB:m.mintA.address.equals(t)?e.destinationToken:e.sourceToken},inputMint:t,amountIn:n.amountIn.amount.raw,amountOutMin:n.minAmountOut.amount.raw.sub((o=(r=n.minAmountOut.fee)==null?void 0:r.raw)!=null?o:new vt(0)),sqrtPriceLimitX64:d,remainingAccounts:(s=n.remainingAccounts[0])!=null?s:[]})}else if(n.poolInfo[0].version===7){let p=n.poolInfo[0],m=t.toString()===n.poolInfo[0].mintA.address;return{signers:[],instructions:[ro(p.programId,e.wallet,p.authority,p.configId,p.id,e.sourceToken,e.destinationToken,m?p.vaultA:p.vaultB,m?p.vaultB:p.vaultA,m?p.mintProgramA:p.mintProgramB,m?p.mintProgramB:p.mintProgramA,new X(p[m?"mintA":"mintB"].address),new X(p[m?"mintB":"mintA"].address),p.observationId,n.amountIn.amount.raw,n.minAmountOut.amount.raw)],lookupTableAddress:[],instructionTypes:[m?te.CpmmSwapBaseIn:te.CpmmSwapBaseOut],address:{}}}else{let p=n.poolKey[0];return{signers:[],instructions:[co({poolKeys:p,version:n.poolInfo[0].pooltype.includes("StablePool")?5:4,userKeys:{tokenAccountIn:e.sourceToken,tokenAccountOut:e.destinationToken,owner:e.wallet},amountIn:n.amountIn.amount.raw,amountOut:n.minAmountOut.amount.raw.sub((c=(a=n.minAmountOut.fee)==null?void 0:a.raw)!=null?c:new vt(0)),fixedSide:"in"})],lookupTableAddress:p.lookupTableAccount?[p.lookupTableAccount]:[],instructionTypes:[n.poolInfo[0].pooltype.includes("StablePool")?te.AmmV5SwapBaseIn:te.AmmV4SwapBaseIn],address:{}}}else if(n.routeType==="route"){let p=n.poolInfo[0],m=n.poolInfo[1],d=n.poolKey[0],y=n.poolKey[1];if(e.routeToken===void 0)throw Error("owner route token account check error");return{signers:[],instructions:[hu(i,e.wallet,e.sourceToken,e.routeToken,e.destinationToken,t.toString(),n.middleToken.mint.toString(),n.outputMint.toString(),p,m,d,y,n.amountIn.amount.raw,n.minAmountOut.amount.raw.sub((l=(u=n.minAmountOut.fee)==null?void 0:u.raw)!=null?l:new vt(0)),n.remainingAccounts)],instructionTypes:[te.RouteSwap],lookupTableAddress:[d.lookupTableAccount,y.lookupTableAccount].filter(f=>f!==void 0),address:{}}}else throw Error("route type error")}var dt=new Hn(0),Gi=class extends Gt{constructor(e){super(e)}async getWSolAccounts(){this.scope.checkOwner(),await this.scope.account.fetchWalletTokenAccounts();let e=this.scope.account.tokenAccounts.filter(t=>t.mint.equals(He));return e.sort((t,n)=>t.isAssociated?1:n.isAssociated||t.amount.lt(n.amount)?-1:1),e}async unWrapWSol(e){let{amount:t,tokenProgram:n,txVersion:r=1,feePayer:o}=e,s=await this.getWSolAccounts(),a=this.createTxBuilder(o);a.addCustomComputeBudget(e.computeBudgetConfig);let c=le(t);for(let u=0;u<s.length;u++)c.gte(s[u].amount)?(a.addInstruction({instructions:[dn({tokenAccount:s[u].publicKey,payer:this.scope.ownerPubKey,owner:this.scope.ownerPubKey,programId:n})]}),c.sub(s[u].amount)):a.addInstruction({instructions:[dn({tokenAccount:s[u].publicKey,payer:this.scope.ownerPubKey,owner:this.scope.ownerPubKey,programId:n})]});return a.versionBuild({txVersion:r})}async wrapWSol(e,t,n,r){let o=this.createTxBuilder(r),s=await go({connection:this.scope.connection,owner:this.scope.ownerPubKey,payer:this.scope.ownerPubKey,amount:e,skipCloseAccount:!0});return o.addInstruction(s),o.versionBuild({txVersion:n!=null?n:1})}async swap({swapInfo:e,swapPoolKeys:t,ownerInfo:n,computeBudgetConfig:r,routeProgram:o,txVersion:s,feePayer:a}){let c=this.createTxBuilder(a),u=e.amountIn,l=e.amountOut,p=u.amount.token.mint.equals(He),m=l.amount.token.mint.equals(He),d=u.amount.token.mint,y=l.amount.token.mint,{account:f,instructionParams:b}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:u.amount.token.isToken2022?zn:Ae,mint:d,notUseTokenAccount:p,owner:this.scope.ownerPubKey,skipCloseAccount:!p,createInfo:p?{payer:this.scope.ownerPubKey,amount:u.amount.raw}:void 0,associatedOnly:p?!1:n.associatedOnly,checkCreateATAOwner:n.checkCreateATAOwner});if(b&&c.addInstruction(b),f===void 0)throw Error("input account check error");let g;if(e.routeType==="route"&&!m)g=this.scope.account.getAssociatedTokenAccount(y,l.amount.token.isToken2022?zn:Ae);else{let{account:B,instructionParams:k}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:l.amount.token.isToken2022?zn:Ae,mint:y,notUseTokenAccount:m,owner:this.scope.ownerPubKey,skipCloseAccount:!0,createInfo:{payer:this.scope.ownerPubKey,amount:0},associatedOnly:m?!1:n.associatedOnly,checkCreateATAOwner:n.checkCreateATAOwner});g=B,k&&c.addInstruction(k)}m&&c.addInstruction({endInstructions:[dn({owner:this.scope.ownerPubKey,payer:this.scope.ownerPubKey,tokenAccount:g,programId:Ae})],endInstructionTypes:[te.CloseAccount]});let A;if(e.routeType==="route"){let B=e.middleToken;A=this.scope.account.getAssociatedTokenAccount(B.mint,B.isToken2022?zn:Ae)}let w=t||await this.computePoolToPoolKeys({pools:e.poolInfoList}),T=Bo({routeProgram:o,inputMint:d,swapInfo:J(q({},e),{poolInfo:[...e.poolInfoList],poolKey:w,outputMint:y}),ownerInfo:{wallet:this.scope.ownerPubKey,sourceToken:f,routeToken:A,destinationToken:g}});if(e.feeConfig!==void 0){let B=this.createTxBuilder();B.addInstruction({instructions:[Io(f,e.feeConfig.feeAccount,this.scope.ownerPubKey,e.feeConfig.feeAmount.toNumber())],instructionTypes:[te.TransferAmount]}),B.addInstruction(T);let{transactions:k}=s===0?await B.sizeCheckBuildV0():await B.sizeCheckBuild();k.length<2&&c.addInstruction({instructions:[Io(f,e.feeConfig.feeAccount,this.scope.ownerPubKey,e.feeConfig.feeAmount.toNumber())],instructionTypes:[te.TransferAmount]})}return c.addInstruction(T),s===0?c.sizeCheckBuildV0({computeBudgetConfig:r,address:T.address}):c.sizeCheckBuild({computeBudgetConfig:r,address:T.address})}async fetchRoutePoolBasicInfo(e){let{amm:t=Tr,clmm:n=bi,cpmm:r=yi}=e||{},o=await this.scope.connection.getProgramAccounts(t,{dataSlice:{offset:Ei.offsetOf("baseMint"),length:64}}),s=F([N("baseMint"),N("quoteMint")]),a=o.map(d=>({id:d.pubkey,version:4,mintA:s.decode(d.account.data).baseMint,mintB:s.decode(d.account.data).quoteMint})),c=F([N("mintA"),N("mintB")]),l=(await this.scope.connection.getProgramAccounts(n,{filters:[{dataSize:Xt.span}],dataSlice:{offset:Xt.offsetOf("mintA"),length:64}})).map(d=>{let y=c.decode(d.account.data);return{id:d.pubkey,version:6,mintA:y.mintA,mintB:y.mintB}}),m=(await this.scope.connection.getProgramAccounts(r,{dataSlice:{offset:no.offsetOf("mintA"),length:64}})).map(d=>{let y=c.decode(d.account.data);return{id:d.pubkey,version:7,mintA:y.mintA,mintB:y.mintB}});return{clmmPools:l,ammPools:a,cpmmPools:m}}getAllRoute({inputMint:e,outputMint:t,clmmPools:n,ammPools:r,cpmmPools:o}){e=e.toString()===_t.default.toString()?He:e,t=t.toString()===_t.default.toString()?He:t;let s={},a={},c={},u=[],l={};for(let m of n!=null?n:[]){if((m.mintA.equals(e)&&m.mintB.equals(t)||m.mintA.equals(t)&&m.mintB.equals(e))&&(u.push(m),a[m.id.toString()]=m),m.mintA.equals(e)){let d=m.mintB.toString();l[d]===void 0&&(l[d]={mintProgram:Ae,in:[],out:[],mDecimals:0}),l[d].in.push(m)}if(m.mintB.equals(e)){let d=m.mintA.toString();l[d]===void 0&&(l[d]={mintProgram:Ae,in:[],out:[],mDecimals:0}),l[d].in.push(m)}if(m.mintA.equals(t)){let d=m.mintB.toString();l[d]===void 0&&(l[d]={mintProgram:Ae,in:[],out:[],mDecimals:0}),l[d].out.push(m)}if(m.mintB.equals(t)){let d=m.mintA.toString();l[d]===void 0&&(l[d]={mintProgram:Ae,in:[],out:[],mDecimals:0}),l[d].out.push(m)}}let p=[];for(let m of r)(m.mintA.equals(e)&&m.mintB.equals(t)||m.mintA.equals(t)&&m.mintB.equals(e))&&(u.push(m),s[m.id.toBase58()]=m,p.push(m)),m.mintA.equals(e)&&(l[m.mintB.toBase58()]===void 0&&(l[m.mintB.toBase58()]={mintProgram:Ae,in:[],out:[],mDecimals:0}),l[m.mintB.toBase58()].in.push(m)),m.mintB.equals(e)&&(l[m.mintA.toBase58()]===void 0&&(l[m.mintA.toBase58()]={mintProgram:Ae,in:[],out:[],mDecimals:0}),l[m.mintA.toBase58()].in.push(m)),m.mintA.equals(t)&&(l[m.mintB.toBase58()]===void 0&&(l[m.mintB.toBase58()]={mintProgram:Ae,in:[],out:[],mDecimals:0}),l[m.mintB.toBase58()].out.push(m)),m.mintB.equals(t)&&(l[m.mintA.toBase58()]===void 0&&(l[m.mintA.toBase58()]={mintProgram:Ae,in:[],out:[],mDecimals:0}),l[m.mintA.toBase58()].out.push(m));for(let m of o)(m.mintA.equals(e)&&m.mintB.equals(t)||m.mintA.equals(t)&&m.mintB.equals(e))&&(u.push(m),c[m.id.toBase58()]=m),m.mintA.equals(e)&&(l[m.mintB.toBase58()]===void 0&&(l[m.mintB.toBase58()]={mintProgram:Ae,in:[],out:[],mDecimals:0}),l[m.mintB.toBase58()].in.push(m)),m.mintB.equals(e)&&(l[m.mintA.toBase58()]===void 0&&(l[m.mintA.toBase58()]={mintProgram:Ae,in:[],out:[],mDecimals:0}),l[m.mintA.toBase58()].in.push(m)),m.mintA.equals(t)&&(l[m.mintB.toBase58()]===void 0&&(l[m.mintB.toBase58()]={mintProgram:Ae,in:[],out:[],mDecimals:0}),l[m.mintB.toBase58()].out.push(m)),m.mintB.equals(t)&&(l[m.mintA.toBase58()]===void 0&&(l[m.mintA.toBase58()]={mintProgram:Ae,in:[],out:[],mDecimals:0}),l[m.mintA.toBase58()].out.push(m));for(let m of Object.keys(l)){if(l[m].in.length===1&&l[m].out.length===1&&l[m].in[0].id.equals(l[m].out[0].id)){delete l[m];continue}if(l[m].in.length===0||l[m].out.length===0){delete l[m];continue}let d=l[m];for(let y of d.in)for(let f of d.out)y.version===6&&a[y.id.toString()]===void 0?a[y.id.toString()]=y:y.version===7&&c[y.id.toString()]===void 0?c[y.id.toString()]=y:(y.version===4||y.version===5)&&s[y.id.toString()]===void 0&&(s[y.id.toString()]=y),f.version===6&&a[f.id.toString()]===void 0?a[f.id.toString()]=f:f.version===7&&c[f.id.toString()]===void 0?c[f.id.toString()]=f:(f.version===4||f.version===5)&&s[f.id.toString()]===void 0&&(s[f.id.toString()]=f)}return{directPath:u,addLiquidityPools:p,routePathDict:l,needSimulate:Object.values(s),needTickArray:Object.values(a),cpmmPoolList:Object.values(c)}}async fetchSwapRoutesData({routes:e,inputMint:t,outputMint:n}){let r=new Set([...e.needTickArray.map(f=>[f.mintA.toBase58(),f.mintB.toBase58()]).flat(),t.toString(),n.toString()]);console.log("fetching amm pools info, total: ",e.needSimulate.length);let o=await this.scope.liquidity.getRpcPoolInfos(e.needSimulate.map(f=>f.id)),s=ko(o),a={};Object.values(s).forEach(f=>{r.delete(f.mintA.address),a[f.mintA.address]={address:new _t(f.mintA.address),programId:Ae,mintAuthority:null,supply:BigInt(0),decimals:f.mintA.decimals,isInitialized:!0,freezeAuthority:null,tlvData:Buffer.from("0","hex"),feeConfig:void 0},r.delete(f.mintB.address),a[f.mintB.address]={address:new _t(f.mintB.address),programId:Ae,mintAuthority:null,supply:BigInt(0),decimals:f.mintB.decimals,isInitialized:!0,freezeAuthority:null,tlvData:Buffer.from("0","hex"),feeConfig:void 0}}),console.log("fetching cpmm pools info, total: ",e.cpmmPoolList.length);let c=await this.scope.cpmm.getRpcPoolInfos(e.cpmmPoolList.map(f=>f.id.toBase58()),!0);Object.values(c).forEach(f=>{let[b,g]=[f.mintA.toBase58(),f.mintB.toBase58()];f.mintProgramA.equals(Ae)?(r.delete(b),a[b]={address:f.mintA,programId:f.mintProgramA,mintAuthority:null,supply:BigInt(0),decimals:f.mintDecimalA,isInitialized:!0,freezeAuthority:null,tlvData:Buffer.from("0","hex"),feeConfig:void 0}):r.add(b),f.mintProgramB.equals(Ae)?(r.delete(g),a[g]={address:f.mintB,programId:f.mintProgramB,mintAuthority:null,supply:BigInt(0),decimals:f.mintDecimalB,isInitialized:!0,freezeAuthority:null,tlvData:Buffer.from("0","hex"),feeConfig:void 0}):r.add(g)}),console.log("fetching mints info, total: ",r.size);let u=await ii({connection:this.scope.connection,mints:Array.from(r).map(f=>new _t(f))});a=q(q({},a),u);let l=this.scope.cpmm.toComputePoolInfos({pools:c,mintInfos:a});console.log("fetching clmm pools info, total:",e.needTickArray.length);let p=await this.scope.clmm.getRpcClmmPoolInfos({poolIds:e.needTickArray.map(f=>f.id)}),{computeClmmPoolInfo:m,computePoolTickData:d}=await this.scope.clmm.getComputeClmmPoolInfos({clmmPoolsRpcInfo:p,mintInfos:a}),y=Object.keys(e.routePathDict).reduce((f,b)=>J(q({},f),{[b]:J(q({},e.routePathDict[b]),{mintProgram:a[b].programId,mDecimals:a[b].decimals,in:e.routePathDict[b].in.map(g=>s[g.id.toBase58()]||m[g.id.toBase58()]||l[g.id.toBase58()]),out:e.routePathDict[b].out.map(g=>s[g.id.toBase58()]||m[g.id.toBase58()]||l[g.id.toBase58()])})}),{});return{mintInfos:a,ammPoolsRpcInfo:o,ammSimulateCache:s,clmmPoolsRpcInfo:p,computeClmmPoolInfo:m,computePoolTickData:d,computeCpmmData:l,routePathDict:y}}getAllRouteComputeAmountOut({inputTokenAmount:e,outputToken:t,directPath:n,routePathDict:r,simulateCache:o,tickCache:s,slippage:a,chainTime:c,epochInfo:u,feeConfig:l}){var g,A,w,T,B,k,x,I,R;let p=l===void 0?new Hn(0):e.raw.mul(new Hn(l.feeBps.toNumber())).div(new Hn(1e4)),m=e.raw.sub(p),d=new me(e.token,m),y=l===void 0?void 0:{feeAmount:p,feeAccount:l.feeAccount},f=J(q({},t),{address:$e(t.address).toString()}),b=[];for(let h of n)try{b.push(J(q({},this.computeAmountOut({itemPool:h,tickCache:s,simulateCache:o,chainTime:c,epochInfo:u,slippage:a,outputToken:f,amountIn:d})),{feeConfig:y}))}catch(L){this.logDebug("direct error",h.version,h.id.toString(),L.message)}this.logDebug("direct done");for(let[h,L]of Object.entries(r)){let G={chainId:101,address:h,programId:L.mintProgram.toBase58(),logoURI:"",symbol:"",name:"",decimals:L.mDecimals,tags:[],extensions:{}},E=L.in.map(D=>{try{return{pool:D,data:this.computeAmountOut({itemPool:D,tickCache:s,simulateCache:o,chainTime:c,epochInfo:u,slippage:a,outputToken:G,amountIn:d})}}catch(v){this.logDebug("route in error",D.version,D.id.toString(),v.message);return}}).sort((D,v)=>{var Bt,zt,Ye,Ge;let qe=D===void 0?dt:D.data.amountOut.amount.raw.sub((zt=(Bt=D.data.amountOut.fee)==null?void 0:Bt.raw)!=null?zt:dt),ft=v===void 0?dt:v.data.amountOut.amount.raw.sub((Ge=(Ye=v.data.amountOut.fee)==null?void 0:Ye.raw)!=null?Ge:dt);return qe.lt(ft)?1:-1})[0];if(E===void 0)continue;let z=new me(_r(G),E.data.amountOut.amount.raw.sub((A=(g=E.data.amountOut.fee)==null?void 0:g.raw)!=null?A:dt));for(let D of L.out)try{let v=this.computeAmountOut({itemPool:D,tickCache:s,simulateCache:o,chainTime:c,epochInfo:u,slippage:a,outputToken:f,amountIn:z});b.push(J(q({},v),{allTrade:!!(E.data.allTrade&&v.allTrade),amountIn:E.data.amountIn,amountOut:v.amountOut,minAmountOut:v.minAmountOut,currentPrice:void 0,executionPrice:new _(new Oe({baseToken:E.data.amountIn.amount.token,denominator:E.data.amountIn.amount.raw,quoteToken:v.amountOut.amount.token,numerator:v.amountOut.amount.raw.sub((T=(w=v.amountOut.fee)==null?void 0:w.raw)!=null?T:dt)}).toFixed()),priceImpact:new _(E.data.priceImpact.add(v.priceImpact).toFixed()),fee:[E.data.fee[0],v.fee[0]],routeType:"route",poolInfoList:[E.pool,D],remainingAccounts:[E.data.remainingAccounts[0],v.remainingAccounts[0]],minMiddleAmountFee:(B=v.amountOut.fee)!=null&&B.raw?new me(E.data.amountOut.amount.token,((x=(k=E.data.amountOut.fee)==null?void 0:k.raw)!=null?x:dt).add((R=(I=v.amountOut.fee)==null?void 0:I.raw)!=null?R:dt)):void 0,middleToken:E.data.amountOut.amount.token,poolReady:E.data.poolReady&&v.poolReady,poolType:[E.data.poolType,v.poolType],feeConfig:y,expirationTime:je(E.data.expirationTime,v.expirationTime)}))}catch(v){this.logDebug("route out error",D.version,D.id.toString(),v.message)}}return b.filter(h=>(h.allTrade||this.logDebug(`pool ${h.poolInfoList.map(L=>L.id.toString()).join(",")} filter out since not all trade`),h.allTrade)).sort((h,L)=>h.amountOut.amount.raw.sub(L.amountOut.amount.raw).gt(dt)?-1:1)}computeAmountOut({itemPool:e,tickCache:t,simulateCache:n,chainTime:r,epochInfo:o,slippage:s,outputToken:a,amountIn:c}){if(e.version===6){let{allTrade:u,realAmountIn:l,amountOut:p,minAmountOut:m,expirationTime:d,currentPrice:y,executionPrice:f,priceImpact:b,fee:g,remainingAccounts:A,executionPriceX64:w}=ge.computeAmountOutFormat({poolInfo:e,tickArrayCache:t[e.id.toString()],amountIn:c.raw,tokenOut:a,slippage:s,epochInfo:o,catchLiquidityInsufficient:!0});return{allTrade:u,amountIn:l,amountOut:p,minAmountOut:m,currentPrice:new _(y.toFixed()),executionPrice:new _(f.toFixed()),priceImpact:new _(b.toFixed()),fee:[g],remainingAccounts:[A],routeType:"amm",poolInfoList:[e],poolReady:e.startTime<r,poolType:"CLMM",slippage:s,clmmExPriceX64:[w],expirationTime:je(l.expirationTime,d)}}else if(e.version===7){let{allTrade:u,executionPrice:l,amountOut:p,minAmountOut:m,priceImpact:d,fee:y}=this.scope.cpmm.computeSwapAmount({pool:e,outputMint:a.address,amountIn:c.raw,slippage:s});return{allTrade:u,amountIn:{amount:c,fee:void 0,expirationTime:void 0},amountOut:{amount:rn(J(q({},a),{amount:p})),fee:void 0,expirationTime:void 0},minAmountOut:{amount:rn(J(q({},a),{amount:m})),fee:void 0,expirationTime:void 0},currentPrice:e.poolPrice,executionPrice:l,priceImpact:d,fee:[new me(c.token,y)],remainingAccounts:[],routeType:"amm",poolInfoList:[e],poolReady:e.openTime.toNumber()<r,poolType:"CPMM",slippage:s,clmmExPriceX64:[void 0],expirationTime:void 0}}else{if(![1,6,7].includes(n[e.id.toString()].status))throw Error("swap error");let{amountOut:u,minAmountOut:l,currentPrice:p,executionPrice:m,priceImpact:d,fee:y}=this.scope.liquidity.computeAmountOut({poolInfo:n[e.id.toString()],amountIn:c.raw,mintIn:c.token.mint,mintOut:a.address,slippage:s});return{amountIn:{amount:c,fee:void 0,expirationTime:void 0},amountOut:{amount:rn(J(q({},a),{amount:u})),fee:void 0,expirationTime:void 0},minAmountOut:{amount:rn(J(q({},a),{amount:l})),fee:void 0,expirationTime:void 0},currentPrice:p,executionPrice:m,priceImpact:d,fee:[new me(c.token,y)],routeType:"amm",poolInfoList:[e],remainingAccounts:[],poolReady:Number(n[e.id].openTime)<r,poolType:e.version===5?"STABLE":void 0,expirationTime:void 0,allTrade:!0,slippage:s,clmmExPriceX64:[void 0]}}}async computePoolToPoolKeys({pools:e,clmmRpcData:t={},ammRpcData:n={}}){let r=new Set(e.filter(u=>u.version===6&&!t[u.id.toString()]).map(u=>u.id.toString()));if(r.size>0){let u=await this.scope.clmm.getRpcClmmPoolInfos({poolIds:Array.from(r)});Object.keys(u).forEach(l=>{t[l]=u[l]})}let o=new Set(e.filter(u=>u.version===4&&!n[u.id.toString()]).map(u=>u.id.toString()));if(o.size>0){let u=await this.scope.liquidity.getRpcPoolInfos(Array.from(o));Object.keys(u).forEach(l=>{n[l]=u[l]})}let s=new Set(e.filter(u=>u.version===4).map(u=>u.marketId)),a={};s.size>0&&(await xt(this.scope.connection,Array.from(s).map(l=>({pubkey:new _t(l)})))).forEach(l=>{if(!l.accountInfo)return;let p=qi.decode(l.accountInfo.data);a[l.pubkey.toBase58()]={marketId:l.pubkey.toString(),marketProgramId:l.accountInfo.owner.toString(),marketAuthority:Xn.getAssociatedAuthority({programId:l.accountInfo.owner,marketId:l.pubkey}).publicKey.toString(),marketBaseVault:p.baseVault.toString(),marketQuoteVault:p.quoteVault.toString(),marketBids:p.bids.toString(),marketAsks:p.asks.toString(),marketEventQueue:p.eventQueue.toString()}});let c=[];return e.forEach(u=>{if(u.version===6){let l=t[u.id.toString()],p={programId:u.programId.toBase58(),id:u.id.toBase58(),mintA:u.mintA,mintB:u.mintB,openTime:String(u.startTime),vault:{A:l.vaultA.toBase58(),B:l.vaultB.toBase58()},config:J(q({},u.ammConfig),{id:u.ammConfig.id.toString(),defaultRange:0,defaultRangePoint:[]}),rewardInfos:[],observationId:u.observationId.toBase58(),exBitmapAccount:u.exBitmapAccount.toBase58()};c.push(p)}else if(u.version===4){let l=n[u.id.toString()],p=q({programId:u.programId,id:u.id,mintA:u.mintA,mintB:u.mintB,openTime:String(u.openTime),vault:{A:l.baseVault.toBase58(),B:l.quoteVault.toBase58()},authority:Po({programId:new _t(u.programId)}).publicKey.toString(),openOrders:l.openOrders.toBase58(),targetOrders:l.targetOrders.toBase58(),mintLp:u.lpMint},a[u.marketId]);c.push(p)}else u.version===7&&c.push({observationId:u.observationId.toBase58(),programId:u.programId.toBase58(),id:u.id.toBase58(),mintA:u.mintA,mintB:u.mintB,openTime:String(u.openTime),authority:io(u.programId).publicKey.toBase58(),vault:{A:u.vaultA.toBase58(),B:u.vaultB.toBase58()},mintLp:Lt({address:u.mintLp.toBase58(),programId:Ae.toBase58(),decimals:u.lpDecimals}),config:J(q({id:u.configId.toBase58()},u.configInfo),{protocolFeeRate:u.configInfo.protocolFeeRate.toNumber(),tradeFeeRate:u.configInfo.tradeFeeRate.toNumber(),fundFeeRate:u.configInfo.fundFeeRate.toNumber(),createPoolFee:u.configInfo.createPoolFee.toString()})})}),c}};export{Gi as default};
/*! noble-hashes - MIT License (c) 2022 Paul Miller (paulmillr.com) */
//# sourceMappingURL=trade.mjs.map