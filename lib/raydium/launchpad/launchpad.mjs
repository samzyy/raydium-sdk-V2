var br=Object.defineProperty,gr=Object.defineProperties;var yr=Object.getOwnPropertyDescriptors;var ht=Object.getOwnPropertySymbols;var Qn=Object.prototype.hasOwnProperty,Yn=Object.prototype.propertyIsEnumerable;var jn=(n,e,t)=>e in n?br(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t,X=(n,e)=>{for(var t in e||(e={}))Qn.call(e,t)&&jn(n,t,e[t]);if(ht)for(var t of ht(e))Yn.call(e,t)&&jn(n,t,e[t]);return n},Q=(n,e)=>gr(n,yr(e));var _e=(n,e)=>{var t={};for(var i in n)Qn.call(n,i)&&e.indexOf(i)<0&&(t[i]=n[i]);if(n!=null&&ht)for(var i of ht(n))e.indexOf(i)<0&&Yn.call(n,i)&&(t[i]=n[i]);return t};import{get as Jn,set as Pr}from"lodash";var nn=class{constructor(e){this.logLevel=e.logLevel!==void 0?e.logLevel:0,this.name=e.name}set level(e){this.logLevel=e}get time(){return Date.now().toString()}get moduleName(){return this.name}isLogLevel(e){return e<=this.logLevel}error(...e){return this.isLogLevel(0)?(console.error(this.time,this.name,"sdk logger error",...e),this):this}logWithError(...e){let t=e.map(i=>typeof i=="object"?JSON.stringify(i):i).join(", ");throw new Error(t)}warning(...e){return this.isLogLevel(1)?(console.warn(this.time,this.name,"sdk logger warning",...e),this):this}info(...e){return this.isLogLevel(2)?(console.info(this.time,this.name,"sdk logger info",...e),this):this}debug(...e){return this.isLogLevel(3)?(console.debug(this.time,this.name,"sdk logger debug",...e),this):this}},$n={},Ar={};function re(n){let e=Jn($n,n);if(!e){let t=Jn(Ar,n);e=new nn({name:n,logLevel:t}),Pr($n,n,e)}return e}import{PublicKey as Ge,sendAndConfirmTransaction as Tn,SystemProgram as Ci,Transaction as ft,TransactionMessage as Vt,VersionedTransaction as qt}from"@solana/web3.js";import Qo from"axios";import{PublicKey as Si,AddressLookupTableAccount as Wt}from"@solana/web3.js";import{PublicKey as jo}from"@solana/web3.js";import he from"bn.js";var Ze=9e15,Me=1e9,rn="0123456789abcdef",Bt="2.3025850929940456840179914546843642076011014886287729760333279009675726096773524802359972050895982983419677840422862486334095254650828067566662873690987816894829072083255546808437998948262331985283935053089653777326288461633662222876982198867465436674744042432743651550489343149393914796194044002221051017141748003688084012647080685567743216228355220114804663715659121373450747856947683463616792101806445070648000277502684916746550586856935673420670581136429224554405758925724208241314695689016758940256776311356919292033376587141660230105703089634572075440370847469940168269282808481184289314848524948644871927809676271275775397027668605952496716674183485704422507197965004714951050492214776567636938662976979522110718264549734772662425709429322582798502585509785265383207606726317164309505995087807523710333101197857547331541421808427543863591778117054309827482385045648019095610299291824318237525357709750539565187697510374970888692180205189339507238539205144634197265287286965110862571492198849978748873771345686209167058",xt="3.1415926535897932384626433832795028841971693993751058209749445923078164062862089986280348253421170679821480865132823066470938446095505822317253594081284811174502841027019385211055596446229489549303819644288109756659334461284756482337867831652712019091456485669234603486104543266482133936072602491412737245870066063155881748815209209628292540917153643678925903600113305305488204665213841469519415116094330572703657595919530921861173819326117931051185480744623799627495673518857527248912279381830119491298336733624406566430860213949463952247371907021798609437027705392171762931767523846748184676694051320005681271452635608277857713427577896091736371787214684409012249534301465495853710507922796892589235420199561121290219608640344181598136297747713099605187072113499999983729780499510597317328160963185950244594553469083026425223082533446850352619311881710100031378387528865875332083814206171776691473035982534904287554687311595628638823537875937519577818577805321712268066130019278766111959092164201989380952572010654858632789",on={precision:20,rounding:4,modulo:1,toExpNeg:-7,toExpPos:21,minE:-Ze,maxE:Ze,crypto:!1},ii,Se,D=!0,St="[DecimalError] ",Re=St+"Invalid argument: ",ri=St+"Precision limit exceeded",oi=St+"crypto unavailable",si="[object Decimal]",oe=Math.floor,te=Math.pow,wr=/^0b([01]+(\.[01]*)?|\.[01]+)(p[+-]?\d+)?$/i,kr=/^0x([0-9a-f]+(\.[0-9a-f]*)?|\.[0-9a-f]+)(p[+-]?\d+)?$/i,hr=/^0o([0-7]+(\.[0-7]*)?|\.[0-7]+)(p[+-]?\d+)?$/i,ai=/^(\d+(\.\d*)?|\.\d+)(e[+-]?\d+)?$/i,be=1e7,M=7,Tr=9007199254740991,Br=Bt.length-1,sn=xt.length-1,g={toStringTag:si};g.absoluteValue=g.abs=function(){var n=new this.constructor(this);return n.s<0&&(n.s=1),N(n)};g.ceil=function(){return N(new this.constructor(this),this.e+1,2)};g.clampedTo=g.clamp=function(n,e){var t,i=this,r=i.constructor;if(n=new r(n),e=new r(e),!n.s||!e.s)return new r(NaN);if(n.gt(e))throw Error(Re+e);return t=i.cmp(n),t<0?n:i.cmp(e)>0?e:new r(i)};g.comparedTo=g.cmp=function(n){var e,t,i,r,o=this,s=o.d,a=(n=new o.constructor(n)).d,c=o.s,u=n.s;if(!s||!a)return!c||!u?NaN:c!==u?c:s===a?0:!s^c<0?1:-1;if(!s[0]||!a[0])return s[0]?c:a[0]?-u:0;if(c!==u)return c;if(o.e!==n.e)return o.e>n.e^c<0?1:-1;for(i=s.length,r=a.length,e=0,t=i<r?i:r;e<t;++e)if(s[e]!==a[e])return s[e]>a[e]^c<0?1:-1;return i===r?0:i>r^c<0?1:-1};g.cosine=g.cos=function(){var n,e,t=this,i=t.constructor;return t.d?t.d[0]?(n=i.precision,e=i.rounding,i.precision=n+Math.max(t.e,t.sd())+M,i.rounding=1,t=xr(i,di(i,t)),i.precision=n,i.rounding=e,N(Se==2||Se==3?t.neg():t,n,e,!0)):new i(1):new i(NaN)};g.cubeRoot=g.cbrt=function(){var n,e,t,i,r,o,s,a,c,u,l=this,m=l.constructor;if(!l.isFinite()||l.isZero())return new m(l);for(D=!1,o=l.s*te(l.s*l,1/3),!o||Math.abs(o)==1/0?(t=ne(l.d),n=l.e,(o=(n-t.length+1)%3)&&(t+=o==1||o==-2?"0":"00"),o=te(t,1/3),n=oe((n+1)/3)-(n%3==(n<0?-1:2)),o==1/0?t="5e"+n:(t=o.toExponential(),t=t.slice(0,t.indexOf("e")+1)+n),i=new m(t),i.s=l.s):i=new m(o.toString()),s=(n=m.precision)+3;;)if(a=i,c=a.times(a).times(a),u=c.plus(l),i=j(u.plus(l).times(a),u.plus(c),s+2,1),ne(a.d).slice(0,s)===(t=ne(i.d)).slice(0,s))if(t=t.slice(s-3,s+1),t=="9999"||!r&&t=="4999"){if(!r&&(N(a,n+1,0),a.times(a).times(a).eq(l))){i=a;break}s+=4,r=1}else{(!+t||!+t.slice(1)&&t.charAt(0)=="5")&&(N(i,n+1,1),e=!i.times(i).times(i).eq(l));break}return D=!0,N(i,n,m.rounding,e)};g.decimalPlaces=g.dp=function(){var n,e=this.d,t=NaN;if(e){if(n=e.length-1,t=(n-oe(this.e/M))*M,n=e[n],n)for(;n%10==0;n/=10)t--;t<0&&(t=0)}return t};g.dividedBy=g.div=function(n){return j(this,new this.constructor(n))};g.dividedToIntegerBy=g.divToInt=function(n){var e=this,t=e.constructor;return N(j(e,new t(n),0,1,1),t.precision,t.rounding)};g.equals=g.eq=function(n){return this.cmp(n)===0};g.floor=function(){return N(new this.constructor(this),this.e+1,3)};g.greaterThan=g.gt=function(n){return this.cmp(n)>0};g.greaterThanOrEqualTo=g.gte=function(n){var e=this.cmp(n);return e==1||e===0};g.hyperbolicCosine=g.cosh=function(){var n,e,t,i,r,o=this,s=o.constructor,a=new s(1);if(!o.isFinite())return new s(o.s?1/0:NaN);if(o.isZero())return a;t=s.precision,i=s.rounding,s.precision=t+Math.max(o.e,o.sd())+4,s.rounding=1,r=o.d.length,r<32?(n=Math.ceil(r/3),e=(1/Kt(4,n)).toString()):(n=16,e="2.3283064365386962890625e-10"),o=je(s,1,o.times(e),new s(1),!0);for(var c,u=n,l=new s(8);u--;)c=o.times(o),o=a.minus(c.times(l.minus(c.times(l))));return N(o,s.precision=t,s.rounding=i,!0)};g.hyperbolicSine=g.sinh=function(){var n,e,t,i,r=this,o=r.constructor;if(!r.isFinite()||r.isZero())return new o(r);if(e=o.precision,t=o.rounding,o.precision=e+Math.max(r.e,r.sd())+4,o.rounding=1,i=r.d.length,i<3)r=je(o,2,r,r,!0);else{n=1.4*Math.sqrt(i),n=n>16?16:n|0,r=r.times(1/Kt(5,n)),r=je(o,2,r,r,!0);for(var s,a=new o(5),c=new o(16),u=new o(20);n--;)s=r.times(r),r=r.times(a.plus(s.times(c.times(s).plus(u))))}return o.precision=e,o.rounding=t,N(r,e,t,!0)};g.hyperbolicTangent=g.tanh=function(){var n,e,t=this,i=t.constructor;return t.isFinite()?t.isZero()?new i(t):(n=i.precision,e=i.rounding,i.precision=n+7,i.rounding=1,j(t.sinh(),t.cosh(),i.precision=n,i.rounding=e)):new i(t.s)};g.inverseCosine=g.acos=function(){var n,e=this,t=e.constructor,i=e.abs().cmp(1),r=t.precision,o=t.rounding;return i!==-1?i===0?e.isNeg()?fe(t,r,o):new t(0):new t(NaN):e.isZero()?fe(t,r+4,o).times(.5):(t.precision=r+6,t.rounding=1,e=e.asin(),n=fe(t,r+4,o).times(.5),t.precision=r,t.rounding=o,n.minus(e))};g.inverseHyperbolicCosine=g.acosh=function(){var n,e,t=this,i=t.constructor;return t.lte(1)?new i(t.eq(1)?0:NaN):t.isFinite()?(n=i.precision,e=i.rounding,i.precision=n+Math.max(Math.abs(t.e),t.sd())+4,i.rounding=1,D=!1,t=t.times(t).minus(1).sqrt().plus(t),D=!0,i.precision=n,i.rounding=e,t.ln()):new i(t)};g.inverseHyperbolicSine=g.asinh=function(){var n,e,t=this,i=t.constructor;return!t.isFinite()||t.isZero()?new i(t):(n=i.precision,e=i.rounding,i.precision=n+2*Math.max(Math.abs(t.e),t.sd())+6,i.rounding=1,D=!1,t=t.times(t).plus(1).sqrt().plus(t),D=!0,i.precision=n,i.rounding=e,t.ln())};g.inverseHyperbolicTangent=g.atanh=function(){var n,e,t,i,r=this,o=r.constructor;return r.isFinite()?r.e>=0?new o(r.abs().eq(1)?r.s/0:r.isZero()?r:NaN):(n=o.precision,e=o.rounding,i=r.sd(),Math.max(i,n)<2*-r.e-1?N(new o(r),n,e,!0):(o.precision=t=i-r.e,r=j(r.plus(1),new o(1).minus(r),t+n,1),o.precision=n+4,o.rounding=1,r=r.ln(),o.precision=n,o.rounding=e,r.times(.5))):new o(NaN)};g.inverseSine=g.asin=function(){var n,e,t,i,r=this,o=r.constructor;return r.isZero()?new o(r):(e=r.abs().cmp(1),t=o.precision,i=o.rounding,e!==-1?e===0?(n=fe(o,t+4,i).times(.5),n.s=r.s,n):new o(NaN):(o.precision=t+6,o.rounding=1,r=r.div(new o(1).minus(r.times(r)).sqrt().plus(1)).atan(),o.precision=t,o.rounding=i,r.times(2)))};g.inverseTangent=g.atan=function(){var n,e,t,i,r,o,s,a,c,u=this,l=u.constructor,m=l.precision,d=l.rounding;if(u.isFinite()){if(u.isZero())return new l(u);if(u.abs().eq(1)&&m+4<=sn)return s=fe(l,m+4,d).times(.25),s.s=u.s,s}else{if(!u.s)return new l(NaN);if(m+4<=sn)return s=fe(l,m+4,d).times(.5),s.s=u.s,s}for(l.precision=a=m+10,l.rounding=1,t=Math.min(28,a/M+2|0),n=t;n;--n)u=u.div(u.times(u).plus(1).sqrt().plus(1));for(D=!1,e=Math.ceil(a/M),i=1,c=u.times(u),s=new l(u),r=u;n!==-1;)if(r=r.times(c),o=s.minus(r.div(i+=2)),r=r.times(c),s=o.plus(r.div(i+=2)),s.d[e]!==void 0)for(n=e;s.d[n]===o.d[n]&&n--;);return t&&(s=s.times(2<<t-1)),D=!0,N(s,l.precision=m,l.rounding=d,!0)};g.isFinite=function(){return!!this.d};g.isInteger=g.isInt=function(){return!!this.d&&oe(this.e/M)>this.d.length-2};g.isNaN=function(){return!this.s};g.isNegative=g.isNeg=function(){return this.s<0};g.isPositive=g.isPos=function(){return this.s>0};g.isZero=function(){return!!this.d&&this.d[0]===0};g.lessThan=g.lt=function(n){return this.cmp(n)<0};g.lessThanOrEqualTo=g.lte=function(n){return this.cmp(n)<1};g.logarithm=g.log=function(n){var e,t,i,r,o,s,a,c,u=this,l=u.constructor,m=l.precision,d=l.rounding,p=5;if(n==null)n=new l(10),e=!0;else{if(n=new l(n),t=n.d,n.s<0||!t||!t[0]||n.eq(1))return new l(NaN);e=n.eq(10)}if(t=u.d,u.s<0||!t||!t[0]||u.eq(1))return new l(t&&!t[0]?-1/0:u.s!=1?NaN:t?0:1/0);if(e)if(t.length>1)o=!0;else{for(r=t[0];r%10===0;)r/=10;o=r!==1}if(D=!1,a=m+p,s=Le(u,a),i=e?It(l,a+10):Le(n,a),c=j(s,i,a,1),st(c.d,r=m,d))do if(a+=10,s=Le(u,a),i=e?It(l,a+10):Le(n,a),c=j(s,i,a,1),!o){+ne(c.d).slice(r+1,r+15)+1==1e14&&(c=N(c,m+1,0));break}while(st(c.d,r+=10,d));return D=!0,N(c,m,d)};g.minus=g.sub=function(n){var e,t,i,r,o,s,a,c,u,l,m,d,p=this,b=p.constructor;if(n=new b(n),!p.d||!n.d)return!p.s||!n.s?n=new b(NaN):p.d?n.s=-n.s:n=new b(n.d||p.s!==n.s?p:NaN),n;if(p.s!=n.s)return n.s=-n.s,p.plus(n);if(u=p.d,d=n.d,a=b.precision,c=b.rounding,!u[0]||!d[0]){if(d[0])n.s=-n.s;else if(u[0])n=new b(p);else return new b(c===3?-0:0);return D?N(n,a,c):n}if(t=oe(n.e/M),l=oe(p.e/M),u=u.slice(),o=l-t,o){for(m=o<0,m?(e=u,o=-o,s=d.length):(e=d,t=l,s=u.length),i=Math.max(Math.ceil(a/M),s)+2,o>i&&(o=i,e.length=1),e.reverse(),i=o;i--;)e.push(0);e.reverse()}else{for(i=u.length,s=d.length,m=i<s,m&&(s=i),i=0;i<s;i++)if(u[i]!=d[i]){m=u[i]<d[i];break}o=0}for(m&&(e=u,u=d,d=e,n.s=-n.s),s=u.length,i=d.length-s;i>0;--i)u[s++]=0;for(i=d.length;i>o;){if(u[--i]<d[i]){for(r=i;r&&u[--r]===0;)u[r]=be-1;--u[r],u[i]+=be}u[i]-=d[i]}for(;u[--s]===0;)u.pop();for(;u[0]===0;u.shift())--t;return u[0]?(n.d=u,n.e=Ct(u,t),D?N(n,a,c):n):new b(c===3?-0:0)};g.modulo=g.mod=function(n){var e,t=this,i=t.constructor;return n=new i(n),!t.d||!n.s||n.d&&!n.d[0]?new i(NaN):!n.d||t.d&&!t.d[0]?N(new i(t),i.precision,i.rounding):(D=!1,i.modulo==9?(e=j(t,n.abs(),0,3,1),e.s*=n.s):e=j(t,n,0,i.modulo,1),e=e.times(n),D=!0,t.minus(e))};g.naturalExponential=g.exp=function(){return an(this)};g.naturalLogarithm=g.ln=function(){return Le(this)};g.negated=g.neg=function(){var n=new this.constructor(this);return n.s=-n.s,N(n)};g.plus=g.add=function(n){var e,t,i,r,o,s,a,c,u,l,m=this,d=m.constructor;if(n=new d(n),!m.d||!n.d)return!m.s||!n.s?n=new d(NaN):m.d||(n=new d(n.d||m.s===n.s?m:NaN)),n;if(m.s!=n.s)return n.s=-n.s,m.minus(n);if(u=m.d,l=n.d,a=d.precision,c=d.rounding,!u[0]||!l[0])return l[0]||(n=new d(m)),D?N(n,a,c):n;if(o=oe(m.e/M),i=oe(n.e/M),u=u.slice(),r=o-i,r){for(r<0?(t=u,r=-r,s=l.length):(t=l,i=o,s=u.length),o=Math.ceil(a/M),s=o>s?o+1:s+1,r>s&&(r=s,t.length=1),t.reverse();r--;)t.push(0);t.reverse()}for(s=u.length,r=l.length,s-r<0&&(r=s,t=l,l=u,u=t),e=0;r;)e=(u[--r]=u[r]+l[r]+e)/be|0,u[r]%=be;for(e&&(u.unshift(e),++i),s=u.length;u[--s]==0;)u.pop();return n.d=u,n.e=Ct(u,i),D?N(n,a,c):n};g.precision=g.sd=function(n){var e,t=this;if(n!==void 0&&n!==!!n&&n!==1&&n!==0)throw Error(Re+n);return t.d?(e=ui(t.d),n&&t.e+1>e&&(e=t.e+1)):e=NaN,e};g.round=function(){var n=this,e=n.constructor;return N(new e(n),n.e+1,e.rounding)};g.sine=g.sin=function(){var n,e,t=this,i=t.constructor;return t.isFinite()?t.isZero()?new i(t):(n=i.precision,e=i.rounding,i.precision=n+Math.max(t.e,t.sd())+M,i.rounding=1,t=Sr(i,di(i,t)),i.precision=n,i.rounding=e,N(Se>2?t.neg():t,n,e,!0)):new i(NaN)};g.squareRoot=g.sqrt=function(){var n,e,t,i,r,o,s=this,a=s.d,c=s.e,u=s.s,l=s.constructor;if(u!==1||!a||!a[0])return new l(!u||u<0&&(!a||a[0])?NaN:a?s:1/0);for(D=!1,u=Math.sqrt(+s),u==0||u==1/0?(e=ne(a),(e.length+c)%2==0&&(e+="0"),u=Math.sqrt(e),c=oe((c+1)/2)-(c<0||c%2),u==1/0?e="5e"+c:(e=u.toExponential(),e=e.slice(0,e.indexOf("e")+1)+c),i=new l(e)):i=new l(u.toString()),t=(c=l.precision)+3;;)if(o=i,i=o.plus(j(s,o,t+2,1)).times(.5),ne(o.d).slice(0,t)===(e=ne(i.d)).slice(0,t))if(e=e.slice(t-3,t+1),e=="9999"||!r&&e=="4999"){if(!r&&(N(o,c+1,0),o.times(o).eq(s))){i=o;break}t+=4,r=1}else{(!+e||!+e.slice(1)&&e.charAt(0)=="5")&&(N(i,c+1,1),n=!i.times(i).eq(s));break}return D=!0,N(i,c,l.rounding,n)};g.tangent=g.tan=function(){var n,e,t=this,i=t.constructor;return t.isFinite()?t.isZero()?new i(t):(n=i.precision,e=i.rounding,i.precision=n+10,i.rounding=1,t=t.sin(),t.s=1,t=j(t,new i(1).minus(t.times(t)).sqrt(),n+10,0),i.precision=n,i.rounding=e,N(Se==2||Se==4?t.neg():t,n,e,!0)):new i(NaN)};g.times=g.mul=function(n){var e,t,i,r,o,s,a,c,u,l=this,m=l.constructor,d=l.d,p=(n=new m(n)).d;if(n.s*=l.s,!d||!d[0]||!p||!p[0])return new m(!n.s||d&&!d[0]&&!p||p&&!p[0]&&!d?NaN:!d||!p?n.s/0:n.s*0);for(t=oe(l.e/M)+oe(n.e/M),c=d.length,u=p.length,c<u&&(o=d,d=p,p=o,s=c,c=u,u=s),o=[],s=c+u,i=s;i--;)o.push(0);for(i=u;--i>=0;){for(e=0,r=c+i;r>i;)a=o[r]+p[i]*d[r-i-1]+e,o[r--]=a%be|0,e=a/be|0;o[r]=(o[r]+e)%be|0}for(;!o[--s];)o.pop();return e?++t:o.shift(),n.d=o,n.e=Ct(o,t),D?N(n,m.precision,m.rounding):n};g.toBinary=function(n,e){return cn(this,2,n,e)};g.toDecimalPlaces=g.toDP=function(n,e){var t=this,i=t.constructor;return t=new i(t),n===void 0?t:(ce(n,0,Me),e===void 0?e=i.rounding:ce(e,0,8),N(t,n+t.e+1,e))};g.toExponential=function(n,e){var t,i=this,r=i.constructor;return n===void 0?t=we(i,!0):(ce(n,0,Me),e===void 0?e=r.rounding:ce(e,0,8),i=N(new r(i),n+1,e),t=we(i,!0,n+1)),i.isNeg()&&!i.isZero()?"-"+t:t};g.toFixed=function(n,e){var t,i,r=this,o=r.constructor;return n===void 0?t=we(r):(ce(n,0,Me),e===void 0?e=o.rounding:ce(e,0,8),i=N(new o(r),n+r.e+1,e),t=we(i,!1,n+i.e+1)),r.isNeg()&&!r.isZero()?"-"+t:t};g.toFraction=function(n){var e,t,i,r,o,s,a,c,u,l,m,d,p=this,b=p.d,f=p.constructor;if(!b)return new f(p);if(u=t=new f(1),i=c=new f(0),e=new f(i),o=e.e=ui(b)-p.e-1,s=o%M,e.d[0]=te(10,s<0?M+s:s),n==null)n=o>0?e:u;else{if(a=new f(n),!a.isInt()||a.lt(u))throw Error(Re+a);n=a.gt(e)?o>0?e:u:a}for(D=!1,a=new f(ne(b)),l=f.precision,f.precision=o=b.length*M*2;m=j(a,e,0,1,1),r=t.plus(m.times(i)),r.cmp(n)!=1;)t=i,i=r,r=u,u=c.plus(m.times(r)),c=r,r=e,e=a.minus(m.times(r)),a=r;return r=j(n.minus(t),i,0,1,1),c=c.plus(r.times(u)),t=t.plus(r.times(i)),c.s=u.s=p.s,d=j(u,i,o,1).minus(p).abs().cmp(j(c,t,o,1).minus(p).abs())<1?[u,i]:[c,t],f.precision=l,D=!0,d};g.toHexadecimal=g.toHex=function(n,e){return cn(this,16,n,e)};g.toNearest=function(n,e){var t=this,i=t.constructor;if(t=new i(t),n==null){if(!t.d)return t;n=new i(1),e=i.rounding}else{if(n=new i(n),e===void 0?e=i.rounding:ce(e,0,8),!t.d)return n.s?t:n;if(!n.d)return n.s&&(n.s=t.s),n}return n.d[0]?(D=!1,t=j(t,n,0,e,1).times(n),D=!0,N(t)):(n.s=t.s,t=n),t};g.toNumber=function(){return+this};g.toOctal=function(n,e){return cn(this,8,n,e)};g.toPower=g.pow=function(n){var e,t,i,r,o,s,a=this,c=a.constructor,u=+(n=new c(n));if(!a.d||!n.d||!a.d[0]||!n.d[0])return new c(te(+a,u));if(a=new c(a),a.eq(1))return a;if(i=c.precision,o=c.rounding,n.eq(1))return N(a,i,o);if(e=oe(n.e/M),e>=n.d.length-1&&(t=u<0?-u:u)<=Tr)return r=ci(c,a,t,i),n.s<0?new c(1).div(r):N(r,i,o);if(s=a.s,s<0){if(e<n.d.length-1)return new c(NaN);if((n.d[e]&1)==0&&(s=1),a.e==0&&a.d[0]==1&&a.d.length==1)return a.s=s,a}return t=te(+a,u),e=t==0||!isFinite(t)?oe(u*(Math.log("0."+ne(a.d))/Math.LN10+a.e+1)):new c(t+"").e,e>c.maxE+1||e<c.minE-1?new c(e>0?s/0:0):(D=!1,c.rounding=a.s=1,t=Math.min(12,(e+"").length),r=an(n.times(Le(a,i+t)),i),r.d&&(r=N(r,i+5,1),st(r.d,i,o)&&(e=i+10,r=N(an(n.times(Le(a,e+t)),e),e+5,1),+ne(r.d).slice(i+1,i+15)+1==1e14&&(r=N(r,i+1,0)))),r.s=s,D=!0,c.rounding=o,N(r,i,o))};g.toPrecision=function(n,e){var t,i=this,r=i.constructor;return n===void 0?t=we(i,i.e<=r.toExpNeg||i.e>=r.toExpPos):(ce(n,1,Me),e===void 0?e=r.rounding:ce(e,0,8),i=N(new r(i),n,e),t=we(i,n<=i.e||i.e<=r.toExpNeg,n)),i.isNeg()&&!i.isZero()?"-"+t:t};g.toSignificantDigits=g.toSD=function(n,e){var t=this,i=t.constructor;return n===void 0?(n=i.precision,e=i.rounding):(ce(n,1,Me),e===void 0?e=i.rounding:ce(e,0,8)),N(new i(t),n,e)};g.toString=function(){var n=this,e=n.constructor,t=we(n,n.e<=e.toExpNeg||n.e>=e.toExpPos);return n.isNeg()&&!n.isZero()?"-"+t:t};g.truncated=g.trunc=function(){return N(new this.constructor(this),this.e+1,1)};g.valueOf=g.toJSON=function(){var n=this,e=n.constructor,t=we(n,n.e<=e.toExpNeg||n.e>=e.toExpPos);return n.isNeg()?"-"+t:t};function ne(n){var e,t,i,r=n.length-1,o="",s=n[0];if(r>0){for(o+=s,e=1;e<r;e++)i=n[e]+"",t=M-i.length,t&&(o+=Ne(t)),o+=i;s=n[e],i=s+"",t=M-i.length,t&&(o+=Ne(t))}else if(s===0)return"0";for(;s%10===0;)s/=10;return o+s}function ce(n,e,t){if(n!==~~n||n<e||n>t)throw Error(Re+n)}function st(n,e,t,i){var r,o,s,a;for(o=n[0];o>=10;o/=10)--e;return--e<0?(e+=M,r=0):(r=Math.ceil((e+1)/M),e%=M),o=te(10,M-e),a=n[r]%o|0,i==null?e<3?(e==0?a=a/100|0:e==1&&(a=a/10|0),s=t<4&&a==99999||t>3&&a==49999||a==5e4||a==0):s=(t<4&&a+1==o||t>3&&a+1==o/2)&&(n[r+1]/o/100|0)==te(10,e-2)-1||(a==o/2||a==0)&&(n[r+1]/o/100|0)==0:e<4?(e==0?a=a/1e3|0:e==1?a=a/100|0:e==2&&(a=a/10|0),s=(i||t<4)&&a==9999||!i&&t>3&&a==4999):s=((i||t<4)&&a+1==o||!i&&t>3&&a+1==o/2)&&(n[r+1]/o/1e3|0)==te(10,e-3)-1,s}function Tt(n,e,t){for(var i,r=[0],o,s=0,a=n.length;s<a;){for(o=r.length;o--;)r[o]*=e;for(r[0]+=rn.indexOf(n.charAt(s++)),i=0;i<r.length;i++)r[i]>t-1&&(r[i+1]===void 0&&(r[i+1]=0),r[i+1]+=r[i]/t|0,r[i]%=t)}return r.reverse()}function xr(n,e){var t,i,r;if(e.isZero())return e;i=e.d.length,i<32?(t=Math.ceil(i/3),r=(1/Kt(4,t)).toString()):(t=16,r="2.3283064365386962890625e-10"),n.precision+=t,e=je(n,1,e.times(r),new n(1));for(var o=t;o--;){var s=e.times(e);e=s.times(s).minus(s).times(8).plus(1)}return n.precision-=t,e}var j=function(){function n(i,r,o){var s,a=0,c=i.length;for(i=i.slice();c--;)s=i[c]*r+a,i[c]=s%o|0,a=s/o|0;return a&&i.unshift(a),i}function e(i,r,o,s){var a,c;if(o!=s)c=o>s?1:-1;else for(a=c=0;a<o;a++)if(i[a]!=r[a]){c=i[a]>r[a]?1:-1;break}return c}function t(i,r,o,s){for(var a=0;o--;)i[o]-=a,a=i[o]<r[o]?1:0,i[o]=a*s+i[o]-r[o];for(;!i[0]&&i.length>1;)i.shift()}return function(i,r,o,s,a,c){var u,l,m,d,p,b,f,P,h,w,A,k,B,I,S,T,F,O,_,x,L=i.constructor,H=i.s==r.s?1:-1,E=i.d,R=r.d;if(!E||!E[0]||!R||!R[0])return new L(!i.s||!r.s||(E?R&&E[0]==R[0]:!R)?NaN:E&&E[0]==0||!R?H*0:H/0);for(c?(p=1,l=i.e-r.e):(c=be,p=M,l=oe(i.e/p)-oe(r.e/p)),_=R.length,F=E.length,h=new L(H),w=h.d=[],m=0;R[m]==(E[m]||0);m++);if(R[m]>(E[m]||0)&&l--,o==null?(I=o=L.precision,s=L.rounding):a?I=o+(i.e-r.e)+1:I=o,I<0)w.push(1),b=!0;else{if(I=I/p+2|0,m=0,_==1){for(d=0,R=R[0],I++;(m<F||d)&&I--;m++)S=d*c+(E[m]||0),w[m]=S/R|0,d=S%R|0;b=d||m<F}else{for(d=c/(R[0]+1)|0,d>1&&(R=n(R,d,c),E=n(E,d,c),_=R.length,F=E.length),T=_,A=E.slice(0,_),k=A.length;k<_;)A[k++]=0;x=R.slice(),x.unshift(0),O=R[0],R[1]>=c/2&&++O;do d=0,u=e(R,A,_,k),u<0?(B=A[0],_!=k&&(B=B*c+(A[1]||0)),d=B/O|0,d>1?(d>=c&&(d=c-1),f=n(R,d,c),P=f.length,k=A.length,u=e(f,A,P,k),u==1&&(d--,t(f,_<P?x:R,P,c))):(d==0&&(u=d=1),f=R.slice()),P=f.length,P<k&&f.unshift(0),t(A,f,k,c),u==-1&&(k=A.length,u=e(R,A,_,k),u<1&&(d++,t(A,_<k?x:R,k,c))),k=A.length):u===0&&(d++,A=[0]),w[m++]=d,u&&A[0]?A[k++]=E[T]||0:(A=[E[T]],k=1);while((T++<F||A[0]!==void 0)&&I--);b=A[0]!==void 0}w[0]||w.shift()}if(p==1)h.e=l,ii=b;else{for(m=1,d=w[0];d>=10;d/=10)m++;h.e=m+l*p-1,N(h,a?o+h.e+1:o,s,b)}return h}}();function N(n,e,t,i){var r,o,s,a,c,u,l,m,d,p=n.constructor;e:if(e!=null){if(m=n.d,!m)return n;for(r=1,a=m[0];a>=10;a/=10)r++;if(o=e-r,o<0)o+=M,s=e,l=m[d=0],c=l/te(10,r-s-1)%10|0;else if(d=Math.ceil((o+1)/M),a=m.length,d>=a)if(i){for(;a++<=d;)m.push(0);l=c=0,r=1,o%=M,s=o-M+1}else break e;else{for(l=a=m[d],r=1;a>=10;a/=10)r++;o%=M,s=o-M+r,c=s<0?0:l/te(10,r-s-1)%10|0}if(i=i||e<0||m[d+1]!==void 0||(s<0?l:l%te(10,r-s-1)),u=t<4?(c||i)&&(t==0||t==(n.s<0?3:2)):c>5||c==5&&(t==4||i||t==6&&(o>0?s>0?l/te(10,r-s):0:m[d-1])%10&1||t==(n.s<0?8:7)),e<1||!m[0])return m.length=0,u?(e-=n.e+1,m[0]=te(10,(M-e%M)%M),n.e=-e||0):m[0]=n.e=0,n;if(o==0?(m.length=d,a=1,d--):(m.length=d+1,a=te(10,M-o),m[d]=s>0?(l/te(10,r-s)%te(10,s)|0)*a:0),u)for(;;)if(d==0){for(o=1,s=m[0];s>=10;s/=10)o++;for(s=m[0]+=a,a=1;s>=10;s/=10)a++;o!=a&&(n.e++,m[0]==be&&(m[0]=1));break}else{if(m[d]+=a,m[d]!=be)break;m[d--]=0,a=1}for(o=m.length;m[--o]===0;)m.pop()}return D&&(n.e>p.maxE?(n.d=null,n.e=NaN):n.e<p.minE&&(n.e=0,n.d=[0])),n}function we(n,e,t){if(!n.isFinite())return mi(n);var i,r=n.e,o=ne(n.d),s=o.length;return e?(t&&(i=t-s)>0?o=o.charAt(0)+"."+o.slice(1)+Ne(i):s>1&&(o=o.charAt(0)+"."+o.slice(1)),o=o+(n.e<0?"e":"e+")+n.e):r<0?(o="0."+Ne(-r-1)+o,t&&(i=t-s)>0&&(o+=Ne(i))):r>=s?(o+=Ne(r+1-s),t&&(i=t-r-1)>0&&(o=o+"."+Ne(i))):((i=r+1)<s&&(o=o.slice(0,i)+"."+o.slice(i)),t&&(i=t-s)>0&&(r+1===s&&(o+="."),o+=Ne(i))),o}function Ct(n,e){var t=n[0];for(e*=M;t>=10;t/=10)e++;return e}function It(n,e,t){if(e>Br)throw D=!0,t&&(n.precision=t),Error(ri);return N(new n(Bt),e,1,!0)}function fe(n,e,t){if(e>sn)throw Error(ri);return N(new n(xt),e,t,!0)}function ui(n){var e=n.length-1,t=e*M+1;if(e=n[e],e){for(;e%10==0;e/=10)t--;for(e=n[0];e>=10;e/=10)t++}return t}function Ne(n){for(var e="";n--;)e+="0";return e}function ci(n,e,t,i){var r,o=new n(1),s=Math.ceil(i/M+4);for(D=!1;;){if(t%2&&(o=o.times(e),ti(o.d,s)&&(r=!0)),t=oe(t/2),t===0){t=o.d.length-1,r&&o.d[t]===0&&++o.d[t];break}e=e.times(e),ti(e.d,s)}return D=!0,o}function ei(n){return n.d[n.d.length-1]&1}function li(n,e,t){for(var i,r=new n(e[0]),o=0;++o<e.length;)if(i=new n(e[o]),i.s)r[t](i)&&(r=i);else{r=i;break}return r}function an(n,e){var t,i,r,o,s,a,c,u=0,l=0,m=0,d=n.constructor,p=d.rounding,b=d.precision;if(!n.d||!n.d[0]||n.e>17)return new d(n.d?n.d[0]?n.s<0?0:1/0:1:n.s?n.s<0?0:n:0/0);for(e==null?(D=!1,c=b):c=e,a=new d(.03125);n.e>-2;)n=n.times(a),m+=5;for(i=Math.log(te(2,m))/Math.LN10*2+5|0,c+=i,t=o=s=new d(1),d.precision=c;;){if(o=N(o.times(n),c,1),t=t.times(++l),a=s.plus(j(o,t,c,1)),ne(a.d).slice(0,c)===ne(s.d).slice(0,c)){for(r=m;r--;)s=N(s.times(s),c,1);if(e==null)if(u<3&&st(s.d,c-i,p,u))d.precision=c+=10,t=o=a=new d(1),l=0,u++;else return N(s,d.precision=b,p,D=!0);else return d.precision=b,s}s=a}}function Le(n,e){var t,i,r,o,s,a,c,u,l,m,d,p=1,b=10,f=n,P=f.d,h=f.constructor,w=h.rounding,A=h.precision;if(f.s<0||!P||!P[0]||!f.e&&P[0]==1&&P.length==1)return new h(P&&!P[0]?-1/0:f.s!=1?NaN:P?0:f);if(e==null?(D=!1,l=A):l=e,h.precision=l+=b,t=ne(P),i=t.charAt(0),Math.abs(o=f.e)<15e14){for(;i<7&&i!=1||i==1&&t.charAt(1)>3;)f=f.times(n),t=ne(f.d),i=t.charAt(0),p++;o=f.e,i>1?(f=new h("0."+t),o++):f=new h(i+"."+t.slice(1))}else return u=It(h,l+2,A).times(o+""),f=Le(new h(i+"."+t.slice(1)),l-b).plus(u),h.precision=A,e==null?N(f,A,w,D=!0):f;for(m=f,c=s=f=j(f.minus(1),f.plus(1),l,1),d=N(f.times(f),l,1),r=3;;){if(s=N(s.times(d),l,1),u=c.plus(j(s,new h(r),l,1)),ne(u.d).slice(0,l)===ne(c.d).slice(0,l))if(c=c.times(2),o!==0&&(c=c.plus(It(h,l+2,A).times(o+""))),c=j(c,new h(p),l,1),e==null)if(st(c.d,l-b,w,a))h.precision=l+=b,u=s=f=j(m.minus(1),m.plus(1),l,1),d=N(f.times(f),l,1),r=a=1;else return N(c,h.precision=A,w,D=!0);else return h.precision=A,c;c=u,r+=2}}function mi(n){return String(n.s*n.s/0)}function un(n,e){var t,i,r;for((t=e.indexOf("."))>-1&&(e=e.replace(".","")),(i=e.search(/e/i))>0?(t<0&&(t=i),t+=+e.slice(i+1),e=e.substring(0,i)):t<0&&(t=e.length),i=0;e.charCodeAt(i)===48;i++);for(r=e.length;e.charCodeAt(r-1)===48;--r);if(e=e.slice(i,r),e){if(r-=i,n.e=t=t-i-1,n.d=[],i=(t+1)%M,t<0&&(i+=M),i<r){for(i&&n.d.push(+e.slice(0,i)),r-=M;i<r;)n.d.push(+e.slice(i,i+=M));e=e.slice(i),i=M-e.length}else i-=r;for(;i--;)e+="0";n.d.push(+e),D&&(n.e>n.constructor.maxE?(n.d=null,n.e=NaN):n.e<n.constructor.minE&&(n.e=0,n.d=[0]))}else n.e=0,n.d=[0];return n}function Ir(n,e){var t,i,r,o,s,a,c,u,l;if(e.indexOf("_")>-1){if(e=e.replace(/(\d)_(?=\d)/g,"$1"),ai.test(e))return un(n,e)}else if(e==="Infinity"||e==="NaN")return+e||(n.s=NaN),n.e=NaN,n.d=null,n;if(kr.test(e))t=16,e=e.toLowerCase();else if(wr.test(e))t=2;else if(hr.test(e))t=8;else throw Error(Re+e);for(o=e.search(/p/i),o>0?(c=+e.slice(o+1),e=e.substring(2,o)):e=e.slice(2),o=e.indexOf("."),s=o>=0,i=n.constructor,s&&(e=e.replace(".",""),a=e.length,o=a-o,r=ci(i,new i(t),o,o*2)),u=Tt(e,t,be),l=u.length-1,o=l;u[o]===0;--o)u.pop();return o<0?new i(n.s*0):(n.e=Ct(u,l),n.d=u,D=!1,s&&(n=j(n,r,a*4)),c&&(n=n.times(Math.abs(c)<54?te(2,c):at.pow(2,c))),D=!0,n)}function Sr(n,e){var t,i=e.d.length;if(i<3)return e.isZero()?e:je(n,2,e,e);t=1.4*Math.sqrt(i),t=t>16?16:t|0,e=e.times(1/Kt(5,t)),e=je(n,2,e,e);for(var r,o=new n(5),s=new n(16),a=new n(20);t--;)r=e.times(e),e=e.times(o.plus(r.times(s.times(r).minus(a))));return e}function je(n,e,t,i,r){var o,s,a,c,u=1,l=n.precision,m=Math.ceil(l/M);for(D=!1,c=t.times(t),a=new n(i);;){if(s=j(a.times(c),new n(e++*e++),l,1),a=r?i.plus(s):i.minus(s),i=j(s.times(c),new n(e++*e++),l,1),s=a.plus(i),s.d[m]!==void 0){for(o=m;s.d[o]===a.d[o]&&o--;);if(o==-1)break}o=a,a=i,i=s,s=o,u++}return D=!0,s.d.length=m+1,s}function Kt(n,e){for(var t=n;--e;)t*=n;return t}function di(n,e){var t,i=e.s<0,r=fe(n,n.precision,1),o=r.times(.5);if(e=e.abs(),e.lte(o))return Se=i?4:1,e;if(t=e.divToInt(r),t.isZero())Se=i?3:2;else{if(e=e.minus(t.times(r)),e.lte(o))return Se=ei(t)?i?2:3:i?4:1,e;Se=ei(t)?i?1:4:i?3:2}return e.minus(r).abs()}function cn(n,e,t,i){var r,o,s,a,c,u,l,m,d,p=n.constructor,b=t!==void 0;if(b?(ce(t,1,Me),i===void 0?i=p.rounding:ce(i,0,8)):(t=p.precision,i=p.rounding),!n.isFinite())l=mi(n);else{for(l=we(n),s=l.indexOf("."),b?(r=2,e==16?t=t*4-3:e==8&&(t=t*3-2)):r=e,s>=0&&(l=l.replace(".",""),d=new p(1),d.e=l.length-s,d.d=Tt(we(d),10,r),d.e=d.d.length),m=Tt(l,10,r),o=c=m.length;m[--c]==0;)m.pop();if(!m[0])l=b?"0p+0":"0";else{if(s<0?o--:(n=new p(n),n.d=m,n.e=o,n=j(n,d,t,i,0,r),m=n.d,o=n.e,u=ii),s=m[t],a=r/2,u=u||m[t+1]!==void 0,u=i<4?(s!==void 0||u)&&(i===0||i===(n.s<0?3:2)):s>a||s===a&&(i===4||u||i===6&&m[t-1]&1||i===(n.s<0?8:7)),m.length=t,u)for(;++m[--t]>r-1;)m[t]=0,t||(++o,m.unshift(1));for(c=m.length;!m[c-1];--c);for(s=0,l="";s<c;s++)l+=rn.charAt(m[s]);if(b){if(c>1)if(e==16||e==8){for(s=e==16?4:3,--c;c%s;c++)l+="0";for(m=Tt(l,r,e),c=m.length;!m[c-1];--c);for(s=1,l="1.";s<c;s++)l+=rn.charAt(m[s])}else l=l.charAt(0)+"."+l.slice(1);l=l+(o<0?"p":"p+")+o}else if(o<0){for(;++o;)l="0"+l;l="0."+l}else if(++o>c)for(o-=c;o--;)l+="0";else o<c&&(l=l.slice(0,o)+"."+l.slice(o))}l=(e==16?"0x":e==2?"0b":e==8?"0o":"")+l}return n.s<0?"-"+l:l}function ti(n,e){if(n.length>e)return n.length=e,!0}function Cr(n){return new this(n).abs()}function Kr(n){return new this(n).acos()}function Nr(n){return new this(n).acosh()}function Lr(n,e){return new this(n).plus(e)}function Rr(n){return new this(n).asin()}function Mr(n){return new this(n).asinh()}function vr(n){return new this(n).atan()}function Fr(n){return new this(n).atanh()}function Er(n,e){n=new this(n),e=new this(e);var t,i=this.precision,r=this.rounding,o=i+4;return!n.s||!e.s?t=new this(NaN):!n.d&&!e.d?(t=fe(this,o,1).times(e.s>0?.25:.75),t.s=n.s):!e.d||n.isZero()?(t=e.s<0?fe(this,i,r):new this(0),t.s=n.s):!n.d||e.isZero()?(t=fe(this,o,1).times(.5),t.s=n.s):e.s<0?(this.precision=o,this.rounding=1,t=this.atan(j(n,e,o,1)),e=fe(this,o,1),this.precision=i,this.rounding=r,t=n.s<0?t.minus(e):t.plus(e)):t=this.atan(j(n,e,o,1)),t}function Or(n){return new this(n).cbrt()}function Dr(n){return N(n=new this(n),n.e+1,2)}function Wr(n,e,t){return new this(n).clamp(e,t)}function _r(n){if(!n||typeof n!="object")throw Error(St+"Object expected");var e,t,i,r=n.defaults===!0,o=["precision",1,Me,"rounding",0,8,"toExpNeg",-Ze,0,"toExpPos",0,Ze,"maxE",0,Ze,"minE",-Ze,0,"modulo",0,9];for(e=0;e<o.length;e+=3)if(t=o[e],r&&(this[t]=on[t]),(i=n[t])!==void 0)if(oe(i)===i&&i>=o[e+1]&&i<=o[e+2])this[t]=i;else throw Error(Re+t+": "+i);if(t="crypto",r&&(this[t]=on[t]),(i=n[t])!==void 0)if(i===!0||i===!1||i===0||i===1)if(i)if(typeof crypto<"u"&&crypto&&(crypto.getRandomValues||crypto.randomBytes))this[t]=!0;else throw Error(oi);else this[t]=!1;else throw Error(Re+t+": "+i);return this}function Vr(n){return new this(n).cos()}function qr(n){return new this(n).cosh()}function pi(n){var e,t,i;function r(o){var s,a,c,u=this;if(!(u instanceof r))return new r(o);if(u.constructor=r,ni(o)){u.s=o.s,D?!o.d||o.e>r.maxE?(u.e=NaN,u.d=null):o.e<r.minE?(u.e=0,u.d=[0]):(u.e=o.e,u.d=o.d.slice()):(u.e=o.e,u.d=o.d?o.d.slice():o.d);return}if(c=typeof o,c==="number"){if(o===0){u.s=1/o<0?-1:1,u.e=0,u.d=[0];return}if(o<0?(o=-o,u.s=-1):u.s=1,o===~~o&&o<1e7){for(s=0,a=o;a>=10;a/=10)s++;D?s>r.maxE?(u.e=NaN,u.d=null):s<r.minE?(u.e=0,u.d=[0]):(u.e=s,u.d=[o]):(u.e=s,u.d=[o]);return}else if(o*0!==0){o||(u.s=NaN),u.e=NaN,u.d=null;return}return un(u,o.toString())}else if(c!=="string")throw Error(Re+o);return(a=o.charCodeAt(0))===45?(o=o.slice(1),u.s=-1):(a===43&&(o=o.slice(1)),u.s=1),ai.test(o)?un(u,o):Ir(u,o)}if(r.prototype=g,r.ROUND_UP=0,r.ROUND_DOWN=1,r.ROUND_CEIL=2,r.ROUND_FLOOR=3,r.ROUND_HALF_UP=4,r.ROUND_HALF_DOWN=5,r.ROUND_HALF_EVEN=6,r.ROUND_HALF_CEIL=7,r.ROUND_HALF_FLOOR=8,r.EUCLID=9,r.config=r.set=_r,r.clone=pi,r.isDecimal=ni,r.abs=Cr,r.acos=Kr,r.acosh=Nr,r.add=Lr,r.asin=Rr,r.asinh=Mr,r.atan=vr,r.atanh=Fr,r.atan2=Er,r.cbrt=Or,r.ceil=Dr,r.clamp=Wr,r.cos=Vr,r.cosh=qr,r.div=Ur,r.exp=Gr,r.floor=Xr,r.hypot=Hr,r.ln=zr,r.log=Zr,r.log10=Qr,r.log2=jr,r.max=Yr,r.min=Jr,r.mod=$r,r.mul=eo,r.pow=to,r.random=no,r.round=io,r.sign=ro,r.sin=oo,r.sinh=so,r.sqrt=ao,r.sub=uo,r.sum=co,r.tan=lo,r.tanh=mo,r.trunc=po,n===void 0&&(n={}),n&&n.defaults!==!0)for(i=["precision","rounding","toExpNeg","toExpPos","maxE","minE","modulo","crypto"],e=0;e<i.length;)n.hasOwnProperty(t=i[e++])||(n[t]=this[t]);return r.config(n),r}function Ur(n,e){return new this(n).div(e)}function Gr(n){return new this(n).exp()}function Xr(n){return N(n=new this(n),n.e+1,3)}function Hr(){var n,e,t=new this(0);for(D=!1,n=0;n<arguments.length;)if(e=new this(arguments[n++]),e.d)t.d&&(t=t.plus(e.times(e)));else{if(e.s)return D=!0,new this(1/0);t=e}return D=!0,t.sqrt()}function ni(n){return n instanceof at||n&&n.toStringTag===si||!1}function zr(n){return new this(n).ln()}function Zr(n,e){return new this(n).log(e)}function jr(n){return new this(n).log(2)}function Qr(n){return new this(n).log(10)}function Yr(){return li(this,arguments,"lt")}function Jr(){return li(this,arguments,"gt")}function $r(n,e){return new this(n).mod(e)}function eo(n,e){return new this(n).mul(e)}function to(n,e){return new this(n).pow(e)}function no(n){var e,t,i,r,o=0,s=new this(1),a=[];if(n===void 0?n=this.precision:ce(n,1,Me),i=Math.ceil(n/M),this.crypto)if(crypto.getRandomValues)for(e=crypto.getRandomValues(new Uint32Array(i));o<i;)r=e[o],r>=429e7?e[o]=crypto.getRandomValues(new Uint32Array(1))[0]:a[o++]=r%1e7;else if(crypto.randomBytes){for(e=crypto.randomBytes(i*=4);o<i;)r=e[o]+(e[o+1]<<8)+(e[o+2]<<16)+((e[o+3]&127)<<24),r>=214e7?crypto.randomBytes(4).copy(e,o):(a.push(r%1e7),o+=4);o=i/4}else throw Error(oi);else for(;o<i;)a[o++]=Math.random()*1e7|0;for(i=a[--o],n%=M,i&&n&&(r=te(10,M-n),a[o]=(i/r|0)*r);a[o]===0;o--)a.pop();if(o<0)t=0,a=[0];else{for(t=-1;a[0]===0;t-=M)a.shift();for(i=1,r=a[0];r>=10;r/=10)i++;i<M&&(t-=M-i)}return s.e=t,s.d=a,s}function io(n){return N(n=new this(n),n.e+1,this.rounding)}function ro(n){return n=new this(n),n.d?n.d[0]?n.s:0*n.s:n.s||NaN}function oo(n){return new this(n).sin()}function so(n){return new this(n).sinh()}function ao(n){return new this(n).sqrt()}function uo(n,e){return new this(n).sub(e)}function co(){var n=0,e=arguments,t=new this(e[n]);for(D=!1;t.s&&++n<e.length;)t=t.plus(e[n]);return D=!0,N(t,this.precision,this.rounding)}function lo(n){return new this(n).tan()}function mo(n){return new this(n).tanh()}function po(n){return N(n=new this(n),n.e+1,1)}g[Symbol.for("nodejs.util.inspect.custom")]=g.toString;g[Symbol.toStringTag]="Decimal";var at=g.constructor=pi(on);Bt=new at(Bt);xt=new at(xt);var V=at;import ko from"big.js";import ea from"bn.js";import fo from"toformat";var bo=fo,ut=bo;import Lt from"big.js";import yo from"bn.js";import Po from"decimal.js-light";import ct from"bn.js";var fi=9007199254740991;function ke(n){let e=re("Raydium_parseBigNumberish");if(n instanceof ct)return n;if(typeof n=="string"){if(n.match(/^-?[0-9]+$/))return new ct(n);e.logWithError(`invalid BigNumberish string: ${n}`)}return typeof n=="number"?(n%1&&e.logWithError(`BigNumberish number underflow: ${n}`),(n>=fi||n<=-fi)&&e.logWithError(`BigNumberish number overflow: ${n}`),new ct(String(n))):typeof n=="bigint"?new ct(n.toString()):(e.error(`invalid BigNumberish value: ${n}`),new ct(0))}var Nt=re("module/fraction"),ln=ut(Lt),lt=ut(Po),Ao={[0]:lt.ROUND_DOWN,[1]:lt.ROUND_HALF_UP,[2]:lt.ROUND_UP},wo={[0]:Lt.roundDown,[1]:Lt.roundHalfUp,[2]:Lt.roundUp},Y=class{constructor(e,t=new yo(1)){this.numerator=ke(e),this.denominator=ke(t)}get quotient(){return this.numerator.div(this.denominator)}invert(){return new Y(this.denominator,this.numerator)}add(e){let t=e instanceof Y?e:new Y(ke(e));return this.denominator.eq(t.denominator)?new Y(this.numerator.add(t.numerator),this.denominator):new Y(this.numerator.mul(t.denominator).add(t.numerator.mul(this.denominator)),this.denominator.mul(t.denominator))}sub(e){let t=e instanceof Y?e:new Y(ke(e));return this.denominator.eq(t.denominator)?new Y(this.numerator.sub(t.numerator),this.denominator):new Y(this.numerator.mul(t.denominator).sub(t.numerator.mul(this.denominator)),this.denominator.mul(t.denominator))}mul(e){let t=e instanceof Y?e:new Y(ke(e));return new Y(this.numerator.mul(t.numerator),this.denominator.mul(t.denominator))}div(e){let t=e instanceof Y?e:new Y(ke(e));return new Y(this.numerator.mul(t.denominator),this.denominator.mul(t.numerator))}toSignificant(e,t={groupSeparator:""},i=1){Number.isInteger(e)||Nt.logWithError(`${e} is not an integer.`),e<=0&&Nt.logWithError(`${e} is not positive.`),lt.set({precision:e+1,rounding:Ao[i]});let r=new lt(this.numerator.toString()).div(this.denominator.toString()).toSignificantDigits(e);return r.toFormat(r.decimalPlaces(),t)}toFixed(e,t={groupSeparator:""},i=1){return Number.isInteger(e)||Nt.logWithError(`${e} is not an integer.`),e<0&&Nt.logWithError(`${e} is negative.`),ln.DP=e,ln.RM=wo[i]||1,new ln(this.numerator.toString()).div(this.denominator.toString()).toFormat(e,t)}isZero(){return this.numerator.isZero()}};var ca=re("Raydium_amount"),la=ut(ko);import{PublicKey as To}from"@solana/web3.js";import{TOKEN_PROGRAM_ID as bi}from"@solana/spl-token";var mn={chainId:101,address:To.default.toBase58(),programId:bi.toBase58(),decimals:9,symbol:"SOL",name:"solana",logoURI:"https://img-v1.raydium.io/icon/So11111111111111111111111111111111111111112.png",tags:[],priority:2,type:"raydium",extensions:{coingeckoId:"solana"}},ve={chainId:101,address:"So11111111111111111111111111111111111111112",programId:bi.toBase58(),decimals:9,symbol:"WSOL",name:"Wrapped SOL",logoURI:"https://img-v1.raydium.io/icon/So11111111111111111111111111111111111111112.png",tags:[],priority:2,type:"raydium",extensions:{coingeckoId:"solana"}};import{PublicKey as fn}from"@solana/web3.js";import{PublicKey as J,SystemProgram as gi,SYSVAR_RENT_PUBKEY as Bo}from"@solana/web3.js";import{TOKEN_PROGRAM_ID as xo}from"@solana/spl-token";function dn({pubkey:n,isSigner:e=!1,isWritable:t=!0}){return{pubkey:n,isWritable:t,isSigner:e}}var Pa=[dn({pubkey:xo,isWritable:!1}),dn({pubkey:gi.programId,isWritable:!1}),dn({pubkey:Bo,isWritable:!1})];function yi({publicKey:n,transformSol:e}){let t=Pi(n.toString());if(t instanceof J)return e&&t.equals(mt)?Rt:t;if(e&&t.toString()===mt.toBase58())return Rt;if(typeof t=="string"){if(t===J.default.toBase58())return J.default;try{return new J(t)}catch{throw new Error("invalid public key")}}throw new Error("invalid public key")}function Pi(n){try{return new J(n)}catch{return n}}var Io=new J("MemoSq4gqABAXKb96qnH8TysNcWxMyWCqXgDLGmfcHr"),So=new J("MemoSq4gqABAXKb96qnH8TysNcWxMyWCqXgDLGmfcHr"),pn=new J("SysvarRent111111111111111111111111111111111"),Aa=new J("SysvarC1ock11111111111111111111111111111111"),Qe=new J("metaqbxxUerdq28cj1RbAWkYQm3ybzjb6a8bt518x1s"),wa=new J("Sysvar1nstructions1111111111111111111111111"),ka=gi.programId,ha=new J("4k3Dyjzvzp8eMZWUXbBCjEvwSkkk59S5iCNLY3QrkX6R"),Ta=new J("Ea5SjE2Y6yvCeW5dYTn7PYMuW5ikXkvbGdcmSnXeaLjS"),Ba=new J("SRMuApVNdxXokk5GT7XD5cUUgXMBCoAz2LHeuAoKWRt"),xa=new J("EPjFWdd5AufqSSqeM2qN1xzybapC8G4wEGGkZwyTDt1v"),Ia=new J("Es9vMFrzaCERmJfrF4H2FYD4KCoNkY11McCe8BenwNYB"),Sa=new J("mSoLzYCxHdYgdzU16g5QSh3i5K3z3KZK7ytfqcJm7So"),Ca=new J("7dHbWXmci3dT8UFYWYZweBLXgycu7Y3iL6trKn1Y7ARj"),Ka=new J("USDH1SM1ojwWUga67PGrgFWUHibbjqMvuMaDkRJTgkX"),Na=new J("NRVwhjBQiUPYtfDT5zRBVJajzFQHaBUNtC7SNVvqRFa"),La=new J("ANAxByE6G2WjFp7A4NqtWYXb3mgruyzZYg3spfxe6Lbo"),Ra=new J("7vfCXTUXx5WJV5JADk17DUJ4ksgau7utNKj4b963voxs"),Rt=new J("So11111111111111111111111111111111111111112"),mt=J.default;var bn=class{constructor({mint:e,decimals:t,symbol:i,name:r,skipMint:o=!1,isToken2022:s=!1}){if(e===mt.toBase58()||e instanceof fn&&mt.equals(e)){this.decimals=ve.decimals,this.symbol=ve.symbol,this.name=ve.name,this.mint=new fn(ve.address),this.isToken2022=!1;return}this.decimals=t,this.symbol=i||e.toString().substring(0,6),this.name=r||e.toString().substring(0,6),this.mint=o?fn.default:yi({publicKey:e}),this.isToken2022=s}equals(e){return this===e?!0:this.mint.equals(e.mint)}},Fe=bn;Fe.WSOL=new bn(Q(X({},ve),{mint:ve.address}));var gn=class{constructor({decimals:e,symbol:t="UNKNOWN",name:i="UNKNOWN"}){this.decimals=e,this.symbol=t,this.name=i}equals(e){return this===e}},Mt=gn;Mt.SOL=new gn(mn);import Co from"bn.js";var Ga=new Y(new Co(100));var Qa=re("Raydium_price");import{PublicKey as pu}from"@solana/web3.js";import bu from"bn.js";var Ko=new he(0),Mu=new he(1),vu=new he(2),Fu=new he(3),Eu=new he(5),ho=new he(10),Ou=new he(100),Du=new he(1e3),Wu=new he(1e4);function Ai(n,e,t){return n.mul(e).add(t).sub(new he(1)).div(t)}function An(n,e=1,t=[]){let i=[...n];if(e<=0)return t;for(;i.length;)t.push(i.splice(0,e));return t}import{PublicKey as Eo}from"@solana/web3.js";import{TOKEN_PROGRAM_ID as Oo}from"@solana/spl-token";import{ComputeBudgetProgram as wi,Keypair as hi,PublicKey as No,Transaction as Ti,TransactionMessage as Lo,VersionedTransaction as Bi}from"@solana/web3.js";var Ve={CreateAccount:"CreateAccount",InitAccount:"InitAccount",CreateATA:"CreateATA",CloseAccount:"CloseAccount",TransferAmount:"TransferAmount",InitMint:"InitMint",MintTo:"MintTo",InitMarket:"InitMarket",Util1216OwnerClaim:"Util1216OwnerClaim",SetComputeUnitPrice:"SetComputeUnitPrice",SetComputeUnitLimit:"SetComputeUnitLimit",ClmmCreatePool:"ClmmCreatePool",ClmmOpenPosition:"ClmmOpenPosition",ClmmIncreasePosition:"ClmmIncreasePosition",ClmmDecreasePosition:"ClmmDecreasePosition",ClmmClosePosition:"ClmmClosePosition",ClmmSwapBaseIn:"ClmmSwapBaseIn",ClmmSwapBaseOut:"ClmmSwapBaseOut",ClmmInitReward:"ClmmInitReward",ClmmSetReward:"ClmmSetReward",ClmmCollectReward:"ClmmCollectReward",ClmmLockPosition:"ClmmLockPosition",ClmmHarvestLockPosition:"ClmmHarvestLockPosition",AmmV4Swap:"AmmV4Swap",AmmV4AddLiquidity:"AmmV4AddLiquidity",AmmV4RemoveLiquidity:"AmmV4RemoveLiquidity",AmmV4SimulatePoolInfo:"AmmV4SimulatePoolInfo",AmmV4SwapBaseIn:"AmmV4SwapBaseIn",AmmV4SwapBaseOut:"AmmV4SwapBaseOut",AmmV4CreatePool:"AmmV4CreatePool",AmmV4InitPool:"AmmV4InitPool",AmmV5AddLiquidity:"AmmV5AddLiquidity",AmmV5RemoveLiquidity:"AmmV5RemoveLiquidity",AmmV5SimulatePoolInfo:"AmmV5SimulatePoolInfo",AmmV5SwapBaseIn:"AmmV5SwapBaseIn",AmmV5SwapBaseOut:"AmmV5SwapBaseOut",RouteSwap:"RouteSwap",RouteSwap1:"RouteSwap1",RouteSwap2:"RouteSwap2",FarmV3Deposit:"FarmV3Deposit",FarmV3Withdraw:"FarmV3Withdraw",FarmV3CreateLedger:"FarmV3CreateLedger",FarmV4Withdraw:"FarmV4Withdraw",FarmV5Deposit:"FarmV5Deposit",FarmV5Withdraw:"FarmV5Withdraw",FarmV5CreateLedger:"FarmV5CreateLedger",FarmV6Deposit:"FarmV6Deposit",FarmV6Withdraw:"FarmV6Withdraw",FarmV6Create:"FarmV6Create",FarmV6Restart:"FarmV6Restart",FarmV6CreatorAddReward:"FarmV6CreatorAddReward",FarmV6CreatorWithdraw:"FarmV6CreatorWithdraw",CpmmCreatePool:"CpmmCreatePool",CpmmAddLiquidity:"CpmmAddLiquidity",CpmmWithdrawLiquidity:"CpmmWithdrawLiquidity",CpmmSwapBaseIn:"CpmmSwapBaseIn",CpmmSwapBaseOut:"CpmmSwapBaseOut",CpmmLockLp:"CpmmLockLp",CpmmCollectLockFee:"CpmmCollectLockFee",TransferTip:"TransferTip"};import{TOKEN_PROGRAM_ID as Ro}from"@solana/spl-token";var ki=re("Raydium_txUtil"),xi=1644;function Ft(n){let e=[],t=[];return n.microLamports&&(e.push(wi.setComputeUnitPrice({microLamports:n.microLamports})),t.push(Ve.SetComputeUnitPrice)),n.units&&(e.push(wi.setComputeUnitLimit({units:n.units})),t.push(Ve.SetComputeUnitLimit)),{instructions:e,instructionTypes:t}}async function Ye(n,e){var i,r;let t=e!=null?e:"confirmed";return(r=await((i=n.getLatestBlockhash)==null?void 0:i.call(n,{commitment:t})))==null?void 0:r.blockhash}async function wn(n,e){return n.getSignatureStatuses([e]),new Promise((t,i)=>{let r=setTimeout(i,6e4);n.onSignature(e,o=>{if(clearTimeout(r),!o.err){t("");return}i(Object.assign(o.err,{txId:e}))},"confirmed")})}function Mo(n,e){n.length<1&&ki.logWithError(`no instructions provided: ${n.toString()}`),e.length<1&&ki.logWithError(`no signers provided:, ${e.toString()}`);let t=new Ti;t.recentBlockhash="11111111111111111111111111111111",t.feePayer=e[0],t.add(...n);try{return Buffer.from(t.serialize({verifySignatures:!1})).toString("base64").length<xi}catch{return!1}}function ge(n,e){let[t,i]=No.findProgramAddressSync(n,e);return{publicKey:t,nonce:i}}function dt({instructions:n,payer:e,signers:t}){return Mo(n,[e,...t])}function Et({instructions:n,payer:e,lookupTableAddressAccount:t,recentBlockhash:i=hi.generate().publicKey.toString()}){let o=new Lo({payerKey:e,recentBlockhash:i,instructions:n}).compileToV0Message(Object.values(t!=null?t:{}));try{return Buffer.from(new Bi(o).serialize()).toString("base64").length<xi}catch{return!1}}var vo=n=>Buffer.isBuffer(n)?n:n instanceof Uint8Array?Buffer.from(n.buffer,n.byteOffset,n.byteLength):Buffer.from(n),Fo=n=>{let e=n.serialize({requireAllSignatures:!1,verifySignatures:!1});n instanceof Bi&&(e=vo(e));try{return e instanceof Buffer?e.toString("base64"):Buffer.from(e).toString("base64")}catch{return e.toString("base64")}};function Je(n){let e=[];return n.forEach(t=>{t instanceof Ti&&(t.recentBlockhash||(t.recentBlockhash=Ro.toBase58()),t.feePayer||(t.feePayer=hi.generate().publicKey)),e.push(Fo(t))}),console.log("simulate tx string:",e),e}function Ee(n,e,t){return ge([n.toBuffer(),(t!=null?t:Oo).toBuffer(),e.toBuffer()],new Eo("ATokenGPvbdGVxr1b2hvZbsiqW5xWH25efTNsLJA8knL"))}import{PublicKey as W}from"@solana/web3.js";var sc=new W("EhhTKczWMGQt46ynNeRX1WfeagwwJd7ufHvCDjRxjo5Q"),ac=new W("CBuCnLe26faBpcBP2fktp4rp8abpcAnTWft6ZrP5Q4T"),uc=new W("9KEPoZmtHUrBbhWN1v1KWLMkkvwY6WLtAVUCPRtRjP4z"),cc=new W("FarmqiPv5eAj3j1GMdMCMUGXqPUvmquZtMy86QH6rzhG"),lc=new W("CLaimxFqjHzgTJtAGHU47NPhg6qrc5sCnpC4tBLyABQS"),mc=new W("srmqPvymJeFKQ4zGQed1GFppgkRHL9kaELCbyksJtPX"),dc=new W("9xQeWvG816bUx9EPjHmaT23yvVM2ZWbrrpZb9PusVFin"),pc=new W("675kPX9MHTjS2zt1qfr1NYHuzeLXfQM9H24wFSUt1Mp8"),fc=new W("5quBtoiQqxF9Jv6KYKctB59NT3gtJD2Y65kdnB1Uev3h"),bc=new W("CDSr3ssLcRB6XYPJwAfFt18MZvEZp4LjHcvzBVZ45duo"),Do=new W("CAMMCzo5YL8w4VFF8KVHrK22GGUsp5VTaW7grrKgrWqK"),Wo=new W("LockrWmn6K5twhz3y9w1dQERbmgSaRkfnTeTKbpofwE"),_o=new W("kN1kEznaF5Xbd8LYuqtEFcxzWSBk5Fv6ygX6SqEGJVy"),gc=new W("routeUGWgWzqBWFcrCfv8tritsqukccJPu3q5GPP3xS"),yc=new W("7YttLkHDoNj9wyDur5pM1ejNaAvT9X4eqaYcHQqtj2G5"),Pc=new W("6FJon3QE27qgPVggARueB22hLvoh22VzJpXv4rBEoSLF"),Ac=new W("CC12se5To1CdEuw7fDS27B7Geo5jJyL7t5UK2B44NgiH"),wc=new W("9HzJyW1qZsEiSfMUf6L2jo3CcTKAyBmSyKdwQeYisHrC"),kc=new W("DropEU8AvevN3UrXWXTMuz3rqnMczQVNjq3kcSdW2SQi"),hc=new W("CPMMoo8L3F4NbTegBCKVNunggL7H1ZpdTHKxQB5qKP1C"),Tc=new W("GpMZbSM2GgvTKHJirzeGfMFoaZ8UR2X7F4v8vHTvxFbL"),Bc=new W("DNXgeM9EiiaAbaWvwjHj9fQQLAX5ZsfHyvmYUNRAdNC8"),Vo=new W("CPMDWBwJDtYax9qW7AyRuVC19Cc4L4Vcy4n2BHAbHkCW"),qo=new W("7rQ1QFNosMkUCuh7Z7fPbTHvh73b68sQYdirycEzJVuw"),Uo=new W("G11FKBRaAkHAKuLCgLM6K6NUc9rTjPAznRCjZifrTQe2"),xc=new W("LockrWmn6K5twhz3y9w1dQERbmgSaRkfnTeTKbpofwE"),Go=new W("DLockwT7X7sxtLmGH9g5kmfcjaBtncdbUmi738m5bvQC"),Ic=new W("3f7GcQFG397GAaEnv51zR6tsTVihYRydnydDD1cXekxH"),Xo=new W("7AFUeLVRjBfzqK3tTGw8hN48KLQWSk6DTE8xprWdPqix"),Te=new W("LanMV9sAd7wArD4vJFi2qDdfnVhFxYSUg6eADduJ3uj"),Sc=new W("WLHv2UAZm6z4KyaaELi5pjdbJh6RESMva1Rnn8pJVVh"),Ho=new W("LanD8FpTBBvzZFXjTxsAoipkFsxPUCDB4qAqKxYDiNP"),zo=new W("HYNHiyKJ3gGVFvyxJAurK7qr7P2o5J9THmvCGMdULtpW");var Cc={AMM_V4:new W("HWy1jotHpo6UqeQxx49dpYYdQB8wj9Qk9MdxwjLvDHB8"),AMM_STABLE:new W("DDg4VmQaJV9ogWce7LpcjBA9bv22wRp5uaTPa5pGjijF"),CLMM_PROGRAM_ID:new W("devi51mZmdwUJGU9hjN27vEz64Gps7uUefqxg27EAtH"),CLMM_LOCK_PROGRAM_ID:new W("DLockwT7X7sxtLmGH9g5kmfcjaBtncdbUmi738m5bvQC"),CLMM_LOCK_AUTH_ID:new W("8qmHNvu2Kr2C7U8mJL4Vz1vTDxMhVuXKREwU7TNoaVEo"),FARM_PROGRAM_ID_V3:new W("85BFyr98MbCUU9MVTEgzx1nbhWACbJqLzho6zd6DZcWL"),FARM_PROGRAM_ID_V5:new W("EcLzTrNg9V7qhcdyXDe2qjtPkiGzDM2UbdRaeaadU5r2"),FARM_PROGRAM_ID_V6:new W("Farm2hJLcqPtPg8M4rR6DMrsRNc5TPm5Cs4bVQrMe2T7"),OPEN_BOOK_PROGRAM:new W("EoTcMgcDRTJVZDMZWBoU6rhYHZfkNTVEAfz3uUJRcYGj"),SERUM_PROGRAM_ID_V3:W.default,UTIL1216:W.default,Router:new W("BVChZ3XFEwTMUk1o9i3HAf91H6mFxSwa5X2wFAWhYPhU"),CREATE_CPMM_POOL_PROGRAM:Vo,CREATE_CPMM_POOL_AUTH:qo,CREATE_CPMM_POOL_FEE_ACC:Uo,LOCK_CPMM_PROGRAM:Go,LOCK_CPMM_AUTH:Xo,LAUNCHPAD_PROGRAM:Ho,LAUNCHPAD_AUTH:zo,FEE_DESTINATION_ID:new W("3XMrhbv989VxAMi3DErLV9eJht1pHppW5LbKxe9fkEFR")};import Ot from"bn.js";function Dt(n,e){if(n.isZero())return new Ot(0);let t=n.div(e);return t.isZero()?new Ot(1):n.mod(e).gt(new Ot(0))?t.add(new Ot(1)):t}import Zo from"bn.js";var qe=new Zo(1e6);import{MINT_SIZE as sl,TOKEN_PROGRAM_ID as al,getTransferFeeConfig as ul,unpackMint as cl}from"@solana/spl-token";var kn=re("Raydium_accountInfo_util");async function pt(n,e,t){let{batchRequest:i,commitment:r="confirmed",chunkCount:o=100}=X({batchRequest:!1},t),s=An(e,o),a=new Array(s.length).fill([]);if(i){let c=s.map(m=>{let d=n._buildArgs([m.map(p=>p.toBase58())],r,"base64");return{methodName:"getMultipleAccounts",args:d}}),u=An(c,10);a=(await(await Promise.all(u.map(async m=>await n._rpcBatchRequest(m)))).flat()).map(m=>(m.error&&kn.logWithError(`failed to get info for multiple accounts, RPC_ERROR, ${m.error.message}`),m.result.value.map(d=>{if(d){let{data:p,executable:b,lamports:f,owner:P,rentEpoch:h}=d;return p.length!==2&&p[1]!=="base64"&&kn.logWithError("info must be base64 encoded, RPC_ERROR"),{data:Buffer.from(p[0],"base64"),executable:b,lamports:f,owner:new jo(P),rentEpoch:h}}return null})))}else try{a=await Promise.all(s.map(c=>n.getMultipleAccountsInfo(c,r)))}catch(c){c instanceof Error&&kn.logWithError(`failed to get info for multiple accounts, RPC_ERROR, ${c.message}`)}return a.flat()}async function Ue(n,e,t){let i=await pt(n,e.map(r=>r.pubkey),t);return e.map((r,o)=>Q(X({},r),{accountInfo:i[o]}))}async function hn({connection:n,address:e}){let t=await pt(n,[...new Set(e.map(r=>r.toString()))].map(r=>new Si(r))),i={};for(let r=0;r<e.length;r++){let o=t[r],s=e[r];if(!o)continue;let a=new Wt({key:s,state:Wt.deserialize(o.data)});i[s.toString()]=a,_t[s.toString()]=a}return i}var _t={AcL1Vo8oy1ULiavEcjSUcwfBSForXMudcZvDZy5nzJkU:new Wt({key:new Si("AcL1Vo8oy1ULiavEcjSUcwfBSForXMudcZvDZy5nzJkU"),state:Wt.deserialize(Buffer.from("AQAAAP//////////I1rcEwAAAAAvAQYwun9CU6c5Ikm2pAj+D9IEnCOR45nK+SFTGSdpd6J6AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAbd9uHXZaGT2cvhRs7reawctIXtX1s3kTqM9YV+/wCpBt324e51j94YQl285GzN2rYa/E2DuQ0n/r35KNihi/wFSlNQ+F3IgtYUpVZyeIopbd8eq6vQpgZ4iEky9O72oAVKU1qZKSEGTSTocWDaOHx8NbXdvJK7geQfqEBBBUSNBqfVFxksXFEhjMlMPUrxf1ja7gibof1E49vZigAAAAAGp9UXGMd0yShWY5hpHV62i164o5tLbVxzVVshAAAAAIyXJY9OJInxuz0QKRSODYMLWhOZ2v8QhASOe9jb6fhZC3BlsePRfEU4nVJ/awTDzVi4bHMaoP21SbbRvAP4KUbIScv+6Yw2LHF/6K0ZjUPibbSWXCirYPGuuVl7zT789IUPLW4CpHr4JNCatp3ELXDLKMv6JJ+37le50lbBJ2LvBkX2T9y7AHdNGviJAqQNtlDUDCnauQRWybsLji6nPM8Qkw5asQRvCdB3MbX6IEBwytOrpM32l4jQygKG9TKgR0vZScQ2AsM/IHeQ7RajUkyhuZdc8SGiqQz/7H34torNR/Wir3sl0ruUrVxJWEZfUg+QLNAxxODdBi53/OP7Ioil1cqeBM9dtZC3FLov4yyxWRM/wcGStyJX/QfTnLBAHqkqWotPKVlShCVQqpP9W5W1rOao65IMk5QuQ2kMIOxzDMKAy2vjGSxQODgBz0QwGA+eP4ZjIjrIAQaXENv31QfLlOdXSRCkaybRniDHF4C8YcwhcvsqrOVuTP4B2Na+9wLdtrB31uz2rtlFI5kahdsnp/d1SrASDInYCtTYtdoke4kX+hoKWcEWM4Tle8pTUkUVv4BxS6fje/EzKBE4Qu/YsA/yfEEFGcr8Z57VKDw8uQzpiru7g4lvjnfapW62W030syevD8k07SGoxUHiuT/ai7gAHWWhDsVmg/C63ajgpkH7Sn3GdutArDTfyqOkdqv4/IPC/EFFy7mGkfDd2C57N5a/4jC+BbmJy7wQaSEZr0CQU88lPtUxIVvzGjC95b8Ooss2TqmkrayGKofkPMGQn7Ux+9lfwBSNfxwH8NgbpqC/7LNlV4I7nCvsXf3p+ohQk9NrAJb2KAFpUqEIJ9ZBV7BYDzHF/ORKYlgtvPnXjudZQ6CEo5OzUDaNIomTCCsvhD16TxJjsbgne1kGnQPCFSoaxUbq2V1bPMFQ3VYP6wDZ9bKStCFKx9A3tNbwZFC5ZGAN83MFK7XoTy+OmmcFEr6rLOjfSuTfPvHJkSVxW6Qllwkl67XcBi5v00u2gQsbu+38sp+rd5pA/LvyWj4P94ZGZwc1tE2P88xekCLcAwZGb+UhFzL/7K26csOb57yM5bvF9xJrLEObOkAAAAAn+HWRkdcPKyFFMnVwEoD7vnD0jCKFIU1sImubYCxNTSVzsKpaQX+fzNxrLAI3L14JQnJx/D6Uk2LADIHGqnGELzjEbkBDAlaM77NkXMPfqXNLSveCkWI7UEgNs31WEWB6XHSYI/v5DklHOb4QTtDOR804PVbi3fjloZeLR2F8d4FuZmMMO7ck3Fnkn2zEMG5gOmqsygb6PjTitArVl52NhcSznTxVnguaIJxiZkAnurDmn3MWR0PC2GLghp2KJqHCc6QQ85odeIjFHKOlRlJyeSXVJmL8vb1UgOzsbJPVP8p6zM4M3C1Sd7uWIHP33G42AP2Zg8ucn/n6meQjjD266JgCWdxZD6PXs9CsnIeL7SSG0/6lGb9xfP0ZcWkCXB/3hjxHYVXjra/GPOeXGk0fLLKjCbk+mgs2w6d2oCwimBipTzuoZ30GiI8ij8VRzD5CzMWtu2m21eDBIfjGAEo4pQeNNonKcqzV/cleX8ySZLOHsz8PtBCrLqF+VkLm9hOzIT+6i/nIf6keR4GWKMOD4AvqfpjHoD4DuhBpz8P28+DxkGrDXXr/nr20x291VPvcTU/b+b+o2kC9G0kcXeTlLjU6a2TQXWlZ4gBUdBl1jgT7mObSTpLblNiXZsLkbmVXZwvFKXua5cUKlWed/w30skmEUraTuQqtqr5fHZPW9n57EmeTif6LjHL2YJFZkQU+TrJmFzqzmF4/b8OwrPQAprl8mX3q4LUIdAS/a+11B6DWD1Xk2++Sn94dLC4xjkO4Wtlw8c4XuzciVbepHOmnoWzVu/0y3KCrLCSfQxQ3br8DJCoVzhgtPsS2nZZjsBGIZgnU0QpMv+2MnRsnKwdp1VsrCX84j/qvaZn4WhKunippgTbN2EUs0tPTP55Qfgj+nKmjtWW5IYs72FrEwJKYoNfsmqaF4o5pf4v9zgPwVwY/5I4XJKUL2L25m9kAQcW/K+H1RTFEUoj8Z4ajpOmAB/dG0COmCphVMW2CCMvnxhcGiSgPnpDuWu6qiJ7NG7ye5kvHgefgqPLeicspNJ5EpL3XiRNLM2tmJLI1awAwOyd6iHv0dCkMYRKaa6rcaZeYwmKCkckm0kM2JNmnmmAaBQQ7mwmIM0IMxX4f5W6j9PqZWcJxF7r17T/lQBAmcjoupRiJifbnXCNUv9GhpRF19WcBdeKbivRJVlGop6I2RS6lGImJ9udcI1S/0aGlEXX1ZwF14puK9ElWUainojZFYVHLHD6dIP2ESjqBzg3ol1/wB7+/ylGwd9LS7wSZ2A630CJSVKwH47K9P4bB8PEQP8BwjMFa7xQHOqZFP1XqaQ==","base64"))})};import{LAMPORTS_PER_SOL as Li}from"@solana/web3.js";var Yo="http://sg-sender.helius-rpc.com/fast",Sl=.001*Li,Ki=["4ACfpUFoaSD9bfPdeu6DBt89gB6ENTeHBXCAi87NhDEE","D2L6yPZ2FmmmTKPgzaMKdhu6EWZcTpLy1Vhx8uvZe7NZ","9bnz4RShgq1hAnLnZbP8kbgBg1kEmcJBYQq3gQbmnSta","5VY91ws6B2hMmBFRsXkoAAdsPHBJwRfBht4DXox3xkwn","2nyhqdwKcJZR2vcqCyrYsaPVdAnFoJjiksCXJ7hfEYgD","2q5pghRs6arqVjRvT5gfgWfWcHWmw1ZuCzphgd5KfWGJ","wyvPkWjVZz1M8fHQnMMCDTQDbkManefNNhweYk5WkcF","3KCKozbAaF75qEU33jtzozcJ29yJuaLJTy2jFdzUY8bT","4vieeGHPYPG2MmyPRcYjdiDmmhN3ww7hsFNap8pVN3Ey","4TQLFNWK8AovT1gFvda5jfw2oJeRMKEmw7aH6MGBJ3or"].map(n=>new Ge(n)),Ut=2e3;async function Jo(n){let e=Buffer.from(n.serialize()).toString("base64"),i=await(await fetch(Yo,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({jsonrpc:"2.0",id:Date.now().toString(),method:"sendTransaction",params:[e,{encoding:"base64",skipPreflight:!0,maxRetries:0}]})})).json();if(console.log("Helius response:",JSON.stringify(i,null,2)),i.error)throw new Error(i.error.message);let r=i.result;return console.log("Transaction sent:",r),r}var Gt=class{constructor(e){this.instructions=[];this.endInstructions=[];this.lookupTableAddress=[];this.signers=[];this.instructionTypes=[];this.endInstructionTypes=[];this.connection=e.connection,this.feePayer=e.feePayer,this.signAllTransactions=e.signAllTransactions,this.owner=e.owner,this.cluster=e.cluster,this.blockhashCommitment=e.blockhashCommitment,this.loopMultiTxStatus=!!e.loopMultiTxStatus}get AllTxData(){return{instructions:this.instructions,endInstructions:this.endInstructions,signers:this.signers,instructionTypes:this.instructionTypes,endInstructionTypes:this.endInstructionTypes,lookupTableAddress:this.lookupTableAddress}}get allInstructions(){return[...this.instructions,...this.endInstructions]}async getComputeBudgetConfig(){var i;let e=(await Qo.get(`https://solanacompass.com/api/fees?cacheFreshTime=${3e5}`)).data,{avg:t}=(i=e==null?void 0:e[15])!=null?i:{};if(!!t)return{units:6e5,microLamports:Math.min(Math.ceil(t*1e6/6e5),25e3)}}addCustomComputeBudget(e){if(e){let{instructions:t,instructionTypes:i}=Ft(e);return this.instructions.unshift(...t),this.instructionTypes.unshift(...i),!0}return!1}addTipInstruction(e){var t;return e?(this.endInstructions.push(Ci.transfer({fromPubkey:(t=e.feePayer)!=null?t:this.feePayer,toPubkey:new Ge(e.address),lamports:BigInt(e.amount.toString())})),this.endInstructionTypes.push(Ve.TransferTip),!0):!1}async calComputeBudget({config:e,defaultIns:t}){try{let i=e||await this.getComputeBudgetConfig();if(this.addCustomComputeBudget(i))return;t&&this.instructions.unshift(...t)}catch{t&&this.instructions.unshift(...t)}}addInstruction({instructions:e=[],endInstructions:t=[],signers:i=[],instructionTypes:r=[],endInstructionTypes:o=[],lookupTableAddress:s=[]}){return this.instructions.push(...e),this.endInstructions.push(...t),this.signers.push(...i),this.instructionTypes.push(...r),this.endInstructionTypes.push(...o),this.lookupTableAddress.push(...s.filter(a=>a!==Ge.default.toString())),this}async versionBuild({txVersion:e,extInfo:t}){return e===0?await this.buildV0(X({},t||{})):this.build(t)}build(e){var i;let t=new ft;return this.allInstructions.length&&t.add(...this.allInstructions),t.feePayer=this.feePayer,((i=this.owner)==null?void 0:i.signer)&&!this.signers.some(r=>r.publicKey.equals(this.owner.publicKey))&&this.signers.push(this.owner.signer),{builder:this,transaction:t,signers:this.signers,instructionTypes:[...this.instructionTypes,...this.endInstructionTypes],execute:async r=>{var l;let{recentBlockHash:o,skipPreflight:s=!0,sendAndConfirm:a,notSendToRpc:c}=r||{},u=o!=null?o:await Ye(this.connection,this.blockhashCommitment);if(t.recentBlockhash=u,this.signers.length&&t.sign(...this.signers),Je([t]),console.log("SEND 1"),(l=this.owner)!=null&&l.isKeyPair)return{txId:a?await Tn(this.connection,t,this.signers.find(d=>d.publicKey.equals(this.owner.publicKey))?this.signers:[...this.signers,this.owner.signer],{skipPreflight:s}):await this.connection.sendRawTransaction(t.serialize(),{skipPreflight:s}),signedTx:t};if(this.signAllTransactions){let m=await this.signAllTransactions([t]);if(this.signers.length)for(let d of m)try{d.sign(...this.signers)}catch{}return{txId:c?"":await this.connection.sendRawTransaction(m[0].serialize(),{skipPreflight:s}),signedTx:m[0]}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:e||{}}}buildMultiTx(e){var u;let{extraPreBuildData:t=[],extInfo:i}=e,{transaction:r}=this.build(i),o=t.filter(l=>l.transaction.instructions.length>0),s=[r,...o.map(l=>l.transaction)],a=[this.signers,...o.map(l=>l.signers)],c=[...this.instructionTypes,...o.map(l=>l.instructionTypes).flat()];return(u=this.owner)!=null&&u.signer&&a.forEach(l=>{l.some(m=>m.publicKey.equals(this.owner.publicKey))||this.signers.push(this.owner.signer)}),{builder:this,transactions:s,signers:a,instructionTypes:c,execute:async l=>{var h;let{sequentially:m,onTxUpdate:d,skipTxCount:p=0,recentBlockHash:b,skipPreflight:f=!0}=l||{},P=b!=null?b:await Ye(this.connection,this.blockhashCommitment);if((h=this.owner)!=null&&h.isKeyPair){if(m){let w=[],A=0;for(let k of s){if(++A,A<=p)continue;let B=await Tn(this.connection,k,this.signers.find(I=>I.publicKey.equals(this.owner.publicKey))?this.signers:[...this.signers,this.owner.signer],{skipPreflight:f});w.push(B)}return{txIds:w,signedTxs:s}}return{txIds:await await Promise.all(s.map(async w=>(w.recentBlockhash=P,await this.connection.sendRawTransaction(w.serialize(),{skipPreflight:f})))),signedTxs:s}}if(this.signAllTransactions){let w=s.map((k,B)=>(k.recentBlockhash=P,a[B].length&&k.sign(...a[B]),k));Je(w),console.log("SEND 2");let A=await this.signAllTransactions(w);if(m){let k=0,B=[],I=async()=>{if(!A[k])return;let S=await this.connection.sendRawTransaction(A[k].serialize(),{skipPreflight:f});B.push({txId:S,status:"sent",signedTx:A[k]}),d==null||d([...B]),k++;let T=!1,F=null,O=null,_=x=>{F!==null&&clearInterval(F),O!==null&&this.connection.removeSignatureListener(O);let L=B.findIndex(H=>H.txId===S);if(L>-1){if(B[L].status==="error"||B[L].status==="success")return;B[L].status=x.err?"error":"success"}d==null||d([...B]),x.err||I()};this.loopMultiTxStatus&&(F=setInterval(async()=>{var x;if(T){clearInterval(F);return}try{let L=await this.connection.getTransaction(S,{commitment:"confirmed",maxSupportedTransactionVersion:0});L&&(T=!0,clearInterval(F),_({err:((x=L.meta)==null?void 0:x.err)||null}),console.log("tx status from getTransaction:",S))}catch(L){T=!0,clearInterval(F),console.error("getTransaction timeout:",L,S)}},Ut)),O=this.connection.onSignature(S,x=>{if(T){this.connection.removeSignatureListener(O);return}T=!0,_(x)},"confirmed"),this.connection.getSignatureStatus(S)};return await I(),{txIds:B.map(S=>S.txId),signedTxs:A}}else{let k=[];for(let B=0;B<A.length;B+=1){let I=await this.connection.sendRawTransaction(A[B].serialize(),{skipPreflight:f});k.push(I)}return{txIds:k,signedTxs:A}}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:i||{}}}async versionMultiBuild({extraPreBuildData:e,txVersion:t,extInfo:i}){return t===0?await this.buildV0MultiTx({extraPreBuildData:e,buildProps:i||{}}):this.buildMultiTx({extraPreBuildData:e,extInfo:i})}async buildV0(e){var f;let b=e||{},{lookupTableCache:t={},lookupTableAddress:i=[],forerunCreate:r,recentBlockhash:o}=b,s=_e(b,["lookupTableCache","lookupTableAddress","forerunCreate","recentBlockhash"]),a=X(X({},this.cluster==="devnet"?{}:_t),t),c=Array.from(new Set([...i,...this.lookupTableAddress])),u=[];for(let P of c)a[P]===void 0&&u.push(new Ge(P));let l=await hn({connection:this.connection,address:u});for(let[P,h]of Object.entries(l))a[P]=h;let m=r?Ge.default.toBase58():o!=null?o:await Ye(this.connection,this.blockhashCommitment),d=new Vt({payerKey:this.feePayer,recentBlockhash:m,instructions:[...this.allInstructions]}).compileToV0Message(Object.values(a));((f=this.owner)==null?void 0:f.signer)&&!this.signers.some(P=>P.publicKey.equals(this.owner.publicKey))&&this.signers.push(this.owner.signer);let p=new qt(d);return p.sign(this.signers),{builder:this,transaction:p,signers:this.signers,instructionTypes:[...this.instructionTypes,...this.endInstructionTypes],execute:async P=>{var k;let{skipPreflight:h=!0,sendAndConfirm:w,notSendToRpc:A}=P||{};if(Je([p]),console.log("SEND 3"),(k=this.owner)!=null&&k.isKeyPair){let B=await this.connection.sendTransaction(p,{skipPreflight:h});return w&&await wn(this.connection,B),{txId:B,signedTx:p}}if(this.signAllTransactions){let B=await this.signAllTransactions([p]);if(this.signers.length)for(let I of B)try{I.sign(this.signers)}catch{}return{txId:A?"":await this.connection.sendTransaction(B[0],{skipPreflight:h}),signedTx:B[0]}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:s||{}}}async buildV0MultiTx(e){var u;let{extraPreBuildData:t=[],buildProps:i}=e,{transaction:r}=await this.buildV0(i),o=t.filter(l=>l.builder.instructions.length>0),s=[r,...o.map(l=>l.transaction)],a=[this.signers,...o.map(l=>l.signers)],c=[...this.instructionTypes,...o.map(l=>l.instructionTypes).flat()];return(u=this.owner)!=null&&u.signer&&a.forEach(l=>{l.some(m=>m.publicKey.equals(this.owner.publicKey))||this.signers.push(this.owner.signer)}),s.forEach(async(l,m)=>{l.sign(a[m])}),{builder:this,transactions:s,signers:a,instructionTypes:c,buildProps:i,execute:async l=>{var f;let{sequentially:m,onTxUpdate:d,recentBlockHash:p,skipPreflight:b=!0}=l||{};if(p&&s.forEach(P=>P.message.recentBlockhash=p),Je(s),console.log("SEND 4"),(f=this.owner)!=null&&f.isKeyPair){if(m){let P=[];for(let h of s){let w=await this.connection.sendTransaction(h,{skipPreflight:b});await wn(this.connection,w),P.push(w)}return{txIds:P,signedTxs:s}}return{txIds:await Promise.all(s.map(async P=>await this.connection.sendTransaction(P,{skipPreflight:b}))),signedTxs:s}}if(this.signAllTransactions){let P=await this.signAllTransactions(s);if(m){let h=0,w=[],A=async()=>{if(!P[h])return;let k=await this.connection.sendTransaction(P[h],{skipPreflight:b});w.push({txId:k,status:"sent",signedTx:P[h]}),d==null||d([...w]),h++;let B=!1,I=null,S=null,T=F=>{I!==null&&clearInterval(I),S!==null&&this.connection.removeSignatureListener(S);let O=w.findIndex(_=>_.txId===k);if(O>-1){if(w[O].status==="error"||w[O].status==="success")return;w[O].status=F.err?"error":"success"}d==null||d([...w]),F.err||A()};this.loopMultiTxStatus&&(I=setInterval(async()=>{var F;if(B){clearInterval(I);return}try{let O=await this.connection.getTransaction(k,{commitment:"confirmed",maxSupportedTransactionVersion:0});O&&(B=!0,clearInterval(I),T({err:((F=O.meta)==null?void 0:F.err)||null}),console.log("tx status from getTransaction:",k))}catch(O){B=!0,clearInterval(I),console.error("getTransaction timeout:",O,k)}},Ut)),S=this.connection.onSignature(k,F=>{if(B){this.connection.removeSignatureListener(S);return}B=!0,T(F)},"confirmed"),this.connection.getSignatureStatus(k)};return A(),{txIds:[],signedTxs:P}}else{let h=[];for(let w=0;w<P.length;w+=1){let A=await this.connection.sendTransaction(P[w],{skipPreflight:b});h.push(A)}return{txIds:h,signedTxs:P}}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:i||{}}}async sizeCheckBuild(e){var d;let m=e||{},{splitIns:t=[],computeBudgetConfig:i}=m,r=_e(m,["splitIns","computeBudgetConfig"]),o=i?Ft(i):{instructions:[],instructionTypes:[]},s=this.signers.reduce((p,b)=>Q(X({},p),{[b.publicKey.toBase58()]:b}),{}),a=[],c=[],u=[],l=0;if(this.allInstructions.forEach(p=>{let b=[...u,p],f=i?[...o.instructions,...b]:b,h=[...new Set(b.map(w=>w.keys.filter(A=>A.isSigner).map(A=>A.pubkey.toString())).flat()).values()].map(w=>new Ge(w));if(p!==t[l]&&u.length<12&&(dt({instructions:f,payer:this.feePayer,signers:h})||dt({instructions:b,payer:this.feePayer,signers:h})))u.push(p);else{if(u.length===0)throw Error("item ins too big");l+=p===t[l]?1:0,dt({instructions:i?[...o.instructions,...u]:[...u],payer:this.feePayer,signers:h})?a.push(new ft().add(...o.instructions,...u)):a.push(new ft().add(...u)),c.push(Array.from(new Set(u.map(w=>w.keys.filter(A=>A.isSigner).map(A=>A.pubkey.toString())).flat())).map(w=>s[w]).filter(w=>w!==void 0)),u=[p]}}),u.length>0){let b=[...new Set(u.map(f=>f.keys.filter(P=>P.isSigner).map(P=>P.pubkey.toString())).flat()).values()].map(f=>s[f]).filter(f=>f!==void 0);dt({instructions:i?[...o.instructions,...u]:[...u],payer:this.feePayer,signers:b.map(f=>f.publicKey)})?a.push(new ft().add(...o.instructions,...u)):a.push(new ft().add(...u)),c.push(b)}return a.forEach(p=>p.feePayer=this.feePayer),(d=this.owner)!=null&&d.signer&&c.forEach(p=>{p.some(b=>b.publicKey.equals(this.owner.publicKey))||p.push(this.owner.signer)}),{builder:this,transactions:a,signers:c,instructionTypes:this.instructionTypes,execute:async p=>{var k;let{sequentially:b,onTxUpdate:f,skipTxCount:P=0,recentBlockHash:h,skipPreflight:w=!0}=p||{},A=h!=null?h:await Ye(this.connection,this.blockhashCommitment);if(a.forEach(async(B,I)=>{B.recentBlockhash=A,c[I].length&&B.sign(...c[I])}),Je(a),console.log("SEND 5"),console.log("sizeCheckBuild"),(k=this.owner)!=null&&k.isKeyPair){if(b){let B=0,I=[];for(let S of a){if(++B,B<=P){I.push("tx skipped");continue}let T=await Tn(this.connection,S,this.signers.find(F=>F.publicKey.equals(this.owner.publicKey))?this.signers:[...this.signers,this.owner.signer],{skipPreflight:w});I.push(T)}return{txIds:I,signedTxs:a}}return{txIds:await Promise.all(a.map(async B=>await this.connection.sendRawTransaction(B.serialize(),{skipPreflight:w}))),signedTxs:a}}if(this.signAllTransactions){let B=await this.signAllTransactions(a.slice(P,a.length)),I=[...a.slice(0,P),...B];if(b){let S=0,T=[],F=async()=>{if(!I[S])return;S<P&&(T.push({txId:"",status:"success",signedTx:I[S]}),f==null||f([...T]),S++,F());let O=await this.connection.sendRawTransaction(I[S].serialize(),{skipPreflight:w});T.push({txId:O,status:"sent",signedTx:I[S]}),f==null||f([...T]),S++;let _=!1,x=null,L=null,H=E=>{x!==null&&clearInterval(x),L!==null&&this.connection.removeSignatureListener(L);let R=T.findIndex(ue=>ue.txId===O);if(R>-1){if(T[R].status==="error"||T[R].status==="success")return;T[R].status=E.err?"error":"success"}f==null||f([...T]),E.err||F()};this.loopMultiTxStatus&&(x=setInterval(async()=>{var E;if(_){clearInterval(x);return}try{let R=await this.connection.getTransaction(O,{commitment:"confirmed",maxSupportedTransactionVersion:0});R&&(_=!0,clearInterval(x),H({err:((E=R.meta)==null?void 0:E.err)||null}),console.log("tx status from getTransaction:",O))}catch(R){_=!0,clearInterval(x),console.error("getTransaction timeout:",R,O)}},Ut)),L=this.connection.onSignature(O,E=>{if(_){this.connection.removeSignatureListener(L);return}_=!0,H(E)},"confirmed"),this.connection.getSignatureStatus(O)};return await F(),{txIds:T.map(O=>O.txId),signedTxs:I}}else{let S=[];for(let T=0;T<I.length;T+=1){let F=await this.connection.sendRawTransaction(I[T].serialize(),{skipPreflight:w});S.push(F)}return{txIds:S,signedTxs:I}}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:r||{}}}async sizeCheckBuildV0(e){var A;let w=e||{},{computeBudgetConfig:t,splitIns:i=[],lookupTableCache:r={},lookupTableAddress:o=[]}=w,s=_e(w,["computeBudgetConfig","splitIns","lookupTableCache","lookupTableAddress"]),a=X(X({},this.cluster==="devnet"?{}:_t),r),c=Array.from(new Set([...this.lookupTableAddress,...o])),u=[];for(let k of c)a[k]===void 0&&u.push(new Ge(k));let l=await hn({connection:this.connection,address:u});for(let[k,B]of Object.entries(l))a[k]=B;let m=t?Ft(t):{instructions:[],instructionTypes:[]},d=await Ye(this.connection,this.blockhashCommitment),p=this.signers.reduce((k,B)=>Q(X({},k),{[B.publicKey.toBase58()]:B}),{}),b=[],f=[],P=[],h=0;if(this.allInstructions.forEach(k=>{let B=[...P,k],I=t?[...m.instructions,...B]:B;if(k!==i[h]&&P.length<12&&(Et({instructions:I,payer:this.feePayer,lookupTableAddressAccount:a})||Et({instructions:B,payer:this.feePayer,lookupTableAddressAccount:a})))P.push(k);else{if(P.length===0)throw Error("item ins too big");h+=k===i[h]?1:0;let S={};for(let T of[...new Set(c)])a[T]!==void 0&&(S[T]=a[T]);if(t&&Et({instructions:[...m.instructions,...P],payer:this.feePayer,lookupTableAddressAccount:a,recentBlockhash:d})){let T=new Vt({payerKey:this.feePayer,recentBlockhash:d,instructions:[...m.instructions,...P]}).compileToV0Message(Object.values(a));b.push(new qt(T))}else{let T=new Vt({payerKey:this.feePayer,recentBlockhash:d,instructions:[...P]}).compileToV0Message(Object.values(a));b.push(new qt(T))}f.push(Array.from(new Set(P.map(T=>T.keys.filter(F=>F.isSigner).map(F=>F.pubkey.toString())).flat())).map(T=>p[T]).filter(T=>T!==void 0)),P=[k]}}),P.length>0){let B=[...new Set(P.map(F=>F.keys.filter(O=>O.isSigner).map(O=>O.pubkey.toString())).flat()).values()].map(F=>p[F]).filter(F=>F!==void 0),I=Ki[Math.floor(Math.random()*Ki.length)],S=Ci.transfer({fromPubkey:this.feePayer,toPubkey:I,lamports:Math.floor(.001*Li)}),T=new Vt({payerKey:this.feePayer,recentBlockhash:d,instructions:[S,...P]}).compileToV0Message(Object.values(a));b.push(new qt(T)),f.push(B)}return(A=this.owner)!=null&&A.signer&&f.forEach(k=>{k.some(B=>B.publicKey.equals(this.owner.publicKey))||k.push(this.owner.signer)}),b.forEach((k,B)=>{k.sign(f[B]),console.log(`Tx #${B+1} size (bytes):`,k.serialize().length)}),{builder:this,transactions:b,buildProps:e,signers:f,instructionTypes:this.instructionTypes,execute:async k=>{var O;let{sequentially:B,onTxUpdate:I,skipTxCount:S=0,recentBlockHash:T,skipPreflight:F=!0}=k||{};if(b.map(async(_,x)=>{f[x].length&&_.sign(f[x]),T&&(_.message.recentBlockhash=T)}),(O=this.owner)!=null&&O.isKeyPair){console.log("Sending transaction using Helius Sender");for(let _ of b){let x=await Jo(_)}return{txIds:[],signedTxs:[]}}if(this.signAllTransactions){let _=await this.signAllTransactions(b.slice(S,b.length)),x=[...b.slice(0,S),..._];if(B){let L=0,H=[],E=async()=>{if(!x[L])return;if(L<S){H.push({txId:"",status:"success",signedTx:x[L]}),I==null||I([...H]),L++,E();return}let R=await this.connection.sendTransaction(x[L],{skipPreflight:F});H.push({txId:R,status:"sent",signedTx:x[L]}),I==null||I([...H]),L++;let ue=!1,se=null,ie=null,z=ee=>{se!==null&&clearInterval(se),ie!==null&&this.connection.removeSignatureListener(ie);let ae=H.findIndex(ot=>ot.txId===R);if(ae>-1){if(H[ae].status==="error"||H[ae].status==="success")return;H[ae].status=ee.err?"error":"success"}I==null||I([...H]),ee.err||E()};this.loopMultiTxStatus&&(se=setInterval(async()=>{var ee;if(ue){clearInterval(se);return}try{let ae=await this.connection.getTransaction(R,{commitment:"confirmed",maxSupportedTransactionVersion:0});ae&&(ue=!0,clearInterval(se),z({err:((ee=ae.meta)==null?void 0:ee.err)||null}),console.log("tx status from getTransaction:",R))}catch(ae){ue=!0,clearInterval(se),console.error("getTransaction timeout:",ae,R)}},Ut)),ie=this.connection.onSignature(R,ee=>{if(ue){this.connection.removeSignatureListener(ie);return}ue=!0,z(ee)},"confirmed"),this.connection.getSignatureStatus(R)};return E(),{txIds:[],signedTxs:x}}else{let L=[];for(let H=0;H<x.length;H+=1){let E=await this.connection.sendTransaction(x[H],{skipPreflight:F});L.push(E)}return{txIds:L,signedTxs:x}}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:s||{}}}};var Bn=(...n)=>n.map(e=>{try{return typeof e=="object"?JSON.stringify(e):e}catch{return e}}).join(", "),$e=class{constructor({scope:e,moduleName:t}){this.disabled=!1;this.scope=e,this.logger=re(t)}createTxBuilder(e){return this.scope.checkOwner(),new Gt({connection:this.scope.connection,feePayer:e||this.scope.ownerPubKey,cluster:this.scope.cluster,owner:this.scope.owner,blockhashCommitment:this.scope.blockhashCommitment,loopMultiTxStatus:this.scope.loopMultiTxStatus,api:this.scope.api,signAllTransactions:this.scope.signAllTransactions})}logDebug(...e){this.logger.debug(Bn(e))}logInfo(...e){this.logger.info(Bn(e))}logAndCreateError(...e){let t=Bn(e);throw new Error(t)}checkDisabled(){(this.disabled||!this.scope)&&this.logAndCreateError("module not working")}};import{PublicKey as wf}from"@solana/web3.js";import hf from"bn.js";import{AccountLayout as If,TOKEN_2022_PROGRAM_ID as Sf,TOKEN_PROGRAM_ID as Cf}from"@solana/spl-token";import{PublicKey as Fl}from"@solana/web3.js";import{MintLayout as Ol,TOKEN_PROGRAM_ID as Wl}from"@solana/spl-token";import{Keypair as Up,PublicKey as Gp,SystemProgram as Hp,TransactionInstruction as zp}from"@solana/web3.js";import jp from"bn.js";import{ASSOCIATED_TOKEN_PROGRAM_ID as Jp,TOKEN_2022_PROGRAM_ID as $p,TOKEN_PROGRAM_ID as ef}from"@solana/spl-token";import{PublicKey as cs}from"@solana/web3.js";import Oi,{isBN as Di}from"bn.js";import{bits as Hl,BitStructure as zl,blob as $o,Blob as Zl,cstr as jl,f32 as Ql,f32be as Yl,f64 as Jl,f64be as $l,greedy as em,Layout as es,ns64 as tm,ns64be as nm,nu64 as im,nu64be as rm,offset as ts,s16 as om,s16be as sm,s24 as am,s24be as um,s32 as ns,s32be as cm,s40 as lm,s40be as mm,s48 as dm,s48be as pm,s8 as fm,seq as is,struct as bm,Structure as rs,u16 as os,u16be as gm,u24 as ym,u24be as Pm,u32 as ss,u32be as Am,u40 as wm,u40be as km,u48 as hm,u48be as Tm,u8 as as,UInt as us,union as Bm,Union as xm,unionLayoutDiscriminator as Im,utf8 as Sm}from"@solana/buffer-layout";var xn=es,Ri=rs;var In=us;var Mi=as,Xe=os;var vi=ss;var Ce=ns;var Fi=is;var le=$o;var Ei=ts;var et=class extends xn{constructor(t,i,r){super(t,r);this.blob=le(t),this.signed=i}decode(t,i=0){let r=new Oi(this.blob.decode(t,i),10,"le");return this.signed?r.fromTwos(this.span*8).clone():r}encode(t,i,r=0){return typeof t=="number"&&(t=new Oi(t)),this.signed&&(t=t.toTwos(this.span*8)),this.blob.encode(t.toArrayLike(Buffer,"le",this.span),i,r)}};function U(n){return new In(1,n)}function nt(n){return new In(4,n)}function y(n){return new et(8,!1,n)}function $(n){return new et(16,!1,n)}function Wi(n){return new et(8,!0,n)}function _i(n){return new et(16,!0,n)}var tt=class extends xn{constructor(t,i,r,o){super(t.span,o);this.layout=t,this.decoder=i,this.encoder=r}decode(t,i){return this.decoder(this.layout.decode(t,i))}encode(t,i,r){return this.layout.encode(this.encoder(t),i,r)}getSpan(t,i){return this.layout.getSpan(t,i)}};function v(n){return new tt(le(32),e=>new cs(e),e=>e.toBuffer(),n)}function Cn(n){return new tt(Mi(),ls,ms,n)}function ls(n){if(n===0)return!1;if(n===1)return!0;throw new Error("Invalid bool: "+n)}function ms(n){return n?1:0}function ds(n){let e=vi("length"),t=q([e,le(Ei(e,-e.span),"data")]);return new tt(t,({data:i})=>i,i=>({data:i}),n)}function ye(n){return new tt(ds(),e=>e.toString("utf-8"),e=>Buffer.from(e,"utf-8"),n)}var Sn=class extends Ri{decode(e,t){return super.decode(e,t)}};function q(n,e,t){return new Sn(n,e,t)}function Z(n,e,t){let i,r=typeof e=="number"?e:Di(e)?e.toNumber():new Proxy(e,{get(o,s){if(!i){let a=Reflect.get(o,"count");i=Di(a)?a.toNumber():a,Reflect.set(o,"count",i)}return Reflect.get(o,s)},set(o,s,a){return s==="count"&&(i=a),Reflect.set(o,s,a)}});return Fi(n,r,t)}import hp from"bn.js";import pe from"bn.js";var Kn=new pe(0),Vi=new pe(1),qi=new pe(-1),Pe=new pe(1).shln(64),Ui=new pe(1).shln(128),Nn=Pe.sub(Vi);var ps=Ui.subn(1),it=-443636,bt=-it,Ln=new pe("4295048016"),Rn=new pe("79226673521066979257578248091"),Wm=new pe("4295048017"),_m=new pe("79226673521066979257578248090");var fs=new pe(10).pow(new pe(6));var Vm=new pe("18446744073700000000");import up from"bn.js";var zm=Buffer.from("amm_config","utf8"),Zm=Buffer.from("pool","utf8"),jm=Buffer.from("pool_vault","utf8"),Qm=Buffer.from("pool_reward_vault","utf8"),Ym=Buffer.from("position","utf8"),Jm=Buffer.from("tick_array","utf8"),$m=Buffer.from("operation","utf8"),ed=Buffer.from("pool_tick_array_bitmap_extension","utf8"),td=Buffer.from("observation","utf8");function Mn(n){return ge([Buffer.from("metadata","utf8"),Qe.toBuffer(),n.toBuffer()],Qe)}var nd=Buffer.from("locked_position","utf8");var id=Buffer.from("support_mint","utf8");import{PublicKey as Ed}from"@solana/web3.js";import{TOKEN_2022_PROGRAM_ID as Dd}from"@solana/spl-token";import _d from"bn.js";import sd from"bn.js";var En=14;var Xt=60;var As=q([le(8),U("bump"),Xe("index"),v(""),nt("protocolFeeRate"),nt("tradeFeeRate"),Xe("tickSpacing"),Z(y(),8,"")]),ws=q([nt("blockTimestamp"),Wi("tickCumulative"),Z(y(),4)]),$i=q([le(8),Cn("initialized"),y("recentEpoch"),Xe("observationIndex"),v("poolId"),Z(ws,100,"observations"),Z(y(),4)]),ks=q([U("rewardState"),y("openTime"),y("endTime"),y("lastUpdateTime"),$("emissionsPerSecondX64"),y("rewardTotalEmissioned"),y("rewardClaimed"),v("tokenMint"),v("tokenVault"),v("creator"),$("rewardGrowthGlobalX64")]),Qi=q([le(8),U("bump"),v("ammConfig"),v("creator"),v("mintA"),v("mintB"),v("vaultA"),v("vaultB"),v("observationId"),U("mintDecimalsA"),U("mintDecimalsB"),Xe("tickSpacing"),$("liquidity"),$("sqrtPriceX64"),Ce("tickCurrent"),nt(),$("feeGrowthGlobalX64A"),$("feeGrowthGlobalX64B"),y("protocolFeesTokenA"),y("protocolFeesTokenB"),$("swapInAmountTokenA"),$("swapOutAmountTokenB"),$("swapInAmountTokenB"),$("swapOutAmountTokenA"),U("status"),Z(U(),7,""),Z(ks,3,"rewardInfos"),Z(y(),16,"tickArrayBitmap"),y("totalFeesTokenA"),y("totalFeesClaimedTokenA"),y("totalFeesTokenB"),y("totalFeesClaimedTokenB"),y("fundFeesTokenA"),y("fundFeesTokenB"),y("startTime"),Z(y(),15*4-3,"padding")]),hs=q([$("growthInsideLastX64"),y("rewardAmountOwed")]),Yi=q([le(8),U("bump"),v("nftMint"),v("poolId"),Ce("tickLower"),Ce("tickUpper"),$("liquidity"),$("feeGrowthInsideLastX64A"),$("feeGrowthInsideLastX64B"),y("tokenFeesOwedA"),y("tokenFeesOwedB"),Z(hs,3,"rewardInfos"),Z(y(),8,"")]),Rp=q([le(8),U("bump"),v("poolId"),Ce("tickLowerIndex"),Ce("tickUpperIndex"),$("liquidity"),$("feeGrowthInsideLastX64A"),$("feeGrowthInsideLastX64B"),y("tokenFeesOwedA"),y("tokenFeesOwedB"),Z($(),3,"rewardGrowthInside"),Z(y(),8,"")]),Ts=q([Ce("tick"),_i("liquidityNet"),$("liquidityGross"),$("feeGrowthOutsideX64A"),$("feeGrowthOutsideX64B"),Z($(),3,"rewardGrowthsOutsideX64"),Z(nt(),13,"")]),zi=q([le(8),v("poolId"),Ce("startTickIndex"),Z(Ts,Xt,"ticks"),U("initializedTickCount"),Z(U(),115,"")]),Bs=q([le(329),Z(v(),100,"whitelistMints")]),Ps=q([le(8),v("poolId"),Z(Z(y(),8),En,"positiveTickArrayBitmap"),Z(Z(y(),8),En,"negativeTickArrayBitmap")]),Mp=q([y(),U("bump"),v("owner"),v("poolId"),v("positionId"),v("nftAccount"),Z(y(),8)]),vp=q([le(8),U("bump"),v("lockOwner"),v("poolId"),v("positionId"),v("nftAccount"),v("lockNftMint"),y("recentEpoch"),Z(y(),8)]);$i.span;var lf=re("Raydium_Clmm");var Cs=Buffer.from("vault_auth_seed","utf8"),pb=Buffer.from("global_config","utf8"),Ks=Buffer.from("pool","utf8"),Ns=Buffer.from("pool_vault","utf8"),Ls=Buffer.from("pool_vesting","utf8"),Rs=Buffer.from("platform_config","utf8");function He(n){return ge([Cs],n)}function Ht(n,e,t){return ge([Ks,e.toBuffer(),t.toBuffer()],n)}function On(n,e,t){return ge([Ns,e.toBuffer(),t.toBuffer()],n)}function zt(n){return ge([Buffer.from("__event_authority","utf8")],n)}function Dn(n,e){return ge([Rs,e.toBuffer()],n)}function Wn(n,e,t){return ge([Ls,e.toBuffer(),t.toBuffer()],n)}import{SystemProgram as Pt,TransactionInstruction as Oe}from"@solana/web3.js";import{ASSOCIATED_TOKEN_PROGRAM_ID as er}from"@solana/spl-token";import tr from"bn.js";var De={initialize:Buffer.from([175,175,109,31,13,152,155,237]),buyExactIn:Buffer.from([250,234,13,123,213,156,19,236]),buyExactOut:Buffer.from([24,211,116,40,105,3,153,56]),sellExactIn:Buffer.from([149,39,222,155,211,124,152,26]),sellExactOut:Buffer.from([95,200,71,34,8,9,11,166]),createVestingAccount:Buffer.from([129,178,2,13,217,172,230,218]),claimVestedToken:Buffer.from([49,33,104,30,189,157,79,35]),createPlatformConfig:Buffer.from([176,90,196,175,253,113,220,20]),claimPlatformFee:Buffer.from([156,39,208,135,76,237,61,72]),updatePlaformConfig:Buffer.from([195,60,76,129,146,45,67,143])};function nr(n,e,t,i,r,o,s,a,c,u,l,m,d,p,b,f,P,h,w,A,k,B){let I=q([U("decimals"),ye("name"),ye("symbol"),ye("uri")]),S=q([y("totalLockedAmount"),y("cliffPeriod"),y("unlockPeriod")]),T=q([U("index"),y("supply"),y("totalFundRaisingB"),U("migrateType")]),F=q([U("index"),y("supply"),y("totalSellA"),y("totalFundRaisingB"),U("migrateType")]),O=[{pubkey:e,isSigner:!0,isWritable:!1},{pubkey:t,isSigner:!1,isWritable:!1},{pubkey:i,isSigner:!1,isWritable:!1},{pubkey:r,isSigner:!1,isWritable:!1},{pubkey:o,isSigner:!1,isWritable:!1},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!0,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!1},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:m,isSigner:!1,isWritable:!0},{pubkey:d,isSigner:!1,isWritable:!1},{pubkey:p,isSigner:!1,isWritable:!1},{pubkey:Qe,isSigner:!1,isWritable:!1},{pubkey:Pt.programId,isSigner:!1,isWritable:!1},{pubkey:pn,isSigner:!1,isWritable:!1},{pubkey:zt(n).publicKey,isSigner:!1,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!1}],_=Buffer.alloc(Buffer.from(f,"utf-8").length+Buffer.from(P,"utf-8").length+Buffer.from(h,"utf-8").length+4*3+1),x=Buffer.alloc(S.span),L=Buffer.alloc(w.type==="ConstantCurve"?F.span:T.span);return I.encode({decimals:b,name:f,symbol:P,uri:h},_),w.type==="ConstantCurve"?F.encode(Q(X({index:0},w),{migrateType:w.migrateType==="amm"?0:1}),L):w.type==="FixedCurve"?T.encode(Q(X({index:1},w),{migrateType:w.migrateType==="amm"?0:1}),L):w.type==="LinearCurve"&&T.encode(Q(X({index:2},w),{migrateType:w.migrateType==="amm"?0:1}),L),S.encode({totalLockedAmount:A,cliffPeriod:k,unlockPeriod:B},x),new Oe({keys:O,programId:n,data:Buffer.from([...De.initialize,..._,...L,...x])})}function ir(n,e,t,i,r,o,s,a,c,u,l,m,d,p,b,f,P,h){let w=q([y("amountB"),y("minAmountA"),y("shareFeeRate")]),A=[{pubkey:e,isSigner:!0,isWritable:!1},{pubkey:t,isSigner:!1,isWritable:!1},{pubkey:i,isSigner:!1,isWritable:!1},{pubkey:r,isSigner:!1,isWritable:!1},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!1},{pubkey:m,isSigner:!1,isWritable:!1},{pubkey:d,isSigner:!1,isWritable:!1},{pubkey:p,isSigner:!1,isWritable:!1},{pubkey:zt(n).publicKey,isSigner:!1,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!1}];h&&A.push({pubkey:h,isSigner:!1,isWritable:!0}),console.log({amountB:b.toString(),minAmountA:f.toString()});let k=Buffer.alloc(w.span);return w.encode({amountB:b,minAmountA:f,shareFeeRate:P!=null?P:new tr(0)},k),new Oe({keys:A,programId:n,data:Buffer.from([...De.buyExactIn,...k])})}function rr(n,e,t,i,r,o,s,a,c,u,l,m,d,p,b,f,P,h){let w=q([y("amountA"),y("minAmountB"),y("shareFeeRate")]),A=[{pubkey:e,isSigner:!0,isWritable:!1},{pubkey:t,isSigner:!1,isWritable:!1},{pubkey:i,isSigner:!1,isWritable:!1},{pubkey:r,isSigner:!1,isWritable:!1},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!1},{pubkey:m,isSigner:!1,isWritable:!1},{pubkey:d,isSigner:!1,isWritable:!1},{pubkey:p,isSigner:!1,isWritable:!1},{pubkey:zt(n).publicKey,isSigner:!1,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!1}];h&&A.push({pubkey:h,isSigner:!1,isWritable:!0});let k=Buffer.alloc(w.span);return w.encode({amountA:b,minAmountB:f,shareFeeRate:P!=null?P:new tr(0)},k),new Oe({keys:A,programId:n,data:Buffer.from([...De.sellExactIn,...k])})}function or(n,e,t,i,r,o,s,a,c){let u=q([]),l=[{pubkey:e,isSigner:!0,isWritable:!1},{pubkey:t,isSigner:!1,isWritable:!1},{pubkey:i,isSigner:!1,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!1},{pubkey:c,isSigner:!1,isWritable:!1},{pubkey:Pt.programId,isSigner:!1,isWritable:!1},{pubkey:er,isSigner:!1,isWritable:!1}],m=Buffer.alloc(u.span);return u.encode({},m),new Oe({keys:l,programId:n,data:Buffer.from([...De.claimVestedToken,...m])})}function sr(n,e,t,i,r,o){let s=q([y("shareAmount")]),a=[{pubkey:e,isSigner:!0,isWritable:!1},{pubkey:t,isSigner:!1,isWritable:!0},{pubkey:i,isSigner:!1,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:Pt.programId,isSigner:!1,isWritable:!1}],c=Buffer.alloc(s.span);return s.encode({shareAmount:o},c),new Oe({keys:a,programId:n,data:Buffer.from([...De.createVestingAccount,...c])})}function _n(n,e,t,i,r,o,s,a,c){let u=[{pubkey:e,isSigner:!0,isWritable:!0},{pubkey:t,isSigner:!1,isWritable:!1},{pubkey:i,isSigner:!1,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:Pt.programId,isSigner:!1,isWritable:!0},{pubkey:er,isSigner:!1,isWritable:!0}];return new Oe({keys:u,programId:n,data:De.claimPlatformFee})}function ar(n,e,t,i,r,o,s,a,c,u,l){let m=q([y("platformScale"),y("creatorScale"),y("burnScale"),y("feeRate"),ye("name"),ye("web"),ye("img")]),d=[{pubkey:e,isSigner:!0,isWritable:!0},{pubkey:t,isSigner:!1,isWritable:!1},{pubkey:i,isSigner:!1,isWritable:!1},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:Pt.programId,isSigner:!1,isWritable:!1}],p=Buffer.alloc(8*4+Buffer.from(c,"utf-8").length+Buffer.from(u,"utf-8").length+Buffer.from(l,"utf-8").length+4*3);return m.encode({platformScale:s.platformScale,creatorScale:s.creatorScale,burnScale:s.burnScale,feeRate:a,name:c,web:u,img:l},p),new Oe({keys:d,programId:n,data:Buffer.from([...De.createPlatformConfig,...p])})}function ur(n,e,t,i){let r=[{pubkey:e,isSigner:!0,isWritable:!1},{pubkey:t,isSigner:!1,isWritable:!0}],o;if(i.type==="updateClaimFeeWallet"){let s=q([U("index"),v("value")]);o=Buffer.alloc(s.span),s.encode({index:0,value:i.value},o)}else if(i.type==="updateLockNftWallet"){let s=q([U("index"),v("value")]);o=Buffer.alloc(s.span),s.encode({index:1,value:i.value},o)}else if(i.type==="migrateCpLockNftScale"){let s=q([U("index"),y("platformScale"),y("creatorScale"),y("burnScale")]);o=Buffer.alloc(s.span),s.encode(X({index:2},i.value),o)}else if(i.type==="updateFeeRate"){let s=q([U("index"),y("value")]);o=Buffer.alloc(s.span),s.encode({index:3,value:i.value},o)}else if(i.type==="updateImg"||i.type==="updateName"||i.type==="updateWeb"){let s=q([U("index"),ye("value")]);o=Buffer.alloc(Buffer.from(i.value,"utf-8").length+4+1*1),i.type==="updateName"?s.encode({index:4,value:i.value},o):i.type==="updateWeb"?s.encode({index:5,value:i.value},o):i.type==="updateImg"&&s.encode({index:6,value:i.value},o)}else if(i.type==="updateCpConfigId"){r.push({pubkey:i.value,isSigner:!1,isWritable:!1});let s=q([U("index")]);o=Buffer.alloc(s.span),s.encode({index:7},o)}else if(i.type==="updateAll"){console.log("Please note that this update will overwrite all data in the platform account with the new data."),r.push({pubkey:i.value.cpConfigId,isSigner:!1,isWritable:!1});let s=q([U("index"),v("platformClaimFeeWallet"),v("platformLockNftWallet"),y("platformScale"),y("creatorScale"),y("burnScale"),y("feeRate"),ye("name"),ye("web"),ye("img")]);o=Buffer.alloc(1+32+32+8*4+4*3+Buffer.from(i.value.name,"utf-8").length+Buffer.from(i.value.web,"utf-8").length+Buffer.from(i.value.img,"utf-8").length),s.encode({index:8,platformClaimFeeWallet:i.value.platformClaimFeeWallet,platformLockNftWallet:i.value.platformLockNftWallet,platformScale:i.value.migrateCpLockNftScale.platformScale,creatorScale:i.value.migrateCpLockNftScale.creatorScale,burnScale:i.value.migrateCpLockNftScale.burnScale,feeRate:i.value.feeRate,name:i.value.name,web:i.value.web,img:i.value.img},o)}else throw Error("updateInfo params type error");return new Oe({keys:r,programId:n,data:Buffer.from([...De.updatePlaformConfig,...o])})}import{NATIVE_MINT as Jt,TOKEN_PROGRAM_ID as de,createAssociatedTokenAccountIdempotentInstruction as kt}from"@solana/spl-token";import G from"bn.js";import{PublicKey as mr}from"@solana/web3.js";var rt=q([y(),y("epoch"),U("curveType"),Xe("index"),y("migrateFee"),y("tradeFeeRate"),y("maxShareFeeRate"),y("minSupplyA"),y("maxLockRate"),y("minSellRateA"),y("minMigrateRateA"),y("minFundRaisingB"),v("mintB"),v("protocolFeeOwner"),v("migrateFeeOwner"),v("migrateToAmmWallet"),v("migrateToCpmmWallet"),Z(y(),16)]),Ms=q([y("totalLockedAmount"),y("cliffPeriod"),y("unlockPeriod"),y("startTime"),y("totalAllocatedShare")]),Ke=q([y(),y("epoch"),U("bump"),U("status"),U("mintDecimalsA"),U("mintDecimalsB"),U("migrateType"),y("supply"),y("totalSellA"),y("virtualA"),y("virtualB"),y("realA"),y("realB"),y("totalFundRaisingB"),y("protocolFee"),y("platformFee"),y("migrateFee"),Ms.replicate("vestingSchedule"),v("configId"),v("platformId"),v("mintA"),v("mintB"),v("vaultA"),v("vaultB"),v("creator"),Z(y(),8)]),xb=q([y(),y("epoch"),v("poolId"),v("beneficiary"),y("claimedAmount"),y("tokenShareAmount"),Z(y(),8)]),Zt=q([y(),y("epoch"),v("platformClaimFeeWallet"),v("platformLockNftWallet"),y("platformScale"),y("creatorScale"),y("burnScale"),y("feeRate"),Z(U(),64,"name"),Z(U(),256,"web"),Z(U(),256,"img"),v("cpConfigId"),Z(U(),224)]);import Be from"bn.js";import At from"bn.js";var We=class{static getPoolInitPriceByPool({poolInfo:e,decimalA:t,decimalB:i}){throw Error()}static getPoolInitPriceByInit({a:e,b:t,decimalA:i,decimalB:r}){throw Error()}static getPoolPrice({poolInfo:e,decimalA:t,decimalB:i}){throw Error()}static getPoolEndPrice({supply:e,totalSell:t,totalLockedAmount:i,totalFundRaising:r,migrateFee:o,decimalA:s,decimalB:a}){throw Error()}static getPoolEndPriceReal({poolInfo:e,decimalA:t,decimalB:i}){throw Error()}static getInitParam({supply:e,totalFundRaising:t,totalSell:i,totalLockedAmount:r,migrateFee:o}){throw Error()}static buyExactIn({poolInfo:e,amount:t}){throw Error()}static buyExactOut({poolInfo:e,amount:t}){throw Error()}static sellExactIn({poolInfo:e,amount:t}){throw Error()}static sellExactOut({poolInfo:e,amount:t}){throw Error()}};var jt=class extends We{static getPoolInitPriceByPool({poolInfo:e,decimalA:t,decimalB:i}){return new V(e.virtualB.toString()).div(e.virtualA.toString()).mul(10**(t-i))}static getPoolInitPriceByInit({a:e,b:t,decimalA:i,decimalB:r}){return new V(t.toString()).div(e.toString()).mul(10**(i-r))}static getPoolPrice({poolInfo:e,decimalA:t,decimalB:i}){return new V(e.virtualB.add(e.realB).toString()).div(e.virtualA.sub(e.realA).toString()).mul(10**(t-i))}static getPoolEndPrice({supply:e,totalSell:t,totalLockedAmount:i,totalFundRaising:r,migrateFee:o,decimalA:s,decimalB:a}){return new V(r.sub(o).toString()).div(e.sub(t).sub(i).toString()).mul(10**(s-a))}static getPoolEndPriceReal({poolInfo:e,decimalA:t,decimalB:i}){let r=e.totalSellA.sub(e.realA),o=e.totalFundRaisingB.sub(e.realB);return new V(e.virtualB.add(e.realB.add(o)).toString()).div(e.virtualA.sub(e.realA.add(r)).toString()).mul(10**(t-i))}static getInitParam({supply:e,totalFundRaising:t,totalSell:i,totalLockedAmount:r,migrateFee:o}){if(e.lte(i))throw Error("supply need gt total sell");let s=e.sub(i).sub(r);if(s.lte(new At(0)))throw Error("supplyMinusSellLocked <= 0");let a=t.sub(o);if(a.lte(new At(0)))throw Error("tfMinusMf <= 0");let c=a.mul(i).mul(i).div(s),u=a.mul(i).div(s).sub(t);if(u.lt(new At(0)))throw Error("supply/totalSell/totalLockedAmount diff too high");let l=c.div(u),m=t.mul(t).div(u);if(l.lt(new At(0))||m.lt(new At(0)))throw Error("invalid input 0");return{a:l,b:m,c:i}}static buyExactIn({poolInfo:e,amount:t}){return this.getAmountOut({amountIn:t,inputReserve:e.virtualB.add(e.realB),outputReserve:e.virtualA.sub(e.realA)})}static buyExactOut({poolInfo:e,amount:t}){return this.getAmountIn({amountOut:t,inputReserve:e.virtualB.add(e.realB),outputReserve:e.virtualA.sub(e.realA)})}static sellExactIn({poolInfo:e,amount:t}){return this.getAmountOut({amountIn:t,inputReserve:e.virtualA.sub(e.realA),outputReserve:e.virtualB.add(e.realB)})}static sellExactOut({poolInfo:e,amount:t}){return this.getAmountIn({amountOut:t,inputReserve:e.virtualA.sub(e.realA),outputReserve:e.virtualB.add(e.realB)})}static getAmountOut({amountIn:e,inputReserve:t,outputReserve:i}){let r=e.mul(i),o=t.add(e);return r.div(o)}static getAmountIn({amountOut:e,inputReserve:t,outputReserve:i}){let r=t.mul(e),o=i.sub(e);return Dt(r,o)}};import cr from"bn.js";var Qt=class extends We{static getPoolInitPriceByPool({poolInfo:e,decimalA:t,decimalB:i}){return new V(e.virtualB.toString()).div(e.virtualA.toString()).mul(10**(t-i))}static getPoolInitPriceByInit({a:e,b:t,decimalA:i,decimalB:r}){return new V(t.toString()).div(e.toString()).mul(10**(i-r))}static getPoolPrice({poolInfo:e,decimalA:t,decimalB:i}){return new V(e.virtualB.toString()).div(e.virtualA.toString()).mul(10**(t-i))}static getPoolEndPrice({supply:e,totalSell:t,totalLockedAmount:i,totalFundRaising:r,migrateFee:o,decimalA:s,decimalB:a}){return new V(r.sub(o).toString()).div(e.sub(t).sub(i).toString()).mul(10**(s-a))}static getPoolEndPriceReal({poolInfo:e,decimalA:t,decimalB:i}){let r=e.totalSellA.sub(e.realA),o=e.totalFundRaisingB.sub(e.realB);return new V(e.virtualB.add(e.realB).add(o).toString()).div(e.virtualA.sub(e.realA).add(r).toString()).mul(10**(t-i))}static getInitParam({supply:e,totalFundRaising:t,totalSell:i,totalLockedAmount:r,migrateFee:o}){let s=e.sub(r);if(s.lte(new cr(0)))throw Error("invalid input 1");let a=new cr(2).mul(t).sub(o),u=t.mul(s).div(a);return{a:u,b:t,c:u}}static buyExactIn({poolInfo:e,amount:t}){return this.getAmountOut({amountIn:t,initInput:e.virtualB,initOutput:e.virtualA})}static buyExactOut({poolInfo:e,amount:t}){return this.getAmountIn({amountOut:t,initInput:e.virtualB,initOutput:e.virtualA})}static sellExactIn({poolInfo:e,amount:t}){return this.getAmountOut({amountIn:t,initInput:e.virtualA,initOutput:e.virtualB})}static sellExactOut({poolInfo:e,amount:t}){return this.getAmountIn({amountOut:t,initInput:e.virtualA,initOutput:e.virtualB})}static getAmountOut({amountIn:e,initInput:t,initOutput:i}){return i.mul(e).div(t)}static getAmountIn({amountOut:e,initInput:t,initOutput:i}){let r=t.mul(e);return Dt(r,i)}};import me from"bn.js";import lr from"bn.js";var wt=class{static _multipler(e){return new V(10).pow(e)}static getPrice({priceX64:e,decimalA:t,decimalB:i}){return new V(e.toString()).div(this._Q64).mul(this._multipler(t)).div(this._multipler(i))}static getPriceX64({price:e,decimalA:t,decimalB:i}){let r=e.mul(this._multipler(i)).div(this._multipler(t));return new lr(r.mul(this._Q64).toFixed(0))}};wt._Q64=new V(new lr(1).shln(64).toString());var Yt=class extends We{static getPoolInitPriceByPool({poolInfo:e,decimalA:t,decimalB:i}){return new V(0)}static getPoolInitPriceByInit({a:e,b:t,decimalA:i,decimalB:r}){return new V(0)}static getPoolPrice({poolInfo:e,decimalA:t,decimalB:i}){return new V(e.virtualA.mul(e.realA).toString()).div(wt._Q64).mul(10**(t-i))}static getPoolEndPrice({supply:e,totalSell:t,totalLockedAmount:i,totalFundRaising:r,migrateFee:o,decimalA:s,decimalB:a}){return new V(r.sub(o).toString()).div(e.sub(t).sub(i).toString()).mul(10**(s-a))}static getPoolEndPriceReal({poolInfo:e,decimalA:t,decimalB:i}){let r=e.totalSellA.sub(e.realA),o=e.totalFundRaisingB.sub(e.realB);return new V(e.virtualB.add(e.realB).add(o).toString()).div(e.virtualA.sub(e.realA).add(r).toString()).mul(10**(t-i))}static getInitParam({supply:e,totalFundRaising:t,totalSell:i,totalLockedAmount:r,migrateFee:o}){let s=e.sub(r);if(s.lte(new me(0)))throw Error("supplyMinusLocked need gt 0");let a=t.mul(new me(3)).sub(o),u=t.mul(new me(2)).mul(s).div(a),l=u.mul(u),m=t.mul(new me(2)).mul(Pe).div(l);if(!m.gt(new me(0)))throw Error("a need gt 0");if(!Nn.gt(m))throw Error("a need lt u64 max");return{a:m,b:new me(0),c:u}}static buyExactIn({poolInfo:e,amount:t}){let i=e.realB.add(t),r=new me(2).mul(i).mul(Pe).div(e.virtualA);return new me(new V(r.toString()).sqrt().toFixed(0)).sub(e.realA)}static buyExactOut({poolInfo:e,amount:t}){let i=e.realA.add(t),r=i.mul(i),{div:o,mod:s}=e.virtualA.mul(r).divmod(new me(2).mul(Pe));return(s.isZero()?o:o.add(new me(1))).sub(e.realB)}static sellExactIn({poolInfo:e,amount:t}){let i=e.realA.sub(t),r=i.mul(i),{div:o,mod:s}=e.virtualA.mul(r).divmod(new me(2).mul(Pe)),a=s.isZero()?o:o.add(new me(1));return e.realB.sub(a)}static sellExactOut({poolInfo:e,amount:t}){let i=e.realB.sub(t),r=new me(2).mul(i).mul(Pe).div(e.virtualA),o=new me(new V(r.toString()).sqrt().toFixed(0));return e.realA.sub(o)}};var xe=class{static getPoolCurvePointByPoolInfo({curveType:e,pointCount:t,poolInfo:i}){return this.getPoolCurvePointByInit({curveType:e,pointCount:t,supply:i.supply,totalFundRaising:i.totalFundRaisingB,totalSell:i.totalSellA,totalLockedAmount:i.vestingSchedule.totalLockedAmount,migrateFee:i.migrateFee,decimalA:i.mintDecimalsA,decimalB:i.mintDecimalsB})}static getPoolCurvePointByInit({curveType:e,pointCount:t,supply:i,totalFundRaising:r,totalSell:o,totalLockedAmount:s,migrateFee:a,decimalA:c,decimalB:u}){if(t<3)throw Error("point count < 3");let l=this.getCurve(e),m=l.getInitParam({supply:i,totalFundRaising:r,totalSell:o,totalLockedAmount:s,migrateFee:a}),d=l.getPoolInitPriceByInit(Q(X({},m),{decimalA:c,decimalB:u})),p=r.div(new Be(t-1)),b=new Be(0),f=[{price:d,totalSellSupply:0}],{a:P,b:h}=m,w=b,A=b;for(let k=1;k<t;k++){let B=k!==t-1?p:r.sub(A),I=this.buyExactIn({poolInfo:{virtualA:P,virtualB:h,realA:w,realB:A,totalFundRaisingB:r,totalSellA:o},amountB:B,protocolFeeRate:b,platformFeeRate:b,curveType:e,shareFeeRate:b});w=w.add(I.amountA),A=A.add(I.amountB);let S=this.getPrice({poolInfo:{virtualA:P,virtualB:h,realA:w,realB:A},decimalA:c,decimalB:u,curveType:e});f.push({price:S,totalSellSupply:new V(w.toString()).div(10**c).toNumber()})}return f}static getPoolInitPriceByPool({poolInfo:e,decimalA:t,decimalB:i,curveType:r}){return this.getCurve(r).getPoolInitPriceByPool({poolInfo:e,decimalA:t,decimalB:i})}static getPoolInitPriceByInit({a:e,b:t,decimalA:i,decimalB:r,curveType:o}){return this.getCurve(o).getPoolInitPriceByInit({a:e,b:t,decimalA:i,decimalB:r})}static getPrice({poolInfo:e,curveType:t,decimalA:i,decimalB:r}){return this.getCurve(t).getPoolPrice({poolInfo:e,decimalA:i,decimalB:r})}static getEndPrice({poolInfo:e,curveType:t,decimalA:i,decimalB:r}){return this.getCurve(t).getPoolPrice({poolInfo:e,decimalA:i,decimalB:r})}static getPoolEndPriceReal({poolInfo:e,curveType:t,decimalA:i,decimalB:r}){return this.getCurve(t).getPoolEndPriceReal({poolInfo:e,decimalA:i,decimalB:r})}static checkParam({supply:e,totalFundRaising:t,totalSell:i,totalLockedAmount:r,decimals:o,config:s,migrateType:a}){if(Number(o)!==6)throw Error("decimals = 6");if(e.mul(s.maxLockRate).div(qe).lt(r))throw Error("total lock amount gte max lock amount");if(e.lt(s.minSupplyA.mul(new Be(10**o))))throw Error("supply lt min supply");let u=e.mul(s.minSellRateA).div(qe);if(i.lt(u))throw Error("invalid input");if(t.lt(s.minFundRaisingB))throw Error("total fund raising lt min fund raising");let l=e.sub(i).sub(r),m=e.mul(s.minMigrateRateA).div(qe);if(l.lt(m))throw Error("migrate lt min migrate amount");let d=e.sub(i).sub(r),p=new Be(new V(d.mul(t).toString()).sqrt().toFixed(0));if(a==="amm"){let b=new Be(10).pow(new Be(o));if(p.lte(b))throw Error("check migrate lp error")}else if(a==="cpmm"){let b=new Be(100);if(p.lte(b))throw Error("check migrate lp error")}else throw Error("migrate type error")}static buyExactIn({poolInfo:e,amountB:t,protocolFeeRate:i,platformFeeRate:r,curveType:o,shareFeeRate:s}){let a=i.add(s).add(r),c=this.calculateFee({amount:t,feeRate:a}),u=t.sub(c),l=this.getCurve(o),m=l.buyExactIn({poolInfo:e,amount:u}),d=e.totalSellA.sub(e.realA),p,b,f;if(m.gt(d)){p=d;let h=l.buyExactOut({poolInfo:e,amount:p});b=this.calculatePreFee({postFeeAmount:h,feeRate:a}),f=b.sub(h)}else p=m,b=t,f=c;let P=this.splitFee({totalFee:f,protocolFeeRate:i,platformFeeRate:r,shareFeeRate:s});return{amountA:p,amountB:b,splitFee:P}}static buyExactOut({poolInfo:e,amountA:t,protocolFeeRate:i,platformFeeRate:r,curveType:o,shareFeeRate:s}){let a=e.totalSellA.sub(e.realA),c=t;t.gt(a)&&(c=a);let l=this.getCurve(o).buyExactOut({poolInfo:e,amount:t}),m=i.add(s).add(r),d=this.calculatePreFee({postFeeAmount:l,feeRate:m}),p=d.sub(l),b=this.splitFee({totalFee:p,protocolFeeRate:i,platformFeeRate:r,shareFeeRate:s});return{amountA:c,amountB:d,splitFee:b}}static sellExactIn({poolInfo:e,amountA:t,protocolFeeRate:i,platformFeeRate:r,curveType:o,shareFeeRate:s}){let c=this.getCurve(o).sellExactIn({poolInfo:e,amount:t}),u=this.calculateFee({amount:c,feeRate:i.add(s).add(r)}),l=this.splitFee({totalFee:u,protocolFeeRate:i,platformFeeRate:r,shareFeeRate:s});return{amountA:t,amountB:c.sub(u),splitFee:l}}static sellExactOut({poolInfo:e,amountB:t,protocolFeeRate:i,platformFeeRate:r,curveType:o,shareFeeRate:s}){let a=i.add(s).add(r),c=this.calculatePreFee({postFeeAmount:t,feeRate:a});if(e.realB.lt(c))throw Error("Insufficient liquidity");let u=c.sub(t),m=xe.getCurve(o).sellExactOut({poolInfo:e,amount:c});if(m.gt(e.realA))throw Error();let d=this.splitFee({totalFee:u,protocolFeeRate:i,platformFeeRate:r,shareFeeRate:s});return{amountA:m,amountB:t,splitFee:d}}static splitFee({totalFee:e,protocolFeeRate:t,platformFeeRate:i,shareFeeRate:r}){let o=t.add(i).add(r),s=o.isZero()?new Be(0):e.mul(i).div(o),a=o.isZero()?new Be(0):e.mul(r).div(o),c=e.sub(s).sub(a);return{platformFee:s,shareFee:a,protocolFee:c}}static calculateFee({amount:e,feeRate:t}){return Ai(e,t,qe)}static calculatePreFee({postFeeAmount:e,feeRate:t}){if(t.isZero())return e;let i=e.mul(qe),r=qe.sub(t);return i.add(r).sub(new Be(1)).div(r)}static getCurve(e){switch(e){case 0:return jt;case 1:return Qt;case 2:return Yt}throw Error("find curve error")}};var ze={initPriceX64:new G("515752397214619"),supply:new G(1e15),totalSellA:new G(7931e11),totalFundRaisingB:new G(85e9),totalLockedAmount:new G("0"),cliffPeriod:new G("0"),unlockPeriod:new G("0"),decimals:6,virtualA:new G("1073471847374405"),virtualB:new G("30050573465"),realA:new G(0),realB:new G(0),protocolFee:new G(0),platformId:new mr("4Bu96XjU84XjPDSpveTVf6LYGCkfW5FK7SNkREWcEfV4"),vestingSchedule:{totalLockedAmount:new G(0),cliffPeriod:new G(0),unlockPeriod:new G(0),startTime:new G(0),totalAllocatedShare:new G(0)}},$t=new G(1e4),Vn=class extends $e{constructor(e){super(e)}async createLaunchpad(F){var O=F,{programId:e=Te,authProgramId:t,platformId:i=ze.platformId,mintA:r,decimals:o=6,mintBDecimals:s=9,name:a,symbol:c,uri:u,migrateType:l,configId:m,configInfo:d,platformFeeRate:p,txVersion:b,computeBudgetConfig:f,txTipConfig:P,feePayer:h,buyAmount:w,minMintAAmount:A,slippage:k,associatedOnly:B=!0,checkCreateATAOwner:I=!1,extraSigners:S}=O,T=_e(O,["programId","authProgramId","platformId","mintA","decimals","mintBDecimals","name","symbol","uri","migrateType","configId","configInfo","platformFeeRate","txVersion","computeBudgetConfig","txTipConfig","feePayer","buyAmount","minMintAAmount","slippage","associatedOnly","checkCreateATAOwner","extraSigners"]);var Un,Gn,Xn,Hn,zn,Zn;let _=this.createTxBuilder(h);t=t!=null?t:He(e).publicKey;let x=d;if(!x&&m){let Ae=await this.scope.connection.getAccountInfo(m);Ae&&(x=rt.decode(Ae.data))}x||this.logAndCreateError("config not found");let L=x.mintB,H=x.curveType,{publicKey:E}=Ht(e,r,L),{publicKey:R}=On(e,E,r),{publicKey:ue}=On(e,E,L),{publicKey:se}=Mn(r);console.log(`create token: ${r.toBase58()}, mintB: ${L.toBase58()}, decimals A:${o}/B:${s}, config:${m.toBase58()}`),c.length>10&&this.logAndCreateError("Symbol length should shorter than 11"),u||this.logAndCreateError("uri should not empty"),w.lte(new G(0))&&this.logAndCreateError("buy amount should gt 0:",w.toString());let ie=(Un=T==null?void 0:T.supply)!=null?Un:ze.supply,z=(Gn=T==null?void 0:T.totalSellA)!=null?Gn:ze.totalSellA,ee=(Xn=T==null?void 0:T.totalFundRaisingB)!=null?Xn:ze.totalFundRaisingB,ae=(Hn=T==null?void 0:T.totalLockedAmount)!=null?Hn:new G(0),ot=p;if(!p){let Ae=await this.scope.connection.getAccountInfo(i);Ae||this.logAndCreateError("platform id not found:",i.toString()),ot=Zt.decode(Ae.data).feeRate}let qn=xe.getCurve(x.curveType).getInitParam({supply:ie,totalFundRaising:ee,totalSell:z,totalLockedAmount:ae,migrateFee:x.migrateFee}),Ie={epoch:new G(896),bump:254,status:0,mintDecimalsA:o,mintDecimalsB:s,supply:ie,totalSellA:z,mintA:new mr(r),mintB:L,virtualA:qn.a,virtualB:qn.b,realA:ze.realA,realB:ze.realB,migrateFee:x.migrateFee,migrateType:l==="amm"?0:1,protocolFee:ze.protocolFee,platformFee:ot,platformId:i,configId:m,vaultA:R,vaultB:ue,creator:this.scope.ownerPubKey,totalFundRaisingB:ee,vestingSchedule:{totalLockedAmount:ae,cliffPeriod:new G(0),unlockPeriod:new G(0),startTime:new G(0),totalAllocatedShare:new G(0)}},dr=xe.getCurve(x.curveType),{c:pr}=dr.getInitParam({supply:Ie.supply,totalFundRaising:Ie.totalFundRaisingB,totalLockedAmount:ae,totalSell:x.curveType===0?Ie.totalSellA:new G(0),migrateFee:x.migrateFee});try{xe.checkParam({supply:Ie.supply,totalFundRaising:Ie.totalFundRaisingB,totalSell:pr,totalLockedAmount:ae,decimals:Ie.mintDecimalsA,config:x,migrateType:l}),console.log("check init params success")}catch(Ae){this.logAndCreateError(`check create mint params failed, ${Ae.message}`)}_.addInstruction({instructions:[nr(e,h!=null?h:this.scope.ownerPubKey,this.scope.ownerPubKey,m,i,t,E,r,L,R,ue,se,de,de,o,a,c,u||"https://",{type:H===0?"ConstantCurve":H===1?"FixedCurve":H===2?"LinearCurve":"ConstantCurve",totalSellA:z,migrateType:l,supply:ie,totalFundRaisingB:ee},ae,(zn=T==null?void 0:T.cliffPeriod)!=null?zn:new G(0),(Zn=T==null?void 0:T.unlockPeriod)!=null?Zn:new G(0))]});let en=new G(0),tn;if(S!=null&&S.length&&_.addInstruction({signers:S}),!T.createOnly){let{builder:Ae,extInfo:fr}=await this.buyToken({programId:e,authProgramId:t,mintA:r,mintB:L,poolInfo:Ie,buyAmount:w,minMintAAmount:A,shareFeeRate:T.shareFeeRate,shareFeeReceiver:T.shareFeeReceiver,configInfo:x,platformFeeRate:ot,slippage:k,associatedOnly:B,checkCreateATAOwner:I});_.addInstruction(X({},Ae.AllTxData)),en=fr.outAmount,tn=(this.scope.cluster==="devnet"||b===1)&&T.shareFeeReceiver?[Ae.allInstructions[0]]:void 0}return _.addTipInstruction(P),b===0?_.sizeCheckBuildV0({computeBudgetConfig:f,outAmount:en,splitIns:tn,address:Q(X({},Ie),{poolId:E})}):_.sizeCheckBuild({computeBudgetConfig:f,outAmount:en,splitIns:tn,address:Q(X({},Ie),{poolId:E})})}async buyToken({programId:e=Te,authProgramId:t,mintA:i,mintB:r=Jt,poolInfo:o,configInfo:s,platformFeeRate:a,txVersion:c,computeBudgetConfig:u,txTipConfig:l,feePayer:m,buyAmount:d,minMintAAmount:p,slippage:b,shareFeeRate:f=new G(0),shareFeeReceiver:P,associatedOnly:h=!0,checkCreateATAOwner:w=!1}){d.lte(new G(0))&&this.logAndCreateError("buy amount should gt 0:",d.toString());let A=this.createTxBuilder(m),{publicKey:k}=Ht(e,i,r);t=t!=null?t:He(e).publicKey;let B=null,I=null,S=r.equals(Jt),{account:T,instructionParams:F}=await this.scope.account.getOrCreateTokenAccount({mint:i,owner:this.scope.ownerPubKey,createInfo:{payer:this.scope.ownerPubKey,amount:0},skipCloseAccount:!0,notUseTokenAccount:!1,associatedOnly:h,checkCreateATAOwner:w});T&&(B=T),A.addInstruction(F||{}),B===void 0&&this.logAndCreateError(`cannot found mintA(${i.toBase58()}) token accounts`,"tokenAccounts",this.scope.account.tokenAccounts);let{account:O,instructionParams:_}=await this.scope.account.getOrCreateTokenAccount({mint:r,owner:this.scope.ownerPubKey,createInfo:S?{payer:this.scope.ownerPubKey,amount:d}:void 0,skipCloseAccount:!S,notUseTokenAccount:S,associatedOnly:S?!1:h,checkCreateATAOwner:w});O&&(I=O),A.addInstruction(_||{}),I===void 0&&this.logAndCreateError(`cannot found mintB(${r.toBase58()}) token accounts`,"tokenAccounts",this.scope.account.tokenAccounts);let x=o;if(!x){let z=await this.scope.connection.getAccountInfo(k,{commitment:"processed"});z||this.logAndCreateError("cannot found pool:",k.toBase58()),x=Ke.decode(z.data)}let L=s,H=await Ue(this.scope.connection,[L?void 0:x.configId,a?void 0:x.platformId].filter(Boolean).map(z=>({pubkey:z})));if(!L){let z=H.find(ee=>ee.pubkey.equals(x.configId));(!z||!z.accountInfo)&&this.logAndCreateError("config not found: ",x.configId.toBase58()),L=rt.decode(z.accountInfo.data)}if(!a){let z=H.find(ee=>ee.pubkey.equals(x.platformId));(!z||!z.accountInfo)&&this.logAndCreateError("platform info not found: ",x.configId.toBase58()),a=Zt.decode(z.accountInfo.data).feeRate}let E=xe.buyExactIn({poolInfo:x,amountB:d,protocolFeeRate:L.tradeFeeRate,platformFeeRate:a,curveType:L.curveType,shareFeeRate:f}),R=new V(E.amountA.toString()),ue=b?new V($t.sub(b).toNumber()/$t.toNumber()).clampedTo(0,1):new V(1),se=p!=null?p:b?new G(R.mul(ue).toFixed(0)):E.amountA;E.amountB.lt(d)&&console.log(`maximum ${i.toBase58()} amount can buy is ${E.amountA.toString()}, input ${r.toBase58()} amount: ${E.amountB.toString()}`);let ie=P?Ee(P,r,de).publicKey:void 0;return ie&&A.addInstruction({instructions:[kt(this.scope.ownerPubKey,ie,P,r)]}),A.addInstruction({instructions:[ir(e,this.scope.ownerPubKey,t,x.configId,x.platformId,k,B,I,x.vaultA,x.vaultB,i,r,de,de,E.amountB.lt(d)?E.amountB:d,se,f,ie)]}),A.addCustomComputeBudget(u),A.addTipInstruction(l),A.versionBuild({txVersion:c,extInfo:{outAmount:se}})}async sellToken({programId:e=Te,authProgramId:t,mintA:i,mintB:r=Jt,poolInfo:o,configInfo:s,platformFeeRate:a,txVersion:c,computeBudgetConfig:u,txTipConfig:l,feePayer:m,sellAmount:d,minAmountB:p,slippage:b,shareFeeRate:f=new G(0),shareFeeReceiver:P,associatedOnly:h=!0,checkCreateATAOwner:w=!1}){t=t!=null?t:He(e).publicKey;let A=this.createTxBuilder(m);d.lte(new G(0))&&this.logAndCreateError("sell amount should be gt 0");let{publicKey:k}=Ht(e,i,r),B=null,I=null,S=r.equals(Jt),{account:T,instructionParams:F}=await this.scope.account.getOrCreateTokenAccount({mint:i,owner:this.scope.ownerPubKey,createInfo:void 0,skipCloseAccount:!0,notUseTokenAccount:!1,associatedOnly:h,checkCreateATAOwner:w});T&&(B=T),A.addInstruction(F||{}),B===void 0&&this.logAndCreateError("cannot found mintA token accounts","tokenAccounts",this.scope.account.tokenAccounts);let{account:O,instructionParams:_}=await this.scope.account.getOrCreateTokenAccount({mint:r,owner:this.scope.ownerPubKey,createInfo:S?{payer:this.scope.ownerPubKey,amount:0}:void 0,skipCloseAccount:!S,notUseTokenAccount:S,associatedOnly:S?!1:h,checkCreateATAOwner:w});O&&(I=O),A.addInstruction(_||{}),I===void 0&&this.logAndCreateError("cannot found mintB token accounts","tokenAccounts",this.scope.account.tokenAccounts);let x=o;if(!x){let z=await this.scope.connection.getAccountInfo(k,{commitment:"processed"});z||this.logAndCreateError("cannot found pool",k.toBase58()),x=Ke.decode(z.data)}let L=s,H=await Ue(this.scope.connection,[L?void 0:x.configId,a?void 0:x.platformId].filter(Boolean).map(z=>({pubkey:z})));if(!L){let z=H.find(ee=>ee.pubkey.equals(x.configId));(!z||!z.accountInfo)&&this.logAndCreateError("config not found: ",x.configId.toBase58()),L=rt.decode(z.accountInfo.data)}if(!a){let z=H.find(ee=>ee.pubkey.equals(x.platformId));(!z||!z.accountInfo)&&this.logAndCreateError("platform info not found: ",x.configId.toBase58()),a=Zt.decode(z.accountInfo.data).feeRate}let E=xe.sellExactIn({poolInfo:x,amountA:d,protocolFeeRate:L.tradeFeeRate,platformFeeRate:a,curveType:L.curveType,shareFeeRate:f}),R=new V(E.amountB.toString()),ue=b?new V($t.sub(b).toNumber()/$t.toNumber()).clampedTo(0,1):new V(1),se=p!=null?p:b?new G(R.mul(ue).toFixed(0)):E.amountB;se.lte(new G(0))&&this.logAndCreateError(`out ${r.toBase58()} amount should be gt 0`);let ie=P?Ee(P,r,de).publicKey:void 0;return ie&&A.addInstruction({instructions:[kt(this.scope.ownerPubKey,ie,P,r)]}),A.addInstruction({instructions:[rr(e,this.scope.ownerPubKey,t,x.configId,x.platformId,k,B,I,x.vaultA,x.vaultB,i,r,de,de,E.amountA.lt(d)?E.amountA:d,se,f,ie)]}),A.addCustomComputeBudget(u),A.addTipInstruction(l),A.versionBuild({txVersion:c,extInfo:{outAmount:se}})}async createPlatformConfig({programId:e=Te,platformAdmin:t,platformClaimFeeWallet:i,platformLockNftWallet:r,cpConfigId:o,migrateCpLockNftScale:s,feeRate:a,name:c,web:u,img:l,txVersion:m,computeBudgetConfig:d,txTipConfig:p,feePayer:b}){let f=this.createTxBuilder(b),{publicKey:P}=Dn(e,t);return f.addInstruction({instructions:[ar(e,t,i,r,P,o,s,a,c,u,l)]}),f.addCustomComputeBudget(d),f.addTipInstruction(p),f.versionBuild({txVersion:m,extInfo:{platformId:P}})}async updatePlatformConfig({programId:e=Te,platformAdmin:t,platformId:i,updateInfo:r,txVersion:o,computeBudgetConfig:s,txTipConfig:a,feePayer:c}){let u=this.createTxBuilder(c),l=i!=null?i:Dn(e,t).publicKey;return u.addInstruction({instructions:[ur(e,t,l,r)]}),u.addCustomComputeBudget(s),u.addTipInstruction(a),u.versionBuild({txVersion:o})}async claimPlatformFee({programId:e=Te,authProgramId:t,platformId:i,poolId:r,platformClaimFeeWallet:o,mintB:s,vaultB:a,mintBProgram:c=de,txVersion:u,computeBudgetConfig:l,txTipConfig:m,feePayer:d}){var h;let p=this.createTxBuilder(d);t=t!=null?t:He(e).publicKey;let b=s,f=a;if(!b){let w=await this.scope.connection.getAccountInfo(r,{commitment:"processed"});w||this.logAndCreateError("cannot found pool:",r.toBase58());let A=Ke.decode(w.data),k=await this.scope.connection.getAccountInfo(A.configId,{commitment:"processed"});k||this.logAndCreateError("cannot found config:",A.configId.toBase58()),b=rt.decode(k.data).mintB,f=f!=null?f:A.vaultB}(!b||!f)&&this.logAndCreateError("cannot found mint info, mintB: ",b.toBase58(),", vaultB: ",(h=f==null?void 0:f.toBase58())!=null?h:"");let P=Ee(this.scope.ownerPubKey,b,de).publicKey;return p.addInstruction({instructions:[kt(this.scope.ownerPubKey,P,this.scope.ownerPubKey,b)]}),p.addInstruction({instructions:[_n(e,o,t,r,i,f,P,b,c)]}),p.addCustomComputeBudget(l),p.addTipInstruction(m),p.versionBuild({txVersion:u})}async claimAllPlatformFee({programId:e=Te,authProgramId:t,platformId:i,platformClaimFeeWallet:r,txVersion:o,computeBudgetConfig:s,txTipConfig:a,feePayer:c}){let u=this.createTxBuilder(c);return t=t!=null?t:He(e).publicKey,(await this.scope.connection.getProgramAccounts(e,{filters:[{dataSize:Ke.span},{memcmp:{offset:Ke.offsetOf("platformId"),bytes:i.toString()}}]})).forEach(m=>{let d=Ke.decode(m.account.data),p=Ee(this.scope.ownerPubKey,d.mintB,de).publicKey;u.addInstruction({instructions:[kt(this.scope.ownerPubKey,p,this.scope.ownerPubKey,d.mintB)]}),u.addInstruction({instructions:[_n(e,r,t,m.pubkey,i,d.vaultB,p,d.mintB,de)]})}),u.addTipInstruction(a),o===0?u.sizeCheckBuildV0({computeBudgetConfig:s}):u.sizeCheckBuild({computeBudgetConfig:s})}async createVesting({programId:e=Te,poolId:t,beneficiary:i,shareAmount:r,txVersion:o,computeBudgetConfig:s,txTipConfig:a,feePayer:c}){let u=this.createTxBuilder(c),l=Wn(e,t,i).publicKey;return u.addInstruction({instructions:[sr(e,this.scope.ownerPubKey,i,t,l,r)]}),u.addCustomComputeBudget(s),u.addTipInstruction(a),u.versionBuild({txVersion:o})}async claimVesting({programId:e=Te,poolId:t,poolInfo:i,txVersion:r,computeBudgetConfig:o,txTipConfig:s,feePayer:a,associatedOnly:c=!0,checkCreateATAOwner:u=!1}){let l=this.createTxBuilder(a),m=He(e).publicKey,d=Wn(e,t,this.scope.ownerPubKey).publicKey,p=i;if(!p){let f=await this.scope.connection.getAccountInfo(t);f||this.logAndCreateError("pool not found"),p=Ke.decode(f.data)}let b=Ee(this.scope.ownerPubKey,p.mintA,de).publicKey;return l.addInstruction({instructions:[kt(this.scope.ownerPubKey,b,this.scope.ownerPubKey,p.mintA)]}),l.addInstruction({instructions:[or(e,this.scope.ownerPubKey,m,t,d,b,p.vaultA,p.mintA,de)]}),l.addCustomComputeBudget(o),l.addTipInstruction(s),l.versionBuild({txVersion:r})}async getRpcPoolInfo({poolId:e}){return(await this.getRpcPoolsInfo({poolIdList:[e]})).poolInfoMap[e.toBase58()]}async getRpcPoolsInfo({poolIdList:e,config:t}){let i=await Ue(this.scope.connection,e.map(c=>({pubkey:c})),t),r={},o=[];for(let c=0;c<e.length;c++){let u=i[c];if(u===null||!u.accountInfo)throw Error("fetch pool info error: "+e[c].toBase58());let l=Ke.decode(u.accountInfo.data);r[e[c].toBase58()]=Q(X({},l),{poolId:u.accountInfo.owner}),o.push(l.configId)}let s=await Ue(this.scope.connection,o.map(c=>({pubkey:c})),t),a={};for(let c=0;c<o.length;c++){let u=s[c];if(u===null||!u.accountInfo)throw Error("fetch config info error: "+o[c].toBase58());let l=rt.decode(u.accountInfo.data);a[o[c].toBase58()]=Q(X({},l),{configId:u.accountInfo.owner})}return{poolInfoMap:Object.keys(r).reduce((c,u)=>Q(X({},c),{[u]:Q(X({},r[u]),{configInfo:a[r[u].configId.toBase58()]})}),{})}}};export{ze as LaunchpadPoolInitParam,Vn as default};
//# sourceMappingURL=launchpad.mjs.map